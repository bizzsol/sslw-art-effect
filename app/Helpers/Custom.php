<?php
bolt_decrypt( __FILE__ , 'e6uBfH'); return 0;
##!!!##Cm5hbWVzcGFjZSBBcHBcSGVscGVyczsKCnVzZSBBcHBcTW9kZWxzXEVtcGxveWVlOwp1c2UgQXBwXE1vZGVsc1xIclxMb2NhdGlvbjsKdXNlIEFwcFxNb2RlbHNcSHJcU2FsYXJ5QWRqdXN0TWFzdGVyOwp1c2UgQXBwXE1vZGVsc1xIclxVbml0Owp1c2UgQXBwXE1vZGVsc1xNZXJjaFxNck9yZGVyQm9va2luZzsKdXNlIEFwcFxNb2RlbHNcTWVyY2hcT3JkZXJCT007CnVzZSBBcHBcTW9kZWxzXE1lcmNoXE9yZGVyQm9tQ29zdGluZ0Jvb2tpbmc7CnVzZSBBcHBcTW9kZWxzXE1lcmNoXFBvQm9va2luZzsKdXNlIEFwcFxNb2RlbHNcTWVyY2hcUG9Cb29raW5nRGV0YWlsOwp1c2UgREI7Ci8qKgogKiBDcmVhdGUgY3VzdG9tIGZ1bmN0aW9uCiAqLwoKY2xhc3MgQ3VzdG9tCnsKICAgIC8vIFJ1YmVsIHN0YXJ0CiAgICBzdGF0aWMgcHVibGljIGZ1bmN0aW9uIGNpbnB1dCgkbmFtZSwkdHlwZT0ndGV4dCcsJGlkPScnLCRjbGFzcz0nJywkcGxhY2Vob2xkZXI9JycsJHZhbHVlPScnLCRyZWFkb25seT0nJykKICAgIHsKICAgICAgICAkcmVhZG9ubHkgPSAhZW1wdHkoJHJlYWRvbmx5KT8ncmVhZG9ubHk9InJlYWRvbmx5Iic6Jyc7CiAgICAgICAgcmV0dXJuICc8aW5wdXQgdHlwZT0iJy4kdHlwZS4nIiBjbGFzcz0iZm9ybS1jb250cm9sICcuJGNsYXNzLiciIG5hbWU9IicuJG5hbWUuJyIgaWQ9IicuJGlkLiciIHZhbHVlPSInLiR2YWx1ZS4nIiBwbGFjZWhvbGRlcj0iJy4kcGxhY2Vob2xkZXIuJyIgc3R5bGU9ImJvcmRlcjogbm9uZTsgYmFja2dyb3VuZC1jb2xvcjogI2ZmZiIgJy4kcmVhZG9ubHkuJz4nOwogICAgfQoKICAgIHN0YXRpYyBwdWJsaWMgZnVuY3Rpb24gaWZJc3NldCgmJHZhbHVlLCAkY3VzdG9tVmFsdWUgPSAnJykKICAgIHsKICAgICAgICBpZighZW1wdHkoJGN1c3RvbVZhbHVlKSkgewogICAgICAgICAgICByZXR1cm4gJGN1c3RvbVZhbHVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAoaXNzZXQoJHZhbHVlKSkgPyAkdmFsdWUgOiAnJzsKICAgICAgICB9CiAgICB9CgogICAgc3RhdGljIHB1YmxpYyBmdW5jdGlvbiBnZXRVbml0TmFtZSgkdW5pdCkKICAgIHsKICAgICAgICBpZihpc19udW1lcmljKCR1bml0KSkgewogICAgICAgICAgICAkdW5pdEZpcnN0ID0gVW5pdDo6d2hlcmUoJ2hyX3VuaXRfaWQnLCR1bml0KS0+Zmlyc3QoKTsKICAgICAgICAgICAgaWYoIWVtcHR5KCR1bml0Rmlyc3QpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHVuaXRGaXJzdC0+aHJfdW5pdF9zaG9ydF9uYW1lOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuICR1bml0OwogICAgICAgIH0KICAgIH0KCiAgICBzdGF0aWMgcHVibGljIGZ1bmN0aW9uIHNzZWxlY3RlZCgkdmFsdWUxLCAkdmFsdWUyKQogICAgewogICAgICAgIGlmKCR2YWx1ZTEgPT0gJHZhbHVlMikgewogICAgICAgICAgICByZXR1cm4gInNlbGVjdGVkPSdzZWxlY3RlZCciOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJyc7CiAgICB9CgogICAgc3RhdGljIHB1YmxpYyBmdW5jdGlvbiBnZXRJdGVtUG9Db3VudCgkY29zdGluZ0Jvb2tpbmdJZCwkb3JkZXJJZCkKICAgIHsKICAgICAgICAkd2hlcmUgPSBbCiAgICAgICAgICAgICdtcl9vcmRlcl9lbnRyeV9vcmRlcl9pZCcgPT4gJG9yZGVySWQsCiAgICAgICAgICAgICdtcl9vcmRlcl9ib21fY29zdGluZ19ib29raW5nX2lkJyA9PiAkY29zdGluZ0Jvb2tpbmdJZAogICAgICAgIF07CiAgICAgICAgJHBvQm9va2luZ0RldGFpbHMgPSBQb0Jvb2tpbmdEZXRhaWw6OndoZXJlKCR3aGVyZSktPmdyb3VwQnkoJ21yX29yZGVyX2JvbV9jb3N0aW5nX2Jvb2tpbmdfaWQnKS0+Z2V0KCktPnRvQXJyYXkoKTsKICAgICAgICByZXR1cm4gJHBvQm9va2luZ0RldGFpbHM7CiAgICB9CgogICAgc3RhdGljIHB1YmxpYyBmdW5jdGlvbiBnZXRPcmRlckJvb2tpbmdRdHlDb2xvcigkcG9Cb29raW5nSWQsJGNvc3RpbmdCb29raW5nSWQsJGl0ZW1JZCwkY2xySWQpCiAgICB7CiAgICAgICAgJHdoZXJlID0gWwogICAgICAgICAgICAnbXJfcG9fYm9va2luZ19pZCcgPT4gJHBvQm9va2luZ0lkLAogICAgICAgICAgICAnbXJfb3JkZXJfYm9tX2Nvc3RpbmdfYm9va2luZ19pZCcgPT4gJGNvc3RpbmdCb29raW5nSWQsCiAgICAgICAgICAgICdtcl9jYXRfaXRlbV9pZCcgPT4gJGl0ZW1JZCwKICAgICAgICAgICAgJ21yX21hdGVyaWFsX2NvbG9yX2lkJyA9PiAkY2xySWQsCiAgICAgICAgICAgICdzaXplJyA9PiBudWxsCiAgICAgICAgXTsKICAgICAgICAkYm9va2luZ0RldGFpbHMgPSBNck9yZGVyQm9va2luZzo6d2hlcmUoJHdoZXJlKS0+Zmlyc3QoKTsKICAgICAgICBpZighZW1wdHkoJGJvb2tpbmdEZXRhaWxzKSkgewogICAgICAgICAgICByZXR1cm4gJGJvb2tpbmdEZXRhaWxzLT5ib29raW5nX3F0eTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgfQogICAgfQoKICAgIHN0YXRpYyBwdWJsaWMgZnVuY3Rpb24gZ2V0T3JkZXJCb29raW5nVmFsdWVRdHlDb2xvcigkcG9Cb29raW5nSWQsJGNvc3RpbmdCb29raW5nSWQsJGl0ZW1JZCwkY2xySWQpCiAgICB7CiAgICAgICAgJHdoZXJlID0gWwogICAgICAgICAgICAnbXJfcG9fYm9va2luZ19pZCcgPT4gJHBvQm9va2luZ0lkLAogICAgICAgICAgICAnbXJfb3JkZXJfYm9tX2Nvc3RpbmdfYm9va2luZ19pZCcgPT4gJGNvc3RpbmdCb29raW5nSWQsCiAgICAgICAgICAgICdtcl9jYXRfaXRlbV9pZCcgPT4gJGl0ZW1JZCwKICAgICAgICAgICAgJ21yX21hdGVyaWFsX2NvbG9yX2lkJyA9PiAkY2xySWQsCiAgICAgICAgICAgICdzaXplJyA9PiBudWxsCiAgICAgICAgXTsKICAgICAgICAkYm9va2luZ0RldGFpbHMgPSBNck9yZGVyQm9va2luZzo6d2hlcmUoJHdoZXJlKS0+Zmlyc3QoKTsKICAgICAgICBpZighZW1wdHkoJGJvb2tpbmdEZXRhaWxzKSkgewogICAgICAgICAgICByZXR1cm4gJGJvb2tpbmdEZXRhaWxzLT52YWx1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICB9CgogICAgc3RhdGljIHB1YmxpYyBmdW5jdGlvbiBnZXRPcmRlckJvb2tpbmdSZVF0eUNvbG9yKCRjb3N0aW5nQm9va2luZ0lkLCRpdGVtSWQsJGNscklkKQogICAgewogICAgICAgICR3aGVyZSA9IFsKICAgICAgICAgICAgJ21yX29yZGVyX2JvbV9jb3N0aW5nX2Jvb2tpbmdfaWQnID0+ICRjb3N0aW5nQm9va2luZ0lkLAogICAgICAgICAgICAnbXJfY2F0X2l0ZW1faWQnID0+ICRpdGVtSWQsCiAgICAgICAgICAgICdtcl9tYXRlcmlhbF9jb2xvcl9pZCcgPT4gJGNscklkLAogICAgICAgICAgICAnc2l6ZScgPT4gbnVsbAogICAgICAgIF07CiAgICAgICAgJGJvb2tpbmdEZXRhaWxzID0gTXJPcmRlckJvb2tpbmc6OndoZXJlKCR3aGVyZSk7CiAgICAgICAgaWYoJGJvb2tpbmdEZXRhaWxzLT5jb3VudCgpID4gMCkgewogICAgICAgICAgICAkcmVzdWx0Wydib29raW5nUXR5J10gPSAkYm9va2luZ0RldGFpbHMtPnN1bSgnYm9va2luZ19xdHknKTsKICAgICAgICAgICAgJHJlc3VsdFsncmVxUXR5J10gPSAkYm9va2luZ0RldGFpbHMtPmZpcnN0KCk7CiAgICAgICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICB9CiAgICB9CgogICAgc3RhdGljIHB1YmxpYyBmdW5jdGlvbiBnZXRPcmRlckJvb2tpbmdRdHlTaXplKCRwb0Jvb2tpbmdJZCwkY29zdGluZ0Jvb2tpbmdJZCwkaXRlbUlkLCRzaXplSWQpCiAgICB7CiAgICAgICAgJHdoZXJlID0gWwogICAgICAgICAgICAnbXJfcG9fYm9va2luZ19pZCcgPT4gJHBvQm9va2luZ0lkLAogICAgICAgICAgICAnbXJfb3JkZXJfYm9tX2Nvc3RpbmdfYm9va2luZ19pZCcgPT4gJGNvc3RpbmdCb29raW5nSWQsCiAgICAgICAgICAgICdtcl9jYXRfaXRlbV9pZCcgPT4gJGl0ZW1JZCwKICAgICAgICAgICAgJ3NpemUnID0+ICRzaXplSWQsCiAgICAgICAgICAgICdtcl9tYXRlcmlhbF9jb2xvcl9pZCcgPT4gbnVsbAogICAgICAgIF07CiAgICAgICAgJGJvb2tpbmdEZXRhaWxzID0gTXJPcmRlckJvb2tpbmc6OndoZXJlKCR3aGVyZSktPmZpcnN0KCk7CiAgICAgICAgaWYoIWVtcHR5KCRib29raW5nRGV0YWlscykpIHsKICAgICAgICAgICAgcmV0dXJuICRib29raW5nRGV0YWlscy0+Ym9va2luZ19xdHk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgIH0KICAgIH0KCiAgICBzdGF0aWMgcHVibGljIGZ1bmN0aW9uIGdldE9yZGVyQm9va2luZ1ZhbHVlUXR5U2l6ZSgkcG9Cb29raW5nSWQsJGNvc3RpbmdCb29raW5nSWQsJGl0ZW1JZCwkc2l6ZUlkKQogICAgewogICAgICAgICR3aGVyZSA9IFsKICAgICAgICAgICAgJ21yX3BvX2Jvb2tpbmdfaWQnID0+ICRwb0Jvb2tpbmdJZCwKICAgICAgICAgICAgJ21yX29yZGVyX2JvbV9jb3N0aW5nX2Jvb2tpbmdfaWQnID0+ICRjb3N0aW5nQm9va2luZ0lkLAogICAgICAgICAgICAnbXJfY2F0X2l0ZW1faWQnID0+ICRpdGVtSWQsCiAgICAgICAgICAgICdzaXplJyA9PiAkc2l6ZUlkLAogICAgICAgICAgICAnbXJfbWF0ZXJpYWxfY29sb3JfaWQnID0+IG51bGwKICAgICAgICBdOwogICAgICAgICRib29raW5nRGV0YWlscyA9IE1yT3JkZXJCb29raW5nOjp3aGVyZSgkd2hlcmUpLT5maXJzdCgpOwogICAgICAgIGlmKCFlbXB0eSgkYm9va2luZ0RldGFpbHMpKSB7CiAgICAgICAgICAgIHJldHVybiAkYm9va2luZ0RldGFpbHMtPnZhbHVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICB9CiAgICB9CgogICAgc3RhdGljIHB1YmxpYyBmdW5jdGlvbiBnZXRPcmRlckJvb2tpbmdSZVF0eVNpemUoJGNvc3RpbmdCb29raW5nSWQsJGl0ZW1JZCwkc2l6ZUlkKQogICAgewogICAgICAgICR3aGVyZSA9IFsKICAgICAgICAgICAgJ21yX29yZGVyX2JvbV9jb3N0aW5nX2Jvb2tpbmdfaWQnID0+ICRjb3N0aW5nQm9va2luZ0lkLAogICAgICAgICAgICAnbXJfY2F0X2l0ZW1faWQnID0+ICRpdGVtSWQsCiAgICAgICAgICAgICdzaXplJyA9PiAkc2l6ZUlkLAogICAgICAgICAgICAnbXJfbWF0ZXJpYWxfY29sb3JfaWQnID0+IG51bGwKICAgICAgICBdOwogICAgICAgICRib29raW5nRGV0YWlscyA9IE1yT3JkZXJCb29raW5nOjp3aGVyZSgkd2hlcmUpOwogICAgICAgIGlmKCRib29raW5nRGV0YWlscy0+Y291bnQoKSA+IDApIHsKICAgICAgICAgICAgJHJlc3VsdFsnYm9va2luZ1F0eSddID0gJGJvb2tpbmdEZXRhaWxzLT5zdW0oJ2Jvb2tpbmdfcXR5Jyk7CiAgICAgICAgICAgICRyZXN1bHRbJ3JlcVF0eSddID0gJGJvb2tpbmdEZXRhaWxzLT5maXJzdCgpOwogICAgICAgICAgICByZXR1cm4gJHJlc3VsdDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgfQogICAgfQoKICAgIHN0YXRpYyBwdWJsaWMgZnVuY3Rpb24gZ2V0T3JkZXJCb29raW5nUXR5Q29sb3JTaXplKCRwb0Jvb2tpbmdJZCwkY29zdGluZ0Jvb2tpbmdJZCwkaXRlbUlkLCRjbHJJZCwkc2l6ZUlkKQogICAgewogICAgICAgICR3aGVyZSA9IFsKICAgICAgICAgICAgJ21yX3BvX2Jvb2tpbmdfaWQnID0+ICRwb0Jvb2tpbmdJZCwKICAgICAgICAgICAgJ21yX29yZGVyX2JvbV9jb3N0aW5nX2Jvb2tpbmdfaWQnID0+ICRjb3N0aW5nQm9va2luZ0lkLAogICAgICAgICAgICAnbXJfY2F0X2l0ZW1faWQnID0+ICRpdGVtSWQsCiAgICAgICAgICAgICdtcl9tYXRlcmlhbF9jb2xvcl9pZCcgPT4gJGNscklkLAogICAgICAgICAgICAnc2l6ZScgPT4gJHNpemVJZAogICAgICAgIF07CiAgICAgICAgJGJvb2tpbmdEZXRhaWxzID0gTXJPcmRlckJvb2tpbmc6OndoZXJlKCR3aGVyZSktPmZpcnN0KCk7CiAgICAgICAgaWYoIWVtcHR5KCRib29raW5nRGV0YWlscykpIHsKICAgICAgICAgICAgcmV0dXJuICRib29raW5nRGV0YWlscy0+Ym9va2luZ19xdHk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgIH0KICAgIH0KCiAgICBzdGF0aWMgcHVibGljIGZ1bmN0aW9uIGdldE9yZGVyQm9va2luZ1ZhbHVlUXR5Q29sb3JTaXplKCRwb0Jvb2tpbmdJZCwkY29zdGluZ0Jvb2tpbmdJZCwkaXRlbUlkLCRjbHJJZCwkc2l6ZUlkKQogICAgewogICAgICAgICR3aGVyZSA9IFsKICAgICAgICAgICAgJ21yX3BvX2Jvb2tpbmdfaWQnID0+ICRwb0Jvb2tpbmdJZCwKICAgICAgICAgICAgJ21yX29yZGVyX2JvbV9jb3N0aW5nX2Jvb2tpbmdfaWQnID0+ICRjb3N0aW5nQm9va2luZ0lkLAogICAgICAgICAgICAnbXJfY2F0X2l0ZW1faWQnID0+ICRpdGVtSWQsCiAgICAgICAgICAgICdtcl9tYXRlcmlhbF9jb2xvcl9pZCcgPT4gJGNscklkLAogICAgICAgICAgICAnc2l6ZScgPT4gJHNpemVJZAogICAgICAgIF07CiAgICAgICAgJGJvb2tpbmdEZXRhaWxzID0gTXJPcmRlckJvb2tpbmc6OndoZXJlKCR3aGVyZSktPmZpcnN0KCk7CiAgICAgICAgaWYoIWVtcHR5KCRib29raW5nRGV0YWlscykpIHsKICAgICAgICAgICAgcmV0dXJuICRib29raW5nRGV0YWlscy0+dmFsdWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgIH0KICAgIH0KCiAgICBzdGF0aWMgcHVibGljIGZ1bmN0aW9uIGdldE9yZGVyQm9va2luZ1JlUXR5Q29sb3JTaXplKCRjb3N0aW5nQm9va2luZ0lkLCRpdGVtSWQsJGNscklkLCRzaXplSWQpCiAgICB7CiAgICAgICAgJHdoZXJlID0gWwogICAgICAgICAgICAnbXJfb3JkZXJfYm9tX2Nvc3RpbmdfYm9va2luZ19pZCcgPT4gJGNvc3RpbmdCb29raW5nSWQsCiAgICAgICAgICAgICdtcl9jYXRfaXRlbV9pZCcgPT4gJGl0ZW1JZCwKICAgICAgICAgICAgJ21yX21hdGVyaWFsX2NvbG9yX2lkJyA9PiAkY2xySWQsCiAgICAgICAgICAgICdzaXplJyA9PiAkc2l6ZUlkCiAgICAgICAgXTsKICAgICAgICAkYm9va2luZ0RldGFpbHMgPSBNck9yZGVyQm9va2luZzo6d2hlcmUoJHdoZXJlKTsKICAgICAgICBpZigkYm9va2luZ0RldGFpbHMtPmNvdW50KCkgPiAwKSB7CiAgICAgICAgICAgICRyZXN1bHRbJ2Jvb2tpbmdRdHknXSA9ICRib29raW5nRGV0YWlscy0+c3VtKCdib29raW5nX3F0eScpOwogICAgICAgICAgICAkcmVzdWx0WydyZXFRdHknXSA9ICRib29raW5nRGV0YWlscy0+Zmlyc3QoKTsKICAgICAgICAgICAgcmV0dXJuICRyZXN1bHQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgIH0KICAgIH0KCiAgICAvL3JrYgogICAgc3RhdGljIHB1YmxpYyBmdW5jdGlvbiBnZXRPcmRlckJvb2tpbmdRdHlOb0RlcGVuZCgkcG9Cb29raW5nSWQsJGNvc3RpbmdCb29raW5nSWQsJGl0ZW1JZCkKICAgIHsKICAgICAgICAkd2hlcmUgPSBbCiAgICAgICAgICAgICdtcl9wb19ib29raW5nX2lkJyA9PiAkcG9Cb29raW5nSWQsCiAgICAgICAgICAgICdtcl9jYXRfaXRlbV9pZCcgPT4gJGl0ZW1JZCwKICAgICAgICAgICAgJ21yX29yZGVyX2JvbV9jb3N0aW5nX2Jvb2tpbmdfaWQnID0+ICRjb3N0aW5nQm9va2luZ0lkLAogICAgICAgICAgICAnbXJfbWF0ZXJpYWxfY29sb3JfaWQnID0+IG51bGwsCiAgICAgICAgICAgICdzaXplJyA9PiBudWxsCiAgICAgICAgXTsKICAgICAgICAkYm9va2luZ0RldGFpbHMgPSBNck9yZGVyQm9va2luZzo6d2hlcmUoJHdoZXJlKS0+Zmlyc3QoKTsKICAgICAgICBpZighZW1wdHkoJGJvb2tpbmdEZXRhaWxzKSkgewogICAgICAgICAgICByZXR1cm4gJGJvb2tpbmdEZXRhaWxzLT5ib29raW5nX3F0eTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgfQogICAgfQoKICAgIHN0YXRpYyBwdWJsaWMgZnVuY3Rpb24gZ2V0T3JkZXJCb29raW5nUmVRdHlOb0RlcGVuZCgkY29zdGluZ0Jvb2tpbmdJZCwkaXRlbUlkKQogICAgewogICAgICAgICR3aGVyZSA9IFsKICAgICAgICAgICAgJ21yX2NhdF9pdGVtX2lkJyA9PiAkaXRlbUlkLAogICAgICAgICAgICAnbXJfb3JkZXJfYm9tX2Nvc3RpbmdfYm9va2luZ19pZCcgPT4gJGNvc3RpbmdCb29raW5nSWQsCiAgICAgICAgICAgICdtcl9tYXRlcmlhbF9jb2xvcl9pZCcgPT4gbnVsbCwKICAgICAgICAgICAgJ3NpemUnID0+IG51bGwKICAgICAgICBdOwogICAgICAgICRib29raW5nRGV0YWlscyA9IE1yT3JkZXJCb29raW5nOjp3aGVyZSgkd2hlcmUpOwogICAgICAgIGlmKCRib29raW5nRGV0YWlscy0+Y291bnQoKSA+IDApIHsKICAgICAgICAgICAgJHJlc3VsdFsnYm9va2luZ1F0eSddID0gJGJvb2tpbmdEZXRhaWxzLT5zdW0oJ2Jvb2tpbmdfcXR5Jyk7CiAgICAgICAgICAgICRyZXN1bHRbJ3JlcVF0eSddID0gJGJvb2tpbmdEZXRhaWxzLT5maXJzdCgpOwogICAgICAgICAgICByZXR1cm4gJHJlc3VsdDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgfQogICAgfQoKICAgIHN0YXRpYyBwdWJsaWMgZnVuY3Rpb24gZ2V0T3JkZXJWYWx1ZVF0eU5vRGVwZW5kKCRwb0Jvb2tpbmdJZCwkY29zdGluZ0Jvb2tpbmdJZCwkaXRlbUlkKQogICAgewogICAgICAgICR3aGVyZSA9IFsKICAgICAgICAgICAgJ21yX3BvX2Jvb2tpbmdfaWQnID0+ICRwb0Jvb2tpbmdJZCwKICAgICAgICAgICAgJ21yX2NhdF9pdGVtX2lkJyA9PiAkaXRlbUlkLAogICAgICAgICAgICAnbXJfb3JkZXJfYm9tX2Nvc3RpbmdfYm9va2luZ19pZCcgPT4gJGNvc3RpbmdCb29raW5nSWQsCiAgICAgICAgICAgICdtcl9tYXRlcmlhbF9jb2xvcl9pZCcgPT4gbnVsbCwKICAgICAgICAgICAgJ3NpemUnID0+IG51bGwKICAgICAgICBdOwogICAgICAgICRib29raW5nRGV0YWlscyA9IE1yT3JkZXJCb29raW5nOjp3aGVyZSgkd2hlcmUpLT5maXJzdCgpOwogICAgICAgIGlmKCFlbXB0eSgkYm9va2luZ0RldGFpbHMpKSB7CiAgICAgICAgICAgIHJldHVybiAkYm9va2luZ0RldGFpbHMtPnZhbHVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICB9CiAgICB9CgogICAgc3RhdGljIHB1YmxpYyBmdW5jdGlvbiBnZXRQb0RldGFpbEl0ZW1FeGlzdCgkcG9JZCwkY29zdGluZ0Jvb2tpbmdJZCkKICAgIHsKICAgICAgICAkd2hlcmUgPSBbCiAgICAgICAgICAgICdtcl9wdXJjaGFzZV9vcmRlcl9wb19pZCcgPT4gJHBvSWQsCiAgICAgICAgICAgICdtcl9vcmRlcl9ib21fY29zdGluZ19ib29raW5nX2lkJyA9PiAkY29zdGluZ0Jvb2tpbmdJZAogICAgICAgIF07CiAgICAgICAgJHBvQm9va2luZ0xpc3QgPSBQb0Jvb2tpbmdEZXRhaWw6OndoZXJlKCR3aGVyZSk7CiAgICAgICAgaWYoJHBvQm9va2luZ0xpc3QtPmNvdW50KCkgPiAwKSB7CiAgICAgICAgICAgICRib29raW5nTGlzdEZpcnN0ID0gJHBvQm9va2luZ0xpc3QtPmZpcnN0KCk7CiAgICAgICAgICAgIGlmKCRib29raW5nTGlzdEZpcnN0LT5tcl9tYXRlcmlhbF9jb2xvcl9pZCAhPSBudWxsIHx8ICRib29raW5nTGlzdEZpcnN0LT5zaXplKSB7CiAgICAgICAgICAgICAgICAkYm9va2luZ1F0eSA9IE1yT3JkZXJCb29raW5nOjp3aGVyZShbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21yX3BvX2Jvb2tpbmdfaWQnID0+ICRib29raW5nTGlzdEZpcnN0LT5tcl9wb19ib29raW5nX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtcl9vcmRlcl9ib21fY29zdGluZ19ib29raW5nX2lkJyA9PiAkY29zdGluZ0Jvb2tpbmdJZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgXSktPnN1bSgncmVxX3F0eScpOwogICAgICAgICAgICAgICAgJHJlcVF0eSA9ICRib29raW5nUXR5OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHJlcVF0eSA9ICRib29raW5nTGlzdEZpcnN0LT5yZXFfcXR5OwogICAgICAgICAgICB9CiAgICAgICAgICAgICRib29raW5nUXR5ID0gTXJPcmRlckJvb2tpbmc6OndoZXJlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbXJfb3JkZXJfYm9tX2Nvc3RpbmdfYm9va2luZ19pZCcgPT4gJGNvc3RpbmdCb29raW5nSWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pLT5zdW0oJ2Jvb2tpbmdfcXR5Jyk7CiAgICAgICAgICAgICRyZXN1bHRRdHkgPSAkcmVxUXR5IC0gJGJvb2tpbmdRdHk7CiAgICAgICAgICAgIGlmKCRyZXN1bHRRdHkgPT0gMCB8fCAkcmVzdWx0UXR5IDwgMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgc3RhdGljIHB1YmxpYyBmdW5jdGlvbiBnZXRPcmRlclN1cHBsaWVyTGlzdCgkb3JkZXJJZCkKICAgIHsKICAgICAgICAkd2hlcmUgPSBbCiAgICAgICAgICAgICdvcmRlcl9pZCcgPT4gJG9yZGVySWQKICAgICAgICBdOwogICAgICAgICRzdXBMaXN0ID0gW107CiAgICAgICAgJHN1cExpc3QgPSBEQjo6dGFibGUoJ21yX29yZGVyX2JvbV9jb3N0aW5nX2Jvb2tpbmcgYXMgYScpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgkd2hlcmUpCiAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbignbXJfc3VwcGxpZXIgYXMgYicsJ2Iuc3VwX2lkJywnYS5tcl9zdXBwbGllcl9zdXBfaWQnKQogICAgICAgICAgICAgICAgICAgIC0+Z3JvdXBCeSgnYi5zdXBfaWQnKQogICAgICAgICAgICAgICAgICAgIC0+cGx1Y2soJ2Iuc3VwX25hbWUnLCdiLnN1cF9pZCcpCiAgICAgICAgICAgICAgICAgICAgLT50b0FycmF5KCk7CiAgICAgICAgaWYoIWVtcHR5KCRzdXBMaXN0KSkgewogICAgICAgICAgICAkcmVzdWx0ID0gW107CiAgICAgICAgICAgICRzdXBFeGlzdCA9IFtdOwogICAgICAgICAgICBmb3JlYWNoKCRzdXBMaXN0IGFzICRzdXBJZD0+JHN1cHBsaWVyTmFtZSl7CiAgICAgICAgICAgICAgICAkd2hlcmUgPSBbCiAgICAgICAgICAgICAgICAgICAgJ21yX29yZGVyX2VudHJ5X29yZGVyX2lkJyA9PiAkb3JkZXJJZAogICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICRwb0Jvb2tpbmdEZXRhaWxzID0gUG9Cb29raW5nRGV0YWlsOjp3aGVyZSgkd2hlcmUpLT5maXJzdCgpOwogICAgICAgICAgICAgICAgaWYoIWVtcHR5KCRwb0Jvb2tpbmdEZXRhaWxzKSkgewogICAgICAgICAgICAgICAgICAgICRzdXBFeGlzdCA9IFBvQm9va2luZzo6d2hlcmUoWydtcl9zdXBwbGllcl9zdXBfaWQnID0+ICRzdXBJZCwgJ2lkJyA9PiAkcG9Cb29raW5nRGV0YWlscy0+bXJfcG9fYm9va2luZ19pZF0pLT5maXJzdCgpOwogICAgICAgICAgICAgICAgICAgIGlmKGVtcHR5KCRzdXBFeGlzdCkpewogICAgICAgICAgICAgICAgICAgICAgICAkcmVzdWx0WyRzdXBJZF0gPSAkc3VwcGxpZXJOYW1lOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJHJlc3VsdFskc3VwSWRdID0gJHN1cHBsaWVyTmFtZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gJHJlc3VsdDsKICAgIH0KCiAgICBzdGF0aWMgcHVibGljIGZ1bmN0aW9uIGdldE9yZGVySXRlbUxpc3QoJG9yZGVySWQsJHN1cHBsaWVySWQ9JycpCiAgICB7CiAgICAgICAgJHdoZXJlID0gWwogICAgICAgICAgICAnb3JkZXJfaWQnID0+ICRvcmRlcklkCiAgICAgICAgXTsKICAgICAgICBpZighZW1wdHkoJHN1cHBsaWVySWQpKXsKICAgICAgICAgICAgJHdoZXJlWydtcl9zdXBwbGllcl9zdXBfaWQnXSA9ICRzdXBwbGllcklkOwogICAgICAgIH0KICAgICAgICAkY29zQm9va2luZ0xpc3QgPSBbXTsKICAgICAgICAkY29zQm9va2luZ0xpc3QgPSBEQjo6dGFibGUoJ21yX3BvX2JvbV9jb3N0aW5nX2Jvb2tpbmcgYXMgYScpCiAgICAgICAgICAgICAgICAgICAgLT5zZWxlY3QoWwogICAgICAgICAgICAgICAgICAgICAgICAnYS5pZCBhcyBjb3NJZCcsCiAgICAgICAgICAgICAgICAgICAgICAgICdhLm9yZGVyX2lkJywKICAgICAgICAgICAgICAgICAgICAgICAgJ2EubXJfY2F0X2l0ZW1faWQnLAogICAgICAgICAgICAgICAgICAgICAgICAnYi5pdGVtX25hbWUnLAogICAgICAgICAgICAgICAgICAgICAgICAnYy5zdXBfbmFtZScKICAgICAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJHdoZXJlKQogICAgICAgICAgICAgICAgICAgIC0+bGVmdEpvaW4oJ21yX2NhdF9pdGVtIGFzIGInLCAnYi5pZCcsICdhLm1yX2NhdF9pdGVtX2lkJykKICAgICAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCdtcl9zdXBwbGllciBhcyBjJywgJ2Muc3VwX2lkJywgJ2EubXJfc3VwcGxpZXJfc3VwX2lkJykKICAgICAgICAgICAgICAgICAgICAvLyAtPnBsdWNrKCdiLml0ZW1fbmFtZScsJ2EuaWQnKQogICAgICAgICAgICAgICAgICAgIC0+Z2V0KCkKICAgICAgICAgICAgICAgICAgICAtPnRvQXJyYXkoKTsKICAgICAgICAkcG9Cb29raW5nRGV0YWlscyA9IFBvQm9va2luZ0RldGFpbDo6d2hlcmUoWydtcl9vcmRlcl9lbnRyeV9vcmRlcl9pZCcgPT4gJG9yZGVySWRdKS0+cGx1Y2soJ21yX29yZGVyX2JvbV9jb3N0aW5nX2Jvb2tpbmdfaWQnLCdpZCcpLT50b0FycmF5KCk7CiAgICAgICAgJHJlc3VsdCA9IFtdOwovKiAgICAgICBpZihlbXB0eSgkcG9Cb29raW5nRGV0YWlscykpIHsKICAgICAgICAgICAgZm9yZWFjaCgkY29zQm9va2luZ0xpc3QgYXMgJGtleT0+JGNvc0Jvb2tpbmcpIHsKICAgICAgICAgICAgICAgICRyZXN1bHRbXSA9ICRjb3NCb29raW5nLT5zdXBfbmFtZS4nKCcuJGNvc0Jvb2tpbmctPml0ZW1fbmFtZS4nKSc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gJHJlc3VsdCA9IGFycmF5X2NvbHVtbigkY29zQm9va2luZ0xpc3QsJ2l0ZW1fbmFtZScpOwogICAgICAgICAgICAvLyAkcmVzdWx0ID0gJGNvc0Jvb2tpbmdMaXN0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZvcmVhY2goJGNvc0Jvb2tpbmdMaXN0IGFzICRrZXk9PiRjb3NCb29raW5nKSB7CiAgICAgICAgICAgICAgIGlmKCFpbl9hcnJheSgkY29zQm9va2luZy0+Y29zSWQsJHBvQm9va2luZ0RldGFpbHMpKSB7CiAgICAgICAgICAgICAgICAgICAgJHJlc3VsdFtdID0gJGNvc0Jvb2tpbmctPnN1cF9uYW1lLicoJy4kY29zQm9va2luZy0+aXRlbV9uYW1lLicpJzsKICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkbXJCb29raW5nID0gTXJPcmRlckJvb2tpbmc6OndoZXJlKFsnbXJfb3JkZXJfYm9tX2Nvc3RpbmdfYm9va2luZ19pZCcgPT4gJGNvc0Jvb2tpbmctPmNvc0lkXSk7CiAgICAgICAgICAgICAgICAgICAgaWYoJG1yQm9va2luZy0+Y291bnQoKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGJvb2tpbmdRdHkgPSBzZWxmOjpmaXhlZE51bWJlcigkbXJCb29raW5nLT5zdW0oJ2Jvb2tpbmdfcXR5JyksMix0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHJlcVF0eSA9ICRtckJvb2tpbmctPmZpcnN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRyZXFRdHktPm1yX21hdGVyaWFsX2NvbG9yX2lkICE9IG51bGwgfHwgJHJlcVF0eS0+c2l6ZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmVxUXR5ID0gTXJPcmRlckJvb2tpbmc6OndoZXJlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbXJfcG9fYm9va2luZ19pZCcgPT4gJHJlcVF0eS0+bXJfcG9fYm9va2luZ19pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbXJfb3JkZXJfYm9tX2Nvc3RpbmdfYm9va2luZ19pZCcgPT4gJGNvc0Jvb2tpbmctPmNvc0lkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKS0+c3VtKCdyZXFfcXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmVxUXR5ID0gc2VsZjo6Zml4ZWROdW1iZXIoJHJlcVF0eSwyLHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlcVF0eSA9IHNlbGY6OmZpeGVkTnVtYmVyKCRyZXFRdHktPnJlcV9xdHksMix0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkcGVyY2VudGFnZSA9IHNlbGY6OmZpeGVkTnVtYmVyKCgkcmVxUXR5IT0wPygkYm9va2luZ1F0eS8kcmVxUXR5KSoxMDA6MCksMix0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHJlc3VsdFtdID0gJGNvc0Jvb2tpbmctPnN1cF9uYW1lLicgKCcuJGNvc0Jvb2tpbmctPml0ZW1fbmFtZS4nKScuJ34nLiRib29raW5nUXR5Lid8Jy4kcmVxUXR5Lid8Jy4kcGVyY2VudGFnZS4nJSc7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHJlc3VsdFtdID0gJGNvc0Jvb2tpbmctPnN1cF9uYW1lLicgKCcuJGNvc0Jvb2tpbmctPml0ZW1fbmFtZS4nKScuJ34wfDB8MC4wMCUnOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHJlc3VsdFtdID0gJGNvc0Jvb2tpbmctPnN1cF9uYW1lLicgKCcuJGNvc0Jvb2tpbmctPml0ZW1fbmFtZS4nKScuJ34wfDB8MC4wMCUnOwogICAgICAgICAgICB9CiAgICAgICAgfSovCiAgICAgICAgZm9yZWFjaCgkY29zQm9va2luZ0xpc3QgYXMgJGtleT0+JGNvc0Jvb2tpbmcpIHsKICAgICAgICAgICAgLy9yZXR1cm4gJGNvc0Jvb2tpbmc7CiAgICAgICAgICAgICRtcl9vcmRlcl9ib21fY29zdGluZyA9IERCOjp0YWJsZSgnbXJfcG9fYm9tX2Nvc3RpbmdfYm9va2luZycpLT53aGVyZShbJ2lkJyA9PiAkY29zQm9va2luZy0+Y29zSWRdKS0+Zmlyc3QoKTsKICAgICAgICAgICAgJHByZWNvc3RfcmVxUXR5ID0gJG1yX29yZGVyX2JvbV9jb3N0aW5nLT5wcmVjb3N0X3JlcV9xdHk7CiAgICAgICAgICAgICRtcl9ib29raW5nX3F0eSA9IERCOjp0YWJsZSgnbXJfcG9fYm9va2luZ19kZXRhaWwnKS0+c2VsZWN0KERCOjpyYXcoJ3N1bShib29raW5nX3F0eSkgYXMgYm9va2luZ19xdHknKSwgJ3JlcV9xdHknKS0+d2hlcmUoWydtcl9vcmRlcl9ib21fY29zdGluZ19ib29raW5nX2lkJyA9PiAkY29zQm9va2luZy0+Y29zSWRdKS0+Zmlyc3QoKTsKICAgICAgICAgICAgLy8kbXJfYm9va2luZ19xdHkgPSBQb0Jvb2tpbmdEZXRhaWw6OndoZXJlKFsnbXJfb3JkZXJfYm9tX2Nvc3RpbmdfYm9va2luZ19pZCcgPT4gJGNvc0Jvb2tpbmctPmNvc0lkXSktPmZpcnN0KCk7CiAgICAgICAgICAgICRib29raW5nX3F0eSA9ICRtcl9ib29raW5nX3F0eS0+Ym9va2luZ19xdHk/PzA7CiAgICAgICAgICAgICRyZXFRdHkgPSAvKiRtcl9ib29raW5nX3F0eS0+cmVxX3F0eT8/Ki8kcHJlY29zdF9yZXFRdHk7CiAgICAgICAgICAgICRwcmVjZW50YWdlID0gcm91bmQoY2VpbCgoKCRib29raW5nX3F0eS8kcmVxUXR5KSoxMDApKSk/PzA7CgogICAgICAgICAgICAkcmVzdWx0W10gPSAkY29zQm9va2luZy0+c3VwX25hbWUuJyAoJy4kY29zQm9va2luZy0+aXRlbV9uYW1lLicpJy4nficuJGJvb2tpbmdfcXR5Lid8Jy4kcmVxUXR5Lid8Jy4kcHJlY2VudGFnZS4nJSc7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgfQoKICAgIHN0YXRpYyBwdWJsaWMgZnVuY3Rpb24gZml4ZWROdW1iZXIoJG51bWJlciwkZml4ZWQ9NiwkZGVjaW1hbENoZWNrPWZhbHNlKQogICAgewogICAgICAgICRyZXR1cm5OdW1iZXIgPSAwOwogICAgICAgIGlmKGlzX251bWVyaWMoJG51bWJlcikpIHsKICAgICAgICAgICAgJHJldHVybk51bWJlciA9IG51bWJlcl9mb3JtYXQoKGZsb2F0KSRudW1iZXIsICRmaXhlZCwgJy4nLCAnJyk7CiAgICAgICAgICAgIGlmKCRkZWNpbWFsQ2hlY2sgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgaWYoZm1vZCgkcmV0dXJuTnVtYmVyLCAxKSA9PSAwLjAwKXsKICAgICAgICAgICAgICAgICAgICAkcmV0dXJuTnVtYmVyID0gcm91bmQoJG51bWJlciwgMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICRyZXR1cm5OdW1iZXI7CiAgICB9CgogICAgc3RhdGljIHB1YmxpYyBmdW5jdGlvbiBidG4oJGJ0bk5hbWUsJHJlc2V0PXRydWUpCiAgICB7CiAgICAgICAgJHJlc2V0QnRuID0gJyc7CiAgICAgICAgaWYoJHJlc2V0KSB7CiAgICAgICAgICAgICRyZXNldEJ0biA9ICcKICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4teHMiIHR5cGU9InJlc2V0Ij4KICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJhY2UtaWNvbiBmYSBmYS11bmRvIGJpZ2dlci0xMTAiPjwvaT4gUmVzZXQKICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICZuYnNwOyAmbmJzcDsgJm5ic3A7CiAgICAgICAgICAgICc7CiAgICAgICAgfQogICAgICAgICRidG4gPSAnCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNsZWFyZml4IGZvcm0tYWN0aW9ucyI+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29sLXNtLW9mZnNldC0zIGNvbC1zbS05IG5vLXBhZGRpbmciPgogICAgICAgICAgICAgICAgICAnLiRyZXNldEJ0bi4nCiAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiIHR5cGU9InN1Ym1pdCI+CiAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iYWNlLWljb24gZmEgZmEtY2hlY2sgYmlnZ2VyLTExMCI+PC9pPiAnLiRidG5OYW1lLicgICZuYnNwOwogICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgJzsKICAgICAgICByZXR1cm4gJGJ0bjsKICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGdldEVtcFN0YXR1c05hbWUoJHN0YXR1cykKICAgIHsKICAgICAgICAkbmFtZSA9ICcnOwogICAgICAgIGlmKCRzdGF0dXMgPT0gMikgewogICAgICAgICAgICAkbmFtZSA9ICdyZXNpZ24nOwogICAgICAgIH0gZWxzZSBpZigkc3RhdHVzID09IDMpIHsKICAgICAgICAgICAgJG5hbWUgPSAndGVybWluYXRlJzsKICAgICAgICB9IGVsc2UgaWYoJHN0YXR1cyA9PSA0KSB7CiAgICAgICAgICAgICRuYW1lID0gJ3N1c3BlbmQnOwogICAgICAgIH0gZWxzZSBpZigkc3RhdHVzID09IDUpIHsKICAgICAgICAgICAgJG5hbWUgPSAnbGVmdCc7CiAgICAgICAgfSBlbHNlIGlmKCRzdGF0dXMgPT0gNikgewogICAgICAgICAgICAkbmFtZSA9ICdtYXRlcm5pdHknOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJG5hbWU7CiAgICB9CgoKICAgIC8vIFJ1YmVsIGVuZAoKICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gbG9jYXRpb25OYW1lQmFuZ2xhKCR2YWx1ZSkKICAgIHsKICAgICAgICByZXR1cm4gTG9jYXRpb246OmdldExvY2F0aW9uTmFtZUJhbmdsYSgkdmFsdWUpOwogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gdW5pdE5hbWVCYW5nbGEoJHZhbHVlKQogICAgewogICAgICAgIHJldHVybiBVbml0OjpnZXRVbml0TmFtZUJhbmdsYSgkdmFsdWUpOwogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZW1wbG95ZWVCeUFzSWQoJGFzc29jaWF0ZV9pZCkKICAgIHsKICAgICAgICByZXR1cm4gRW1wbG95ZWU6OndoZXJlKCdhc3NvY2lhdGVfaWQnLCAkYXNzb2NpYXRlX2lkKS0+Zmlyc3QoKTsKICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGVuZ1RvQm5Db252ZXJ0KCR2YWx1ZSkKICAgIHsKICAgICAgICAkZW4gPSBhcnJheSgnMCcsJzEnLCcyJywnMycsJzQnLCc1JywnNicsJzcnLCc4JywnOScsICdKYW51YXJ5JywgJ0ZlYnJ1YXJ5JywgJ01hcmNoJywgJ0FwcmlsJywgJ01heScsICdKdW5lJywgJ0p1bHknLCAnQXVndXN0JywgJ1NlcHRlbWJlcicsICdPY3RvYmVyJywgJ05vdmVtYmVyJywgJ0RlY2VtYmVyJywnLCcpOwogICAgICAgICRibiA9IGFycmF5KCfgp6YnLCAn4KenJywgJ+CnqCcsICfgp6knLCAgJ+CnqicsICfgp6snLCAn4KesJywgJ+CnrScsICfgp64nLCAn4KevJywgJ+CmnOCmvuCmqOCngeCmr+CmvOCmvuCmsOCngCcsICfgpqvgp4fgpqzgp43gprDgp4Hgpq/gprzgpr7gprDgpr8nLCAn4Kau4Ka+4Kaw4KeN4KaaJywgJ+Cmj+CmquCnjeCmsOCmv+CmsicsICfgpq7gp4cnLCAn4Kac4KeB4KaoJywgJ+CmnOCngeCmsuCmvuCmhycsICfgpobgppfgprjgp43gpp8nLCAn4Ka44KeH4Kaq4KeN4Kaf4KeH4Kau4KeN4Kas4KawJywgJ+CmheCmleCnjeCmn+Cni+CmrOCmsCcsICfgpqjgpq3gp4fgpq7gp43gpqzgprAnLCAn4Kah4Ka/4Ka44KeH4Kau4KeN4Kas4KawJywnLCcpOwoKICAgICAgICByZXR1cm4gc3RyX3JlcGxhY2UoJGVuLCAkYm4sICR2YWx1ZSk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGNvbnZlcnROdW1iZXJUb1dvcmQoJG51bSA9IGZhbHNlKQogICAgewogICAgICAgICRudW0gPSBzdHJfcmVwbGFjZShhcnJheSgnLCcsICcgJyksICcnICwgdHJpbSgkbnVtKSk7CiAgICAgICAgaWYoISAkbnVtKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgJG51bSA9IChpbnQpICRudW07CiAgICAgICAgJHdvcmRzID0gYXJyYXkoKTsKICAgICAgICAkbGlzdDEgPSBhcnJheSgnJywgJ29uZScsICd0d28nLCAndGhyZWUnLCAnZm91cicsICdmaXZlJywgJ3NpeCcsICdzZXZlbicsICdlaWdodCcsICduaW5lJywgJ3RlbicsICdlbGV2ZW4nLAogICAgICAgICAgICAndHdlbHZlJywgJ3RoaXJ0ZWVuJywgJ2ZvdXJ0ZWVuJywgJ2ZpZnRlZW4nLCAnc2l4dGVlbicsICdzZXZlbnRlZW4nLCAnZWlnaHRlZW4nLCAnbmluZXRlZW4nCiAgICAgICAgKTsKICAgICAgICAkbGlzdDIgPSBhcnJheSgnJywgJ3RlbicsICd0d2VudHknLCAndGhpcnR5JywgJ2ZvcnR5JywgJ2ZpZnR5JywgJ3NpeHR5JywgJ3NldmVudHknLCAnZWlnaHR5JywgJ25pbmV0eScsICdodW5kcmVkJyk7CiAgICAgICAgJGxpc3QzID0gYXJyYXkoJycsICd0aG91c2FuZCcsICdtaWxsaW9uJywgJ2JpbGxpb24nLCAndHJpbGxpb24nLCAncXVhZHJpbGxpb24nLCAncXVpbnRpbGxpb24nLCAnc2V4dGlsbGlvbicsICdzZXB0aWxsaW9uJywKICAgICAgICAgICAgJ29jdGlsbGlvbicsICdub25pbGxpb24nLCAnZGVjaWxsaW9uJywgJ3VuZGVjaWxsaW9uJywgJ2R1b2RlY2lsbGlvbicsICd0cmVkZWNpbGxpb24nLCAncXVhdHR1b3JkZWNpbGxpb24nLAogICAgICAgICAgICAncXVpbmRlY2lsbGlvbicsICdzZXhkZWNpbGxpb24nLCAnc2VwdGVuZGVjaWxsaW9uJywgJ29jdG9kZWNpbGxpb24nLCAnbm92ZW1kZWNpbGxpb24nLCAndmlnaW50aWxsaW9uJwogICAgICAgICk7CiAgICAgICAgJG51bV9sZW5ndGggPSBzdHJsZW4oJG51bSk7CiAgICAgICAgJGxldmVscyA9IChpbnQpICgoJG51bV9sZW5ndGggKyAyKSAvIDMpOwogICAgICAgICRtYXhfbGVuZ3RoID0gJGxldmVscyAqIDM7CiAgICAgICAgJG51bSA9IHN1YnN0cignMDAnIC4gJG51bSwgLSRtYXhfbGVuZ3RoKTsKICAgICAgICAkbnVtX2xldmVscyA9IHN0cl9zcGxpdCgkbnVtLCAzKTsKICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCBjb3VudCgkbnVtX2xldmVscyk7ICRpKyspIHsKICAgICAgICAgICAgJGxldmVscy0tOwogICAgICAgICAgICAkaHVuZHJlZHMgPSAoaW50KSAoJG51bV9sZXZlbHNbJGldIC8gMTAwKTsKICAgICAgICAgICAgJGh1bmRyZWRzID0gKCRodW5kcmVkcyA/ICcgJyAuICRsaXN0MVskaHVuZHJlZHNdIC4gJyBodW5kcmVkJyAuICcgJyA6ICcnKTsKICAgICAgICAgICAgJHRlbnMgPSAoaW50KSAoJG51bV9sZXZlbHNbJGldICUgMTAwKTsKICAgICAgICAgICAgJHNpbmdsZXMgPSAnJzsKICAgICAgICAgICAgaWYgKCAkdGVucyA8IDIwICkgewogICAgICAgICAgICAgICAgJHRlbnMgPSAoJHRlbnMgPyAnICcgLiAkbGlzdDFbJHRlbnNdIC4gJyAnIDogJycgKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICR0ZW5zID0gKGludCkoJHRlbnMgLyAxMCk7CiAgICAgICAgICAgICAgICAkdGVucyA9ICcgJyAuICRsaXN0MlskdGVuc10gLiAnICc7CiAgICAgICAgICAgICAgICAkc2luZ2xlcyA9IChpbnQpICgkbnVtX2xldmVsc1skaV0gJSAxMCk7CiAgICAgICAgICAgICAgICAkc2luZ2xlcyA9ICcgJyAuICRsaXN0MVskc2luZ2xlc10gLiAnICc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHdvcmRzW10gPSAkaHVuZHJlZHMgLiAkdGVucyAuICRzaW5nbGVzIC4gKCAoICRsZXZlbHMgJiYgKCBpbnQgKSAoICRudW1fbGV2ZWxzWyRpXSApICkgPyAnICcgLiAkbGlzdDNbJGxldmVsc10gLiAnICcgOiAnJyApOwogICAgICAgIH0gLy9lbmQgZm9yIGxvb3AKICAgICAgICAkY29tbWFzID0gY291bnQoJHdvcmRzKTsKICAgICAgICBpZiAoJGNvbW1hcyA+IDEpIHsKICAgICAgICAgICAgJGNvbW1hcyA9ICRjb21tYXMgLSAxOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaW1wbG9kZSgnICcsICR3b3Jkcyk7CiAgICB9CgogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiB1bml0SWRXaXNlTmFtZSgkdW5pdCkKICAgIHsKICAgICAgICBpZigkdW5pdCA9PTEpewogICAgICAgICAgICAkdGFibGVOYW1lPSJNQk0gR0FSTUVOVFMgTFRELiI7CiAgICAgICAgfSBlbHNlIGlmKCR1bml0ID09Mil7CiAgICAgICAgICAgICR0YWJsZU5hbWU9IkNVVFRJTkcgRURHRSBJTkRVU1RSSUVTIExURCI7CiAgICAgICAgfSBlbHNlIGlmKCR1bml0ID09Myl7CiAgICAgICAgICAgICR0YWJsZU5hbWU9IkFCU09MVVRFIFFVQUxJVFlXRUFSIExURC4iOwogICAgICAgIH0gZWxzZSBpZigkdW5pdCA9PTQpewogICAgICAgICAgICAkdGFibGVOYW1lPSJNQk0gRkFTSElPTiBXRUFSIExURC4iOwogICAgICAgIH0gZWxzZSBpZigkdW5pdCA9PTUpewogICAgICAgICAgICAkdGFibGVOYW1lPSJNQk0gR0FSTUVOVFMgTFREKFVOSVQgMSkuIjsKICAgICAgICB9IGVsc2UgaWYoJHVuaXQgPT02KXsKICAgICAgICAgICAgJHRhYmxlTmFtZT0iSE8iOwogICAgICAgIH0gZWxzZSBpZigkdW5pdCA9PTgpewogICAgICAgICAgICAkdGFibGVOYW1lPSJDVVRUSU5HIEVER0UgSU5EVVNUUklFUyBMVEQgKFdBU0hJTkcgUExBTlQpLiI7CiAgICAgICAgfSAgZWxzZXsKICAgICAgICAgICAgJHRhYmxlTmFtZT0iIjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICR0YWJsZU5hbWU7CiAgICB9CgogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiB1bml0V2lzZUF0dGVuZGFuY2VUYWJsZU5hbWUoJHVuaXQpCiAgICB7CiAgICAgICAgaWYoJHVuaXQgPT0xIHx8ICR1bml0PT00IHx8ICR1bml0PT01IHx8ICR1bml0PT05KXsKICAgICAgICAgICAgJHRhYmxlTmFtZT0iaHJfYXR0ZW5kYW5jZV9tYm0iOwogICAgICAgIH0gZWxzZSBpZigkdW5pdCA9PTIpewogICAgICAgICAgICAkdGFibGVOYW1lPSJocl9hdHRlbmRhbmNlX2NlaWwiOwogICAgICAgIH0gZWxzZSBpZigkdW5pdCA9PTMpewogICAgICAgICAgICAkdGFibGVOYW1lPSJocl9hdHRlbmRhbmNlX2FxbCI7CiAgICAgICAgfSBlbHNlIGlmKCR1bml0ID09Nil7CiAgICAgICAgICAgICR0YWJsZU5hbWU9ImhyX2F0dGVuZGFuY2VfaG8iOwogICAgICAgIH0gZWxzZSBpZigkdW5pdCA9PTgpewogICAgICAgICAgICAkdGFibGVOYW1lPSJocl9hdHRlbmRhbmNlX2NldyI7CiAgICAgICAgfSBlbHNlewogICAgICAgICAgICAkdGFibGVOYW1lPSJocl9hdHRlbmRhbmNlX21ibSI7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkdGFibGVOYW1lOwogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZ2V0QnV5ZXJXaXNlT3QoJHVuaXQsICRhc0lkLCAkbW9udGgsICR5ZWFyLCAkb3QpCiAgICB7CgogICAgICAgIGlmKCR1bml0ID09MSB8fCAkdW5pdD09NCB8fCAkdW5pdD09NSB8fCAkdW5pdD09OSl7CiAgICAgICAgICAgICR0YWJsZU5hbWU9ImhyX2F0dGVuZGFuY2VfbWJtIjsKICAgICAgICB9IGVsc2UgaWYoJHVuaXQgPT0yKXsKICAgICAgICAgICAgJHRhYmxlTmFtZT0iaHJfYXR0ZW5kYW5jZV9jZWlsIjsKICAgICAgICB9IGVsc2UgaWYoJHVuaXQgPT0zKXsKICAgICAgICAgICAgJHRhYmxlTmFtZT0iaHJfYXR0ZW5kYW5jZV9hcWwiOwogICAgICAgIH0gZWxzZSBpZigkdW5pdCA9PTYpewogICAgICAgICAgICAkdGFibGVOYW1lPSJocl9hdHRlbmRhbmNlX2hvIjsKICAgICAgICB9IGVsc2UgaWYoJHVuaXQgPT04KXsKICAgICAgICAgICAgJHRhYmxlTmFtZT0iaHJfYXR0ZW5kYW5jZV9jZXciOwogICAgICAgIH0gZWxzZXsKICAgICAgICAgICAgJHRhYmxlTmFtZT0iaHJfYXR0ZW5kYW5jZV9tYm0iOwogICAgICAgIH0KICAgICAgICAkZGF0ZSA9ICR5ZWFyLictMCcuJG1vbnRoOwogICAgICAgICRnZXRBdHQgPSBEQjo6dGFibGUoJHRhYmxlTmFtZSkKICAgICAgICAtPndoZXJlKCdhc19pZCcsICRhc0lkKQogICAgICAgIC0+d2hlcmUoJ2luX3RpbWUnLCAnTElLRScsICRkYXRlLiclJykKICAgICAgICAtPnBsdWNrKCdvdF9ob3VyJyk7CiAgICAgICAgJG90SG91ciA9IDA7CiAgICAgICAgaWYoY291bnQoJGdldEF0dCkgPiAwKXsKICAgICAgICAgICAgZm9yZWFjaCgkZ2V0QXR0IGFzICRhdHQpewogICAgICAgICAgICAgICAgaWYoJGF0dCA+ICRvdCl7CiAgICAgICAgICAgICAgICAgICAgJHBhcnRzID0gZXhwbG9kZSgnOicsJG90KTsKICAgICAgICAgICAgICAgICAgICBpZihpc3NldCgkcGFydHNbMV0pKXsKICAgICAgICAgICAgICAgICAgICAgICAgJG90TWludXRlID0gJHBhcnRzWzBdKjYwICsgJHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAkb3RNaW51dGUgPSAkcGFydHNbMF0qNjA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRhdHQgPSAkb3RNaW51dGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkb3RIb3VyICs9ICRhdHQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8tPmdldCgpOwoKICAgICAgICByZXR1cm4gJG90SG91cjsKCiAgICB9CgoKCiAgICAvLy9QSSBnZXQgYm9va2luZwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBnZXRQaVF0eSgkYm9va2luZ19pZCkKICAgIHsKICAgICAgICAkYm9va2VkUGkgPSAgREI6OnRhYmxlKCdjbV9waV9ib20nKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ21yX3BvX2Jvb2tpbmdfaWQnLCAkYm9va2luZ19pZCkKICAgICAgICAgICAgICAgICAgICAtPnN1bSgncGlfcXR5Jyk7CiAgICAgICAgcmV0dXJuICRib29rZWRQaTsKICAgIH0KCi8qICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZ2V0UGlRdHkoJGJvb2tpbmdfaWQpCiAgICB7CiAgICAgICAgJGJvb2tlZFBpID0gIERCOjp0YWJsZSgnbXJfcG9fYm9va2luZ19kZXRhaWwnKQogICAgICAgICAgICAtPndoZXJlKCdtcl9wb19ib29raW5nX2lkJywgJGJvb2tpbmdfaWQpCiAgICAgICAgICAgIC0+c3VtKCdib29raW5nX3F0eScpOwogICAgICAgIHJldHVybiAkYm9va2VkUGk7CiAgICB9Ki8KCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGdldFBpUXR5QnlQaSgkYm9va2luZ19pZCwkcGlfaWQpCiAgICB7CiAgICAgICAgJGJvb2tlZFBpID0gIERCOjp0YWJsZSgnY21fcGlfYm9tJykKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdtcl9wb19ib29raW5nX2lkJywgJGJvb2tpbmdfaWQpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnY21fcGlfbWFzdGVyX2lkJywkcGlfaWQpCiAgICAgICAgICAgICAgICAgICAgLT5zdW0oJ3BpX3F0eScpOwogICAgICAgIHJldHVybiAkYm9va2VkUGk7CiAgICB9CgovKiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGdldFBpSXRlbXNRdHkoJGJvb2tpbmdfaWQsJGl0ZW0pCiAgICB7CiAgICAgICAgJGJvb2tlZFBpID0gIERCOjp0YWJsZSgnY21fcGlfYm9tJykKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdtcl9wb19ib29raW5nX2lkJywgJGJvb2tpbmdfaWQpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnbXJfb3JkZXJfYm9va2luZ19pZCcsJGl0ZW0pCiAgICAgICAgICAgICAgICAgICAgLT5zdW0oJ3BpX3F0eScpOwogICAgICAgIHJldHVybiAkYm9va2VkUGk7CiAgICB9Ki8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZ2V0UGlJdGVtc1F0eSgkYm9va2luZ19pZCkKICAgIHsKICAgICAgICAkYm9va2VkUGkgPSAgREI6OnRhYmxlKCdtcl9wb19ib29raW5nX2RldGFpbCcpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnbXJfcG9fYm9va2luZ19pZCcsICRib29raW5nX2lkKQogICAgICAgICAgICAgICAgICAgIC0+c3VtKCdib29raW5nX3F0eScpOwogICAgICAgIHJldHVybiAkYm9va2VkUGk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGdldFBpSXRlbXNRdHlCeVBpKCRib29raW5nX2lkLCRpdGVtLCRwaV9pZCkKICAgIHsKICAgICAgICAkYm9va2VkUGkgPSAgREI6OnRhYmxlKCdjbV9waV9ib20nKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ21yX3BvX2Jvb2tpbmdfaWQnLCAkYm9va2luZ19pZCkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdtcl9vcmRlcl9ib29raW5nX2lkJywkaXRlbSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdjbV9waV9tYXN0ZXJfaWQnLCRwaV9pZCkKICAgICAgICAgICAgICAgICAgICAtPnN1bSgncGlfcXR5Jyk7CiAgICAgICAgcmV0dXJuICRib29rZWRQaTsKICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGdldEJvb2tpbmdJdGVtTmFtZXMoJGJvb2tpbmdfaWQpCiAgICB7CiAgICAgICAgJGJvb2tpbmcgPSBEQjo6dGFibGUoJ21yX3BvX2JvbV9jb3N0aW5nX2Jvb2tpbmcgQVMgbW9iJykKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdtb2IucG9faWQnLCAkYm9va2luZ19pZCkKICAgICAgICAgICAgICAgICAgICAtPkpvaW4oJ21yX2NhdF9pdGVtIEFzIGknLCdpLmlkJywnbW9iLm1yX2NhdF9pdGVtX2lkJykKICAgICAgICAgICAgICAgICAgICAtPnBsdWNrKCdpdGVtX25hbWUnKQogICAgICAgICAgICAgICAgICAgIC0+dW5pcXVlKCkKICAgICAgICAgICAgICAgICAgICAtPnRvQXJyYXkoKTsKICAgICAgICByZXR1cm4gICRib29raW5nOwogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZ2V0T3JkZXJCeUJvb2tpbmdJZCgkYm9va2luZ19pZCl7CiAgICAgICAgJG9yZGVyID0gREI6OnRhYmxlKCdtcl9vcmRlcl9ib29raW5nIEFTIG1vYicpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnbW9iLm1yX3BvX2Jvb2tpbmdfaWQnLCAkYm9va2luZ19pZCkKICAgICAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCdtcl9vcmRlcl9ib21fY29zdGluZ19ib29raW5nIEFTIGJjYicsICdiY2IuaWQnLCAnbW9iLm1yX29yZGVyX2JvbV9jb3N0aW5nX2Jvb2tpbmdfaWQnKQogICAgICAgICAgICAgICAgICAgIC0+Sm9pbignbXJfb3JkZXJfZW50cnkgQVMgbycsJ28ub3JkZXJfaWQnLCdiY2Iub3JkZXJfaWQnKQogICAgICAgICAgICAgICAgICAgIC0+cGx1Y2soJ28ub3JkZXJfY29kZScpCiAgICAgICAgICAgICAgICAgICAgLT51bmlxdWUoKQogICAgICAgICAgICAgICAgICAgIC0+dG9BcnJheSgpOwogICAgICAgIHJldHVybiAkb3JkZXI7CiAgICB9CgogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBnZXRDbVBpQm9tSW5mb0J5KCRidGIsJGNhdCwkaXRlbSwkY29ucywkY29sb3IsJHNpemUpewogICAgICAgICR3aGVyZSA9IFsKICAgICAgICAgICAgICAgICdidGIuaWQnPT4kYnRiLAogICAgICAgICAgICAgICAgJ2IubXJfbWF0ZXJpYWxfY2F0ZWdvcnlfbWNhdF9pZCc9PiRjYXQsCiAgICAgICAgICAgICAgICAnYi5tcl9jYXRfaXRlbV9pZCc9PiRpdGVtLAogICAgICAgICAgICAgICAgJ2IubXJfY29uc3RydWN0aW9uX2lkJz0+JGNvbnMsCiAgICAgICAgICAgICAgICAnbW9iLm1yX21hdGVyaWFsX2NvbG9yX2lkJz0+JGNvbG9yLAogICAgICAgICAgICAgICAgJ21vYi5zaXplJz0+JHNpemUKICAgICAgICAgICAgXTsKICAgICAgICAkYm9va2luZyA9IERCOjp0YWJsZSgnbXJfb3JkZXJfYm9va2luZyBBcyBtb2InKQogICAgICAgICAgICAgICAgICAgIC0+c2VsZWN0KAogICAgICAgICAgICAgICAgICAgICAgICAibWMuY2xyX25hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAiY3BiLnBpX3F0eSIsCiAgICAgICAgICAgICAgICAgICAgICAgICJjcGIuaWQgQVMgY21fcGlfYm9tX2lkIiwKICAgICAgICAgICAgICAgICAgICAgICAgJ2NwYi5jbV9waV9tYXN0ZXJfaWQnLAogICAgICAgICAgICAgICAgICAgICAgICAnby5vcmRlcl9kZWxpdmVyeV9kYXRlJywKICAgICAgICAgICAgICAgICAgICAgICAgImlwLnVuaXRfcHJpY2UiCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIC0+bGVmdEpvaW4oJ21yX29yZGVyX2JvbV9jb3N0aW5nX2Jvb2tpbmcgQVMgYicsJ2IuaWQnLCdtb2IubXJfb3JkZXJfYm9tX2Nvc3RpbmdfYm9va2luZ19pZCcpCiAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbigibXJfbWF0ZXJpYWxfY2F0ZWdvcnkgQVMgYyIsIGZ1bmN0aW9uKCRqb2luKSB7CiAgICAgICAgICAgICAgICAgICAgICAkam9pbi0+b24oImMubWNhdF9pZCIsICI9IiwgImIubXJfbWF0ZXJpYWxfY2F0ZWdvcnlfbWNhdF9pZCIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbigibXJfY2F0X2l0ZW0gQVMgaSIsIGZ1bmN0aW9uKCRqb2luKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRqb2luLT5vbigiaS5tY2F0X2lkIiwgIj0iLCAiYi5tcl9tYXRlcmlhbF9jYXRlZ29yeV9tY2F0X2lkIik7CiAgICAgICAgICAgICAgICAgICAgICAgICRqb2luLT5vbigiaS5pZCIsICI9IiwgImIubXJfY2F0X2l0ZW1faWQiKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+bGVmdEpvaW4oIm1yX21hdGVyaWFsX2NvbG9yIEFTIG1jIiwgIm1jLmNscl9pZCIsICJtb2IubXJfbWF0ZXJpYWxfY29sb3JfaWQiKQogICAgICAgICAgICAgICAgICAgIC0+bGVmdEpvaW4oIm1yX3N1cHBsaWVyIEFTIHMiLCAicy5zdXBfaWQiLCAiYi5tcl9zdXBwbGllcl9zdXBfaWQiKQogICAgICAgICAgICAgICAgICAgIC0+bGVmdEpvaW4oIm1yX2FydGljbGUgQVMgYSIsICJhLmlkIiwgImIubXJfYXJ0aWNsZV9pZCIpCiAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbigibXJfY29tcG9zaXRpb24gQVMgY29tIiwgImNvbS5pZCIsICJiLm1yX2NvbXBvc2l0aW9uX2lkIikKICAgICAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCJtcl9jb25zdHJ1Y3Rpb24gQVMgY29uIiwgImNvbi5pZCIsICJiLm1yX2NvbnN0cnVjdGlvbl9pZCIpCiAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbigibXJfcHJvZHVjdF9zaXplIEFTIHN6IiwgInN6LmlkIiwibW9iLnNpemUiKQogICAgICAgICAgICAgICAgICAgIC0+Sm9pbigiY21fcGlfYm9tIGFzIGNwYiIsIm1vYi5pZCIgLCJjcGIubXJfb3JkZXJfYm9va2luZ19pZCIpCiAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbigibXJfcGlfaXRlbV91bml0X3ByaWNlIEFTIGlwIiwgZnVuY3Rpb24oJGpvaW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGpvaW4tPm9uKCJpcC5jbV9waV9tYXN0ZXJfaWQiLCAiPSIsICJjcGIuY21fcGlfbWFzdGVyX2lkIik7CiAgICAgICAgICAgICAgICAgICAgICAgICRqb2luLT5vbigiaXAubXJfcG9fYm9va2luZ19pZCIsICI9IiwgImNwYi5tcl9wb19ib29raW5nX2lkIik7CiAgICAgICAgICAgICAgICAgICAgICAgICRqb2luLT5vbigiaXAubXJfY2F0X2l0ZW1faWQiLCAiPSIsICJiLm1yX2NhdF9pdGVtX2lkIik7CgogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5MZWZ0Sm9pbignY21fcGlfZm9yd2FyZGluZ19kZXRhaWxzIEFTIGNkJywnY2QuY21fcGlfbWFzdGVyX2lkJywnY3BiLmNtX3BpX21hc3Rlcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbignY21fYnRiIEFTIGJ0YicsICdidGIuY21fcGlfZm9yd2FyZGluZ19tYXN0ZXJfaWQnLCdjZC5jbV9waV9mb3J3YXJkaW5nX21hc3Rlcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgkd2hlcmUpCiAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbignbXJfb3JkZXJfZW50cnkgQVMgbycsJ28ub3JkZXJfaWQnLCdiLm9yZGVyX2lkJykKICAgICAgICAgICAgICAgICAgICAvLy0+bGVmdEpvaW4oImNtX2ludm9pY2VfcGlfYm9tIEFTIGludiIsICJpbnYuY21fcGlfYm9tX2lkIiwgImNwYi5pZCIpCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckJ5KCJvLm9yZGVyX2RlbGl2ZXJ5X2RhdGUiLCdBU0MnKQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJCeSgiY3BiLmNtX3BpX21hc3Rlcl9pZCIsJ0FTQycpCiAgICAgICAgICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICByZXR1cm4gJGJvb2tpbmc7CiAgICB9CgogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBnZXRDbVBpQm9tSW5mb0VkaXRCeSgkYnRiLCRjYXQsJGl0ZW0sJGNvbnMsJGNvbG9yLCRzaXplLCRpbnZvaWNlX2lkKXsKICAgICAgICAkd2hlcmUgPSBbCiAgICAgICAgICAgICAgICAnYnRiLmlkJz0+JGJ0YiwKICAgICAgICAgICAgICAgICdiLm1yX21hdGVyaWFsX2NhdGVnb3J5X21jYXRfaWQnPT4kY2F0LAogICAgICAgICAgICAgICAgJ2IubXJfY2F0X2l0ZW1faWQnPT4kaXRlbSwKICAgICAgICAgICAgICAgICdiLm1yX2NvbnN0cnVjdGlvbl9pZCc9PiRjb25zLAogICAgICAgICAgICAgICAgJ21vYi5tcl9tYXRlcmlhbF9jb2xvcl9pZCc9PiRjb2xvciwKICAgICAgICAgICAgICAgICdtb2Iuc2l6ZSc9PiRzaXplLAogICAgICAgICAgICAgICAgJ2ludi5jbV9pbXBfaW52b2ljZV9pZCc9PiAkaW52b2ljZV9pZAogICAgICAgICAgICBdOwoKICAgICAgICAkYm9va2luZyA9IERCOjp0YWJsZSgnbXJfb3JkZXJfYm9va2luZyBBcyBtb2InKQogICAgICAgICAgICAgICAgICAgIC0+c2VsZWN0KAogICAgICAgICAgICAgICAgICAgICAgICAibWMuY2xyX25hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAiY3BiLnBpX3F0eSIsCiAgICAgICAgICAgICAgICAgICAgICAgICJjcGIuaWQgQVMgY21fcGlfYm9tX2lkIiwKICAgICAgICAgICAgICAgICAgICAgICAgJ2NwYi5jbV9waV9tYXN0ZXJfaWQnLAogICAgICAgICAgICAgICAgICAgICAgICAnby5vcmRlcl9kZWxpdmVyeV9kYXRlJywKICAgICAgICAgICAgICAgICAgICAgICAgJ2ludi5pZCBhcyBpbnZfaWQnLAogICAgICAgICAgICAgICAgICAgICAgICAiaXAudW5pdF9wcmljZSIKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbignbXJfb3JkZXJfYm9tX2Nvc3RpbmdfYm9va2luZyBBUyBiJywnYi5pZCcsJ21vYi5tcl9vcmRlcl9ib21fY29zdGluZ19ib29raW5nX2lkJykKICAgICAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCJtcl9tYXRlcmlhbF9jYXRlZ29yeSBBUyBjIiwgZnVuY3Rpb24oJGpvaW4pIHsKICAgICAgICAgICAgICAgICAgICAgICRqb2luLT5vbigiYy5tY2F0X2lkIiwgIj0iLCAiYi5tcl9tYXRlcmlhbF9jYXRlZ29yeV9tY2F0X2lkIik7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCJtcl9jYXRfaXRlbSBBUyBpIiwgZnVuY3Rpb24oJGpvaW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGpvaW4tPm9uKCJpLm1jYXRfaWQiLCAiPSIsICJiLm1yX21hdGVyaWFsX2NhdGVnb3J5X21jYXRfaWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGpvaW4tPm9uKCJpLmlkIiwgIj0iLCAiYi5tcl9jYXRfaXRlbV9pZCIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbigibXJfbWF0ZXJpYWxfY29sb3IgQVMgbWMiLCAibWMuY2xyX2lkIiwgIm1vYi5tcl9tYXRlcmlhbF9jb2xvcl9pZCIpCiAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbigibXJfc3VwcGxpZXIgQVMgcyIsICJzLnN1cF9pZCIsICJiLm1yX3N1cHBsaWVyX3N1cF9pZCIpCiAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbigibXJfYXJ0aWNsZSBBUyBhIiwgImEuaWQiLCAiYi5tcl9hcnRpY2xlX2lkIikKICAgICAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCJtcl9jb21wb3NpdGlvbiBBUyBjb20iLCAiY29tLmlkIiwgImIubXJfY29tcG9zaXRpb25faWQiKQogICAgICAgICAgICAgICAgICAgIC0+bGVmdEpvaW4oIm1yX2NvbnN0cnVjdGlvbiBBUyBjb24iLCAiY29uLmlkIiwgImIubXJfY29uc3RydWN0aW9uX2lkIikKICAgICAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCJtcl9wcm9kdWN0X3NpemUgQVMgc3oiLCAic3ouaWQiLCJtb2Iuc2l6ZSIpCiAgICAgICAgICAgICAgICAgICAgLT5Kb2luKCJjbV9waV9ib20gYXMgY3BiIiwibW9iLmlkIiAsImNwYi5tcl9vcmRlcl9ib29raW5nX2lkIikKICAgICAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCJtcl9waV9pdGVtX3VuaXRfcHJpY2UgQVMgaXAiLCBmdW5jdGlvbigkam9pbikgewogICAgICAgICAgICAgICAgICAgICAgICAkam9pbi0+b24oImlwLmNtX3BpX21hc3Rlcl9pZCIsICI9IiwgImNwYi5jbV9waV9tYXN0ZXJfaWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGpvaW4tPm9uKCJpcC5tcl9wb19ib29raW5nX2lkIiwgIj0iLCAiY3BiLm1yX3BvX2Jvb2tpbmdfaWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGpvaW4tPm9uKCJpcC5tcl9jYXRfaXRlbV9pZCIsICI9IiwgImIubXJfY2F0X2l0ZW1faWQiKTsKCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPkxlZnRKb2luKCdjbV9waV9mb3J3YXJkaW5nX2RldGFpbHMgQVMgY2QnLCdjZC5jbV9waV9tYXN0ZXJfaWQnLCdjcGIuY21fcGlfbWFzdGVyX2lkJykKICAgICAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCdjbV9idGIgQVMgYnRiJywgJ2J0Yi5jbV9waV9mb3J3YXJkaW5nX21hc3Rlcl9pZCcsJ2NkLmNtX3BpX2ZvcndhcmRpbmdfbWFzdGVyX2lkJykKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCR3aGVyZSkKICAgICAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCdtcl9vcmRlcl9lbnRyeSBBUyBvJywnby5vcmRlcl9pZCcsJ2Iub3JkZXJfaWQnKQogICAgICAgICAgICAgICAgICAgIC0+Sm9pbigiY21faW52b2ljZV9waV9ib20gQVMgaW52IiwgImludi5jbV9waV9ib21faWQiLCAiY3BiLmlkIikKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQnkoIm8ub3JkZXJfZGVsaXZlcnlfZGF0ZSIsJ0FTQycpCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckJ5KCJjcGIuY21fcGlfbWFzdGVyX2lkIiwnQVNDJykKICAgICAgICAgICAgICAgICAgICAtPmdldCgpOwogICAgICAgIHJldHVybiAkYm9va2luZzsKICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGdldEludlNoaXBwZWRRdHlCeSgkYnRiLCRjYXQsJGl0ZW0sJGNvbnMsJGNvbG9yLCRzaXplLCRpbnZvaWNlX2lkKXsKICAgICAgICAkd2hlcmUgPSBbCiAgICAgICAgICAgICAgICAnYnRiLmlkJz0+JGJ0YiwKICAgICAgICAgICAgICAgICdiLm1yX21hdGVyaWFsX2NhdGVnb3J5X21jYXRfaWQnPT4kY2F0LAogICAgICAgICAgICAgICAgJ2IubXJfY2F0X2l0ZW1faWQnPT4kaXRlbSwKICAgICAgICAgICAgICAgICdiLm1yX2NvbnN0cnVjdGlvbl9pZCc9PiRjb25zLAogICAgICAgICAgICAgICAgJ21vYi5tcl9tYXRlcmlhbF9jb2xvcl9pZCc9PiRjb2xvciwKICAgICAgICAgICAgICAgICdtb2Iuc2l6ZSc9PiRzaXplCiAgICAgICAgICAgIF07CiAgICAgICAgaWYoJGludm9pY2VfaWQgIT0gbnVsbCl7CiAgICAgICAgICAgICR3aGVyZVsnaW52LmNtX2ltcF9pbnZvaWNlX2lkJ109JGludm9pY2VfaWQ7CiAgICAgICAgfQogICAgICAgICRzaGlwcGVkX3F0eSA9IERCOjp0YWJsZSgnbXJfb3JkZXJfYm9va2luZyBBcyBtb2InKQogICAgICAgICAgICAgICAgICAgIC0+c2VsZWN0KAogICAgICAgICAgICAgICAgICAgICAgIm1jLmNscl9uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICJjcGIucGlfcXR5IiwKICAgICAgICAgICAgICAgICAgICAgICJjcGIuaWQgQVMgY21fcGlfYm9tX2lkIiwKICAgICAgICAgICAgICAgICAgICAgICdjcGIuY21fcGlfbWFzdGVyX2lkJywKICAgICAgICAgICAgICAgICAgICAgICdvLm9yZGVyX2RlbGl2ZXJ5X2RhdGUnCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIC0+bGVmdEpvaW4oJ21yX29yZGVyX2JvbV9jb3N0aW5nX2Jvb2tpbmcgQVMgYicsJ2IuaWQnLCdtb2IubXJfb3JkZXJfYm9tX2Nvc3RpbmdfYm9va2luZ19pZCcpCiAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbigibXJfbWF0ZXJpYWxfY2F0ZWdvcnkgQVMgYyIsIGZ1bmN0aW9uKCRqb2luKSB7CiAgICAgICAgICAgICAgICAgICAgICAkam9pbi0+b24oImMubWNhdF9pZCIsICI9IiwgImIubXJfbWF0ZXJpYWxfY2F0ZWdvcnlfbWNhdF9pZCIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbigibXJfY2F0X2l0ZW0gQVMgaSIsIGZ1bmN0aW9uKCRqb2luKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRqb2luLT5vbigiaS5tY2F0X2lkIiwgIj0iLCAiYi5tcl9tYXRlcmlhbF9jYXRlZ29yeV9tY2F0X2lkIik7CiAgICAgICAgICAgICAgICAgICAgICAgICRqb2luLT5vbigiaS5pZCIsICI9IiwgImIubXJfY2F0X2l0ZW1faWQiKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+bGVmdEpvaW4oIm1yX21hdGVyaWFsX2NvbG9yIEFTIG1jIiwgIm1jLmNscl9pZCIsICJtb2IubXJfbWF0ZXJpYWxfY29sb3JfaWQiKQogICAgICAgICAgICAgICAgICAgIC0+bGVmdEpvaW4oIm1yX3N1cHBsaWVyIEFTIHMiLCAicy5zdXBfaWQiLCAiYi5tcl9zdXBwbGllcl9zdXBfaWQiKQogICAgICAgICAgICAgICAgICAgIC0+bGVmdEpvaW4oIm1yX2FydGljbGUgQVMgYSIsICJhLmlkIiwgImIubXJfYXJ0aWNsZV9pZCIpCiAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbigibXJfY29tcG9zaXRpb24gQVMgY29tIiwgImNvbS5pZCIsICJiLm1yX2NvbXBvc2l0aW9uX2lkIikKICAgICAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCJtcl9jb25zdHJ1Y3Rpb24gQVMgY29uIiwgImNvbi5pZCIsICJiLm1yX2NvbnN0cnVjdGlvbl9pZCIpCiAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbigibXJfcHJvZHVjdF9zaXplIEFTIHN6IiwgInN6LmlkIiwibW9iLnNpemUiKQogICAgICAgICAgICAgICAgICAgIC0+Sm9pbigiY21fcGlfYm9tIGFzIGNwYiIsIm1vYi5pZCIgLCJjcGIubXJfb3JkZXJfYm9va2luZ19pZCIpCiAgICAgICAgICAgICAgICAgICAgLT5MZWZ0Sm9pbignY21fcGlfZm9yd2FyZGluZ19kZXRhaWxzIEFTIGNkJywnY2QuY21fcGlfbWFzdGVyX2lkJywnY3BiLmNtX3BpX21hc3Rlcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbignY21fYnRiIEFTIGJ0YicsICdidGIuY21fcGlfZm9yd2FyZGluZ19tYXN0ZXJfaWQnLCdjZC5jbV9waV9mb3J3YXJkaW5nX21hc3Rlcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgkd2hlcmUpCiAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbignbXJfb3JkZXJfZW50cnkgQVMgbycsJ28ub3JkZXJfaWQnLCdiLm9yZGVyX2lkJykKICAgICAgICAgICAgICAgICAgICAtPkpvaW4oImNtX2ludm9pY2VfcGlfYm9tIEFTIGludiIsICJpbnYuY21fcGlfYm9tX2lkIiwgImNwYi5pZCIpCiAgICAgICAgICAgICAgICAgICAgLT5zdW0oJ3NoaXBwZWRfcXR5Jyk7CiAgICAgICAgcmV0dXJuICRzaGlwcGVkX3F0eTsKICAgIH0KCgogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBnZXRTaGlwcGVkUXR5QnkoJHBpbWFzdGVyLCRwaWJvbSwkaW52b2ljZV9pZCl7CiAgICAgICAgJHdoZXJlID0gWwogICAgICAgICAgICAnY21fcGlfbWFzdGVyX2lkJyA9PiAkcGltYXN0ZXIsCiAgICAgICAgICAgICdjbV9waV9ib21faWQnID0+ICRwaWJvbQogICAgICAgIF07CiAgICAgICAgaWYoJGludm9pY2VfaWQgIT0gbnVsbCl7CiAgICAgICAgICAgICR3aGVyZVsnY21faW1wX2ludm9pY2VfaWQnXT0gJGludm9pY2VfaWQ7CiAgICAgICAgfQogICAgICAgIC8vZGQoJHdoZXJlKTsKICAgICAgICByZXR1cm4gREI6OnRhYmxlKCdjbV9pbnZvaWNlX3BpX2JvbScpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJHdoZXJlKQogICAgICAgICAgICAgICAgICAgICAgICAtPnN1bSgnc2hpcHBlZF9xdHknKTsKCiAgICB9CgogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBnZXRSZW1RdHkoJHBpKXsKICAgICAgICAkbWFzdGVyID0gREI6OnRhYmxlKCdjbV9waV9ib20nKS0+d2hlcmUoJ2NtX3BpX21hc3Rlcl9pZCcsICRwaSktPnN1bSgncGlfcXR5Jyk7CiAgICAgICAgJGludm9pY2UgPSBEQjo6dGFibGUoJ2NtX2ludm9pY2VfcGlfYm9tJyktPndoZXJlKCdjbV9waV9tYXN0ZXJfaWQnLCRwaSktPnN1bSgnc2hpcHBlZF9xdHknKTsKICAgICAgICByZXR1cm4gcm91bmQoKCRtYXN0ZXItJGludm9pY2UpLDIpOwoKICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIHNhbGFyeUxlYXZlQWRqdXN0QXNJZE1vbnRoWWVhcldpc2UoJGFzSWQsICRtb250aCwgJHllYXIpCiAgICB7CiAgICAgICAgJHNhbGFyeUFkanVzdCA9IFNhbGFyeUFkanVzdE1hc3Rlcjo6Z2V0Q2hlY2tFbXBsb3llZUlkTW9udGhZZWFyV2lzZSgkYXNJZCwgJG1vbnRoLCAkeWVhcik7CiAgICAgICAgJGFtb3VudCA9IDAuMDA7CiAgICAgICAgaWYoJHNhbGFyeUFkanVzdCAhPSBudWxsKXsKICAgICAgICAgICAgaWYoaXNzZXQoJHNhbGFyeUFkanVzdC0+c2FsYXJ5X2FkanVzdCkpewogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHNhbGFyeUFkanVzdC0+c2FsYXJ5X2FkanVzdCBhcyAkc2FsYXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgJGFtb3VudCArPSAkc2FsYXJ5LT5hbW91bnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiByb3VuZCgkYW1vdW50LCAwKTsKICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIG51bWJlclRvVGltZSgkbnVtYmVyKXsKICAgICAgICAkbnVtYmVyID0gcm91bmQoJG51bWJlciwxKTsKICAgICAgICAkaG91ciA9IGV4cGxvZGUoIi4iLCAkbnVtYmVyKTsKICAgICAgICBpZihpc3NldCgkaG91clsxXSkpewogICAgICAgICAgICByZXR1cm4gJGhvdXJbMF0uJzonLnJvdW5kKCRob3VyWzFdKjYpOwogICAgICAgIH1lbHNlCiAgICAgICAgICAgIHJldHVybiAkaG91clswXTsKICAgIH0KCgogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBudW1iZXJUb1RpbWVGb3JtYXQoJG51bWJlcil7CiAgICAgICAgJG51bWJlciA9IHJvdW5kKCRudW1iZXIsMSk7CiAgICAgICAgJGhvdXIgPSBleHBsb2RlKCIuIiwgJG51bWJlcik7CiAgICAgICAgaWYoaXNzZXQoJGhvdXJbMV0pKXsKICAgICAgICAgICAgJGhvdXJbMV0gPSByb3VuZCgkaG91clsxXSo2KTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgJGhvdXJbMV0gPSAnMDAnOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJGhvdXJbMF0uJzonLiRob3VyWzFdOwogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZ2V0TG9ja0RhdGUoKXsKICAgICAgICByZXR1cm4gREI6OnRhYmxlKCdocl9zeXN0ZW1fc2V0dGluZycpLT5maXJzdCgpLT5zYWxhcnlfbG9jazsKICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZSBMYXJhdmVsIEVudiBmaWxlIEtleSdzIFZhbHVlCiAgICAgKiBAcGFyYW0gc3RyaW5nICRrZXkKICAgICAqIEBwYXJhbSBzdHJpbmcgJHZhbHVlCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZW52VXBkYXRlKCRkYXRhID0gYXJyYXkoKSwgJHR5cGUgPSAnc2V0JykKICAgIHsKICAgICAgICBpZiAoIWNvdW50KCRkYXRhKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAkcGF0dGVybiA9ICcvKFteXD1dKilcPVteXG5dKi8nOwoKICAgICAgICAkZW52RmlsZSA9IGJhc2VfcGF0aCgpIC4gJy8uZW52JzsKICAgICAgICAkbGluZXMgPSBmaWxlKCRlbnZGaWxlKTsKICAgICAgICAkbmV3TGluZXMgPSBbXTsKICAgICAgICAkcmV0dXJuID0gJyc7CiAgICAgICAgZm9yZWFjaCAoJGxpbmVzIGFzICRsaW5lKSB7CiAgICAgICAgICAgIHByZWdfbWF0Y2goJHBhdHRlcm4sICRsaW5lLCAkbWF0Y2hlcyk7CgogICAgICAgICAgICBpZiAoIWNvdW50KCRtYXRjaGVzKSkgewogICAgICAgICAgICAgICAgJG5ld0xpbmVzW10gPSAkbGluZTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIWtleV9leGlzdHModHJpbSgkbWF0Y2hlc1sxXSksICRkYXRhKSkgewogICAgICAgICAgICAgICAgJG5ld0xpbmVzW10gPSAkbGluZTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHJldHVybiA9ICRsaW5lOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkbGluZSA9IHRyaW0oJG1hdGNoZXNbMV0pIC4gIj17JGRhdGFbdHJpbSgkbWF0Y2hlc1sxXSldfVxuIjsKICAgICAgICAgICAgJG5ld0xpbmVzW10gPSAkbGluZTsKICAgICAgICB9CgogICAgICAgIGlmKCR0eXBlID09ICdzZXQnKSB7CiAgICAgICAgICAgICRuZXdDb250ZW50ID0gaW1wbG9kZSgnJywgJG5ld0xpbmVzKTsKICAgICAgICAgICAgZmlsZV9wdXRfY29udGVudHMoJGVudkZpbGUsICRuZXdDb250ZW50KTsKICAgICAgICAgICAgcmV0dXJuICRyZXR1cm4uJyAtIDxiPkNoYW5nZSBUbzwvYj4gLSAnLiRkYXRhW2tleSgkZGF0YSldOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAkcmV0dXJuOwogICAgICAgIH0KICAgIH0KCn0K