<?php
bolt_decrypt( __FILE__ , '8FNgZs'); return 0;
##!!!##CnVzZSBBcHBcTW9kZWxzXERpc3RyaWN0Owp1c2UgQXBwXE1vZGVsc1xFbXBsb3llZTsKdXNlIEFwcFxNb2RlbHNcSHJcQXJlYTsKdXNlIEFwcFxNb2RlbHNcSHJcQmlsbFR5cGU7CnVzZSBBcHBcTW9kZWxzXEhyXEJvbnVzVHlwZTsKdXNlIEFwcFxNb2RlbHNcSHJcRGVwYXJ0bWVudDsKdXNlIEFwcFxNb2RlbHNcSHJcRGVzaWduYXRpb247CnVzZSBBcHBcTW9kZWxzXEhyXEVhcm5lZExlYXZlOwp1c2UgQXBwXE1vZGVsc1xIclxGbG9vcjsKdXNlIEFwcFxNb2RlbHNcSHJcSHJNb250aGx5U2FsYXJ5Owp1c2UgQXBwXE1vZGVsc1xIclxMZWF2ZTsKdXNlIEFwcFxNb2RlbHNcSHJcTGluZTsKdXNlIEFwcFxNb2RlbHNcSHJcRW1wVHlwZTsKdXNlIEFwcFxNb2RlbHNcSHJcTG9jYXRpb247CnVzZSBBcHBcTW9kZWxzXEhyXFNhbGFyeUF1ZGl0Owp1c2UgQXBwXE1vZGVsc1xIclxTZWN0aW9uOwp1c2UgQXBwXE1vZGVsc1xIclxTaGlmdDsKdXNlIEFwcFxNb2RlbHNcSHJcU3Vic2VjdGlvbjsKdXNlIEFwcFxNb2RlbHNcSHJcVW5pdDsKdXNlIEFwcFxNb2RlbHNcVXBhemlsbGE7CnVzZSBBcHBcTW9kZWxzXFVzZXJMb2c7CnVzZSBBcHBcVXNlcjsKdXNlIENhcmJvblxDYXJib247CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xDYWNoZTsKdXNlIElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXERCOwoKCmlmKCFmdW5jdGlvbl9leGlzdHMoJ2NoZWNrX3Blcm1pc3Npb24nKSl7CgogICAgZnVuY3Rpb24gY2hlY2tfcGVybWlzc2lvbigkcGVybWlzc2lvbikKICAgIHsKICAgICAgICAkcGVybSA9IGZhbHNlOwogICAgICAgIGlmKGF1dGgoKS0+dXNlcigpLT5jYW4oJHBlcm1pc3Npb24pIHx8IGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdTdXBlciBBZG1pbicpKXsKICAgICAgICAgICAgJHBlcm0gPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRwZXJtOwogICAgfQp9CgppZighZnVuY3Rpb25fZXhpc3RzKCdnZXRfYXR0X3RhYmxlJykpewoKCWZ1bmN0aW9uIGdldF9hdHRfdGFibGUoJHVuaXQgPSBudWxsKQoJewoJCSR0YWJsZU5hbWUgPSAiIjsKICAgICAgICAvLyBhbGwgbWJtIHVuaXQgMTQ1CiAgICAgICAgaWYoJHVuaXQ9PSAxIHx8ICR1bml0ID09IDQgfHwgJHVuaXQgPT01IHx8ICR1bml0ID09MTQ1KXsKICAgICAgICAgICAgJHRhYmxlTmFtZT0gImhyX2F0dGVuZGFuY2VfbWJtIjsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZigkdW5pdD09Mil7CiAgICAgICAgICAgICR0YWJsZU5hbWU9ICJocl9hdHRlbmRhbmNlX2NlaWwiOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmKCR1bml0PT0zKXsKICAgICAgICAgICAgJHRhYmxlTmFtZT0gImhyX2F0dGVuZGFuY2VfYXFsIjsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZigkdW5pdD09OCl7CiAgICAgICAgICAgICR0YWJsZU5hbWU9ICJocl9hdHRlbmRhbmNlX2NldyI7CiAgICAgICAgfWVsc2UgaWYoJHVuaXQ9PTkpewogICAgICAgICAgICAkdGFibGVOYW1lPSAiaHJfYXR0ZW5kYW5jZSI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHRhYmxlTmFtZTsKCX0KfQoKaWYoIWZ1bmN0aW9uX2V4aXN0cygnZ2V0X2F0dF9tb2RlbCcpKXsKCiAgICBmdW5jdGlvbiBnZXRfYXR0X21vZGVsKCR1bml0ID0gbnVsbCkKICAgIHsKICAgICAgICAkbW9kZWxOYW1lID0gIiI7CiAgICAgICAgLy8gYWxsIG1ibSB1bml0IDE0NQogICAgICAgIGlmKCR1bml0PT0gMSB8fCAkdW5pdCA9PSA0IHx8ICR1bml0ID09NSB8fCAkdW5pdCA9PTE0NSl7CiAgICAgICAgICAgICRtb2RlbE5hbWU9ICJcQXBwXE1vZGVsc1xIclxBdHRNQk0iOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmKCR1bml0PT0yKXsKICAgICAgICAgICAgJG1vZGVsTmFtZT0gIlxBcHBcTW9kZWxzXEhyXEF0dENFSUwiOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmKCR1bml0PT0zKXsKICAgICAgICAgICAgJG1vZGVsTmFtZT0gIlxBcHBcTW9kZWxzXEhyXEF0dEFRTCI7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYoJHVuaXQ9PTgpewogICAgICAgICAgICAkbW9kZWxOYW1lPSAiXEFwcFxNb2RlbHNcSHJcQXR0Q0VXIjsKICAgICAgICB9ZWxzZSBpZigkdW5pdD09OSl7CiAgICAgICAgICAgICRtb2RlbE5hbWU9ICJcQXBwXE1vZGVsc1xIclxBdHRlbmRhY2UiOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRtb2RlbE5hbWU7CiAgICB9Cn0KCmlmKCFmdW5jdGlvbl9leGlzdHMoJ3NzZWxlY3RlZCcpKXsKICAgIGZ1bmN0aW9uIHNzZWxlY3RlZCgkdmFsdWUxLCAkdmFsdWUyKQogICAgewogICAgICAgIGlmKCR2YWx1ZTEgPT0gJHZhbHVlMikgewogICAgICAgICAgICByZXR1cm4gInNlbGVjdGVkPSdzZWxlY3RlZCciOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJyc7CiAgICB9Cn0KCmlmKCFmdW5jdGlvbl9leGlzdHMoJ3NhbGFyeV9sb2NrX2RhdGUnKSl7CiAgICBmdW5jdGlvbiBzYWxhcnlfbG9ja19kYXRlKCkKICAgIHsKICAgICAgICByZXR1cm4gIENhY2hlOjpyZW1lbWJlcignc2FsYXJ5X2xvY2tfZGF0ZScsIDEwMDAwMDAwMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gREI6OnRhYmxlKCdocl9zeXN0ZW1fc2V0dGluZycpLT5maXJzdCgpLT5zYWxhcnlfbG9jazsKICAgICAgICB9KTsKCiAgICB9Cn0KCi8qCiAqIEdldCBtYXhpbXVtIHNhbGFyeSBmcm9tIGJlbmVmaXRzIHRhYmxlCiAqLwoKaWYoIWZ1bmN0aW9uX2V4aXN0cygnZ2V0X3NhbGFyeV9tYXgnKSl7CiAgICBmdW5jdGlvbiBnZXRfc2FsYXJ5X21heCgpCiAgICB7CiAgICAgICAgcmV0dXJuICBDYWNoZTo6cmVtZW1iZXIoJ3NhbGFyeV9tYXgnLCAxMDAwMDAwMDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIERCOjp0YWJsZSgnaHJfYmVuZWZpdHMnKS0+bWF4KCdiZW5fY3VycmVudF9zYWxhcnknKTsKICAgICAgICB9KTsKCiAgICB9Cn0KCi8qCiAqIEdldCBtaW5pbXVtIHNhbGFyeSBmcm9tIGJlbmVmaXRzIHRhYmxlCiAqLwoKaWYoIWZ1bmN0aW9uX2V4aXN0cygnZ2V0X3NhbGFyeV9taW4nKSl7CiAgICBmdW5jdGlvbiBnZXRfc2FsYXJ5X21pbigpCiAgICB7CiAgICAgICAgcmV0dXJuICBDYWNoZTo6cmVtZW1iZXIoJ3NhbGFyeV9taW4nLCAxMDAwMDAwMDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIERCOjp0YWJsZSgnaHJfYmVuZWZpdHMnKS0+bWluKCdiZW5fY3VycmVudF9zYWxhcnknKTsKICAgICAgICB9KTsKCiAgICB9Cn0KCgoKaWYoIWZ1bmN0aW9uX2V4aXN0cygnbWFyaXRpYWxfYmFuZ2xhJykpewogICAgZnVuY3Rpb24gbWFyaXRpYWxfYmFuZ2xhKCRpbmZvKQogICAgewogICAgICAgIGlmKCRpbmZvID09ICdNYXJyaWVkJyl7CiAgICAgICAgICAgICRzdGF0dXMgPSAn4Kas4Ka/4Kas4Ka+4Ka54Ka/4KakJzsKICAgICAgICB9ZWxzZSBpZigkaW5mbyA9PSAnVW5tYXJyaWVkJyl7CiAgICAgICAgICAgICRzdGF0dXMgPSAn4KaF4Kas4Ka/4Kas4Ka+4Ka54Ka/4KakJzsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgJHN0YXR1cyA9ICcnOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHN0YXR1czsKICAgIH0KfQoKaWYoIWZ1bmN0aW9uX2V4aXN0cygncmVsaWdpb25fYmFuZ2xhJykpewogICAgZnVuY3Rpb24gcmVsaWdpb25fYmFuZ2xhKCRpbmZvKQogICAgewogICAgICAgIGlmKCRpbmZvID09ICdJc2xhbScpewogICAgICAgICAgICAkc3RhdHVzID0gJ+Cmh+CmuOCmsuCmvuCmric7CiAgICAgICAgfWVsc2UgaWYoJGluZm8gPT0gJ0hpbmR1aXNtJyl7CiAgICAgICAgICAgICRzdGF0dXMgPSAn4Ka54Ka/4Kao4KeN4Kam4KeBJzsKICAgICAgICB9ZWxzZSBpZigkaW5mbyA9PSAnQ2hyaXN0aWFucycpewogICAgICAgICAgICAkc3RhdHVzID0gJ+CmluCnjeCmsOCmv+CmuOCnjeCmn+CmvuCmqCc7CiAgICAgICAgfWVsc2UgaWYoJGluZm8gPT0gJ0J1ZGRoaXN0cycpewogICAgICAgICAgICAkc3RhdHVzID0gJ+CmrOCnjOCmpuCnjeCmpyc7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICRzdGF0dXMgPSAnJzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRzdGF0dXM7CiAgICB9Cn0KCmlmKCFmdW5jdGlvbl9leGlzdHMoJ21vbnRobHlfYWN0aXZpdHlfY2xvc2UnKSl7CiAgICBmdW5jdGlvbiBtb250aGx5X2FjdGl2aXR5X2Nsb3NlKCRkYXRhKXsKICAgICAgICAkZmxhZyA9IDE7IC8vIGxvY2sKICAgICAgICAkc2FsYXJ5U3RhdHVzID0gU2FsYXJ5QXVkaXQ6OmNoZWNrU2FsYXJ5QXVkaXRTdGF0dXMoJGRhdGEpOwogICAgICAgIGlmKCRzYWxhcnlTdGF0dXMgPT0gbnVsbCl7CiAgICAgICAgICAgICRmbGFnID0gMDsgLy8gdW5sb2NrCiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIGlmKCRzYWxhcnlTdGF0dXMtPmhyX2F1ZGl0ID09IG51bGwpewogICAgICAgICAgICAgICAgJGZsYWcgPSAwOyAvLyB1bmxvY2sKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRmbGFnOwogICAgfQp9CgppZighZnVuY3Rpb25fZXhpc3RzKCdudW1iZXJfdG9fdGltZScpKXsKICAgIGZ1bmN0aW9uIG51bWJlcl90b190aW1lKCRudW1iZXIpCiAgICB7CiAgICAgICAgJG51bWJlciA9IHJvdW5kKCRudW1iZXIsMSk7CiAgICAgICAgJGhvdXIgPSBleHBsb2RlKCIuIiwgJG51bWJlcik7CiAgICAgICAgaWYoaXNzZXQoJGhvdXJbMV0pKXsKICAgICAgICAgICAgcmV0dXJuICRob3VyWzBdLic6Jy5yb3VuZCgkaG91clsxXSo2KTsKICAgICAgICB9ZWxzZQogICAgICAgICAgICByZXR1cm4gJGhvdXJbMF07CiAgICB9Cn0KCmlmKCFmdW5jdGlvbl9leGlzdHMoJ2VuZ190b19ibicpKXsKICAgIGZ1bmN0aW9uIGVuZ190b19ibigkdmFsdWUpCiAgICB7CiAgICAgICAgJGVuID0gYXJyYXkoJzAnLCcxJywnMicsJzMnLCc0JywnNScsJzYnLCc3JywnOCcsJzknLCAnSmFudWFyeScsICdGZWJydWFyeScsICdNYXJjaCcsICdBcHJpbCcsICdNYXknLCAnSnVuZScsICdKdWx5JywgJ0F1Z3VzdCcsICdTZXB0ZW1iZXInLCAnT2N0b2JlcicsICdOb3ZlbWJlcicsICdEZWNlbWJlcicsJywnKTsKICAgICAgICAkYm4gPSBhcnJheSgn4KemJywgJ+CnpycsICfgp6gnLCAn4KepJywgICfgp6onLCAn4KerJywgJ+CnrCcsICfgp60nLCAn4KeuJywgJ+CnrycsICfgppzgpr7gpqjgp4Hgpq/gprzgpr7gprDgp4AnLCAn4Kar4KeH4Kas4KeN4Kaw4KeB4Kav4Ka84Ka+4Kaw4Ka/JywgJ+CmruCmvuCmsOCnjeCmmicsICfgpo/gpqrgp43gprDgpr/gprInLCAn4Kau4KeHJywgJ+CmnOCngeCmqCcsICfgppzgp4HgprLgpr7gpocnLCAn4KaG4KaX4Ka44KeN4KafJywgJ+CmuOCnh+CmquCnjeCmn+Cnh+CmruCnjeCmrOCmsCcsICfgpoXgppXgp43gpp/gp4vgpqzgprAnLCAn4Kao4Kat4KeH4Kau4KeN4Kas4KawJywgJ+CmoeCmv+CmuOCnh+CmruCnjeCmrOCmsCcsJywnKTsKCiAgICAgICAgcmV0dXJuIHN0cl9yZXBsYWNlKCRlbiwgJGJuLCAkdmFsdWUpOwogICAgfQp9CgppZighZnVuY3Rpb25fZXhpc3RzKCdudW1fdG9fYm5fbW9udGgnKSl7CiAgICBmdW5jdGlvbiBudW1fdG9fYm5fbW9udGgoJHZhbHVlKQogICAgewoKICAgICAgICAkbW9udGggPSBhcnJheSgnJywn4Kac4Ka+4Kao4KeB4Kav4Ka84Ka+4Kaw4KeAJywgJ+Cmq+Cnh+CmrOCnjeCmsOCngeCmr+CmvOCmvuCmsOCmvycsICfgpq7gpr7gprDgp43gpponLCAn4KaP4Kaq4KeN4Kaw4Ka/4KayJywgJ+CmruCnhycsICfgppzgp4HgpqgnLCAn4Kac4KeB4Kay4Ka+4KaHJywgJ+CmhuCml+CmuOCnjeCmnycsICfgprjgp4fgpqrgp43gpp/gp4fgpq7gp43gpqzgprAnLCAn4KaF4KaV4KeN4Kaf4KeL4Kas4KawJywgJ+CmqOCmreCnh+CmruCnjeCmrOCmsCcsICfgpqHgpr/gprjgp4fgpq7gp43gpqzgprAnKTsKCiAgICAgICAgcmV0dXJuICRtb250aFsoaW50KSAkdmFsdWVdOwogICAgfQp9CgppZighZnVuY3Rpb25fZXhpc3RzKCdkYXRlX3RvX2JuX21vbnRoJykpewogICAgZnVuY3Rpb24gZGF0ZV90b19ibl9tb250aCgkZGF0ZSkKICAgIHsKICAgICAgICAkbl9tb250aCA9IGRhdGUoJ24nLCBzdHJ0b3RpbWUoJGRhdGUpKTsKICAgICAgICAkbl95ZWFyID0gZW5nX3RvX2JuKGRhdGUoJ1knLCBzdHJ0b3RpbWUoJGRhdGUpKSk7CgogICAgICAgICRtb250aCA9IGFycmF5KCcnLCfgppzgpr7gpqjgp4Hgpq/gprzgpr7gprDgp4AnLCAn4Kar4KeH4Kas4KeN4Kaw4KeB4Kav4Ka84Ka+4Kaw4Ka/JywgJ+CmruCmvuCmsOCnjeCmmicsICfgpo/gpqrgp43gprDgpr/gprInLCAn4Kau4KeHJywgJ+CmnOCngeCmqCcsICfgppzgp4HgprLgpr7gpocnLCAn4KaG4KaX4Ka44KeN4KafJywgJ+CmuOCnh+CmquCnjeCmn+Cnh+CmruCnjeCmrOCmsCcsICfgpoXgppXgp43gpp/gp4vgpqzgprAnLCAn4Kao4Kat4KeH4Kau4KeN4Kas4KawJywgJ+CmoeCmv+CmuOCnh+CmruCnjeCmrOCmsCcpOwoKICAgICAgICByZXR1cm4gJG1vbnRoWyRuX21vbnRoXS4nLCAnLiRuX3llYXI7CiAgICB9Cn0KCmlmKCFmdW5jdGlvbl9leGlzdHMoJ2JuX21vbmV5JykpewogICAgZnVuY3Rpb24gYm5fbW9uZXkoJHZhbHVlKQogICAgewogICAgICAgIHJldHVybiBwcmVnX3JlcGxhY2UoIi8oXGQrPykoPz0oXGRcZCkrKFxkKSg/IVxkKSkoXC5cZCspPy9pIiwgIiQxLCIsICR2YWx1ZSk7CiAgICB9Cn0KCmlmKCFmdW5jdGlvbl9leGlzdHMoJ251bV90b193b3JkJykpewogICAgZnVuY3Rpb24gbnVtX3RvX3dvcmQoJG51bSkKICAgIHsKICAgICAgICAkbnVtID0gc3RyX3JlcGxhY2UoYXJyYXkoJywnLCAnICcpLCAnJyAsIHRyaW0oJG51bSkpOwogICAgICAgIGlmKCEgJG51bSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgICRudW0gPSAoaW50KSAkbnVtOwogICAgICAgICR3b3JkcyA9IGFycmF5KCk7CiAgICAgICAgJGxpc3QxID0gYXJyYXkoJycsICdvbmUnLCAndHdvJywgJ3RocmVlJywgJ2ZvdXInLCAnZml2ZScsICdzaXgnLCAnc2V2ZW4nLCAnZWlnaHQnLCAnbmluZScsICd0ZW4nLCAnZWxldmVuJywKICAgICAgICAgICAgJ3R3ZWx2ZScsICd0aGlydGVlbicsICdmb3VydGVlbicsICdmaWZ0ZWVuJywgJ3NpeHRlZW4nLCAnc2V2ZW50ZWVuJywgJ2VpZ2h0ZWVuJywgJ25pbmV0ZWVuJwogICAgICAgICk7CiAgICAgICAgJGxpc3QyID0gYXJyYXkoJycsICd0ZW4nLCAndHdlbnR5JywgJ3RoaXJ0eScsICdmb3J0eScsICdmaWZ0eScsICdzaXh0eScsICdzZXZlbnR5JywgJ2VpZ2h0eScsICduaW5ldHknLCAnaHVuZHJlZCcpOwogICAgICAgICRsaXN0MyA9IGFycmF5KCcnLCAndGhvdXNhbmQnLCAnbWlsbGlvbicsICdiaWxsaW9uJywgJ3RyaWxsaW9uJywgJ3F1YWRyaWxsaW9uJywgJ3F1aW50aWxsaW9uJywgJ3NleHRpbGxpb24nLCAnc2VwdGlsbGlvbicsCiAgICAgICAgICAgICdvY3RpbGxpb24nLCAnbm9uaWxsaW9uJywgJ2RlY2lsbGlvbicsICd1bmRlY2lsbGlvbicsICdkdW9kZWNpbGxpb24nLCAndHJlZGVjaWxsaW9uJywgJ3F1YXR0dW9yZGVjaWxsaW9uJywKICAgICAgICAgICAgJ3F1aW5kZWNpbGxpb24nLCAnc2V4ZGVjaWxsaW9uJywgJ3NlcHRlbmRlY2lsbGlvbicsICdvY3RvZGVjaWxsaW9uJywgJ25vdmVtZGVjaWxsaW9uJywgJ3ZpZ2ludGlsbGlvbicKICAgICAgICApOwogICAgICAgICRudW1fbGVuZ3RoID0gc3RybGVuKCRudW0pOwogICAgICAgICRsZXZlbHMgPSAoaW50KSAoKCRudW1fbGVuZ3RoICsgMikgLyAzKTsKICAgICAgICAkbWF4X2xlbmd0aCA9ICRsZXZlbHMgKiAzOwogICAgICAgICRudW0gPSBzdWJzdHIoJzAwJyAuICRudW0sIC0kbWF4X2xlbmd0aCk7CiAgICAgICAgJG51bV9sZXZlbHMgPSBzdHJfc3BsaXQoJG51bSwgMyk7CiAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgY291bnQoJG51bV9sZXZlbHMpOyAkaSsrKSB7CiAgICAgICAgICAgICRsZXZlbHMtLTsKICAgICAgICAgICAgJGh1bmRyZWRzID0gKGludCkgKCRudW1fbGV2ZWxzWyRpXSAvIDEwMCk7CiAgICAgICAgICAgICRodW5kcmVkcyA9ICgkaHVuZHJlZHMgPyAnICcgLiAkbGlzdDFbJGh1bmRyZWRzXSAuICcgaHVuZHJlZCcgLiAnICcgOiAnJyk7CiAgICAgICAgICAgICR0ZW5zID0gKGludCkgKCRudW1fbGV2ZWxzWyRpXSAlIDEwMCk7CiAgICAgICAgICAgICRzaW5nbGVzID0gJyc7CiAgICAgICAgICAgIGlmICggJHRlbnMgPCAyMCApIHsKICAgICAgICAgICAgICAgICR0ZW5zID0gKCR0ZW5zID8gJyAnIC4gJGxpc3QxWyR0ZW5zXSAuICcgJyA6ICcnICk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkdGVucyA9IChpbnQpKCR0ZW5zIC8gMTApOwogICAgICAgICAgICAgICAgJHRlbnMgPSAnICcgLiAkbGlzdDJbJHRlbnNdIC4gJyAnOwogICAgICAgICAgICAgICAgJHNpbmdsZXMgPSAoaW50KSAoJG51bV9sZXZlbHNbJGldICUgMTApOwogICAgICAgICAgICAgICAgJHNpbmdsZXMgPSAnICcgLiAkbGlzdDFbJHNpbmdsZXNdIC4gJyAnOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR3b3Jkc1tdID0gJGh1bmRyZWRzIC4gJHRlbnMgLiAkc2luZ2xlcyAuICggKCAkbGV2ZWxzICYmICggaW50ICkgKCAkbnVtX2xldmVsc1skaV0gKSApID8gJyAnIC4gJGxpc3QzWyRsZXZlbHNdIC4gJyAnIDogJycgKTsKICAgICAgICB9IC8vZW5kIGZvciBsb29wCiAgICAgICAgJGNvbW1hcyA9IGNvdW50KCR3b3Jkcyk7CiAgICAgICAgaWYgKCRjb21tYXMgPiAxKSB7CiAgICAgICAgICAgICRjb21tYXMgPSAkY29tbWFzIC0gMTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGltcGxvZGUoJyAnLCAkd29yZHMpOwogICAgfQp9CgoKaWYoIWZ1bmN0aW9uX2V4aXN0cygnbnVtYmVyX3RvX3RpbWVfZm9ybWF0JykpewogICAgZnVuY3Rpb24gbnVtYmVyX3RvX3RpbWVfZm9ybWF0KCRudW1iZXIpCiAgICB7CiAgICAgICAgJG51bWJlciA9IHJvdW5kKCRudW1iZXIsMSk7CiAgICAgICAgJGhvdXIgPSBleHBsb2RlKCIuIiwgJG51bWJlcik7CiAgICAgICAgaWYoaXNzZXQoJGhvdXJbMV0pKXsKICAgICAgICAgICAgJGhvdXJbMV0gPSByb3VuZCgkaG91clsxXSo2KTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgJGhvdXJbMV0gPSAnMDAnOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJGhvdXJbMF0uJzonLiRob3VyWzFdOwogICAgfQp9CgoKaWYoIWZ1bmN0aW9uX2V4aXN0cygnbG9nX2ZpbGVfd3JpdGUnKSl7CgogICAgZnVuY3Rpb24gbG9nX2ZpbGVfd3JpdGUoJG1lc3NhZ2UsICRldmVudF9pZCkKICAgIHsKICAgICAgICAkbG9nX21lc3NhZ2UgPSBkYXRlKCJZLW0tZCBIOmk6cyIpLiIgXCIiLmF1dGgoKS0+dXNlcigpLT5hc3NvY2lhdGVfaWQuIlwiICIuJG1lc3NhZ2UuIiAiLiRldmVudF9pZC5QSFBfRU9MOwogICAgICAgICRsb2dfbWVzc2FnZSAuPSBmaWxlX2dldF9jb250ZW50cygiYXNzZXRzL2xvZy50eHQiKTsKICAgICAgICBmaWxlX3B1dF9jb250ZW50cygiYXNzZXRzL2xvZy50eHQiLCAkbG9nX21lc3NhZ2UpOwoKICAgICAgICAvLyBzdG9yZSB1c2VyIGxvZwogICAgICAgICRsb2dzID0gVXNlckxvZzo6d2hlcmUoJ2xvZ19hc19pZCcsIGF1dGgoKS0+aWQoKSktPm9yZGVyQnkoJ3VwZGF0ZWRfYXQnLCdBU0MnKS0+Z2V0KCk7CgogICAgICAgIGlmKGNvdW50KCRsb2dzKTwzKXsKICAgICAgICAgICAgJHVzZXJfbG9nPSBuZXcgVXNlckxvZygpOwogICAgICAgIH1lbHNlewogICAgICAgICAgICAkdXNlcl9sb2cgPSAkbG9ncy0+Zmlyc3QoKTsKICAgICAgICAgICAgJHVzZXJfbG9nLT5pZCA9ICRsb2dzLT5maXJzdCgpLT5pZDsKICAgICAgICB9CiAgICAgICAgICAgICR1c2VyX2xvZy0+bG9nX2FzX2lkID0gYXV0aCgpLT5pZCgpOwogICAgICAgICAgICAkdXNlcl9sb2ctPmxvZ19tZXNzYWdlID0gJG1lc3NhZ2U7CiAgICAgICAgICAgICR1c2VyX2xvZy0+bG9nX3RhYmxlID0gJyc7CiAgICAgICAgICAgICR1c2VyX2xvZy0+bG9nX3Jvd19ubyA9ICRldmVudF9pZDsKICAgICAgICAgICAgJHVzZXJfbG9nLT5zYXZlKCk7CiAgICB9Cn0KCmlmKCFmdW5jdGlvbl9leGlzdHMoJ2VtcF9yZW1haW5fbGVhdmVfY2hlY2snKSl7CiAgICBmdW5jdGlvbiBlbXBfcmVtYWluX2xlYXZlX2NoZWNrKCRyZXF1ZXN0KQogICAgewogICAgICAgICRzdGF0ZW1lbnQgPSBbXTsKICAgICAgICAkc3RhdGVtZW50WydzdGF0J10gPSAiZmFsc2UiOwogICAgICAgICRhc3NvY2lhdGVfaWQgPSAkcmVxdWVzdC0+YXNzb2NpYXRlX2lkOwogICAgICAgIGlmKGF1dGgoKS0+dXNlcigpLT5hc3NvY2lhdGVfaWQgPT0gJGFzc29jaWF0ZV9pZCl7CiAgICAgICAgICAgICRoZWxsbyA9ICdZb3UgaGF2ZSc7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICRoZWxsbyA9ICdUaGlzIGVtcGxveWVlIGhhcyc7CiAgICAgICAgfQoKICAgICAgICAkbWVtYmVyX2pvaW5fZGF0ZSA9IERCOjp0YWJsZSgnaHJfYXNfYmFzaWNfaW5mbycpLT53aGVyZSgnYXNzb2NpYXRlX2lkJywgJGFzc29jaWF0ZV9pZCktPmZpcnN0KCk7CiAgICAgICAgJG1lbWJlcl9qb2luX3llYXIgPSBkYXRlKCdZJywgc3RydG90aW1lKCRtZW1iZXJfam9pbl9kYXRlLT5hc19kb2opKTsKICAgICAgICAkbWVtYmVyX2pvaW5fbW9udGggPSBkYXRlKCdtJywgc3RydG90aW1lKCRtZW1iZXJfam9pbl9kYXRlLT5hc19kb2opKTsKCgogICAgICAgIGlmKCRyZXF1ZXN0LT5sZWF2ZV90eXBlPT0gIkVhcm5lZCIpewogICAgICAgICAgICAkc3RhdGVtZW50WydzdGF0J10gPSAidHJ1ZSI7CiAgICAgICAgICAgIC8qJGVhcm5lZCA9IERCOjp0YWJsZSgnaHJfZWFybmVkX2xlYXZlJykKICAgICAgICAgICAgICAgICAgICAgICAgLT5zZWxlY3QoREI6OnJhdygnc3VtKGVhcm5lZCAtIGVuam95ZWQpIGFzIGwnKSkKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnYXNzb2NpYXRlX2lkJywgJGFzc29jaWF0ZV9pZCkKICAgICAgICAgICAgICAgICAgICAgICAgLT5ncm91cEJ5KCdhc3NvY2lhdGVfaWQnKS0+Zmlyc3QoKS0+bD8/MDsKICAgICAgICAgICAgLy9kZCgkZWFybmVkLCAkcmVxdWVzdC0+c2VsX2RheXMpOwogICAgICAgICAgICAkYXZhaWwgPSAoaW50KSAoJGVhcm5lZC8yKTsKICAgICAgICAgICAgaWYoJGF2YWlsID49ICRyZXF1ZXN0LT5zZWxfZGF5cyl7CiAgICAgICAgICAgICAgICAkc3RhdGVtZW50WydzdGF0J10gPSAidHJ1ZSI7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgJHN0YXRlbWVudFsnc3RhdCddID0gImZhbHNlIjsKICAgICAgICAgICAgICAgIGlmKCRlYXJuZWQgPjApewogICAgICAgICAgICAgICAgICAgICRzdGF0ZW1lbnRbJ21zZyddID0gJGhlbGxvLicgb25seSAnLiRlYXJuZWQuJyBkYXkocykgb2YgRWFybmVkIExlYXZlIGFuZCB5b3UgY2FuIHRha2Ugb25seSAnLiRhdmFpbC4gJyBkYXkocyknIDsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICRzdGF0ZW1lbnRbJ21zZyddID0gJGhlbGxvLicgbm8gZWFybmVkIGxlYXZlJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSovCiAgICAgICAgfQoKCgogICAgICAgIGlmKCRyZXF1ZXN0LT5sZWF2ZV90eXBlPT0gIkNhc3VhbCIpewogICAgICAgICAgICAkbGVhdmVzID0gREI6OnRhYmxlKCJocl9sZWF2ZSIpCiAgICAgICAgICAgICAgICAtPnNlbGVjdCgKICAgICAgICAgICAgICAgICAgICBEQjo6cmF3KCIKICAgICAgICAgICAgICAgICAgICAgICAgU1VNKENBU0UgV0hFTiBsZWF2ZV90eXBlID0gJ0Nhc3VhbCcgVEhFTiBEQVRFRElGRihsZWF2ZV90bywgbGVhdmVfZnJvbSkrMSBFTkQpIEFTIGNhc3VhbAogICAgICAgICAgICAgICAgICAgICIpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAtPndoZXJlKCJsZWF2ZV9hc3NfaWQiLCAkYXNzb2NpYXRlX2lkKQogICAgICAgICAgICAgICAgLT53aGVyZSgibGVhdmVfc3RhdHVzIiwgIjEiKQogICAgICAgICAgICAgICAgLT53aGVyZShmdW5jdGlvbiAoJHEpewogICAgICAgICAgICAgICAgICAgICRxLT53aGVyZShEQjo6cmF3KCJZRUFSKGxlYXZlX2Zyb20pIiksICc9JywgZGF0ZSgiWSIpKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpcnN0KCk7CgogICAgICAgICAgICBpZiAoJG1lbWJlcl9qb2luX3llYXIgPT0gQ2FyYm9uOjpub3coKS0+eWVhcil7CiAgICAgICAgICAgICAgICAkY2FzdWFsID0gY2VpbCgoMTAvMTIpKigxMi0oJG1lbWJlcl9qb2luX21vbnRoLTEpKSktJGxlYXZlcy0+Y2FzdWFsOwogICAgICAgICAgICB9IGVsc2V7CiAgICAgICAgICAgICAgICAkY2FzdWFsID0gMTAtJGxlYXZlcy0+Y2FzdWFsOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZigkcmVxdWVzdC0+c2VsX2RheXMgPD0gJGNhc3VhbCl7CiAgICAgICAgICAgICAgICAkc3RhdGVtZW50WydzdGF0J10gPSAidHJ1ZSI7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgJHN0YXRlbWVudFsnbXNnJ10gPSAkaGVsbG8uJyAnLiRjYXN1YWwuJyBkYXkocykgb2YgQ2FzdWFsIExlYXZlJzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBTaWNrIExlYXZlIFJlc3RyaWN0aW9uCiAgICAgICAgaWYoJHJlcXVlc3QtPmxlYXZlX3R5cGU9PSAiU2ljayIpewogICAgICAgICAgICAkbGVhdmVzID0gREI6OnRhYmxlKCJocl9sZWF2ZSIpCiAgICAgICAgICAgICAgICAtPnNlbGVjdCgKICAgICAgICAgICAgICAgICAgICBEQjo6cmF3KCIKICAgICAgICAgICAgICAgICAgICAgICAgU1VNKENBU0UgV0hFTiBsZWF2ZV90eXBlID0gJ1NpY2snIFRIRU4gREFURURJRkYobGVhdmVfdG8sIGxlYXZlX2Zyb20pKzEgRU5EKSBBUyBzaWNrCiAgICAgICAgICAgICAgICAgICAgIikKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIC0+d2hlcmUoImxlYXZlX2Fzc19pZCIsICRhc3NvY2lhdGVfaWQpCiAgICAgICAgICAgICAgICAtPndoZXJlKCJsZWF2ZV9zdGF0dXMiLCAiMSIpCiAgICAgICAgICAgICAgICAtPndoZXJlKGZ1bmN0aW9uICgkcSl7CiAgICAgICAgICAgICAgICAgICAgJHEtPndoZXJlKERCOjpyYXcoIllFQVIobGVhdmVfZnJvbSkiKSwgJz0nLCBkYXRlKCJZIikpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+Zmlyc3QoKTsKCiAgICAgICAgICAgIGlmICgkbWVtYmVyX2pvaW5feWVhciA9PSBDYXJib246Om5vdygpLT55ZWFyKXsKICAgICAgICAgICAgICAgICRzaWNrID0gY2VpbCgoMTQvMTIpKigxMi0oJG1lbWJlcl9qb2luX21vbnRoLTEpKSktJGxlYXZlcy0+c2ljazsKICAgICAgICAgICAgfSBlbHNlewogICAgICAgICAgICAgICAgJHNpY2sgPSAxNC0kbGVhdmVzLT5zaWNrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCRyZXF1ZXN0LT5zZWxfZGF5cyA8PSAkc2ljayl7CiAgICAgICAgICAgICAgICAkc3RhdGVtZW50WydzdGF0J10gPSAidHJ1ZSI7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgaWYgKCRtZW1iZXJfam9pbl95ZWFyID09IENhcmJvbjo6bm93KCktPnllYXIpewogICAgICAgICAgICAgICAgICAgICRzaWNrID0gY2VpbCgoMTQvMTIpKigxMi0oJG1lbWJlcl9qb2luX21vbnRoLTEpKSktJGxlYXZlcy0+c2ljazsKICAgICAgICAgICAgICAgICAgICAkc3RhdGVtZW50Wydtc2cnXSA9ICRoZWxsby4nICcuJHNpY2suJyBkYXkocykgb2YgU2ljaygnLmNlaWwoKDE0LzEyKSooMTItKCRtZW1iZXJfam9pbl9tb250aC0xKSkpLicpIExlYXZlJzsKICAgICAgICAgICAgICAgIH0gZWxzZXsKICAgICAgICAgICAgICAgICAgICAkc3RhdGVtZW50Wydtc2cnXSA9ICRoZWxsby4nICcuJHNpY2suJyBkYXkocykgb2YgU2ljaygxNCkgTGVhdmUnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIE1hdGVybml0eSBMZWF2ZSBSZXN0cmljdGlvbgogICAgICAgIGlmKCRyZXF1ZXN0LT5sZWF2ZV90eXBlPT0gIk1hdGVybml0eSIpewogICAgICAgICAgICAkbGVhdmVzID0gREI6OnRhYmxlKCJocl9sZWF2ZSIpCiAgICAgICAgICAgICAgICAtPnNlbGVjdCgKICAgICAgICAgICAgICAgICAgICBEQjo6cmF3KCIKICAgICAgICAgICAgICAgICAgICAgICAgU1VNKENBU0UgV0hFTiBsZWF2ZV90eXBlID0gJ01hdGVybml0eScgVEhFTiBEQVRFRElGRihsZWF2ZV90bywgbGVhdmVfZnJvbSkrMSBFTkQpIEFTIG1hdGVybml0eQogICAgICAgICAgICAgICAgICAgICIpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAtPndoZXJlKCJsZWF2ZV9hc3NfaWQiLCAkcmVxdWVzdC0+YXNzb2NpYXRlX2lkKQogICAgICAgICAgICAgICAgLT53aGVyZSgibGVhdmVfc3RhdHVzIiwgMSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoZnVuY3Rpb24gKCRxKXsKICAgICAgICAgICAgICAgICAgICAkcS0+d2hlcmUoREI6OnJhdygiWUVBUihsZWF2ZV9mcm9tKSIpLCAnPScsIGRhdGUoIlkiKSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maXJzdCgpOwogICAgICAgICAgICAkcmVtYWluID0gMTEyLSgkbGVhdmVzLT5tYXRlcm5pdHk/PzApOwogICAgICAgICAgICAvL2RkKCRyZXF1ZXN0LT5zZWxfZGF5cyk7CiAgICAgICAgICAgIGlmKCRsZWF2ZXMgPT0gbnVsbCB8fCAoJGxlYXZlcyAhPSBudWxsICYmICRyZXF1ZXN0LT5zZWxfZGF5czwgJHJlbWFpbikgKSB7CiAgICAgICAgICAgICAgICAkc3RhdGVtZW50WydzdGF0J10gPSAidHJ1ZSI7CiAgICAgICAgICAgIH1lbHNlIGlmICgoJGxlYXZlcyAhPSBudWxsICYmICRyZXF1ZXN0LT5zZWxfZGF5cyA+ICRyZW1haW4pKXsKICAgICAgICAgICAgICAgICRzdGF0ZW1lbnRbJ21zZyddID0gJGhlbGxvLicgb25seSAnLiRyZW1haW4uJyBkYXkocykgcmVtYWluJzsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAkc3RhdGVtZW50Wydtc2cnXSA9ICRoZWxsby4nIGFscmVhZHkgdGFrZW4gTWF0ZXJuaXR5IExlYXZlJzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZigkcmVxdWVzdC0+bGVhdmVfdHlwZSA9PSAiU3BlY2lhbCIpewogICAgICAgICAgICAkc3RhdGVtZW50WydzdGF0J10gPSAidHJ1ZSI7CiAgICAgICAgfQoKICAgICAgICBpZigkc3RhdGVtZW50WydzdGF0J10gPT0gJ3RydWUnKXsKICAgICAgICAgICAgJGZyb21fZGF0ZSA9IG5ldyBcRGF0ZVRpbWUoJHJlcXVlc3QtPmZyb21fZGF0ZSk7CiAgICAgICAgICAgICR0b19kYXRlID0gbmV3IFxEYXRlVGltZSgkcmVxdWVzdC0+dG9fZGF0ZSk7CiAgICAgICAgICAgICR0b19kYXRlLT5tb2RpZnkoIisxIGRheSIpOwogICAgICAgICAgICAkaW50ZXJ2YWwgPSBEYXRlSW50ZXJ2YWw6OmNyZWF0ZUZyb21EYXRlU3RyaW5nKCcxIGRheScpOwogICAgICAgICAgICAkcGVyaW9kID0gbmV3IERhdGVQZXJpb2QoJGZyb21fZGF0ZSwgJGludGVydmFsLCAkdG9fZGF0ZSk7CiAgICAgICAgICAgIC8vZGQoJHBlcmlvZCApOwogICAgICAgICAgICAkc3RhdGVtZW50Wydtc2cnXSA9ICRoZWxsby4nIGFscmVhZHkgdGFrZW4vYXBwbGllZCBmb3IgbGVhdmUgYXQgPGJyPic7CiAgICAgICAgICAgIGZvcmVhY2ggKCRwZXJpb2QgYXMgJGR0KSB7CiAgICAgICAgICAgICAgICAkbGVhdmUgPSBMZWF2ZTo6d2hlcmUoJ2xlYXZlX2Zyb20nLCc8PScsICRkdC0+Zm9ybWF0KCJZLW0tZCIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnbGVhdmVfdG8nLCc+PScsICRkdC0+Zm9ybWF0KCJZLW0tZCIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnbGVhdmVfYXNzX2lkJywgJHJlcXVlc3QtPmFzc29jaWF0ZV9pZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlbigkcmVxdWVzdCwgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UgKCRyZXF1ZXN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXNzZXQoJHJlcXVlc3QtPmxlYXZlX2lkKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2lkJywgJyE9JywgJHJlcXVlc3QtPmxlYXZlX2lkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5maXJzdCgpOwogICAgICAgICAgICAgICAgaWYoJGxlYXZlKXsKICAgICAgICAgICAgICAgICAgICBpZigkbGVhdmUtPmxlYXZlX3N0YXR1cyA9PSAxKXsKICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXR1cyA9ICc8c3BhbiBzdHlsZT0iY29sb3I6IzAwYjMwMDsiPkFwcHJvdmVkPC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYoJGxlYXZlLT5sZWF2ZV9zdGF0dXMgPT0gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0dXMgPSAnQXBwbGllZCc7CiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0dXMgPSAnJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJHN0YXRlbWVudFsnc3RhdCddID0gImZhbHNlIjsKICAgICAgICAgICAgICAgICAgICAkc3RhdGVtZW50Wydtc2cnXSAuPSAkZHQtPmZvcm1hdCgiWS1tLWQiKS4nIDxzcGFuIHN0eWxlPSJjb2xvcjojMDAwOyI+LS0tICcuJGxlYXZlLT5sZWF2ZV90eXBlLictLS08L3NwYW4+ICcuJHN0YXR1cy4nPGJyPic7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAkc3RhdGVtZW50OwogICAgfQp9CgppZighZnVuY3Rpb25fZXhpc3RzKCdnZXRfdW5pdF9uYW1lX2J5X2lkJykpewogICAgZnVuY3Rpb24gZ2V0X3VuaXRfbmFtZV9ieV9pZCgkaWQpCiAgICB7CiAgICAgICAgJHVuaXRfbmFtZSA9ICcnOwogICAgICAgIGlmKGlzX251bWVyaWMoJGlkKSkgewogICAgICAgICAgICAkdW5pdCA9IHVuaXRfYnlfaWQoKTsKICAgICAgICAgICAgJHVuaXRfbmFtZSA9ICR1bml0WyRpZF0tPmhyX3VuaXRfc2hvcnRfbmFtZT8/Jyc7CgogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICR1bml0X25hbWU7CiAgICB9Cn0KCmlmKCFmdW5jdGlvbl9leGlzdHMoJ2VtcF9zdGF0dXNfbmFtZScpKXsKICAgIGZ1bmN0aW9uIGVtcF9zdGF0dXNfbmFtZSgkc3RhdHVzKQogICAgewogICAgICAgICRuYW1lID0gJyc7CiAgICAgICAgaWYoJHN0YXR1cyA9PSAxKSB7CiAgICAgICAgICAgICRuYW1lID0gJ2FjdGl2ZSc7CiAgICAgICAgfSBlbHNlIGlmKCRzdGF0dXMgPT0gMikgewogICAgICAgICAgICAkbmFtZSA9ICdyZXNpZ24nOwogICAgICAgIH0gZWxzZSBpZigkc3RhdHVzID09IDMpIHsKICAgICAgICAgICAgJG5hbWUgPSAndGVybWluYXRlJzsKICAgICAgICB9IGVsc2UgaWYoJHN0YXR1cyA9PSA0KSB7CiAgICAgICAgICAgICRuYW1lID0gJ3N1c3BlbmQnOwogICAgICAgIH0gZWxzZSBpZigkc3RhdHVzID09IDUpIHsKICAgICAgICAgICAgJG5hbWUgPSAnbGVmdCc7CiAgICAgICAgfSBlbHNlIGlmKCRzdGF0dXMgPT0gNikgewogICAgICAgICAgICAkbmFtZSA9ICdtYXRlcm5pdHknOwogICAgICAgIH0gZWxzZSBpZigkc3RhdHVzID09IDI1KXsKICAgICAgICAgICAgJG5hbWUgPSAnTGVmdCAmIFJlc2lnbic7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkbmFtZTsKICAgIH0KfQoKaWYoIWZ1bmN0aW9uX2V4aXN0cygnbnVtX3RvX3RpbWUnKSl7CiAgICBmdW5jdGlvbiBudW1fdG9fdGltZSgkbnVtYmVyKXsKICAgICAgICAkbnVtYmVyID0gcm91bmQoJG51bWJlciwxKTsKICAgICAgICAkaG91ciA9IGV4cGxvZGUoIi4iLCAkbnVtYmVyKTsKICAgICAgICBpZihpc3NldCgkaG91clsxXSkpewogICAgICAgICAgICByZXR1cm4gJGhvdXJbMF0uJzonLnJvdW5kKCRob3VyWzFdKjYpOwogICAgICAgIH1lbHNlCiAgICAgICAgICAgIHJldHVybiAkaG91clswXTsKICAgIH0KfQoKaWYoIWZ1bmN0aW9uX2V4aXN0cygnZW1wX3Byb2ZpbGVfcGljdHVyZScpKXsKICAgIGZ1bmN0aW9uIGVtcF9wcm9maWxlX3BpY3R1cmUoJGVtcGxveWVlKQogICAgewogICAgICAgICRkZWZhdWx0ID0gKCRlbXBsb3llZS0+YXNfZ2VuZGVyID09ICdGZW1hbGUnPycvYXNzZXRzL2ltYWdlcy91c2VyLzEuanBnJzonL2Fzc2V0cy9pbWFnZXMvdXNlci8wOS5qcGcnKTsKCiAgICAgICAgaWYoJGVtcGxveWVlLT5hc19waWMgIT0gbnVsbCAmJiBmaWxlX2V4aXN0cyhwdWJsaWNfcGF0aCgkZW1wbG95ZWUtPmFzX3BpYykpKXsKICAgICAgICAgICAgJGltYWdlID0gJGVtcGxveWVlLT5hc19waWM7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICRpbWFnZSA9ICRkZWZhdWx0OwogICAgICAgIH0KICAgICAgICByZXR1cm4gJGltYWdlOwogICAgfQp9CgppZighZnVuY3Rpb25fZXhpc3RzKCdnZXRfZW1wbG95ZWVfYnlfaWQnKSkKewogICAgZnVuY3Rpb24gZ2V0X2VtcGxveWVlX2J5X2lkKCRhc3NvY2lhdGVfaWQgPSBudWxsKQogICAgewogICAgICAgICRlbXAgPSBFbXBsb3llZTo6c2VsZWN0KAogICAgICAgICAgICAgICAgJ2hyX2FzX2Jhc2ljX2luZm8uKicsCiAgICAgICAgICAgICAgICAndS5ocl91bml0X2lkJywKICAgICAgICAgICAgICAgICd1LmhyX3VuaXRfbmFtZScsCiAgICAgICAgICAgICAgICAndS5ocl91bml0X3Nob3J0X25hbWUnLAogICAgICAgICAgICAgICAgJ3UuaHJfdW5pdF9uYW1lX2JuJywKICAgICAgICAgICAgICAgICd1LmhyX3VuaXRfYWRkcmVzcycsCiAgICAgICAgICAgICAgICAndS5ocl91bml0X2FkZHJlc3NfYm4nLAogICAgICAgICAgICAgICAgJ2YuaHJfZmxvb3JfbmFtZScsCiAgICAgICAgICAgICAgICAnZi5ocl9mbG9vcl9uYW1lX2JuJywKICAgICAgICAgICAgICAgICdsLmhyX2xpbmVfbmFtZScsCiAgICAgICAgICAgICAgICAnbC5ocl9saW5lX25hbWVfYm4nLAogICAgICAgICAgICAgICAgJ2RwLmhyX2RlcGFydG1lbnRfbmFtZScsCiAgICAgICAgICAgICAgICAnZHAuaHJfZGVwYXJ0bWVudF9uYW1lX2JuJywKICAgICAgICAgICAgICAgICdkZy5ocl9kZXNpZ25hdGlvbl9uYW1lJywKICAgICAgICAgICAgICAgICdkZy5ocl9kZXNpZ25hdGlvbl9uYW1lX2JuJywKICAgICAgICAgICAgICAgICdkZy5ocl9kZXNpZ25hdGlvbl9ncmFkZScsCiAgICAgICAgICAgICAgICAnYS4qJywKICAgICAgICAgICAgICAgICdiZS4qJywKICAgICAgICAgICAgICAgICdtLionLAogICAgICAgICAgICAgICAgJ2UuaHJfZW1wX3R5cGVfbmFtZScsCiAgICAgICAgICAgICAgICAnYXIuaHJfYXJlYV9uYW1lJywKICAgICAgICAgICAgICAgICdzZS5ocl9zZWN0aW9uX25hbWUnLAogICAgICAgICAgICAgICAgJ3NlLmhyX3NlY3Rpb25fbmFtZV9ibicsCiAgICAgICAgICAgICAgICAnc2IuaHJfc3Vic2VjX25hbWUnLAogICAgICAgICAgICAgICAgJ3NiLmhyX3N1YnNlY19uYW1lX2JuJywKICAgICAgICAgICAgICAgICdibi4qJywKICAgICAgICAgICAgICAgICMgdW5pdC9mbG9vci9saW5lL3NoaWYKICAgICAgICAgICAgICAgIERCOjpyYXcoIgogICAgICAgICAgICAgICAgICAgIENPTkNBVF9XUygnLiAnLAogICAgICAgICAgICAgICAgICAgICAgICBDT05DQVQoJ1VuaXQ6ICcsIHUuaHJfdW5pdF9zaG9ydF9uYW1lKSwKICAgICAgICAgICAgICAgICAgICAgICAgQ09OQ0FUKCdGbG9vcjogJywgZi5ocl9mbG9vcl9uYW1lKSwKICAgICAgICAgICAgICAgICAgICAgICAgQ09OQ0FUKCdMaW5lOiAnLCBsLmhyX2xpbmVfbmFtZSkKICAgICAgICAgICAgICAgICAgICApIEFTIHVuaXRfZmxvb3JfbGluZQogICAgICAgICAgICAgICAgIiksCiAgICAgICAgICAgICAgICAjIHBlcm1hbmVudCBkaXN0cmljdCAmIHVwYXppbGxhCiAgICAgICAgICAgICAgICAicGVyX2Rpc3QuZGlzX25hbWUgQVMgcGVybWFuZW50X2Rpc3RyaWN0IiwKICAgICAgICAgICAgICAgICJwZXJfZGlzdC5kaXNfbmFtZV9ibiBBUyBwZXJtYW5lbnRfZGlzdHJpY3RfYm4iLAogICAgICAgICAgICAgICAgInBlcl91cHoudXBhX25hbWUgQVMgcGVybWFuZW50X3VwYXppbGxhIiwKICAgICAgICAgICAgICAgICJwZXJfdXB6LnVwYV9uYW1lX2JuIEFTIHBlcm1hbmVudF91cGF6aWxsYV9ibiIsCiAgICAgICAgICAgICAgICAjIHByZXNlbnQgZGlzdHJpY3QgJiB1cGF6aWxsYQogICAgICAgICAgICAgICAgInByZXNfZGlzdC5kaXNfbmFtZSBBUyBwcmVzZW50X2Rpc3RyaWN0IiwKICAgICAgICAgICAgICAgICJwcmVzX2Rpc3QuZGlzX25hbWVfYm4gQVMgcHJlc2VudF9kaXN0cmljdF9ibiIsCiAgICAgICAgICAgICAgICAicHJlc191cHoudXBhX25hbWUgQVMgcHJlc2VudF91cGF6aWxsYSIsCiAgICAgICAgICAgICAgICAicHJlc191cHoudXBhX25hbWVfYm4gQVMgcHJlc2VudF91cGF6aWxsYV9ibiIKICAgICAgICAgICAgKQogICAgICAgICAgICAtPmxlZnRKb2luKCdocl9hcmVhIEFTIGFyJywgJ2FyLmhyX2FyZWFfaWQnLCAnPScsICdocl9hc19iYXNpY19pbmZvLmFzX2FyZWFfaWQnKQogICAgICAgICAgICAtPmxlZnRKb2luKCdocl9zZWN0aW9uIEFTIHNlJywgJ3NlLmhyX3NlY3Rpb25faWQnLCAnPScsICdocl9hc19iYXNpY19pbmZvLmFzX3NlY3Rpb25faWQnKQogICAgICAgICAgICAtPmxlZnRKb2luKCdocl9zdWJzZWN0aW9uIEFTIHNiJywgJ3NiLmhyX3N1YnNlY19pZCcsICc9JywgJ2hyX2FzX2Jhc2ljX2luZm8uYXNfc3Vic2VjdGlvbl9pZCcpCiAgICAgICAgICAgIC0+bGVmdEpvaW4oJ2hyX2VtcF90eXBlIEFTIGUnLCAnZS5lbXBfdHlwZV9pZCcsICc9JywgJ2hyX2FzX2Jhc2ljX2luZm8uYXNfZW1wX3R5cGVfaWQnKQogICAgICAgICAgICAtPmxlZnRKb2luKCdocl91bml0IEFTIHUnLCAndS5ocl91bml0X2lkJywgJz0nLCAnaHJfYXNfYmFzaWNfaW5mby5hc191bml0X2lkJykKICAgICAgICAgICAgLT5sZWZ0Sm9pbignaHJfZmxvb3IgQVMgZicsICdmLmhyX2Zsb29yX2lkJywgJz0nLCAnaHJfYXNfYmFzaWNfaW5mby5hc19mbG9vcl9pZCcpCiAgICAgICAgICAgIC0+bGVmdEpvaW4oJ2hyX2xpbmUgQVMgbCcsICdsLmhyX2xpbmVfaWQnLCAnPScsICdocl9hc19iYXNpY19pbmZvLmFzX2xpbmVfaWQnKQogICAgICAgICAgICAtPmxlZnRKb2luKCdocl9kZXBhcnRtZW50IEFTIGRwJywgJ2RwLmhyX2RlcGFydG1lbnRfaWQnLCAnPScsICdocl9hc19iYXNpY19pbmZvLmFzX2RlcGFydG1lbnRfaWQnKQogICAgICAgICAgICAtPmxlZnRKb2luKCdocl9kZXNpZ25hdGlvbiBBUyBkZycsICdkZy5ocl9kZXNpZ25hdGlvbl9pZCcsICc9JywgJ2hyX2FzX2Jhc2ljX2luZm8uYXNfZGVzaWduYXRpb25faWQnKQogICAgICAgICAgICAtPmxlZnRKb2luKCJocl9hc19hZHZfaW5mbyBBUyBhIiwgImEuZW1wX2Fkdl9pbmZvX2FzX2lkIiwgIj0iLCAiaHJfYXNfYmFzaWNfaW5mby5hc3NvY2lhdGVfaWQiKQogICAgICAgICAgICAtPmxlZnRKb2luKCdocl9iZW5lZml0cyBBUyBiZScsZnVuY3Rpb24gKCRsZWZ0Sm9pbikgewogICAgICAgICAgICAgICAgJGxlZnRKb2luLT5vbignYmUuYmVuX2FzX2lkJywgJz0nICwgJ2hyX2FzX2Jhc2ljX2luZm8uYXNzb2NpYXRlX2lkJykgOwogICAgICAgICAgICAgICAgJGxlZnRKb2luLT53aGVyZSgnYmUuYmVuX3N0YXR1cycsICc9JywgJzEnKSA7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+bGVmdEpvaW4oJ2hyX21lZF9pbmZvIEFTIG0nLCAnbS5tZWRfYXNfaWQnLCAnPScsICdocl9hc19iYXNpY19pbmZvLmFzc29jaWF0ZV9pZCcpCgogICAgICAgICAgICAjcGVybWFuZW50IGRpc3RyaWN0ICYgdXBhemlsbGEKICAgICAgICAgICAgLT5sZWZ0Sm9pbignaHJfZGlzdCBBUyBwZXJfZGlzdCcsICdwZXJfZGlzdC5kaXNfaWQnLCAnPScsICdhLmVtcF9hZHZfaW5mb19wZXJfZGlzdCcpCiAgICAgICAgICAgIC0+bGVmdEpvaW4oJ2hyX3VwYXppbGxhIEFTIHBlcl91cHonLCAncGVyX3Vwei51cGFfaWQnLCAnPScsICdhLmVtcF9hZHZfaW5mb19wZXJfdXB6JykKICAgICAgICAgICAgI3ByZXNlbnQgZGlzdHJpY3QgJiB1cGF6aWxsYQogICAgICAgICAgICAtPmxlZnRKb2luKCdocl9kaXN0IEFTIHByZXNfZGlzdCcsICdwcmVzX2Rpc3QuZGlzX2lkJywgJz0nLCAnYS5lbXBfYWR2X2luZm9fcHJlc19kaXN0JykKICAgICAgICAgICAgLT5sZWZ0Sm9pbignaHJfdXBhemlsbGEgQVMgcHJlc191cHonLCAncHJlc191cHoudXBhX2lkJywgJz0nLCAnYS5lbXBfYWR2X2luZm9fcHJlc191cHonKQogICAgICAgICAgICAtPmxlZnRKb2luKCdocl9lbXBsb3llZV9iZW5nYWxpIEFTIGJuJywgJ2JuLmhyX2JuX2Fzc29jaWF0ZV9pZCcsICc9JywgJ2hyX2FzX2Jhc2ljX2luZm8uYXNzb2NpYXRlX2lkJykKICAgICAgICAgICAgLT53aGVyZSgiaHJfYXNfYmFzaWNfaW5mby5hc3NvY2lhdGVfaWQiLCAkYXNzb2NpYXRlX2lkKQogICAgICAgICAgICAtPndoZXJlSW4oJ2hyX2FzX2Jhc2ljX2luZm8uYXNfdW5pdF9pZCcsIGF1dGgoKS0+dXNlcigpLT51bml0X3Blcm1pc3Npb25zKCkpCiAgICAgICAgICAgIC0+Zmlyc3QoKTsKCiAgICAgICAgaWYoJGVtcCl7CiAgICAgICAgICAgICRlbXAtPmFzX3BpYyA9IGVtcF9wcm9maWxlX3BpY3R1cmUoJGVtcCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJGVtcDsKICAgIH0KfQoKaWYoIWZ1bmN0aW9uX2V4aXN0cygnZ2V0X2NvbXBsZXRlX3VzZXJfaW5mbycpKXsKICAgIGZ1bmN0aW9uIGdldF9jb21wbGV0ZV91c2VyX2luZm8oJGFzc29jaWF0ZV9pZCA9IG51bGwpCiAgICB7CiAgICAgICAgJGluZm89IERCOjp0YWJsZSgnaHJfYXNfYmFzaWNfaW5mbyBBUyBiJykKICAgICAgICAgICAgLT5zZWxlY3QoCiAgICAgICAgICAgICAgICAnYi4qJywKICAgICAgICAgICAgICAgICdhLionLAogICAgICAgICAgICAgICAgJ2JlLionLAogICAgICAgICAgICAgICAgJ20uKicsCiAgICAgICAgICAgICAgICAnYm4uKicKICAgICAgICAgICAgKQogICAgICAgICAgICAtPmxlZnRKb2luKCJocl9hc19hZHZfaW5mbyBBUyBhIiwgImEuZW1wX2Fkdl9pbmZvX2FzX2lkIiwgIj0iLCAiYi5hc3NvY2lhdGVfaWQiKQogICAgICAgICAgICAtPmxlZnRKb2luKCdocl9iZW5lZml0cyBBUyBiZScsZnVuY3Rpb24gKCRsZWZ0Sm9pbikgewogICAgICAgICAgICAgICAgJGxlZnRKb2luLT5vbignYmUuYmVuX2FzX2lkJywgJz0nICwgJ2IuYXNzb2NpYXRlX2lkJykgOwogICAgICAgICAgICAgICAgJGxlZnRKb2luLT53aGVyZSgnYmUuYmVuX3N0YXR1cycsICc9JywgJzEnKSA7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+bGVmdEpvaW4oJ2hyX21lZF9pbmZvIEFTIG0nLCAnbS5tZWRfYXNfaWQnLCAnPScsICdiLmFzc29jaWF0ZV9pZCcpCiAgICAgICAgICAgIC0+bGVmdEpvaW4oJ2hyX2VtcGxveWVlX2JlbmdhbGkgQVMgYm4nLCAnYm4uaHJfYm5fYXNzb2NpYXRlX2lkJywgJz0nLCAnYi5hc3NvY2lhdGVfaWQnKQogICAgICAgICAgICAtPndoZXJlKCJiLmFzc29jaWF0ZV9pZCIsICRhc3NvY2lhdGVfaWQpCiAgICAgICAgICAgIC0+d2hlcmVJbignYi5hc191bml0X2lkJywgYXV0aCgpLT51c2VyKCktPnVuaXRfcGVybWlzc2lvbnMoKSkKICAgICAgICAgICAgLT5maXJzdCgpOwoKICAgICAgICAgICAgJGluZm9jb3VudD0wOyAkdG90YWxpbmZvPTA7CiAgICAgICAgICAgIGZvcmVhY2ggKCRpbmZvIGFzICRrZXkgPT4kaW5mb3ZhbHVlKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZigkaW5mb3ZhbHVlIT1udWxsKXsgJGluZm9jb3VudCsrO30KICAgICAgICAgICAgICAgICR0b3RhbGluZm8rKzsKICAgICAgICAgICAgfQogICAgICAgICAgICAkcGVyX2NvbXBsZXRlPXJvdW5kKCgoJGluZm9jb3VudC8kdG90YWxpbmZvKSoxMDApLCAyKTsKICAgICAgICByZXR1cm4gJHBlcl9jb21wbGV0ZTsKICAgIH0KfQoKLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAqIENhY2hlIG1ldGhvZHMKICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwppZighZnVuY3Rpb25fZXhpc3RzKCdlbXBsb3llZV9jb3VudCcpKXsKICAgIGZ1bmN0aW9uIGVtcGxveWVlX2NvdW50KCkKICAgIHsKCiAgICAgICAgcmV0dXJuIERCOjp0YWJsZSgnaHJfYXNfYmFzaWNfaW5mbycpLT5zZWxlY3QoCiAgICAgICAgICAgICAgICBEQjo6cmF3KCIKICAgICAgICAgICAgICAgICAgQ09VTlQoQ0FTRSBXSEVOIGFzX2dlbmRlciA9ICdNYWxlJyBUSEVOIGFzX2lkIEVORCkgQVMgbWFsZXMsCiAgICAgICAgICAgICAgICAgIENPVU5UKENBU0UgV0hFTiBhc19nZW5kZXIgPSAnRmVtYWxlJyBUSEVOIGFzX2lkIEVORCkgQVMgZmVtYWxlcywKICAgICAgICAgICAgICAgICAgQ09VTlQoQ0FTRSBXSEVOIGFzX290ID0gJzAnIFRIRU4gYXNfaWQgRU5EKSBBUyBub25fb3QsCiAgICAgICAgICAgICAgICAgIENPVU5UKENBU0UgV0hFTiBhc19vdCA9ICcxJyBUSEVOIGFzX2lkIEVORCkgQVMgb3QsCiAgICAgICAgICAgICAgICAgIENPVU5UKENBU0UgV0hFTiBhc19zdGF0dXMgIT0gJzEnIFRIRU4gYXNfaWQgRU5EKSBBUyBpbmFjdGl2ZSwKICAgICAgICAgICAgICAgICAgQ09VTlQoQ0FTRSBXSEVOIGFzX3N0YXR1cyA9ICcxJyBUSEVOIGFzX2lkIEVORCkgQVMgYWN0aXZlLAogICAgICAgICAgICAgICAgICBDT1VOVChDQVNFIFdIRU4gYXNfZG9qID0gQ1VSREFURSgpIFRIRU4gYXNfaWQgRU5EKSBBUyB0b2RheXNfam9pbiwKICAgICAgICAgICAgICAgICAgQ09VTlQoKikgQVMgdG90YWwKICAgICAgICAgICAgICAgICIpCiAgICAgICAgICAgICkKICAgICAgICAgICAgLT53aGVyZSgnYXNfc3RhdHVzJywxKQogICAgICAgICAgICAtPndoZXJlSW4oJ2FzX3VuaXRfaWQnLCBhdXRoKCktPnVzZXIoKS0+dW5pdF9wZXJtaXNzaW9ucygpKQogICAgICAgICAgICAtPndoZXJlSW4oJ2FzX2xvY2F0aW9uJywgYXV0aCgpLT51c2VyKCktPmxvY2F0aW9uX3Blcm1pc3Npb25zKCkpCiAgICAgICAgICAgIC0+Zmlyc3QoKTsKICAgIH0KfQoKaWYoIWZ1bmN0aW9uX2V4aXN0cygnY2FjaGVfYXR0X2FsbCcpKXsKICAgIGZ1bmN0aW9uIGNhY2hlX2F0dF9hbGwoKQogICAgewogICAgICAgIENhY2hlOjpwdXQoJ2F0dF9tYm0nLCBjYWNoZV9hdHRfbWJtKCksIDEwMDAwMDApOwogICAgICAgIENhY2hlOjpwdXQoJ2F0dF9hcWwnLCBjYWNoZV9hdHRfYXFsKCksIDEwMDAwMDApOwogICAgICAgIENhY2hlOjpwdXQoJ2F0dF9jZWlsJywgY2FjaGVfYXR0X2NlaWwoKSwgMTAwMDAwMCk7CiAgICAgICAgQ2FjaGU6OnB1dCgnYXR0X21ibTInLCBjYWNoZV9hdHRfbWJtMigpLCAxMDAwMDAwKTsKICAgICAgICBDYWNoZTo6cHV0KCdhdHRfbWZ3JywgY2FjaGVfYXR0X21mdygpLCAxMDAwMDAwKTsKICAgICAgICBDYWNoZTo6cHV0KCdhdHRfbWZ3JywgY2FjaGVfYXR0X2NldygpLCAxMDAwMDAwKTsKICAgIH0KfQoKCmlmKCFmdW5jdGlvbl9leGlzdHMoJ2NhY2hlX3RvZGF5X2F0dCcpKXsKICAgIGZ1bmN0aW9uIGNhY2hlX3RvZGF5X2F0dCgpCiAgICB7CgogICAgICAgICR0b2RheSA9IGRhdGUoIlktbS1kIik7CiAgICAgICAgJGRhdGEgPSBbXTsKCiAgICAgICAgJG1ibSA9IERCOjp0YWJsZSgnaHJfYXR0ZW5kYW5jZV9tYm0gQVMgYScpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdhLmluX2RhdGUnLCAkdG9kYXkpCiAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCdocl9hc19iYXNpY19pbmZvIEFTIGInLCAnYi5hc19pZCcsICdhLmFzX2lkJykKICAgICAgICAgICAgICAgIC0+cGx1Y2soJ2IuYXNzb2NpYXRlX2lkJywnYi5hc3NvY2lhdGVfaWQnKS0+dG9BcnJheSgpOwoKICAgICAgICAkY2VpbCA9ICBEQjo6dGFibGUoJ2hyX2F0dGVuZGFuY2VfY2VpbCBBUyBhJykKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2EuaW5fZGF0ZScsICR0b2RheSkKICAgICAgICAgICAgICAgIC0+bGVmdEpvaW4oJ2hyX2FzX2Jhc2ljX2luZm8gQVMgYicsICdiLmFzX2lkJywgJ2EuYXNfaWQnKQogICAgICAgICAgICAgICAgLT5wbHVjaygnYi5hc3NvY2lhdGVfaWQnLCdiLmFzc29jaWF0ZV9pZCcpLT50b0FycmF5KCk7CgogICAgICAgICRhcWwgPSBEQjo6dGFibGUoJ2hyX2F0dGVuZGFuY2VfYXFsIEFTIGEnKQogICAgICAgICAgICAgICAgLT53aGVyZSgnYS5pbl9kYXRlJywgJHRvZGF5KQogICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbignaHJfYXNfYmFzaWNfaW5mbyBBUyBiJywgJ2IuYXNfaWQnLCAnYS5hc19pZCcpCiAgICAgICAgICAgICAgICAtPnBsdWNrKCdiLmFzc29jaWF0ZV9pZCcsJ2IuYXNzb2NpYXRlX2lkJyktPnRvQXJyYXkoKTsKCiAgICAgICAgJGNldyA9IERCOjp0YWJsZSgnaHJfYXR0ZW5kYW5jZV9jZXcgQVMgYScpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdhLmluX2RhdGUnLCAkdG9kYXkpCiAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCdocl9hc19iYXNpY19pbmZvIEFTIGInLCAnYi5hc19pZCcsICdhLmFzX2lkJykKICAgICAgICAgICAgICAgIC0+cGx1Y2soJ2IuYXNzb2NpYXRlX2lkJywnYi5hc3NvY2lhdGVfaWQnKS0+dG9BcnJheSgpOwoKICAgICAgICAkZGF0YVsncHJlc2VudCddICA9IGFycmF5X21lcmdlKCRtYm0sJGNlaWwsJGFxbCwkY2V3KTsKCgoKICAgICAgICAkZGF0YVsnbGVhdmUnXSA9IERCOjp0YWJsZSgnaHJfbGVhdmUnKQogICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2xlYXZlX2Zyb20nLCAnPD0nLCAkdG9kYXkpCiAgICAgICAgICAgICAgICAgLT53aGVyZSgnbGVhdmVfdG8nLCAgICc+PScsICR0b2RheSkKICAgICAgICAgICAgICAgICAtPndoZXJlKCdsZWF2ZV9zdGF0dXMnLCAnPScsIDEpCiAgICAgICAgICAgICAgICAgLT5wbHVjaygnbGVhdmVfYXNzX2lkJywnbGVhdmVfYXNzX2lkJyktPnRvQXJyYXkoKTsKCiAgICAgICAgJGRhdGFbJ2Fic2VudCddID0gREI6OnRhYmxlKCdocl9hYnNlbnQnKQogICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2RhdGUnLCR0b2RheSkKICAgICAgICAgICAgICAgICAgICAgICAtPnBsdWNrKCdhc3NvY2lhdGVfaWQnLCdhc3NvY2lhdGVfaWQnKS0+dG9BcnJheSgpOwoKICAgICAgICAkZGF0YVsnaG9saWRheSddID0gREI6OnRhYmxlKCdob2xpZGF5X3JvYXN0ZXInKQogICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdkYXRlJywkdG9kYXkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3JlbWFya3MnLCdIb2xpZGF5JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5wbHVjaygnYXNfaWQnLCdhc19pZCcpLT50b0FycmF5KCk7CiAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgJ2RhdGUnID0+ICR0b2RheSwKICAgICAgICAgICAgJ2RhdGEnID0+ICRkYXRhCiAgICAgICAgXTsKCiAgICB9Cn0KCgppZighZnVuY3Rpb25fZXhpc3RzKCdjYWNoZV9kYWlseV9vcGVyYXRpb24nKSl7CiAgICBmdW5jdGlvbiBjYWNoZV9kYWlseV9vcGVyYXRpb24oJHVuaXQgPSBudWxsKQogICAgewoKICAgICAgICBDYWNoZTo6cHV0KCd0b2RheV9hdHQnLCBjYWNoZV90b2RheV9hdHQoJHVuaXQpLCAxMDAwMDAwKTsKICAgICAgICBjYWNoZV9hdHRfYWxsKCk7CiAgICAgICAgQ2FjaGU6OnB1dCgnbW9udGhseV9vdCcsIGNhY2hlX21vbnRobHlfb3QoKSwgMTAwMDAwMCk7CiAgICAgICAgQ2FjaGU6OnB1dCgnbW9udGhseV9zYWxhcnknLCBjYWNoZV9tb250aGx5X3NhbGFyeSgpLCAxMDAwMDAwKTsKICAgIH0KfQoKaWYoIWZ1bmN0aW9uX2V4aXN0cygnY2FjaGVfYXR0X21ibScpKXsKICAgIGZ1bmN0aW9uIGNhY2hlX2F0dF9tYm0oKQogICAgewogICAgICAgIHJldHVybiBEQjo6dGFibGUoJ2hyX2F0dGVuZGFuY2VfbWJtIGFzIG0nKQogICAgICAgIC0+c2VsZWN0KCdiLmFzX2lkJywgJ20uaW5fZGF0ZScpCiAgICAgICAgLT53aGVyZU1vbnRoKCdtLmluX2RhdGUnLGRhdGUoJ20nKSkKICAgICAgICAtPndoZXJlWWVhcignbS5pbl9kYXRlJyxkYXRlKCdZJykpCiAgICAgICAgLT5sZWZ0Sm9pbignaHJfYXNfYmFzaWNfaW5mbyBhcyBiJywnYi5hc19pZCcsJ20uYXNfaWQnKQogICAgICAgIC0+d2hlcmUoJ2IuYXNfdW5pdF9pZCcsIDEpCiAgICAgICAgLT5nZXQoKQogICAgICAgIC0+Z3JvdXBCeSgnaW5fZGF0ZScpLT50b0FycmF5KCk7CiAgICB9Cn0KCmlmKCFmdW5jdGlvbl9leGlzdHMoJ2NhY2hlX2F0dF9tYm0yJykpewogICAgZnVuY3Rpb24gY2FjaGVfYXR0X21ibTIoKQogICAgewogICAgICAgIHJldHVybiBEQjo6dGFibGUoJ2hyX2F0dGVuZGFuY2VfbWJtIGFzIG0nKQogICAgICAgIC0+c2VsZWN0KCdiLmFzX2lkJywgJ20uaW5fZGF0ZScpCiAgICAgICAgLT53aGVyZU1vbnRoKCdtLmluX2RhdGUnLGRhdGUoJ20nKSkKICAgICAgICAtPndoZXJlWWVhcignbS5pbl9kYXRlJyxkYXRlKCdZJykpCiAgICAgICAgLT5sZWZ0Sm9pbignaHJfYXNfYmFzaWNfaW5mbyBhcyBiJywnYi5hc19pZCcsJ20uYXNfaWQnKQogICAgICAgIC0+d2hlcmUoJ2IuYXNfdW5pdF9pZCcsIDUpCiAgICAgICAgLT5nZXQoKQogICAgICAgIC0+Z3JvdXBCeSgnaW5fZGF0ZScpLT50b0FycmF5KCk7CiAgICB9Cn0KCmlmKCFmdW5jdGlvbl9leGlzdHMoJ2NhY2hlX2F0dF9tZncnKSl7CiAgICBmdW5jdGlvbiBjYWNoZV9hdHRfbWZ3KCkKICAgIHsKICAgICAgICByZXR1cm4gREI6OnRhYmxlKCdocl9hdHRlbmRhbmNlX21ibSBhcyBtJykKICAgICAgICAtPnNlbGVjdCgnYi5hc19pZCcsICdtLmluX2RhdGUnKQogICAgICAgIC0+d2hlcmVNb250aCgnbS5pbl9kYXRlJyxkYXRlKCdtJykpCiAgICAgICAgLT53aGVyZVllYXIoJ20uaW5fZGF0ZScsZGF0ZSgnWScpKQogICAgICAgIC0+bGVmdEpvaW4oJ2hyX2FzX2Jhc2ljX2luZm8gYXMgYicsJ2IuYXNfaWQnLCdtLmFzX2lkJykKICAgICAgICAtPndoZXJlKCdiLmFzX3VuaXRfaWQnLCA0KQogICAgICAgIC0+Z2V0KCkKICAgICAgICAtPmdyb3VwQnkoJ2luX2RhdGUnKS0+dG9BcnJheSgpOwogICAgfQp9CgppZighZnVuY3Rpb25fZXhpc3RzKCdjYWNoZV9hdHRfYXFsJykpewogICAgZnVuY3Rpb24gY2FjaGVfYXR0X2FxbCgpCiAgICB7CiAgICAgICAgcmV0dXJuIERCOjp0YWJsZSgnaHJfYXR0ZW5kYW5jZV9hcWwnKQogICAgICAgICAgICAtPnNlbGVjdCgnYXNfaWQnLCAnaW5fZGF0ZScpCiAgICAgICAgICAgIC0+d2hlcmVNb250aCgnaW5fZGF0ZScsZGF0ZSgnbScpKQogICAgICAgICAgICAtPndoZXJlWWVhcignaW5fZGF0ZScsZGF0ZSgnWScpKQogICAgICAgICAgICAtPmdldCgpCiAgICAgICAgICAgIC0+Z3JvdXBCeSgnaW5fZGF0ZScpLT50b0FycmF5KCk7CiAgICB9Cn0KCmlmKCFmdW5jdGlvbl9leGlzdHMoJ2NhY2hlX2F0dF9jZWlsJykpewogICAgZnVuY3Rpb24gY2FjaGVfYXR0X2NlaWwoKQogICAgewogICAgICAgIHJldHVybiBEQjo6dGFibGUoJ2hyX2F0dGVuZGFuY2VfY2VpbCcpCiAgICAgICAgICAgIC0+c2VsZWN0KCdhc19pZCcsICdpbl9kYXRlJykKICAgICAgICAgICAgLT53aGVyZU1vbnRoKCdpbl9kYXRlJyxkYXRlKCdtJykpCiAgICAgICAgICAgIC0+d2hlcmVZZWFyKCdpbl9kYXRlJyxkYXRlKCdZJykpCiAgICAgICAgICAgIC0+Z2V0KCkKICAgICAgICAgICAgLT5ncm91cEJ5KCdpbl9kYXRlJyktPnRvQXJyYXkoKTsKICAgIH0KfQoKaWYoIWZ1bmN0aW9uX2V4aXN0cygnY2FjaGVfYXR0X2NldycpKXsKICAgIGZ1bmN0aW9uIGNhY2hlX2F0dF9jZXcoKQogICAgewogICAgICAgIHJldHVybiBEQjo6dGFibGUoJ2hyX2F0dGVuZGFuY2VfY2V3JykKICAgICAgICAgICAgLT5zZWxlY3QoJ2FzX2lkJywgJ2luX2RhdGUnKQogICAgICAgICAgICAtPndoZXJlTW9udGgoJ2luX2RhdGUnLGRhdGUoJ20nKSkKICAgICAgICAgICAgLT53aGVyZVllYXIoJ2luX2RhdGUnLGRhdGUoJ1knKSkKICAgICAgICAgICAgLT5nZXQoKQogICAgICAgICAgICAtPmdyb3VwQnkoJ2luX2RhdGUnKS0+dG9BcnJheSgpOwogICAgfQp9CgoKCmlmKCFmdW5jdGlvbl9leGlzdHMoJ2NhY2hlX21vbnRobHlfb3QnKSl7CiAgICBmdW5jdGlvbiBjYWNoZV9tb250aGx5X290KCkKICAgIHsKICAgICAgICByZXR1cm4gQ2FjaGU6OnJlbWVtYmVyKCdtb250aGx5X290JywgMTAwMDAsIGZ1bmN0aW9uICAoKXsKCiAgICAgICAgICAgIHJldHVybiBEQjo6dGFibGUoJ2hyX21vbnRobHlfc2FsYXJ5JyktPnNlbGVjdFJhdygKICAgICAgICAgICAgICAgICdhc19pZCwgb3RfaG91ciwgQ09OQ0FUKHllYXIsIi0iLG1vbnRoKSBhcyB5bScKICAgICAgICAgICAgKQogICAgICAgICAgICAtPmdldCgpCiAgICAgICAgICAgIC0+Z3JvdXBCeSgneW0nKQogICAgICAgICAgICAtPnRvQXJyYXkoKTsKICAgICAgICB9KTsKICAgIH0KfQoKaWYoIWZ1bmN0aW9uX2V4aXN0cygnY2FjaGVfbW9udGhseV9zYWxhcnknKSl7CiAgICBmdW5jdGlvbiBjYWNoZV9tb250aGx5X3NhbGFyeSgpCiAgICB7CiAgICAgICAgcmV0dXJuIENhY2hlOjpyZW1lbWJlcignbW9udGhseV9zYWxhcnknLCAxMDAwMCwgZnVuY3Rpb24gICgpewoKICAgICAgICAgICAgcmV0dXJuIERCOjp0YWJsZSgnaHJfbW9udGhseV9zYWxhcnknKS0+c2VsZWN0UmF3KAogICAgICAgICAgICAgICAgJ2FzX2lkLCBzYWxhcnlfcGF5YWJsZSwgKG90X2hvdXIqb3RfcmF0ZSkgYXMgb3QsIENPTkNBVCh5ZWFyLCItIixtb250aCkgYXMgeW0nCiAgICAgICAgICAgICkKICAgICAgICAgICAgLT5nZXQoKQogICAgICAgICAgICAtPmdyb3VwQnkoJ3ltJykKICAgICAgICAgICAgLT50b0FycmF5KCk7CiAgICAgICAgfSk7CiAgICB9Cn0KCgppZighZnVuY3Rpb25fZXhpc3RzKCd1bml0X3dpc2VfdG9kYXlfYXR0JykpewogICAgZnVuY3Rpb24gdW5pdF93aXNlX3RvZGF5X2F0dCgpCiAgICB7CiAgICAgICAgQ2FjaGU6OnB1dCgndG9kYXlfYXR0JywgY2FjaGVfdG9kYXlfYXR0KCksIDEwMDAwKTsKICAgIH0KCn0KaWYoIWZ1bmN0aW9uX2V4aXN0cygnbG9jYXRpb25fYnlfaWQnKSl7CiAgICBmdW5jdGlvbiBsb2NhdGlvbl9ieV9pZCgpCiAgICB7CiAgICAgICAgJGxvY2F0aW9uX3Blcm1pc3Npb25zID0gYXV0aCgpLT51c2VyKCktPmxvY2F0aW9uX3Blcm1pc3Npb25zKCk7CiAgICAgICAgJGRhdGEgPSBDYWNoZTo6cmVtZW1iZXIoJ2xvY2F0aW9uJywgQ2FyYm9uOjpub3coKS0+YWRkSG91cigyMyksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIExvY2F0aW9uOjpvcmRlckJ5KCdocl9sb2NhdGlvbl9uYW1lJywnREVTQycpLT5nZXQoKS0+a2V5QnkoJ2hyX2xvY2F0aW9uX2lkJyktPnRvQXJyYXkoKTsKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIGNvbGxlY3QoJGRhdGEpCiAgICAgICAgICAgICAgICAtPmZpbHRlcihmdW5jdGlvbigkcSkgdXNlICgkbG9jYXRpb25fcGVybWlzc2lvbnMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpbl9hcnJheSgkcVsnaHJfbG9jYXRpb25faWQnXSwgJGxvY2F0aW9uX3Blcm1pc3Npb25zKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPnZhbHVlcygpCiAgICAgICAgICAgICAgICAtPmtleUJ5KCdocl9sb2NhdGlvbl9pZCcpOwoKICAgIH0KfQoKaWYoIWZ1bmN0aW9uX2V4aXN0cygnZGVzaWduYXRpb25fYnlfaWQnKSl7CiAgICBmdW5jdGlvbiBkZXNpZ25hdGlvbl9ieV9pZCgpCiAgICB7CiAgICAgICByZXR1cm4gIENhY2hlOjpyZW1lbWJlcignZGVzaWduYXRpb24nLCAxMDAwMDAwMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gRGVzaWduYXRpb246OmdldCgpLT5rZXlCeSgnaHJfZGVzaWduYXRpb25faWQnKS0+dG9BcnJheSgpOwogICAgICAgIH0pOwoKICAgIH0KfQoKaWYoIWZ1bmN0aW9uX2V4aXN0cygnZGVzaWduYXRpb25fZ3JhZGVfYnlfaWQnKSl7CiAgICBmdW5jdGlvbiBkZXNpZ25hdGlvbl9ncmFkZV9ieV9pZCgpCiAgICB7CiAgICAgICAgcmV0dXJuICBDYWNoZTo6cmVtZW1iZXIoJ2dyYWRlX2J5X2lkJywgQ2FyYm9uOjpub3coKS0+YWRkSG91cigxMiksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIERCOjp0YWJsZSgnaHJfZ3JhZGUnKS0+b3JkZXJCeSgnZ3JhZGVfc2VxdWVuY2UnLCAnYXNjJyktPmdldCgpLT5rZXlCeSgnaWQnKS0+dG9BcnJheSgpOwogICAgICAgIH0pOwoKICAgIH0KfQoKaWYoIWZ1bmN0aW9uX2V4aXN0cygnc2hvcnRkZXNpZ25hdGlvbl9ieV9pZCcpKXsKICAgIGZ1bmN0aW9uIHNob3J0ZGVzaWduYXRpb25fYnlfaWQoKQogICAgewogICAgICAgcmV0dXJuICBDYWNoZTo6cmVtZW1iZXIoJ3Nob3J0ZGVzaWduYXRpb24nLCAxMDAwMDAwMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAkZHMgPSBEZXNpZ25hdGlvbjo6cGx1Y2soJ2hyX2Rlc2lnbmF0aW9uX25hbWUnLCdocl9kZXNpZ25hdGlvbl9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgICAgIHJldHVybiBjb2xsZWN0KCRkcyktPm1hcChmdW5jdGlvbigkaXRlbSl7CiAgICAgICAgICAgICAgICAkYWkgPSBleHBsb2RlKCIgIiwgJGl0ZW0pOwogICAgICAgICAgICAgICAgJHR4dCA9ICcnOwogICAgICAgICAgICAgICAgaWYoY291bnQoJGFpKSA+IDEpCiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJGFpIGFzICRrZXkgPT4gJHZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZihjdHlwZV9hbHBoYShzdWJzdHIoJHZhbCwwLDEpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0eHQgLj0gc3Vic3RyKCR2YWwsMCwxKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHR4dCAuPSBzdWJzdHIoJHZhbCwxLDIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAkdHh0ID0gc3Vic3RyKCRhaVswXSwwLDMpOwoKICAgICAgICAgICAgICAgIHJldHVybiAkdHh0OwogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICB9Cn0KCmlmKCFmdW5jdGlvbl9leGlzdHMoJ3NoaWZ0X2J5X2NvZGUnKSl7CiAgICBmdW5jdGlvbiBzaGlmdF9ieV9jb2RlKCkKICAgIHsKICAgICAgIHJldHVybiAgQ2FjaGU6OnJlbWVtYmVyKCdzaGlmdF9jb2RlJywgMTAwMDAwMDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIFNoaWZ0OjpnZXQoKS0+a2V5QnkoJ2hyX3NoaWZ0X2NvZGUnKS0+dG9BcnJheSgpOwogICAgICAgIH0pOwoKICAgIH0KfQoKaWYoIWZ1bmN0aW9uX2V4aXN0cygndW5pdF9ieV9pZCcpKXsKICAgIGZ1bmN0aW9uIHVuaXRfYnlfaWQoKQogICAgewogICAgICAgICR1bml0X3Blcm1pc3Npb25zID0gYXV0aCgpLT51c2VyKCktPnVuaXRfcGVybWlzc2lvbnMoKTsKICAgICAgICAkZGF0YSA9IENhY2hlOjpyZW1lbWJlcigndW5pdCcsIENhcmJvbjo6bm93KCktPmFkZEhvdXIoMTIpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBVbml0OjpvcmRlckJ5KCdocl91bml0X25hbWUnLCdERVNDJyktPmdldCgpLT5rZXlCeSgnaHJfdW5pdF9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBjb2xsZWN0KCRkYXRhKQogICAgICAgICAgICAgICAgLT5maWx0ZXIoZnVuY3Rpb24oJHEpIHVzZSAoJHVuaXRfcGVybWlzc2lvbnMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpbl9hcnJheSgkcVsnaHJfdW5pdF9pZCddLCAkdW5pdF9wZXJtaXNzaW9ucyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT52YWx1ZXMoKQogICAgICAgICAgICAgICAgLT5rZXlCeSgnaHJfdW5pdF9pZCcpOwoKICAgIH0KfQoKaWYoIWZ1bmN0aW9uX2V4aXN0cygndW5pdF9saXN0JykpewogICAgZnVuY3Rpb24gdW5pdF9saXN0KCkKICAgIHsKICAgICAgIHJldHVybiAgQ2FjaGU6OnJlbWVtYmVyKCd1bml0X2xpc3QnLCBDYXJib246Om5vdygpLT5hZGRIb3VyKDEyKSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gVW5pdDo6c2VsZWN0KCdocl91bml0X25hbWUnLCAnaHJfdW5pdF9pZCcpLT53aGVyZSgnaHJfdW5pdF9zdGF0dXMnLCAnMScpCiAgICAgICAgICAgIC0+d2hlcmVJbignaHJfdW5pdF9pZCcsIGF1dGgoKS0+dXNlcigpLT51bml0X3Blcm1pc3Npb25zKCkpCiAgICAgICAgICAgIC0+b3JkZXJCeSgnaHJfdW5pdF9uYW1lJywgJ2Rlc2MnKQogICAgICAgICAgICAtPnBsdWNrKCdocl91bml0X25hbWUnLCAnaHJfdW5pdF9pZCcpOwogICAgICAgIH0pOwoKICAgIH0KfQoKaWYoIWZ1bmN0aW9uX2V4aXN0cygncGVybWl0dGVkX3VuaXRfc2hvcnQnKSl7CiAgICBmdW5jdGlvbiBwZXJtaXR0ZWRfdW5pdF9zaG9ydCgpCiAgICB7CiAgICAgICAgJHVuaXQgPSB1bml0X2J5X2lkKCk7CiAgICAgICAgJGF1dGhfdW5pdCA9IGF1dGgoKS0+dXNlcigpLT51bml0X3Blcm1pc3Npb25zKCk7CiAgICAgICAgJHVudGlMaXN0ID0gW107CiAgICAgICAgZm9yZWFjaCgkYXV0aF91bml0IGFzICRrZXkgPT4gJHUpIHsKICAgICAgICAgICAgJHVudGlMaXN0WyR1XSA9ICR1bml0WyR1XVsnaHJfdW5pdF9zaG9ydF9uYW1lJ10/PycnOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICR1bnRpTGlzdDsKCiAgICB9Cn0KCmlmKCFmdW5jdGlvbl9leGlzdHMoJ3Blcm1pdHRlZF91bml0cycpKXsKICAgIGZ1bmN0aW9uIHBlcm1pdHRlZF91bml0cygpCiAgICB7CiAgICAgICAkdW5pdHMgPSAgQ2FjaGU6OnJlbWVtYmVyKCdwZXJtaXR0ZWRfdW5pdHMnLCBDYXJib246Om5vdygpLT5hZGRIb3VyKDEyKSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gVW5pdDo6d2hlcmUoJ2hyX3VuaXRfc3RhdHVzJywgJzEnKQogICAgICAgICAgICAtPm9yZGVyQnkoJ2hyX3VuaXRfbmFtZScsICdkZXNjJykKICAgICAgICAgICAgLT5wbHVjaygnaHJfdW5pdF9zaG9ydF9uYW1lJywgJ2hyX3VuaXRfaWQnKTsKICAgICAgICB9KTsKICAgICAgICAkcGVybWl0ID0gYXV0aCgpLT51c2VyKCktPnVuaXRfcGVybWlzc2lvbnMoKTsKICAgICAgICAkdW5hbWUgPSAnJzsKICAgICAgICBmb3JlYWNoICgkcGVybWl0IGFzICRrZXkgPT4gJHUpIHsKICAgICAgICAgICAgICAkdW5hbWUgLj0gJyAnLigkdW5pdHNbJHVdPz8nJykuJywnOwogICAgICAgICAgICAgIGlmKCRrZXkgPT0gMikKICAgICAgICAgICAgICAgICR1bmFtZSAuPSAnPGJyPic7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHVuYW1lOwogICAgfQp9CgoKCmlmKCFmdW5jdGlvbl9leGlzdHMoJ2xpbmVfYnlfaWQnKSl7CiAgICBmdW5jdGlvbiBsaW5lX2J5X2lkKCkKICAgIHsKICAgICAgIHJldHVybiAgQ2FjaGU6OnJlbWVtYmVyKCdsaW5lJywgMTAwMDAwMDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIExpbmU6OmdldCgpLT5rZXlCeSgnaHJfbGluZV9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgfSk7CgogICAgfQp9CgppZighZnVuY3Rpb25fZXhpc3RzKCdmbG9vcl9ieV9pZCcpKXsKICAgIGZ1bmN0aW9uIGZsb29yX2J5X2lkKCkKICAgIHsKICAgICAgIHJldHVybiAgQ2FjaGU6OnJlbWVtYmVyKCdmbG9vcicsIDEwMDAwMDAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBGbG9vcjo6Z2V0KCktPmtleUJ5KCdocl9mbG9vcl9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgfSk7CgogICAgfQp9CgppZighZnVuY3Rpb25fZXhpc3RzKCdkZXBhcnRtZW50X2J5X2lkJykpewogICAgZnVuY3Rpb24gZGVwYXJ0bWVudF9ieV9pZCgpCiAgICB7CiAgICAgICByZXR1cm4gIENhY2hlOjpyZW1lbWJlcignZGVwYXJ0bWVudCcsIDEwMDAwMDAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBEZXBhcnRtZW50OjpnZXQoKS0+a2V5QnkoJ2hyX2RlcGFydG1lbnRfaWQnKS0+dG9BcnJheSgpOwogICAgICAgIH0pOwoKICAgIH0KfQoKaWYoIWZ1bmN0aW9uX2V4aXN0cygnc2VjdGlvbl9ieV9pZCcpKXsKICAgIGZ1bmN0aW9uIHNlY3Rpb25fYnlfaWQoKQogICAgewogICAgICAgcmV0dXJuICBDYWNoZTo6cmVtZW1iZXIoJ3NlY3Rpb24nLCAxMDAwMDAwMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gU2VjdGlvbjo6Z2V0KCktPmtleUJ5KCdocl9zZWN0aW9uX2lkJyktPnRvQXJyYXkoKTsKICAgICAgICB9KTsKCiAgICB9Cn0KaWYoIWZ1bmN0aW9uX2V4aXN0cygnc3ViU2VjdGlvbl9ieV9pZCcpKXsKICAgIGZ1bmN0aW9uIHN1YlNlY3Rpb25fYnlfaWQoKQogICAgewogICAgICAgcmV0dXJuICBDYWNoZTo6cmVtZW1iZXIoJ3N1YlNlY3Rpb24nLCAxMDAwMDAwMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gU3Vic2VjdGlvbjo6Z2V0KCktPmtleUJ5KCdocl9zdWJzZWNfaWQnKS0+dG9BcnJheSgpOwogICAgICAgIH0pOwoKICAgIH0KfQoKaWYoIWZ1bmN0aW9uX2V4aXN0cygnYXJlYV9ieV9pZCcpKXsKICAgIGZ1bmN0aW9uIGFyZWFfYnlfaWQoKQogICAgewogICAgICAgcmV0dXJuICBDYWNoZTo6cmVtZW1iZXIoJ2FyZWEnLCAxMDAwMDAwMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gQXJlYTo6Z2V0KCktPmtleUJ5KCdocl9hcmVhX2lkJyktPnRvQXJyYXkoKTsKICAgICAgICB9KTsKCiAgICB9Cn0KCgoKCmlmKCFmdW5jdGlvbl9leGlzdHMoJ2Rpc3RyaWN0X2J5X2lkJykpewogICAgZnVuY3Rpb24gZGlzdHJpY3RfYnlfaWQoKQogICAgewoKICAgICAgIHJldHVybiAgQ2FjaGU6OnJlbWVtYmVyRm9yZXZlcignZGlzdHJpY3RfYnlfaWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBEaXN0cmljdDo6cGx1Y2soJ2Rpc19uYW1lJywgJ2Rpc19pZCcpLT50b0FycmF5KCk7CiAgICAgICAgfSk7CgogICAgfQp9CgppZighZnVuY3Rpb25fZXhpc3RzKCdkaXN0cmljdF9pbmZvX2J5X2lkJykpewogICAgZnVuY3Rpb24gZGlzdHJpY3RfaW5mb19ieV9pZCgpCiAgICB7CgogICAgICAgcmV0dXJuICBDYWNoZTo6cmVtZW1iZXJGb3JldmVyKCdkaXN0cmljdF9pbmZvX2J5X2lkJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gRGlzdHJpY3Q6OmdldCgpLT5rZXlCeSgnZGlzX2lkJyktPnRvQXJyYXkoKTsKICAgICAgICB9KTsKCiAgICB9Cn0KCmlmKCFmdW5jdGlvbl9leGlzdHMoJ3VwemlsYV9pbmZvX2J5X2lkJykpewogICAgZnVuY3Rpb24gdXB6aWxhX2luZm9fYnlfaWQoKQogICAgewogICAgICAgcmV0dXJuICBDYWNoZTo6cmVtZW1iZXJGb3JldmVyKCd1cHppbGFfaW5mb19ieV9pZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIFVwYXppbGxhOjpnZXQoKS0+a2V5QnkoJ3VwYV9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgfSk7CgogICAgfQp9CgppZighZnVuY3Rpb25fZXhpc3RzKCd1cHppbGFfYnlfaWQnKSl7CiAgICBmdW5jdGlvbiB1cHppbGFfYnlfaWQoKQogICAgewogICAgICAgcmV0dXJuICBDYWNoZTo6cmVtZW1iZXJGb3JldmVyKCd1cHppbGFfYnlfaWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBVcGF6aWxsYTo6cGx1Y2soJ3VwYV9uYW1lJywgJ3VwYV9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgfSk7CgogICAgfQp9CgppZighZnVuY3Rpb25fZXhpc3RzKCdib251c190eXBlX2J5X2lkJykpewogICAgZnVuY3Rpb24gYm9udXNfdHlwZV9ieV9pZCgpCiAgICB7CiAgICAgICByZXR1cm4gIENhY2hlOjpyZW1lbWJlcignYm9udXNfdHlwZV9ieV9pZCcsIENhcmJvbjo6bm93KCktPmFkZEhvdXIoMTIpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBCb251c1R5cGU6OmdldCgpLT5rZXlCeSgnaWQnKS0+dG9BcnJheSgpOwogICAgICAgIH0pOwoKICAgIH0KfQoKCgovLyBvdCBmb3JtYXQgY2FsY3VsYXRpb24KZnVuY3Rpb24gbnVtYmVyVG9UaW1lQ2xvY2tGb3JtYXQoJG51bWJlcil7CiAgICAvLyAkbnVtYmVyID0gcm91bmQoJG51bWJlciwxKTsKICAgICRob3VyID0gZXhwbG9kZSgiLiIsICRudW1iZXIpOwoKICAgIGlmKGlzc2V0KCRob3VyWzFdKSl7CiAgICAgICAgJGhvdXJbMV0gPSAnMC4nLiRob3VyWzFdOwogICAgICAgICRob3VyWzFdID0gKCRob3VyWzFdKjYwKTsKICAgICAgICAkaG91clsxXSA9IHNwcmludGYoIiUwMmQiLCByb3VuZCgkaG91clsxXSkpOwogICAgICAgIC8vIHJldHVybiAkaG91clsxXTsKICAgIH1lbHNlewogICAgICAgICRob3VyWzFdID0gJzAwJzsKICAgIH0KCiAgICBpZihlbXB0eSgkaG91clswXSkpewogICAgICAgICRob3VyWzBdID0gMDsKICAgIH0KICAgIGlmKCRob3VyWzFdID09IDYwKXsKICAgICAgICByZXR1cm4gKCRob3VyWzBdKzEpLic6Jy4nMDAnOwogICAgfQogICAgcmV0dXJuICRob3VyWzBdLic6Jy4kaG91clsxXTsKfQovLyBtaW4gdG8gaG91cgppZighZnVuY3Rpb25fZXhpc3RzKCdtaW5fdG9fb3QnKSl7CiAgICBmdW5jdGlvbiBtaW5fdG9fb3QoKQogICAgewogICAgICAgcmV0dXJuICBDYWNoZTo6cmVtZW1iZXJGb3JldmVyKCdtaW5fdG9fb3QnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgJHJhbmdlID0gcmFuZ2UoMCwgNjApOwogICAgICAgICAgICRtaW4gPSBbXTsKICAgICAgICAgICBmb3JlYWNoICgkcmFuZ2UgYXMgJGsgPT4gJHYpIHsKICAgICAgICAgICAgICAgJG1pblska10gPSByb3VuZCgkdi82MCwgMyk7CiAgICAgICAgICAgfQogICAgICAgICAgIHJldHVybiAkbWluOwogICAgICAgIH0pOwogICAgfQp9CgovLyBhbGwgZGF0ZXMgYmV0d2VlbiB0d28gZGF0ZXMKZnVuY3Rpb24gZGlzcGxheUJldHdlZW5Ud29EYXRlcygkZGF0ZTEsICRkYXRlMiwgJGZvcm1hdCA9ICdZLW0tZCcgKSB7CiAgICAkZGF0ZXMgPSBhcnJheSgpOwogICAgJGN1cnJlbnQgPSBzdHJ0b3RpbWUoJGRhdGUxKTsKICAgICRkYXRlMiA9IHN0cnRvdGltZSgkZGF0ZTIpOwogICAgJHN0ZXBWYWwgPSAnKzEgZGF5JzsKICAgIHdoaWxlKCAkY3VycmVudCA8PSAkZGF0ZTIgKSB7CiAgICAgICAgJGRhdGVzW10gPSBkYXRlKCRmb3JtYXQsICRjdXJyZW50KTsKICAgICAgICAkY3VycmVudCA9IHN0cnRvdGltZSgkc3RlcFZhbCwgJGN1cnJlbnQpOwogICAgfQogICAgcmV0dXJuICRkYXRlczsKfQoKZnVuY3Rpb24gbnVtYmVyVG9Nb250aCgkdmFsKQp7CiAgICByZXR1cm4gZGF0ZSgiRiIsIG1rdGltZSgwLCAwLCAwLCAkdmFsLCAxMCkpOwp9CgpmdW5jdGlvbiBtb250aGx5X25hdmJhcigkeWVhck1vbnRoKXsKICAgICRkYXRlID0gQ2FyYm9uOjpwYXJzZSgkeWVhck1vbnRoKTsKICAgICRub3cgPSBDYXJib246Om5vdygpOwogICAgaWYoJGRhdGUtPmRpZmZJbk1vbnRocygkbm93KSA8PSA2ICl7CiAgICAgICAgJG1heCA9IENhcmJvbjo6bm93KCk7CiAgICB9ZWxzZXsKICAgICAgICAkbWF4ID0gJGRhdGUtPmFkZE1vbnRocyg2KTsKICAgIH0KICAgICRtb250aHMgPSBbXTsKICAgICRtb250aHNbZGF0ZSgnWS1tJyldID0gJ0N1cnJlbnQnOwogICAgZm9yICgkaT0xOyAkaSA8PSA5IDsgJGkrKykgewogICAgICAgICRtb250aHNbJG1heC0+Zm9ybWF0KCdZLW0nKV0gPSAkbWF4LT5mb3JtYXQoJ00sIHknKTsKICAgICAgICAkbWF4ID0gJG1heC0+c3ViTW9udGgoMSk7CiAgICB9CiAgICByZXR1cm4gJG1vbnRoczsKfQoKaWYoIWZ1bmN0aW9uX2V4aXN0cygnYmlsbF90eXBlX2J5X2lkJykpewogICAgZnVuY3Rpb24gYmlsbF90eXBlX2J5X2lkKCkKICAgIHsKICAgICAgICAvL3JldHVybiBbJzEnPT4nVGlmZmluJywnMic9PidEaW5uZXInLCAnMyc9PidMdW5jaCcsICc0Jz0+J0lmdGFyJ107CiAgICAgICAgcmV0dXJuICBDYWNoZTo6cmVtZW1iZXIoJ2JpbGxfdHlwZV9ieV9pZCcsIENhcmJvbjo6bm93KCktPmFkZEhvdXIoMTIpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBCaWxsVHlwZTo6cGx1Y2soJ25hbWUnLCAnaWQnKTsKICAgICAgICB9KTsKICAgIH0KfQoKaWYoIWZ1bmN0aW9uX2V4aXN0cygnZW1wX3R5cGVfYnlfaWQnKSl7CiAgICBmdW5jdGlvbiBlbXBfdHlwZV9ieV9pZCgpCiAgICB7CiAgICAgICAgcmV0dXJuICBDYWNoZTo6cmVtZW1iZXIoJ2VtcF90eXBlX2J5X2lkJywgQ2FyYm9uOjpub3coKS0+YWRkSG91cigyNCksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIEVtcFR5cGU6OmdldCgpLT5rZXlCeSgnZW1wX3R5cGVfaWQnKS0+dG9BcnJheSgpOwogICAgICAgIH0pOwogICAgfQp9CgppZighZnVuY3Rpb25fZXhpc3RzKCdjYWNoZWRfc2hpZnRfY29kZScpKXsKICAgIGZ1bmN0aW9uIGNhY2hlZF9zaGlmdF9jb2RlKCkKICAgIHsKICAgICAgICAvL3JldHVybiBbJzEnPT4nVGlmZmluJywnMic9PidEaW5uZXInLCAnMyc9PidMdW5jaCcsICc0Jz0+J0lmdGFyJ107CiAgICAgICAgcmV0dXJuICBDYWNoZTo6cmVtZW1iZXIoJ2NhY2hlZF9zaGlmdF9jb2RlJywgQ2FyYm9uOjpub3coKS0+YWRkSG91cigxMiksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgJGNvZGUgPSBEQjo6dGFibGUoJ2hyX3NoaWZ0JyktPnBsdWNrKCdocl9zaGlmdF9uYW1lJywnaHJfc2hpZnRfY29kZScpOwogICAgICAgICAgICAkaGlzdG9yeSA9IERCOjp0YWJsZSgnaHJfc2hpZnRfaGlzdG9yeSBhcyBoJykKICAgICAgICAgICAgICAgIC0+bGVmdEpvaW4oJ2hyX3NoaWZ0IGFzIHMnLCdzLmhyX3NoaWZ0X2lkJywnaC5ocl9zaGlmdF9pZCcpCiAgICAgICAgICAgICAgICAtPnBsdWNrKCdzLmhyX3NoaWZ0X25hbWUnLCdoLmhyX3NoaWZ0X2NvZGUnKTsKCiAgICAgICAgICAgIHJldHVybiAkY29kZS0+bWVyZ2UoJGhpc3RvcnkpOwogICAgICAgIH0pOwogICAgfQp9CgppZighZnVuY3Rpb25fZXhpc3RzKCdhdHRlbmRhbmNlX3RhYmxlJykpewogICAgZnVuY3Rpb24gYXR0ZW5kYW5jZV90YWJsZSgpCiAgICB7CiAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgJzEnPT4naHJfYXR0ZW5kYW5jZV9tYm0nLAogICAgICAgICAgICAnMic9Pidocl9hdHRlbmRhbmNlX2NlaWwnLCAKICAgICAgICAgICAgJzMnPT4naHJfYXR0ZW5kYW5jZV9hcWwnLCAKICAgICAgICAgICAgJzQnPT4naHJfYXR0ZW5kYW5jZV9tYm0nLAogICAgICAgICAgICAnNSc9Pidocl9hdHRlbmRhbmNlX21ibScsCiAgICAgICAgICAgICc4Jz0+J2hyX2F0dGVuZGFuY2VfY2V3JywKICAgICAgICAgICAgJzknPT4naHJfYXR0ZW5kYW5jZScKICAgICAgICBdOwogICAgfQp9CgppZighZnVuY3Rpb25fZXhpc3RzKCd1bml0X2F1dGhvcml6YXRpb25fY2hlY2snKSl7CiAgICBmdW5jdGlvbiB1bml0X2F1dGhvcml6YXRpb25fY2hlY2soJHVuaXQpCiAgICB7CiAgICAgICAgLy8gZ2V0IExvY2F0aW9uCiAgICAgICAgJGdldExvY2F0aW9uID0gY29sbGVjdChsb2NhdGlvbl9ieV9pZCgpKS0+d2hlcmUoJ2hyX2xvY2F0aW9uX3VuaXRfaWQnLCAkdW5pdCktPnBsdWNrKCdocl9sb2NhdGlvbl9pZCcpLT5hbGwoKTsKCiAgICAgICAgaWYoY291bnQoYXJyYXlfaW50ZXJzZWN0KGF1dGgoKS0+dXNlcigpLT5sb2NhdGlvbl9wZXJtaXNzaW9ucygpLCAkZ2V0TG9jYXRpb24pKSA+IDApewogICAgICAgICAgICByZXR1cm4gJ3llcyc7CiAgICAgICAgfQogICAgICAgIHJldHVybiAnbm8nOwogICAgfQp9CgppZighZnVuY3Rpb25fZXhpc3RzKCd1bml0X2F1dGhvcml6YXRpb25fYnlfaWQnKSl7CiAgICBmdW5jdGlvbiB1bml0X2F1dGhvcml6YXRpb25fYnlfaWQoKQogICAgewogICAgICAgIHJldHVybiBjb2xsZWN0KHVuaXRfYnlfaWQoKSktPmZpbHRlcihmdW5jdGlvbigkcSwgJGtleSl7CiAgICAgICAgICAgICRjaGVja1VuaXQgPSB1bml0X2F1dGhvcml6YXRpb25fY2hlY2soJHFbJ2hyX3VuaXRfaWQnXSk7CiAgICAgICAgICAgIGlmKCRjaGVja1VuaXQgPT0gJ25vJyl7CiAgICAgICAgICAgICAgICB1bnNldCgka2V5KTsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICByZXR1cm4gJHE7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSk7CiAgICB9Cn0KCmlmKCFmdW5jdGlvbl9leGlzdHMoJ2Jhbmtfcm91dGluZycpKXsKICAgIGZ1bmN0aW9uIGJhbmtfcm91dGluZygpCiAgICB7CiAgICAgICByZXR1cm4gIENhY2hlOjpyZW1lbWJlcignYmFua19yb3V0aW5nJywgQ2FyYm9uOjpub3coKS0+YWRkSG91cigxMiksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIERCOjp0YWJsZSgnYmFua19icmFuY2gnKS0+Z2V0KCktPmtleUJ5KCdicmFuY2hfY29kZScpLT50b0FycmF5KCk7CiAgICAgICAgfSk7CgogICAgfQp9Cgo=