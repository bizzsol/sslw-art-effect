<?php
bolt_decrypt( __FILE__ , '8gm2tN'); return 0;
##!!!##Cm5hbWVzcGFjZSBBcHBcSGVscGVyczsKCnVzZSBBcHBcSGVscGVyc1xDdXN0b207CnVzZSBBcHBcSm9ic1xQcm9jZXNzQXR0ZW5kYW5jZUZpbGU7CnVzZSBBcHBcSm9ic1xQcm9jZXNzVW5pdFdpc2VTYWxhcnk7CnVzZSBBcHBcTW9kZWxzXEVtcGxveWVlOwp1c2UgQXBwXE1vZGVsc1xIclxBYnNlbnQ7CnVzZSBBcHBcTW9kZWxzXEhyXEF0dGVuZGFuY2VCb251c0NvbmZpZzsKdXNlIEFwcFxNb2RlbHNcSHJcQXR0ZW5kYW5jZUhpc3Rvcnk7CnVzZSBBcHBcTW9kZWxzXEhyXEJlbmVmaXRzOwp1c2UgQXBwXE1vZGVsc1xIclxCaWxsU2V0dGluZ3M7CnVzZSBBcHBcTW9kZWxzXEhyXEJpbGxTcGVjaWFsU2V0dGluZ3M7CnVzZSBBcHBcTW9kZWxzXEhyXEJpbGxzOwp1c2UgQXBwXE1vZGVsc1xIclxIb2xpZGF5Um9hc3RlcjsKdXNlIEFwcFxNb2RlbHNcSHJcSHJNb250aGx5U2FsYXJ5Owp1c2UgQXBwXE1vZGVsc1xIclxMZWF2ZTsKdXNlIEFwcFxNb2RlbHNcSHJcUGFydGlhbFNhbGFyeTsKdXNlIEFwcFxNb2RlbHNcSHJcU2FsYXJ5QWRkRGVkdWN0Owp1c2UgQXBwXE1vZGVsc1xIclxTYWxhcnlBZGp1c3RNYXN0ZXI7CnVzZSBBcHBcTW9kZWxzXEhyXFNoaWZ0Owp1c2UgQXBwXE1vZGVsc1xIclxZZWFybHlIb2x5RGF5Owp1c2UgQ2FyYm9uXENhcmJvbjsKdXNlIERCOwoKY2xhc3MgRW1wbG95ZWVIZWxwZXIKewoJLyogKi8KCS8vaW50aW1lUHVuY2ggID0gRW1wbG95ZWUgSW4gVGltZSBwdW5jaAoJLy9vdXR0aW1lUHVuY2ggPSBFbXBsb3llZSBPdXQgVGltZSBwdW5jaAoJLy9zaGlmdEludGltZSAgPSBFbXBsb3llZSBTaGlmdCBJbiBUaW1lCgkvL3NoaWZ0T3V0dGltZSA9IEVtcGxveWVlIFNoaWZ0IE91dCBUaW1lCgkvL3NoaWZ0QnJlYWsgICA9IEVtcGxveWVlIFNoaWZ0IEJyZWFrIFRpbWUKCS8vc2hpZnROaWdodCAgID0gRW1wbG95ZWUgTmlnaHQgRmxhZyBTdGF0dXMKCS8vZUFzSWQgICAgICAgID0gRW1wbG95ZWUgQXNzb2NpYXRlIElkCgkvL2VTUlN0YXR1cyAgICA9IEVtcGxveWVlIFNoaWZ0IFJvc3RlciBTdGF0dXMKCS8vZVVuaXQgICAgICAgID0gRW1wbG95ZWUgVW5pdCBJZAoJLyoqLwoJcHVibGljIHN0YXRpYyBmdW5jdGlvbiBkYWxpeU9UQ2FsY3VsYXRpb24oJGludGltZVB1bmNoLCAkb3V0dGltZVB1bmNoLCAkc2hpZnRJbnRpbWUsICRzaGlmdE91dHRpbWUsICRzaGlmdEJyZWFrLCAkc2hpZnROaWdodCwgJGVBc0lkLCAkZVNSU3RhdHVzLCAkZVVuaXQpCgl7CgkJJG92ZXJ0aW1lcyA9IDA7CgkJJG91dFRpbWVFeCA9IGV4cGxvZGUoJyAnLCAkb3V0dGltZVB1bmNoKTsKCQkkaW5UaW1lRXggPSBleHBsb2RlKCcgJywgJGludGltZVB1bmNoKTsKCQlpZigoaXNzZXQoJG91dFRpbWVFeFsxXSkgJiYgJG91dFRpbWVFeFsxXSAhPSAnMDA6MDA6MDAnKSAmJiAoaXNzZXQoJGluVGltZUV4WzFdKSAmJiAkaW5UaW1lRXhbMV0gIT0gJzAwOjAwOjAwJykpewoJCQkkc2hpZnRJbnRpbWUgPSBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkaW50aW1lUHVuY2gpKS4nICcuJHNoaWZ0SW50aW1lOwoJCQlpZigkc2hpZnROaWdodCA9PSAwKXsKCQkJCSRzaGlmdE91dHRpbWUgPSBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkc2hpZnRJbnRpbWUpKS4nICcuJHNoaWZ0T3V0dGltZTsKCQkJfWVsc2V7CgkJCQlpZigkb3V0VGltZUV4WzBdID09ICRpblRpbWVFeFswXSl7CgkJCQkJJHNoaWZ0T3V0dGltZSA9IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCcrMSBkYXknLCBzdHJ0b3RpbWUoJG91dHRpbWVQdW5jaCkpKS4nICcuJHNoaWZ0T3V0dGltZTsKCQkJCX1lbHNlewoJCQkJCSRzaGlmdE91dHRpbWUgPSBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkb3V0dGltZVB1bmNoKSkuJyAnLiRzaGlmdE91dHRpbWU7CgkJCQl9CgkJCX0KCQkJCgkJICAgICRjT3V0ID0gc3RydG90aW1lKGRhdGUoIkg6aSIsIHN0cnRvdGltZSgkb3V0dGltZVB1bmNoKSkpOwoJCSAgICAvLyBDQUxDVUxBVEUgT1ZFUiBUSU1FCgkJICAgIGlmKCFlbXB0eSgkY091dCkpCgkJICAgIHsgIAoJCQkgICAgJHRvZGF5ID0gQ2FyYm9uOjpwYXJzZSgkaW50aW1lUHVuY2gpLT5mb3JtYXQoJ1ktbS1kJyk7CgkJCSAgICAkeWVhciA9IENhcmJvbjo6cGFyc2UoJGludGltZVB1bmNoKS0+Zm9ybWF0KCdZJyk7CgkJCSAgICAkbW9udGggPSBDYXJib246OnBhcnNlKCRpbnRpbWVQdW5jaCktPmZvcm1hdCgnbScpOwoJCQkgICAgJGRheW5hbWUgPSBDYXJib246OnBhcnNlKCRpbnRpbWVQdW5jaCktPmZvcm1hdCgnbCcpOwoJCQkgICAgJGVtcGxveWVlID0gRW1wbG95ZWU6OndoZXJlKCdhc3NvY2lhdGVfaWQnLCAkZUFzSWQpLT5maXJzdCgpOwoKCQkJICAgIC8vIHJhbWFkYW4gYnJlYWsKCQkJICAgIGlmKHN0cnRvdGltZSgkdG9kYXkpIDwgc3RydG90aW1lKCcyMDIxLTA0LTEzJykgfHwgc3RydG90aW1lKCR0b2RheSkgPiBzdHJ0b3RpbWUoJzIwMjEtMDUtMTMnKSl7CiAgICAJCQkgICAgaWYoZGF0ZSgnSDppOnMnLCBzdHJ0b3RpbWUoJHNoaWZ0SW50aW1lKSkgPCBkYXRlKCdIOmk6cycsIHN0cnRvdGltZSgnMTQ6MDA6MDAnKSkgICYmICRkYXluYW1lID09ICdGcmlkYXknICYmIGluX2FycmF5KCRlVW5pdCwgWzEsNCw1XSkpewogICAgCQkJICAgIAkkc2hpZnRCcmVhayA9IDkwOwogICAgCQkJICAgIAkvKjIyNCA9IHNlY3VyaXR5LCAzNTAvNDI4ID0gY29vayovCiAgICAJCQkgICAgCWlmKCRlbXBsb3llZS0+YXNfZGVzaWduYXRpb25faWQgPT0gMjI0IHx8ICRlbXBsb3llZS0+YXNfZGVzaWduYXRpb25faWQgPT0gMzUwIHx8ICRlbXBsb3llZS0+YXNfZGVzaWduYXRpb25faWQgPT0gNDI4KXsKICAgIAkJCSAgICAJCSRzaGlmdEJyZWFrID0gMzA7CiAgICAJCQkgICAgCX0KICAgIAkJCSAgICB9CgkJCSAgICB9ZWxzZXsKCQkJICAgICAgICBpZihkYXRlKCdIOmk6cycsIHN0cnRvdGltZSgkc2hpZnRJbnRpbWUpKSA8IGRhdGUoJ0g6aTpzJywgc3RydG90aW1lKCcxNDowMDowMCcpKSAgJiYgJGRheW5hbWUgPT0gJ0ZyaWRheScpewogICAgCQkJICAgIAkkc2hpZnRCcmVhayA9IDYwOwogICAgCQkJICAgIAkvKjIyNCA9IHNlY3VyaXR5Ki8KICAgIAkJCSAgICAJaWYoJGVtcGxveWVlLT5hc19kZXNpZ25hdGlvbl9pZCA9PSAyMjQgJiYgaW5fYXJyYXkoJGVVbml0LCBbMSw0LDVdKSl7CiAgICAJCQkgICAgCQkkc2hpZnRCcmVhayA9IDMwOwogICAgCQkJICAgIAl9CiAgICAJCQkgICAgfQoJCQkgICAgfQoKCQkJICAgICRjaGVja0JpbGxIb3VyID0gKHN0cnRvdGltZSgkb3V0dGltZVB1bmNoKSAtIHN0cnRvdGltZSgkc2hpZnRJbnRpbWUpKS8zNjAwOwoJCQkgICAgJGJyZWFrQ291bnQgPSAwOwoJCQkgICAgaWYoJGNoZWNrQmlsbEhvdXIgPiA3KXsKCQkJICAgIAkkYnJlYWtDb3VudCA9IDE7CgkJCSAgICB9CgoJCQkgICAgJHNoaWZ0QnJlYWsgPSAoJHNoaWZ0QnJlYWsgKiAkYnJlYWtDb3VudCk7CgkJCSAgICAkZXh0cmFCcmVha01pbiA9IDA7CgkJICAgIAlpZighaW5fYXJyYXkoJGVVbml0LCBbMSw0LDUsOF0pKXsKCQkgICAgCQkkc2hpZnRBZGRCcmVhayA9IENhcmJvbjo6cGFyc2UoJHNoaWZ0T3V0dGltZSktPmFkZE1pbnV0ZXMoJHNoaWZ0QnJlYWspOwoJCSAgICAJCSRzaGlmdEFkZFNpeEggPSBDYXJib246OnBhcnNlKCRzaGlmdEFkZEJyZWFrKS0+YWRkSG91cnMoOCk7CgkJICAgIAkJJHNoaWZ0QWRkU2V2ZW5IID0gQ2FyYm9uOjpwYXJzZSgkc2hpZnRBZGRCcmVhayktPmFkZEhvdXJzKDkpOwoJCSAgICAJCSAKCQkJICAgICAgICBpZigoc3RydG90aW1lKCRvdXR0aW1lUHVuY2gpID4gc3RydG90aW1lKGRhdGUoJ1ktbS1kIEg6aScsIHN0cnRvdGltZSgkc2hpZnRBZGRTaXhIKSkpKSl7CgkJCSAgICAJCSRleHRyYUJyZWFrTWluID0gJHNoaWZ0QnJlYWs7CgkJCSAgICAJCWlmKHN0cnRvdGltZSgkb3V0dGltZVB1bmNoKSA8IHN0cnRvdGltZShkYXRlKCdZLW0tZCBIOmknLCBzdHJ0b3RpbWUoJHNoaWZ0QWRkU2V2ZW5IKSkpKXsKCQkJICAgICAgICAgICAgICAgICRleHRyYUJyZWFrTWluID0gKHN0cnRvdGltZSgkb3V0dGltZVB1bmNoKSAtIHN0cnRvdGltZShkYXRlKCdZLW0tZCBIOmknLCBzdHJ0b3RpbWUoJHNoaWZ0QWRkU2l4SCkpKSkvNjA7CgkJCSAgICAgICAgICAgIH0KCQkJICAgIAl9CgkJCSAgICB9CgoJCQkgICAgJHNoaWZ0QnJlYWsgPSAkc2hpZnRCcmVhayArICRleHRyYUJyZWFrTWluOwoKCQkJICAgIGlmKChzdHJ0b3RpbWUoJHRvZGF5KSA+IHN0cnRvdGltZSgnMjAyMS0wNC0xMycpICYmIHN0cnRvdGltZSgkdG9kYXkpIDwgc3RydG90aW1lKCcyMDIxLTA1LTEzJykpICYmICRlbXBsb3llZS0+YXNfc3Vic2VjdGlvbl9pZCAhPSAxMDggJiYgKCRzaGlmdE5pZ2h0ID09IDAgfHwgc3RydG90aW1lKCRzaGlmdEludGltZSkgPCBzdHJ0b3RpbWUoZGF0ZSgnWS1tLWQgSDppJywgc3RydG90aW1lKCR0b2RheS4nIDE3OjMwOjAwJykpKSkpewoJCQkgICAgCSRleHRyYU1pbiA9IDA7CgkJCSAgICAJJGJyZWFrU3RhcnRUaW1lID0gc3RydG90aW1lKGRhdGUoJ1ktbS1kIEg6aScsIHN0cnRvdGltZSgkdG9kYXkuJyAxODowMDowMCcpKSk7CgkJCSAgICAJJGJyZWFrRW5kVGltZSA9IHN0cnRvdGltZShkYXRlKCdZLW0tZCBIOmknLCBzdHJ0b3RpbWUoJHRvZGF5LicgMTk6MDA6MDAnKSkpOwoJCQkgICAgCWlmKGluX2FycmF5KCRlVW5pdCwgWzEsNCw1XSkpewoJCQkgICAgCQlpZihzdHJ0b3RpbWUoJHRvZGF5KSA+IHN0cnRvdGltZSgnMjAyMS0wNC0yMCcpKXsKCQkJICAgIAkJCSRicmVha1N0YXJ0VGltZSA9IHN0cnRvdGltZShkYXRlKCdZLW0tZCBIOmknLCBzdHJ0b3RpbWUoJHRvZGF5LicgMTg6MTU6MDAnKSkpOwoJCQkgICAgCQkJJGJyZWFrRW5kVGltZSA9IHN0cnRvdGltZShkYXRlKCdZLW0tZCBIOmknLCBzdHJ0b3RpbWUoJHRvZGF5LicgMTk6MTU6MDAnKSkpOwoJCQkgICAgCQl9CgkJCSAgICAJfQoKCQkJICAgIAlpZigoc3RydG90aW1lKCRvdXR0aW1lUHVuY2gpID4gJGJyZWFrU3RhcnRUaW1lICYmICFpbl9hcnJheSgkZVVuaXQsIFs4XSkpKXsKCQkJICAgIAkJJGV4dHJhTWluID0gNjA7CgkJCSAgICAJCWlmKHN0cnRvdGltZSgkb3V0dGltZVB1bmNoKSA8ICRicmVha0VuZFRpbWUpewoJCQkgICAgICAgICAgICAgICAgJGV4dHJhTWluID0gKHN0cnRvdGltZSgkb3V0dGltZVB1bmNoKSAtICRicmVha1N0YXJ0VGltZSkvNjA7CgkJCSAgICAgICAgICAgIH0KCQkJICAgIAl9CgkJCSAgICAJCgoJCQkgICAgCSRzaGlmdEJyZWFrID0gJHNoaWZ0QnJlYWsgKyAoaW50KSRleHRyYU1pbjsKCQkJICAgIH0KCQkJICAgIAoJCQkgICAgJG90Q2hlY2sgPSAnJzsJCQkgICAgCgkJCSAgICBpZigkZVNSU3RhdHVzID09IDApewoJCQkgICAgICAkaG9saWRheVBsYW5uZXIgPSBZZWFybHlIb2x5RGF5OjpnZXRDaGVja1VuaXREYXlXaXNlSG9saWRheVN0YXR1cygkZVVuaXQsICR0b2RheSwgMik7CgkJCSAgICAgIGlmKCRob2xpZGF5UGxhbm5lciAhPSAnJyl7CgkJCSAgICAgIAkkb3RDaGVjayA9ICdPVCc7CgkJCSAgICAgIH0KCQkJICAgIH0KCgkJCSAgICBpZigkb3RDaGVjayAhPSAnJyl7CgkJCSAgICAJJGhvbGlkYXlSb2FzdGVyID0gSG9saWRheVJvYXN0ZXI6OmdldEhvbGlkYXlZZWFyTW9udGhBc0lkRGF0ZVdpc2VSZW1hcmtNdWx0aSgkeWVhciwgJG1vbnRoLCAkZUFzSWQsICR0b2RheSwgWydHZW5lcmFsJywgJ09UJywgJ0hvbGlkYXknXSk7CgkJCSAgICAJaWYoJGhvbGlkYXlSb2FzdGVyICE9ICcnKXsKCQkJCSAgICAgIAkkb3RDaGVjayA9ICRob2xpZGF5Um9hc3Rlci0+cmVtYXJrczsKCQkJCSAgICB9CgkJCSAgICB9ZWxzZXsKCQkJCQkkaG9saWRheVJvYXN0ZXIgPSBIb2xpZGF5Um9hc3Rlcjo6Z2V0SG9saWRheVllYXJNb250aEFzSWREYXRlV2lzZVJlbWFyaygkeWVhciwgJG1vbnRoLCAkZUFzSWQsICR0b2RheSwgJ09UJyk7CgkJCQkJaWYoJGhvbGlkYXlSb2FzdGVyICE9ICcnKXsKCQkJCSAgICAgIAkkb3RDaGVjayA9ICRob2xpZGF5Um9hc3Rlci0+cmVtYXJrczsKCQkJCSAgICB9CgkJCSAgICB9CgkJCSAgICAKCQkJICAgICRzaGlmdEludGltZSA9IHN0cnRvdGltZSgkc2hpZnRJbnRpbWUpOwoJCQkgICAgJHNoaWZ0T3V0dGltZSA9IHN0cnRvdGltZSgkc2hpZnRPdXR0aW1lKTsKCQkJICAgICRpbnRpbWVQdW5jaCA9IHN0cnRvdGltZSgkaW50aW1lUHVuY2gpOwoJCQkgICAgJG91dHRpbWVQdW5jaCA9IHN0cnRvdGltZSgkb3V0dGltZVB1bmNoKTsKCQkJICAgIGlmKCRzaGlmdEludGltZSA8ICRpbnRpbWVQdW5jaCl7CgkJCSAgICAJJHNoaWZ0SW50aW1lID0gJGludGltZVB1bmNoOwoJCQkgICAgfQoKCQkJICAgIGlmKCRvdENoZWNrICE9ICcnICYmICRvdENoZWNrID09ICdPVCcpewoJCQkgICAgCSRkYXRlMSA9ICRzaGlmdEludGltZTsKCQkJICAgIH1lbHNlewoJCQkgICAgCSRkYXRlMSA9ICRzaGlmdE91dHRpbWU7CgkJCSAgICB9CgkJCQkkZGF0ZTIgPSAkb3V0dGltZVB1bmNoOwoJCQkJJGRpZmYgPSAoJGRhdGUyIC0gKCRkYXRlMSArICgkc2hpZnRCcmVhayo2MCkpKS8zNjAwOwoJCQkJaWYoJGRpZmYgPCAwKXsKCQkJCQkkZGlmZiA9IDA7CgkJCQl9CgkJCQkvLyAkZGlmZiA9IHJvdW5kKCRkaWZmLCAyKTsKCQkJCSRkaWZmRXhwbG9kZSA9IGV4cGxvZGUoJy4nLCAkZGlmZik7CgkJCQkvLyByZXR1cm4gJGRpZmY7CgkJCQkkbWludXRlcyA9IChpc3NldCgkZGlmZkV4cGxvZGVbMV0pID8gJGRpZmZFeHBsb2RlWzFdIDogMCk7CgkJCQkkbWludXRlcyA9IGZsb2F0dmFsKCcwLicuJG1pbnV0ZXMpOwoJCQkJLy8gcmV0dXJuICRtaW51dGVzOwoJCQkJaWYoJG1pbnV0ZXMgPiAwLjE2NjY3ICYmICRtaW51dGVzIDw9IDAuNzUpICRtaW51dGVzID0gJG1pbnV0ZXM7CgkJCSAgICBlbHNlIGlmKCRtaW51dGVzID49IDAuNzUpICRtaW51dGVzID0gMTsKCQkJICAgIGVsc2UgJG1pbnV0ZXMgPSAwOwoJCQkgICAgCgkJCSAgICBpZigkbWludXRlcyA+IDAgJiYgJG1pbnV0ZXMgIT0gMSl7CgkJCSAgICAJJG1pbiA9IChpbnQpcm91bmQoJG1pbnV0ZXMqNjApOwoJCQkgICAgCSRtaW5PVCA9IG1pbl90b19vdCgpOwoJCQkgICAgCSRtaW51dGVzID0gJG1pbk9UWyRtaW5dPz8wOwoJCQkgICAgfQoKCQkJICAgICRvdmVydGltZXMgPSAkZGlmZkV4cGxvZGVbMF0rJG1pbnV0ZXM7CgkJCSAgICAkb3ZlcnRpbWVzID0gbnVtYmVyX2Zvcm1hdCgoZmxvYXQpJG92ZXJ0aW1lcywgMywgJy4nLCAnJyk7CgkJICAgIH0KCQkgICAgcmV0dXJuICRvdmVydGltZXM7CgkJfQoJCQoJfQoKCS8qKi8KCgkvKiovCglwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGVtcGxveWVlRGF0ZVdpc2VNYWtlQWJzZW50KCRhc0lkLCAkZGF0ZSkKCXsKCQkkcmVzdWx0ID0gYXJyYXkoKTsKCQkkcmVzdWx0WydzdGF0dXMnXSA9ICdlcnJvcic7CgkJJGdldEVtcGxveWVlID0gRW1wbG95ZWU6OndoZXJlKCdhc19pZCcsICRhc0lkKS0+Zmlyc3QoKTsKCQlpZigkZ2V0RW1wbG95ZWUgPT0gbnVsbCl7CgkJCSRyZXN1bHRbJ21lc3NhZ2UnXSA9ICJFbXBsb3llZSBub3QgZm91bmQhIjsKCQkJcmV0dXJuICRyZXN1bHQ7CgkJfQoJCSR5ZWFyID0gQ2FyYm9uOjpwYXJzZSgkZGF0ZSktPmZvcm1hdCgnWScpOwogICAgICAgICRtb250aCA9IENhcmJvbjo6cGFyc2UoJGRhdGUpLT5mb3JtYXQoJ20nKTsKICAgICAgICAkdGFibGVOYW1lID0gQ3VzdG9tOjp1bml0V2lzZUF0dGVuZGFuY2VUYWJsZU5hbWUoJGdldEVtcGxveWVlLT5hc191bml0X2lkKTsKCQl0cnkgewoJCQlEQjo6dGFibGUoJHRhYmxlTmFtZSkKICAgICAgICAgICAgLT53aGVyZSgnYXNfaWQnLCAkZ2V0RW1wbG95ZWUtPmFzX2lkKQogICAgICAgICAgICAtPndoZXJlRGF0ZSgnaW5fdGltZScsIGRhdGUoJ1ktbS1kJyxzdHJ0b3RpbWUoJGRhdGUpKSkKICAgICAgICAgICAgLT5kZWxldGUoKTsKCgkJCSRnZXRIb2xpZGF5ID0gSG9saWRheVJvYXN0ZXI6OmdldEhvbGlkYXlZZWFyTW9udGhBc0lkRGF0ZVdpc2VSZW1hcmtNdWx0aSgkeWVhciwgJG1vbnRoLCAkZ2V0RW1wbG95ZWUtPmFzc29jaWF0ZV9pZCwgJGRhdGUsIFsnSG9saWRheScsICdPVCddKTsKCSAgICAgICAgaWYoJGdldEhvbGlkYXkgPT0gbnVsbCAmJiAkZ2V0RW1wbG95ZWUtPnNoaWZ0X3JvYXN0ZXJfc3RhdHVzID09IDApewoJICAgICAgICAgICAgJGdldEhvbGlkYXkgPSBZZWFybHlIb2x5RGF5OjpnZXRDaGVja1VuaXREYXlXaXNlSG9saWRheVN0YXR1c011bHRpKCRnZXRFbXBsb3llZS0+YXNfdW5pdF9pZCwgJGRhdGUsIFswLCAyXSk7CgkgICAgICAgIH0KCSAgICAgICAgCgkgICAgICAgIGlmKCRnZXRIb2xpZGF5ID09IG51bGwpewoJICAgICAgICAgICAgJGdldExlYXZlID0gREI6OnRhYmxlKCdocl9sZWF2ZScpCgkgICAgICAgICAgICAtPndoZXJlKCdsZWF2ZV9hc3NfaWQnLCAkZ2V0RW1wbG95ZWUtPmFzc29jaWF0ZV9pZCkKCSAgICAgICAgICAgIC0+d2hlcmUoJ2xlYXZlX2Zyb20nLCAnPD0nLCAkZGF0ZSkKCSAgICAgICAgICAgIC0+d2hlcmUoJ2xlYXZlX3RvJywgJz49JywgJGRhdGUpCgkgICAgICAgICAgICAtPndoZXJlKCdsZWF2ZV9zdGF0dXMnLDEpCgkgICAgICAgICAgICAtPmZpcnN0KCk7CgkgICAgICAgICAgICAvLwoJICAgICAgICAgICAgJGdldEFic2VudCA9IERCOjp0YWJsZSgnaHJfYWJzZW50JykKCSAgICAgICAgICAgIC0+d2hlcmUoJ2Fzc29jaWF0ZV9pZCcsICRnZXRFbXBsb3llZS0+YXNzb2NpYXRlX2lkKQoJICAgICAgICAgICAgLT53aGVyZSgnaHJfdW5pdCcsICRnZXRFbXBsb3llZS0+YXNfdW5pdF9pZCkKCSAgICAgICAgICAgIC0+d2hlcmUoJ2RhdGUnLCAkZGF0ZSkKCSAgICAgICAgICAgIC0+Zmlyc3QoKTsKCgkgICAgICAgICAgICBpZigkZ2V0TGVhdmUgPT0gJycgJiYgJGdldEFic2VudCA9PSAnJyl7CgkgICAgICAgICAgICAgICAkaWQgPSBEQjo6dGFibGUoJ2hyX2Fic2VudCcpCgkgICAgICAgICAgICAgICAgLT5pbnNlcnRHZXRJZChbCgkgICAgICAgICAgICAgICAgICAgICdhc3NvY2lhdGVfaWQnID0+ICRnZXRFbXBsb3llZS0+YXNzb2NpYXRlX2lkLAoJICAgICAgICAgICAgICAgICAgICAnaHJfdW5pdCcgID0+ICRnZXRFbXBsb3llZS0+YXNfdW5pdF9pZCwKCSAgICAgICAgICAgICAgICAgICAgJ2RhdGUnICA9PiAkZGF0ZQoJICAgICAgICAgICAgICAgIF0pOyAKCSAgICAgICAgICAgICAgICAKCSAgICAgICAgICAgICAgICAkcmVzdWx0WydtZXNzYWdlJ10gPSAnU3VjY2Vzc2Z1bGx5IG1ha2UgYWJzZW50IHRoaXMgZGF5JzsKCSAgICAgICAgICAgIH1lbHNlewoJICAgICAgICAgICAgCSRyZXN1bHRbJ21lc3NhZ2UnXSA9ICdMZWF2ZSBmb3IgdGhpcyBkYXkgLyBBYnNlbnQgbm90IGZvdW5kJzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfWVsc2V7CgkgICAgICAgIAkkcmVzdWx0WydtZXNzYWdlJ10gPSAnSG9saWRheSBmb3IgdGhpcyBkYXknOwoJICAgICAgICB9CgoJICAgICAgICAkeWVhck1vbnRoID0gJHllYXIuJy0nLiRtb250aDsgCiAgICAgICAgICAgIGlmKCRtb250aCA9PSBkYXRlKCdtJykpewogICAgICAgICAgICAgICAgJHRvdGFsRGF5ID0gZGF0ZSgnZCcpOwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICR0b3RhbERheSA9IENhcmJvbjo6cGFyc2UoJHllYXJNb250aCktPmRheXNJbk1vbnRoOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRxdWV1ZSA9IChuZXcgUHJvY2Vzc1VuaXRXaXNlU2FsYXJ5KCR0YWJsZU5hbWUsICRtb250aCwgJHllYXIsICRnZXRFbXBsb3llZS0+YXNfaWQsICR0b3RhbERheSkpCiAgICAgICAgICAgICAgICAgICAgLT5vblF1ZXVlKCdzYWxhcnlnZW5lcmF0ZScpCiAgICAgICAgICAgICAgICAgICAgLT5kZWxheShDYXJib246Om5vdygpLT5hZGRTZWNvbmRzKDIpKTsKICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaCgkcXVldWUpOwoJICAgICAgICAkcmVzdWx0WydzdGF0dXMnXSA9ICdzdWNjZXNzJzsKCSAgICAgICAgcmV0dXJuICRyZXN1bHQ7CgkJfSBjYXRjaCAoXEV4Y2VwdGlvbiAkZSkgewoJCQkkYnVnID0gJGUtPmdldE1lc3NhZ2UoKTsKCQkJJHJlc3VsdFsnbWVzc2FnZSddID0gJGJ1ZzsKCQkJcmV0dXJuICRyZXN1bHQ7CgkJfQoJfQoKCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZW1wbG95ZWVBdHRlbmRhbmNlQWJzZW50RGVsZXRlKCRhc3NvY2lhdGVJZCwgJGRhdGUpCgl7CgkJdHJ5IHsKCQkJJGZsYWcgPSAwOwoJCQkkZ2V0QWJzZW50ID0gQWJzZW50OjpnZXRBYnNlbnRDaGVja0V4aXN0cygkYXNzb2NpYXRlSWQsICRkYXRlKTsKCQkJaWYoJGdldEFic2VudCAhPSBudWxsKXsKCQkJCUFic2VudDo6d2hlcmUoCgkJCQkJJ2lkJywgJGdldEFic2VudC0+aWQpCgkJCQktPmRlbGV0ZSgpOwoJCQkJJGZsYWcgPSAxOwoJCQl9CgoJCQkkZ2V0RW1wbG95ZWUgPSBFbXBsb3llZTo6Z2V0RW1wbG95ZWVBc3NJZFdpc2VTZWxlY3RlZEZpZWxkKCRhc3NvY2lhdGVJZCwgWydhc19pZCcsICdhc191bml0X2lkJ10pOwoJCQkkdGFibGVOYW1lID0gQ3VzdG9tOjp1bml0V2lzZUF0dGVuZGFuY2VUYWJsZU5hbWUoJGdldEVtcGxveWVlLT5hc191bml0X2lkKTsKCQkJJGdldEF0dGVuZGFuY2UgPSBEQjo6dGFibGUoJHRhYmxlTmFtZSkKCQkJCS0+d2hlcmUoJ2FzX2lkJywgJGdldEVtcGxveWVlLT5hc19pZCkKCQkJCS0+d2hlcmVEYXRlKCdpbl90aW1lJywgJGRhdGUpCgkJCQktPmZpcnN0KCk7CgkJCWlmKCRnZXRBdHRlbmRhbmNlICE9IG51bGwpewoJCQkJREI6OnRhYmxlKCR0YWJsZU5hbWUpCgkJCQktPndoZXJlKCdpZCcsICRnZXRBdHRlbmRhbmNlLT5pZCkKCQkJCS0+ZGVsZXRlKCk7CgkJCQkkZmxhZyA9IDE7CgkJCX0KCgkJCWlmKCRmbGFnID09IDEpewoJCQkJcmV0dXJuICdzdWNjZXNzJzsKCQkJfQoJCQlyZXR1cm4gJ25vdCBmb3VuZCc7CgkJfSBjYXRjaCAoXEV4Y2VwdGlvbiAkZSkgewoJCQkkYnVnID0gJGUtPmdldE1lc3NhZ2UoKTsKCQkJcmV0dXJuICRidWc7CgkJfQoJfQoKCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZW1wbG95ZWVEYXlTdGF0dXNDaGVja0FjdGlvbkFic2VudCgkYXNzb2NpYXRlSWQsICRkYXRlKQoJewoJCXRyeSB7CgkJCSRnZXRFbXBsb3llZSA9IEVtcGxveWVlOjpnZXRFbXBsb3llZUFzc29jaWF0ZUlkV2lzZSgkYXNzb2NpYXRlSWQpOwoJCQkkZmxhZyA9IDE7CgkJCSRnZXRMZWF2ZSA9IExlYXZlOjpnZXREYXRlU3RhdHVzV2lzZUVtcGxveWVlTGVhdmVDaGVjaygkYXNzb2NpYXRlSWQsICRkYXRlLCAxKTsKCQkJaWYoJGdldExlYXZlID09IG51bGwpewoJCQkJJGZsYWcgPSAwOwoJCQl9CgkJCSR0YWJsZU5hbWUgPSBnZXRfYXR0X3RhYmxlKCRnZXRFbXBsb3llZS0+YXNfdW5pdF9pZCk7CgkJCSRnZXRBdHRlbmRhbmNlID0gREI6OnRhYmxlKCR0YWJsZU5hbWUpCgkJCS0+d2hlcmUoJ2FzX2lkJywgJGdldEVtcGxveWVlLT5hc19pZCkKCQkJLT53aGVyZSgnaW5fZGF0ZScsICRkYXRlKQoJCQktPmZpcnN0KCk7CgkJCWlmKCRnZXRBdHRlbmRhbmNlID09IG51bGwpewoJCQkJJGZsYWcgPSAwOwoJCQl9CgoJCQlpZigkZmxhZyA9PSAwKXsKCQkJCURCOjp0YWJsZSgnaHJfYWJzZW50JykKCSAgICAgICAgICAgIC0+aW5zZXJ0KFsKCSAgICAgICAgICAgICAgICAnYXNzb2NpYXRlX2lkJyA9PiAkZ2V0RW1wbG95ZWUtPmFzc29jaWF0ZV9pZCwKCSAgICAgICAgICAgICAgICAnaHJfdW5pdCcgID0+ICRnZXRFbXBsb3llZS0+YXNfdW5pdF9pZCwKCSAgICAgICAgICAgICAgICAnZGF0ZScgID0+ICRkYXRlCgkgICAgICAgICAgICBdKTsKCQkJfQoKCQkJcmV0dXJuICdzdWNjZXNzJzsKCQl9IGNhdGNoIChcRXhjZXB0aW9uICRlKSB7CgkJCSRidWcgPSAkZS0+Z2V0TWVzc2FnZSgpOwoJCQlyZXR1cm4gJGJ1ZzsKCQl9Cgl9CgoJcHVibGljIHN0YXRpYyBmdW5jdGlvbiBlbXBsb3llZVN0YXR1c0RhdGVXaXNlQWJzZW50RGVsZXRlKCRhc3NvY2lhdGVJZCwgJGRhdGUpCgl7CgkJdHJ5IHsKCQkJJGZsYWcgPSAwOwoJCQkkZ2V0QWJzZW50ID0gQWJzZW50OjpnZXRBYnNlbnRDaGVja0V4aXN0cygkYXNzb2NpYXRlSWQsICRkYXRlKTsKCQkJaWYoJGdldEFic2VudCAhPSBudWxsKXsKCQkJCUFic2VudDo6d2hlcmUoCgkJCQkJJ2lkJywgJGdldEFic2VudC0+aWQpCgkJCQktPmRlbGV0ZSgpOwoJCQkJJGZsYWcgPSAxOwoJCQl9CgoJCQlpZigkZmxhZyA9PSAxKXsKCQkJCXJldHVybiAnc3VjY2Vzcyc7CgkJCX0KCQkJcmV0dXJuICdub3QgZm91bmQnOwoJCX0gY2F0Y2ggKFxFeGNlcHRpb24gJGUpIHsKCQkJJGJ1ZyA9ICRlLT5nZXRNZXNzYWdlKCk7CgkJCXJldHVybiAkYnVnOwoJCX0KCX0KCglwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGVtcGxveWVlQXR0ZW5kYW5jZU9UVXBkYXRlKCRhc3NvY2lhdGVJZCwgJGRhdGUpCgl7CgkJdHJ5IHsKCQkJJGZsYWcgPSAwOwoJCQkkeWVhciA9IGRhdGUoJ1knLHN0cnRvdGltZSgkZGF0ZSkpOwogICAgICAgICAgCSRtb250aCA9IGRhdGUoJ20nLHN0cnRvdGltZSgkZGF0ZSkpOwoJCQkkZ2V0RW1wbG95ZWUgPSBFbXBsb3llZTo6Z2V0RW1wbG95ZWVBc3NvY2lhdGVJZFdpc2UoJGFzc29jaWF0ZUlkKTsKCQkJaWYoJGdldEVtcGxveWVlICE9IG51bGwgJiYgJGdldEVtcGxveWVlLT5hc19vdCA9PSAxKXsKCQkJCSR0YWJsZU5hbWUgPSBDdXN0b206OnVuaXRXaXNlQXR0ZW5kYW5jZVRhYmxlTmFtZSgkZ2V0RW1wbG95ZWUtPmFzX3VuaXRfaWQpOwoJCQkJJGdldEF0dGVuZGFuY2UgPSBEQjo6dGFibGUoJHRhYmxlTmFtZSkKCQkJCS0+d2hlcmUoJ2FzX2lkJywgJGdldEVtcGxveWVlLT5hc19pZCkKCQkJCS0+d2hlcmVEYXRlKCdpbl90aW1lJywgJGRhdGUpCgkJCQktPmZpcnN0KCk7CgkJCQlpZigkZ2V0QXR0ZW5kYW5jZSAhPSBudWxsKXsKCQkJCQlpZigkZ2V0QXR0ZW5kYW5jZS0+b3V0X3RpbWUgIT0gbnVsbCB8fCAkZ2V0QXR0ZW5kYW5jZS0+b3V0X3RpbWUgIT0gJycpewoJCQkJCQkkdW5pdElkID0gJGdldEVtcGxveWVlLT5hc191bml0X2lkOwoJCQkJCQkkZGF5X29mX2RhdGUgPSBkYXRlKCdqJywgc3RydG90aW1lKCRkYXRlKSk7CgkgICAgICAgICAgICAgICAgCSRkYXlfbnVtID0gImRheV8iLiRkYXlfb2ZfZGF0ZTsKCQkJCQkJJHNoaWZ0PSBEQjo6dGFibGUoImhyX3NoaWZ0X3JvYXN0ZXIiKQoJICAgICAgICAgICAgCQktPndoZXJlKCdzaGlmdF9yb2FzdGVyX21vbnRoJywgJG1vbnRoKQoJICAgICAgICAgICAgCQktPndoZXJlKCdzaGlmdF9yb2FzdGVyX3llYXInLCAkeWVhcikKCSAgICAgICAgICAgIAkJLT53aGVyZSgic2hpZnRfcm9hc3Rlcl91c2VyX2lkIiwgJGdldEVtcGxveWVlLT5hc19pZCkKCSAgICAgICAgICAgIAkJLT5zZWxlY3QoWwoJICAgICAgICAgICAgCQkJJGRheV9udW0sCgkgICAgICAgICAgICAgICAgICAgICAgICAnaHJfc2hpZnQuaHJfc2hpZnRfaWQnLAoJICAgICAgICAgICAgCQkJJ2hyX3NoaWZ0LmhyX3NoaWZ0X3N0YXJ0X3RpbWUnLAoJICAgICAgICAgICAgCQkJJ2hyX3NoaWZ0LmhyX3NoaWZ0X2VuZF90aW1lJywKCSAgICAgICAgICAgICAgICAgICAgICAgICdocl9zaGlmdC5ocl9zaGlmdF9jb2RlJywKCSAgICAgICAgICAgICAgICAgICAgICAgICdocl9zaGlmdC5ocl9zaGlmdF9icmVha190aW1lJywKCSAgICAgICAgICAgICAgICAgICAgICAgICdocl9zaGlmdC5ocl9zaGlmdF9uaWdodF9mbGFnJwoJICAgICAgICAgICAgCQldKQoJICAgICAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCdocl9zaGlmdCcsIGZ1bmN0aW9uKCRxKSB1c2UoJGRheV9udW0sICR1bml0SWQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICRxLT5vbignaHJfc2hpZnQuaHJfc2hpZnRfbmFtZScsICdocl9zaGlmdF9yb2FzdGVyLicuJGRheV9udW0pOwoJICAgICAgICAgICAgICAgICAgICAgICAgJHEtPndoZXJlKCdocl9zaGlmdC5ocl9zaGlmdF91bml0X2lkJywgJHVuaXRJZCk7CgkgICAgICAgICAgICAgICAgICAgIH0pCgkgICAgICAgICAgICAgICAgICAgIC0+b3JkZXJCeSgnaHJfc2hpZnQuaHJfc2hpZnRfaWQnLCAnZGVzYycpCgkgICAgICAgICAgICAJCS0+Zmlyc3QoKTsKCSAgICAgICAgICAgICAgICAgICAgCgkgICAgICAgICAgICAJCWlmKCFlbXB0eSgkc2hpZnQpICYmICRzaGlmdC0+JGRheV9udW0gIT0gbnVsbCl7CgkgICAgICAgICAgICAJCQkkc2hpZnRJbnRpbWU9ICRzaGlmdC0+aHJfc2hpZnRfc3RhcnRfdGltZTsKCSAgICAgICAgICAgIAkJCSRzaGlmdE91dHRpbWU9ICRzaGlmdC0+aHJfc2hpZnRfZW5kX3RpbWU7CgkgICAgICAgICAgICAJCQkkc2hpZnRCcmVhaz0gJHNoaWZ0LT5ocl9zaGlmdF9icmVha190aW1lOwoJICAgICAgICAgICAgCQkJJHNoaWZ0TmlnaHQ9ICRzaGlmdC0+aHJfc2hpZnRfbmlnaHRfZmxhZzsKCSAgICAgICAgICAgIAkJfWVsc2V7CgkgICAgICAgICAgICAJCQkkc2hpZnRJbnRpbWU9ICRnZXRFbXBsb3llZS0+c2hpZnRbJ2hyX3NoaWZ0X3N0YXJ0X3RpbWUnXTsKCSAgICAgICAgICAgIAkJCSRzaGlmdE91dHRpbWU9ICRnZXRFbXBsb3llZS0+c2hpZnRbJ2hyX3NoaWZ0X2VuZF90aW1lJ107CgkgICAgICAgICAgICAJCQkkc2hpZnRCcmVhaz0gJGdldEVtcGxveWVlLT5zaGlmdFsnaHJfc2hpZnRfYnJlYWtfdGltZSddOwoJICAgICAgICAgICAgCQkJJHNoaWZ0TmlnaHQ9ICRnZXRFbXBsb3llZS0+c2hpZnRbJ2hyX3NoaWZ0X25pZ2h0X2ZsYWcnXTsKCSAgICAgICAgICAgIAkJfQoKCQkJCQkJJG92ZXJ0aW1lcyA9IHNlbGY6OmRhbGl5T1RDYWxjdWxhdGlvbigkZ2V0QXR0ZW5kYW5jZS0+aW5fdGltZSwgJGdldEF0dGVuZGFuY2UtPm91dF90aW1lLCAkc2hpZnRJbnRpbWUsICRzaGlmdE91dHRpbWUsICRzaGlmdEJyZWFrLCAkc2hpZnROaWdodCwgJGFzc29jaWF0ZUlkLCAkZ2V0RW1wbG95ZWUtPnNoaWZ0X3JvYXN0ZXJfc3RhdHVzLCAkZ2V0RW1wbG95ZWUtPmFzX3VuaXRfaWQpOwoJCQkJCQkKCQkJCQkJLyokaCA9IGZsb29yKCRvdmVydGltZXMvNjApID8gKChmbG9vcigkb3ZlcnRpbWVzLzYwKTwxMCk/KCIwIi5mbG9vcigkb3ZlcnRpbWVzLzYwKSk6Zmxvb3IoJG92ZXJ0aW1lcy82MCkpIDogJzAwJzsKCSAgICAgICAgICAgICAgICAgICAgJG0gPSAkb3ZlcnRpbWVzJTYwID8gKCgkb3ZlcnRpbWVzJTYwPDEwKT8gKCIwIi4kb3ZlcnRpbWVzJTYwKTooJG92ZXJ0aW1lcyU2MCkpIDogJzAwJzsKCSAgICAgICAgICAgICAgICAgICAgJG90SG91ciA9ICgkaC4nLicuKCRtID09JzMwJz8nNTAnOicwMCcpKTsqLwoJICAgICAgICAgICAgICAgICAgICAKCQkJCQkJaWYoJGdldEF0dGVuZGFuY2UtPm90X2hvdXIgIT0gJG92ZXJ0aW1lcyl7CgkJCQkJCQlEQjo6dGFibGUoJHRhYmxlTmFtZSkKCQkJCQkJCS0+d2hlcmUoJ2lkJywgJGdldEF0dGVuZGFuY2UtPmlkKQoJCQkJCQkJLT51cGRhdGUoWydvdF9ob3VyJyA9PiAkb3ZlcnRpbWVzXSk7CgoJCQkJCQkJJGZsYWcgPSAxOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoKCQkJaWYoJGZsYWcgPT0gMSl7CgkJCQlyZXR1cm4gJ3N1Y2Nlc3MnOwoJCQl9ZWxzZXsKCQkJCXJldHVybiAnbm90IGZvdW5kJzsKCQkJfQoJCX0gY2F0Y2ggKFxFeGNlcHRpb24gJGUpIHsKCQkJJGJ1ZyA9ICRlLT5nZXRNZXNzYWdlKCk7CgkJCXJldHVybiAkYnVnOwoJCX0KCX0KCgkvKiovCgkvLyAkc3JTdGF0dXMgPSBlbXBsb3llZSBzaGlmdCByb3N0ZXIgc3RhdHVzCglwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGVtcGxveWVlRGF0ZVdpc2VTdGF0dXMoJGRhdGUsICRhc3NJZCwgJHVuaXQsICRzclN0YXR1cykKCXsKCQkkbW9udGggPSBkYXRlKCdtJywgc3RydG90aW1lKCRkYXRlKSk7CiAgICAgICAgJHllYXIgPSBkYXRlKCdZJywgc3RydG90aW1lKCRkYXRlKSk7CiAgICAgICAgJHRvZGF5ID0gZGF0ZSgiWS1tLWQiLCBzdHJ0b3RpbWUoJGRhdGUpKTsKICAgICAgICAkZGF5ID0gJ29wZW4nOwogICAgICAgIC8vIGxlYXZlIGNoZWNrIGluZGl2aWR1YWwKICAgICAgICAkZ2V0TGVhdmUgPSBMZWF2ZTo6Z2V0RGF0ZVN0YXR1c1dpc2VFbXBsb3llZUxlYXZlQ2hlY2soJGFzc0lkLCAkdG9kYXksIDEpOwoKICAgICAgICBpZigkZ2V0TGVhdmUgIT0gbnVsbCl7CiAgICAgICAgICAgICRkYXkgPSAnbGVhdmUnOwogICAgICAgIH1lbHNlewogICAgICAgIAkkZ2V0RGF5U3RhdHVzID0gSG9saWRheVJvYXN0ZXI6OmdldEhvbGlkYXlZZWFyTW9udGhBc0lkRGF0ZVdpc2VSZW1hcmtNdWx0aSgkeWVhciwgJG1vbnRoLCAkYXNzSWQsICR0b2RheSwgWydIb2xpZGF5JywgJ09UJywgJ0dlbmVyYWwnXSk7CgkgICAgICAgIGlmKCRnZXREYXlTdGF0dXMgIT0gbnVsbCl7CgkgICAgICAgIAlpZigkZ2V0RGF5U3RhdHVzLT5yZW1hcmtzID09ICdHZW5lcmFsJyl7CgkgICAgICAgIAkJJGRheSA9ICdvcGVuJzsKCSAgICAgICAgCX1lbHNlewoJICAgICAgICAJCSRkYXkgPSAkZ2V0RGF5U3RhdHVzLT5yZW1hcmtzOwoJICAgICAgICAJfQoJICAgICAgICB9ZWxzZSBpZigkc3JTdGF0dXMgPT0gMCl7CgkgICAgICAgIAkkZ2V0RGF5U3RhdHVzID0gWWVhcmx5SG9seURheTo6Z2V0Q2hlY2tVbml0RGF5V2lzZUhvbGlkYXlTdGF0dXNNdWx0aSgkdW5pdCwgJHRvZGF5LCBbMCwgMl0pOwoJICAgICAgICAJaWYoJGdldERheVN0YXR1cyAhPSBudWxsKXsKCSAgICAgICAgCQlpZigkZ2V0RGF5U3RhdHVzLT5ocl95aHBfb3Blbl9zdGF0dXMgPT0gMCl7CgkgICAgICAgIAkJCSRkYXkgPSAnSG9saWRheSc7CgkgICAgICAgIAkJfWVsc2V7CgkgICAgICAgIAkJCSRkYXkgPSAnT1QnOwoJICAgICAgICAJCX0KCSAgICAgICAgCX0KCSAgICAgICAgfWVsc2V7CgkgICAgICAgIAkkZGF5ID0gJ29wZW4nOwoJICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAkZGF5OwoJfQoKCS8vIGRhaWx5IGJpbGwgY2FsY3VsYXRpb24KCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZGFpbHlCaWxsQ2FsY3VsYXRpb24oJGFzT3QsICR1bml0LCAkZGF0ZSwgJGFzSWQsICRzaGlmdE5pZ2h0LCAkZGVzaWduYXRpb25JZCkKCXsKCQl0cnkgewoJCQkkYmlsbFNldHRpbmcgPSBCaWxsU2V0dGluZ3M6OndoZXJlKCd1bml0X2lkJywgJHVuaXQpLT53aGVyZSgnc3RhdHVzJywgMSktPndoZXJlTnVsbCgnZW5kX2RhdGUnKS0+Zmlyc3QoKTsKCQkJJGZsYWcgPSAwOwoJCQlpZigkYmlsbFNldHRpbmcgIT0gbnVsbCl7CgkJCQlpZigkYmlsbFNldHRpbmctPmFzX290ID09IDIpewoJCQkJCSRmbGFnID0gMTsKCQkJCX0KCQkJCWlmKCRmbGFnID09IDApewoJCQkJCWlmKCRiaWxsU2V0dGluZy0+YXNfb3QgPT0gJGFzT3QpewoJCQkJCQkkZmxhZyA9IDE7CgkJCQkJfQoJCQkJfQoKCQkJCWlmKCRmbGFnID09IDEpewoJCQkJCSRiaWxsU3BlY2lhbCA9IEJpbGxTcGVjaWFsU2V0dGluZ3M6OndoZXJlKCdiaWxsX2lkJywgJGJpbGxTZXR0aW5nLT5pZCktPndoZXJlKCdkZXNpZ25hdGlvbl9pZCcsICRkZXNpZ25hdGlvbklkKS0+d2hlcmVOdWxsKCdlbmRfZGF0ZScpLT53aGVyZSgnc3RhdHVzJywgMSktPmZpcnN0KCk7CgkJCQkJaWYoJGJpbGxTcGVjaWFsICE9IG51bGwpewoJCQkJCQkkdGlmZmluID0gJGJpbGxTcGVjaWFsLT50aWZmaW5fYmlsbDsKCQkJCQkJJGRpbm5lciA9ICRiaWxsU3BlY2lhbC0+ZGlubmVyX2JpbGw7CgkJCQkJfWVsc2V7CgkJCQkJCSR0aWZmaW4gPSAkYmlsbFNldHRpbmctPnRpZmZpbl9iaWxsOwoJCQkJCQkkZGlubmVyID0gJGJpbGxTZXR0aW5nLT5kaW5uZXJfYmlsbDsKCQkJCQl9CgkJCQkJJGdldEJpbGwgPSBCaWxsczo6d2hlcmUoJ2FzX2lkJywgJGFzSWQpLT53aGVyZSgnYmlsbF9kYXRlJywgJGRhdGUpLT5maXJzdCgpOwoJCQkJCSRiaWxscyA9IFsKCQkJCQkJJ2FzX2lkJyA9PiAkYXNJZCwKCQkJCQkJJ2JpbGxfZGF0ZScgPT4gJGRhdGUsCgkJCQkJCSdiaWxsX3R5cGUnID0+ICRzaGlmdE5pZ2h0PT0xPzI6MSwKCQkJCQkJJ2Ftb3VudCcgPT4gJHNoaWZ0TmlnaHQ9PTE/JGRpbm5lcjokdGlmZmluCgkJCQkJXTsKCQkJCQlpZigkZ2V0QmlsbCAhPSBudWxsKXsKCQkJCQkJQmlsbHM6OndoZXJlKCdpZCcsICRnZXRCaWxsLT5pZCkKCQkJCQkJLT51cGRhdGUoJGJpbGxzKTsKCQkJCQl9ZWxzZXsKCQkJCQkJJGJpbGxzWydwYXlfc3RhdHVzJ10gPSAwOwoJCQkJCQlCaWxsczo6aW5zZXJ0KCRiaWxscyk7CgkJCQkJfQoJCQkJfQoJCQkJCgkJCX0gCgkJCXJldHVybiAic3VjY2VzcyI7CgkJfSBjYXRjaCAoXEV4Y2VwdGlvbiAkZSkgewoJCQkkYnVnID0gJGUtPmdldE1lc3NhZ2UoKTsKCQkJcmV0dXJuICRidWc7CgkJCXJldHVybiAnZXJyb3InOwoJCX0KCX0KCgoJcHVibGljIHN0YXRpYyBmdW5jdGlvbiBnZXRIb2xpZGF5KCRlbXBsb3llZSwgJGZpcnN0X2RheSwgJGxhc3RfZGF5KQoJewoJCSR0YWJsZSA9IGdldF9hdHRfdGFibGUoJGVtcGxveWVlLT5hc191bml0X2lkKTsKCQkkZW1wZG9qTW9udGggPSBkYXRlKCdZLW0nLCBzdHJ0b3RpbWUoJGVtcGxveWVlLT5hc19kb2opKTsKCQkkeWVhciA9IGRhdGUoJ1knLCBzdHJ0b3RpbWUoJGZpcnN0X2RheSkpOwoJCSRtb250aCA9IGRhdGUoJ20nLCBzdHJ0b3RpbWUoJGZpcnN0X2RheSkpOwoJCSR5ZWFyTW9udGggPSBkYXRlKCdZLW0nLCBzdHJ0b3RpbWUoJGZpcnN0X2RheSkpOwoJCS8vIGNoZWNrIE9UIHJvYXN0ZXIgZW1wbG95ZWUKICAgICAgICAkcm9zdGVyT1RDb3VudCA9IEhvbGlkYXlSb2FzdGVyOjp3aGVyZSgneWVhcicsICR5ZWFyKQogICAgICAgIC0+d2hlcmUoJ21vbnRoJywgJG1vbnRoKQogICAgICAgIC0+d2hlcmUoJ2FzX2lkJywgJGVtcGxveWVlLT5hc3NvY2lhdGVfaWQpCiAgICAgICAgLT53aGVyZSgnZGF0ZScsJz49JywgJGZpcnN0X2RheSkKICAgICAgICAtPndoZXJlKCdkYXRlJywnPD0nLCAkbGFzdF9kYXkpCiAgICAgICAgLT5nZXQoKQogICAgICAgIC0+Z3JvdXBCeSgncmVtYXJrcycpOwoKICAgICAgIAoKICAgICAgICAkcm9zdGVyT3REYXRhID0gJHJvc3Rlck9UQ291bnQtPnBsdWNrKCdkYXRlJyktPnRvQXJyYXkoKTsKCiAgICAgICAgJG90RGF5Q291bnQgPSAwOwogICAgICAgICR0b3RhbE90ID0gY291bnQoJHJvc3Rlck9UQ291bnQpOwoKICAgICAgICAkb3REYXlDb3VudCA9IERCOjp0YWJsZSgkdGFibGUpCgkJCSAgICAgICAgICAgIC0+d2hlcmUoJ2FzX2lkJywgJGVtcGxveWVlLT5hc19pZCkKCQkJICAgICAgICAgICAgLT53aGVyZUluKCdpbl9kYXRlJywgJHJvc3Rlck90RGF0YSkKCQkJICAgICAgICAgICAgLT5jb3VudCgpOwogICAgICAgCgogICAgICAgIGlmKCRlbXBsb3llZS0+c2hpZnRfcm9hc3Rlcl9zdGF0dXMgPT0gMSl7CiAgICAgICAgICAgIC8vIGNoZWNrIGhvbGlkYXkgcm9hc3RlciBlbXBsb3llZQogICAgICAgICAgICAkZ2V0SG9saWRheSA9IEhvbGlkYXlSb2FzdGVyOjp3aGVyZSgneWVhcicsICR5ZWFyKQogICAgICAgICAgICAtPndoZXJlKCdtb250aCcsICRtb250aCkKICAgICAgICAgICAgLT53aGVyZSgnYXNfaWQnLCAkZW1wbG95ZWUtPmFzc29jaWF0ZV9pZCkKICAgICAgICAgICAgLT53aGVyZSgnZGF0ZScsJz49JywgJGZpcnN0X2RheSkKICAgICAgICAgICAgLT53aGVyZSgnZGF0ZScsJzw9JywgJGxhc3RfZGF5KQogICAgICAgICAgICAtPndoZXJlKCdyZW1hcmtzJywgJ0hvbGlkYXknKQogICAgICAgICAgICAtPmNvdW50KCk7CiAgICAgICAgICAgICRnZXRIb2xpZGF5ID0gJGdldEhvbGlkYXkgKyAoJHRvdGFsT3QgLSAkb3REYXlDb3VudCk7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIC8vIGNoZWNrIGhvbGlkYXkgcm9hc3RlciBlbXBsb3llZQogICAgICAgICAgICAkUm9zdGVySG9saWRheUNvdW50ID0gSG9saWRheVJvYXN0ZXI6OndoZXJlKCd5ZWFyJywgJHllYXIpCiAgICAgICAgICAgIC0+d2hlcmUoJ21vbnRoJywgJG1vbnRoKQogICAgICAgICAgICAtPndoZXJlKCdhc19pZCcsICRlbXBsb3llZS0+YXNzb2NpYXRlX2lkKQogICAgICAgICAgICAtPndoZXJlKCdkYXRlJywnPj0nLCAkZmlyc3RfZGF5KQogICAgICAgICAgICAtPndoZXJlKCdkYXRlJywnPD0nLCAkbGFzdF9kYXkpCiAgICAgICAgICAgIC0+d2hlcmUoJ3JlbWFya3MnLCAnSG9saWRheScpCiAgICAgICAgICAgIC0+Y291bnQoKTsKICAgICAgICAgICAgLy8gY2hlY2sgR2VuZXJhbCByb2FzdGVyIGVtcGxveWVlCiAgICAgICAgICAgICRSb3N0ZXJHZW5lcmFsQ291bnQgPSBIb2xpZGF5Um9hc3Rlcjo6d2hlcmUoJ3llYXInLCAkeWVhcikKICAgICAgICAgICAgLT53aGVyZSgnbW9udGgnLCAkbW9udGgpCiAgICAgICAgICAgIC0+d2hlcmUoJ2FzX2lkJywgJGVtcGxveWVlLT5hc3NvY2lhdGVfaWQpCiAgICAgICAgICAgIC0+d2hlcmUoJ2RhdGUnLCc+PScsICRmaXJzdF9kYXkpCiAgICAgICAgICAgIC0+d2hlcmUoJ2RhdGUnLCc8PScsICRsYXN0X2RheSkKICAgICAgICAgICAgLT53aGVyZSgncmVtYXJrcycsICdHZW5lcmFsJykKICAgICAgICAgICAgLT5jb3VudCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgIC8vIGNoZWNrIGhvbGlkYXkgc2hpZnQgZW1wbG95ZWUKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmKCRlbXBkb2pNb250aCA9PSAkeWVhck1vbnRoKXsKICAgICAgICAgICAgICAgICRxdWVyeSA9IFllYXJseUhvbHlEYXk6OgogICAgICAgICAgICAgICAgICAgIHdoZXJlKCdocl95aHBfdW5pdCcsICRlbXBsb3llZS0+YXNfdW5pdF9pZCkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdocl95aHBfZGF0ZXNfb2ZfaG9saWRheXMnLCc+PScsICRmaXJzdF9kYXkpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnaHJfeWhwX2RhdGVzX29mX2hvbGlkYXlzJywnPD0nLCAkbGFzdF9kYXkpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnaHJfeWhwX2RhdGVzX29mX2hvbGlkYXlzJywnPj0nLCAkZW1wbG95ZWUtPmFzX2RvaikKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdocl95aHBfb3Blbl9zdGF0dXMnLCAwKTsKICAgICAgICAgICAgICAgIGlmKGNvdW50KCRyb3N0ZXJPdERhdGEpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZU5vdEluKCdocl95aHBfZGF0ZXNfb2ZfaG9saWRheXMnLCAkcm9zdGVyT3REYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRzaGlmdEhvbGlkYXlDb3VudCA9ICRxdWVyeS0+Y291bnQoKTsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAkcXVlcnkgPSBZZWFybHlIb2x5RGF5OjoKICAgICAgICAgICAgICAgICAgICB3aGVyZSgnaHJfeWhwX3VuaXQnLCAkZW1wbG95ZWUtPmFzX3VuaXRfaWQpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnaHJfeWhwX2RhdGVzX29mX2hvbGlkYXlzJywnPj0nLCAkZmlyc3RfZGF5KQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2hyX3locF9kYXRlc19vZl9ob2xpZGF5cycsJzw9JywgJGxhc3RfZGF5KQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2hyX3locF9vcGVuX3N0YXR1cycsIDApOwogICAgICAgICAgICAgICAgaWYoY291bnQoJHJvc3Rlck90RGF0YSkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlTm90SW4oJ2hyX3locF9kYXRlc19vZl9ob2xpZGF5cycsICRyb3N0ZXJPdERhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHNoaWZ0SG9saWRheUNvdW50ID0gJHF1ZXJ5LT5jb3VudCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRzaGlmdEhvbGlkYXlDb3VudCA9ICRzaGlmdEhvbGlkYXlDb3VudCArICgkdG90YWxPdCAtICRvdERheUNvdW50KTsKCiAgICAgICAgICAgIGlmKCRSb3N0ZXJIb2xpZGF5Q291bnQgPiAwIHx8ICRSb3N0ZXJHZW5lcmFsQ291bnQgPiAwKXsKICAgICAgICAgICAgICAgICRnZXRIb2xpZGF5ID0gKCRSb3N0ZXJIb2xpZGF5Q291bnQgKyAkc2hpZnRIb2xpZGF5Q291bnQpIC0gJFJvc3RlckdlbmVyYWxDb3VudDsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAkZ2V0SG9saWRheSA9ICRzaGlmdEhvbGlkYXlDb3VudDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJGdldEhvbGlkYXkgPSAkZ2V0SG9saWRheSA8IDAgPyAwOiRnZXRIb2xpZGF5OwoKICAgICAgICByZXR1cm4gJGdldEhvbGlkYXk7Cgl9CgoJcHVibGljIHN0YXRpYyBmdW5jdGlvbiBwcm9jZXNzUGFydGlhbFNhbGFyeSgkZW1wbG95ZWUsICRzYWxhcnlfZGF0ZSwgJHN0YXR1cykKICAgIHsKICAgIAl0cnl7CgoJICAgICAgICAkbW9udGggPSBkYXRlKCdtJywgc3RydG90aW1lKCRzYWxhcnlfZGF0ZSkpOwoJICAgICAgICAkeWVhciA9IGRhdGUoJ1knLCBzdHJ0b3RpbWUoJHNhbGFyeV9kYXRlKSk7CgkgICAgICAgICR0b3RhbF9kYXkgPSBkYXRlKCdkJywgc3RydG90aW1lKCRzYWxhcnlfZGF0ZSkpOwoKCSAgICAgICAgJHllYXJNb250aCA9ICR5ZWFyLictJy4kbW9udGg7CgkgICAgICAgICRlbXBkb2ogPSAkZW1wbG95ZWUtPmFzX2RvajsKCSAgICAgICAgJGVtcGRvak1vbnRoID0gZGF0ZSgnWS1tJywgc3RydG90aW1lKCRlbXBsb3llZS0+YXNfZG9qKSk7CgkgICAgICAgICRlbXBkb2pEYXkgPSBkYXRlKCdkJywgc3RydG90aW1lKCRlbXBsb3llZS0+YXNfZG9qKSk7CgoJICAgICAgICAkZmlyc3RfZGF5ID0gQ2FyYm9uOjpwYXJzZSgkc2FsYXJ5X2RhdGUpLT5maXJzdE9mTW9udGgoKS0+Zm9ybWF0KCdZLW0tZCcpOwoJICAgICAgICBpZigkZW1wZG9qTW9udGggPT0gICR5ZWFyTW9udGgpewoJICAgICAgICAgICAgJGZpcnN0X2RheSA9ICRlbXBsb3llZS0+YXNfZG9qOwoJICAgICAgICAgICAgJHRvdGFsX2RheSA9ICR0b3RhbF9kYXkgLSAkZW1wZG9qRGF5ICsgMTsKCSAgICAgICAgfQoKCgkgICAgICAgICR0YWJsZSA9IGdldF9hdHRfdGFibGUoJGVtcGxveWVlLT5hc191bml0X2lkKTsKCSAgICAgICAgJGF0dCA9IERCOjp0YWJsZSgkdGFibGUpCgkgICAgICAgICAgICAgICAgLT5zZWxlY3QoCgkgICAgICAgICAgICAgICAgICAgIERCOjpyYXcoJ0NPVU5UKCopIGFzIHByZXNlbnQnKSwKCSAgICAgICAgICAgICAgICAgICAgREI6OnJhdygnU1VNKG90X2hvdXIpIGFzIG90X2hvdXInKSwKCSAgICAgICAgICAgICAgICAgICAgREI6OnJhdygnQ09VTlQoQ0FTRSBXSEVOIGxhdGVfc3RhdHVzID0xIFRIRU4gMSBFTkQpIEFTIGxhdGUnKQoJICAgICAgICAgICAgICAgICkKCSAgICAgICAgICAgICAgICAtPndoZXJlKCdhc19pZCcsJGVtcGxveWVlLT5hc19pZCkKCSAgICAgICAgICAgICAgICAtPndoZXJlKCdpbl9kYXRlJywnPj0nLCRmaXJzdF9kYXkpCgkgICAgICAgICAgICAgICAgLT53aGVyZSgnaW5fZGF0ZScsJzw9JywgJHNhbGFyeV9kYXRlKQoJICAgICAgICAgICAgICAgIC0+Zmlyc3QoKTsKCgkgICAgICAgICRsYXRlID0gJGF0dC0+bGF0ZT8/MDsKCSAgICAgICAgJG92ZXJ0aW1lcyA9ICRhdHQtPm90X2hvdXI/PzA7CgoJICAgICAgICAvLyBjaGVjayBpZiBmcmlkYXkgaGFzIGV4dHJhIG90CgkgICAgICAgIGlmKCRlbXBsb3llZS0+c2hpZnRfcm9hc3Rlcl9zdGF0dXMgPT0gMSApewoJICAgICAgICAgICAgJGZyaWRheV9vdCA9IERCOjp0YWJsZSgnaHJfYXR0X3NwZWNpYWwnKQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2FzX2lkJywgJGVtcGxveWVlLT5hc19pZCkKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdpbl9kYXRlJywnPj0nLCAkZmlyc3RfZGF5KQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2luX2RhdGUnLCc8PScsICRzYWxhcnlfZGF0ZSkKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmdldCgpCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5zdW0oJ290X2hvdXInKTsKCgkgICAgICAgICAgICAkb3ZlcnRpbWVzID0gJG92ZXJ0aW1lcyArICRmcmlkYXlfb3Q7CgkgICAgICAgIH0KCgkgICAgICAgICRkaWZmRXhwbG9kZSA9IGV4cGxvZGUoJy4nLCAkb3ZlcnRpbWVzKTsKCSAgICAgICAgJG1pbnV0ZXMgPSAoaXNzZXQoJGRpZmZFeHBsb2RlWzFdKSA/ICRkaWZmRXhwbG9kZVsxXSA6IDApOwoJICAgICAgICAkbWludXRlcyA9IGZsb2F0dmFsKCcwLicuJG1pbnV0ZXMpOwoJICAgICAgICBpZigkbWludXRlcyA+IDAgJiYgJG1pbnV0ZXMgIT0gMSl7CgkgICAgICAgICAgICAkbWluID0gKGludClyb3VuZCgkbWludXRlcyo2MCk7CgkgICAgICAgICAgICAkbWluT1QgPSBtaW5fdG9fb3QoKTsKCSAgICAgICAgICAgICRtaW51dGVzID0gJG1pbk9UWyRtaW5dPz8wOwoJICAgICAgICB9CgoJICAgICAgICAkb3ZlcnRpbWVzID0gJGRpZmZFeHBsb2RlWzBdKyRtaW51dGVzOwoJICAgICAgICAKCSAgICAgICAgJHByZXNlbnQgPSAkYXR0LT5wcmVzZW50Pz8wOwoKCSAgICAgICAgJGdldFNhbGFyeSA9IERCOjp0YWJsZSgnaHJfbW9udGhseV9zYWxhcnknKQoJICAgICAgICAgICAgICAgICAgICAtPndoZXJlKFsKCSAgICAgICAgICAgICAgICAgICAgICAgICdhc19pZCcgPT4gJGVtcGxveWVlLT5hc3NvY2lhdGVfaWQsCgkgICAgICAgICAgICAgICAgICAgICAgICAnbW9udGgnID0+ICRtb250aCwKCSAgICAgICAgICAgICAgICAgICAgICAgICd5ZWFyJyA9PiAkeWVhcgoJICAgICAgICAgICAgICAgICAgICBdKQoJICAgICAgICAgICAgICAgICAgICAtPmZpcnN0KCk7CgoJICAgICAgICAkZ2V0SG9saWRheSA9IHNlbGY6OmdldEhvbGlkYXkoJGVtcGxveWVlLCRmaXJzdF9kYXksICRzYWxhcnlfZGF0ZSk7CgoJICAgICAgICAKCSAgICAgICAgLy8gZ2V0IGxlYXZlIGVtcGxveWVlIHdpc2UKCgkgICAgICAgICRsZWF2ZUNvdW50ID0gREI6OnRhYmxlKCdocl9sZWF2ZScpCgkJCQkgICAgICAgIC0+c2VsZWN0KAoJCQkJICAgICAgICAgICAgREI6OnJhdygiU1VNKERBVEVESUZGKGxlYXZlX3RvLCBsZWF2ZV9mcm9tKSsxKSBBUyB0b3RhbCIpCgkJCQkgICAgICAgICkKCQkJCSAgICAgICAgLT53aGVyZSgnbGVhdmVfYXNzX2lkJywgJGVtcGxveWVlLT5hc3NvY2lhdGVfaWQpCgkJCQkgICAgICAgIC0+d2hlcmUoJ2xlYXZlX2Zyb20nLCAnPj0nLCAkZmlyc3RfZGF5KQoJCQkJICAgICAgICAtPndoZXJlKCdsZWF2ZV90bycsICc8PScsICRzYWxhcnlfZGF0ZSkKCQkJCSAgICAgICAgLT5maXJzdCgpLT50b3RhbD8/MDsKCgkgICAgICAgIC8vIGdldCBhYnNlbnQgZW1wbG95ZWUgd2lzZQoJICAgICAgICAkZ2V0QWJzZW50ID0gJHRvdGFsX2RheSAtICgkcHJlc2VudCArICRnZXRIb2xpZGF5ICsgJGxlYXZlQ291bnQpOwoJICAgICAgICBpZigkZ2V0QWJzZW50IDwgMCl7CgkgICAgICAgICAgICAkZ2V0QWJzZW50ID0gMDsKCSAgICAgICAgfQoKCSAgICAgICAgLy8gZ2V0IHNhbGFyeSBhZGQgZGVkdWN0IGlkIGZvcm0gc2FsYXJ5IGFkZCBkZWR1Y3QgdGFibGUKCSAgICAgICAgJGdldEFkZERlZHVjdCA9IFNhbGFyeUFkZERlZHVjdDo6CgkgICAgICAgIHdoZXJlKCdhc3NvY2lhdGVfaWQnLCAkZW1wbG95ZWUtPmFzc29jaWF0ZV9pZCkKCSAgICAgICAgLT53aGVyZSgnbW9udGgnLCAgJG1vbnRoKQoJICAgICAgICAtPndoZXJlKCd5ZWFyJywgICR5ZWFyKQoJICAgICAgICAtPmZpcnN0KCk7CgoJICAgICAgICBpZigkZ2V0QWRkRGVkdWN0ICE9IG51bGwpewoJICAgICAgICAgICAgJGRlZHVjdENvc3QgPSAoJGdldEFkZERlZHVjdC0+YWR2cF9kZWR1Y3QgKyAkZ2V0QWRkRGVkdWN0LT5jZ19kZWR1Y3QgKyAkZ2V0QWRkRGVkdWN0LT5mb29kX2RlZHVjdCArICRnZXRBZGREZWR1Y3QtPm90aGVyc19kZWR1Y3QpOwoJICAgICAgICAgICAgJGRlZHVjdFNhbGFyeUFkZCA9ICRnZXRBZGREZWR1Y3QtPnNhbGFyeV9hZGQ7CgkgICAgICAgICAgICAkcHJvZHVjdGlvbkJvbnVzID0gJGdldEFkZERlZHVjdC0+Ym9udXNfYWRkOwoJICAgICAgICAgICAgJGRlZHVjdElkID0gJGdldEFkZERlZHVjdC0+aWQ7CgkgICAgICAgIH1lbHNlewoJICAgICAgICAgICAgJGRlZHVjdENvc3QgPSAwOwoJICAgICAgICAgICAgJGRlZHVjdFNhbGFyeUFkZCA9IDA7CgkgICAgICAgICAgICAkZGVkdWN0SWQgPSBudWxsOwoJICAgICAgICAgICAgJHByb2R1Y3Rpb25Cb251cyA9IDA7CgkgICAgICAgIH0KCgkgICAgICAgICRkYXRlQ291bnQgPSBjYWxfZGF5c19pbl9tb250aChDQUxfR1JFR09SSUFOLCAkbW9udGgsICR5ZWFyKTsKCgkgICAgICAgIC8vZ2V0IGFkZCBhYnNlbnQgZGVkdWN0IGNhbGN1bGF0aW9uCgkgICAgICAgICRwZXJEYXlCYXNpYyA9IHJvdW5kKCgkZW1wbG95ZWUtPmJlbl9iYXNpYyAvIDMwKSwyKTsKCSAgICAgICAgJHBlckRheUdyb3NzID0gcm91bmQoKCRlbXBsb3llZS0+YmVuX2N1cnJlbnRfc2FsYXJ5IC8gICRkYXRlQ291bnQpLDIpOyAKCSAgICAgICAgJGdldEFic2VudERlZHVjdCA9ICRnZXRBYnNlbnQgKiAkcGVyRGF5QmFzaWM7CgoJICAgICAgICAkc3RhbXAgPSAxMDsgLy8gYnkgZGVmYXVsdCBhbGwgZW1wbG95ZWU7CgkgICAgICAgIAoKCSAgICAgICAgaWYoJGVtcGxveWVlLT5hc19vdCA9PSAxKXsKCSAgICAgICAgICAgICRvdmVydGltZV9yYXRlID0gbnVtYmVyX2Zvcm1hdCgoKCRlbXBsb3llZS0+YmVuX2Jhc2ljLzIwOCkqMiksIDIsICIuIiwgIiIpOwoJICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgJG92ZXJ0aW1lX3JhdGUgPSAwOwoJICAgICAgICB9CgkgICAgICAgICRvdmVydGltZV9zYWxhcnkgPSAwOwoJICAgICAgICAKCgkgICAgICAgICRhdHRCb251cyA9IDA7CgkgICAgICAgICR0b3RhbExhdGUgPSAkbGF0ZTsKCSAgICAgICAgJHNhbGFyeV9kYXRlID0gJHByZXNlbnQgKyAkZ2V0SG9saWRheSArICRsZWF2ZUNvdW50OwoKCSAgICAgICAgCgkgICAgICAgIAoJICAgICAgICAkc2FsYXJ5ID0gWwoJICAgICAgICAgICAgJ2FzX2lkJyA9PiAkZW1wbG95ZWUtPmFzc29jaWF0ZV9pZCwKCSAgICAgICAgICAgICdtb250aCcgPT4gJG1vbnRoLAoJICAgICAgICAgICAgJ3llYXInICA9PiAkeWVhciwKCSAgICAgICAgICAgICdncm9zcycgPT4gJGVtcGxveWVlLT5iZW5fY3VycmVudF9zYWxhcnk/PzAsCgkgICAgICAgICAgICAnYmFzaWMnID0+ICRlbXBsb3llZS0+YmVuX2Jhc2ljPz8wLAoJICAgICAgICAgICAgJ2hvdXNlJyA9PiAkZW1wbG95ZWUtPmJlbl9ob3VzZV9yZW50Pz8wLAoJICAgICAgICAgICAgJ21lZGljYWwnID0+ICRlbXBsb3llZS0+YmVuX21lZGljYWw/PzAsCgkgICAgICAgICAgICAndHJhbnNwb3J0JyA9PiAkZW1wbG95ZWUtPmJlbl90cmFuc3BvcnQ/PzAsCgkgICAgICAgICAgICAnZm9vZCcgPT4gJGVtcGxveWVlLT5iZW5fZm9vZD8/MCwKCSAgICAgICAgICAgICdsYXRlX2NvdW50JyA9PiAkbGF0ZSwKCSAgICAgICAgICAgICdwcmVzZW50JyA9PiAkcHJlc2VudCwKCSAgICAgICAgICAgICdob2xpZGF5JyA9PiAkZ2V0SG9saWRheSwKCSAgICAgICAgICAgICdhYnNlbnQnID0+ICRnZXRBYnNlbnQsCgkgICAgICAgICAgICAnbGVhdmUnID0+ICRsZWF2ZUNvdW50LAoJICAgICAgICAgICAgJ2Fic2VudF9kZWR1Y3QnID0+ICRnZXRBYnNlbnREZWR1Y3QsCgkgICAgICAgICAgICAnc2FsYXJ5X2FkZF9kZWR1Y3RfaWQnID0+ICRkZWR1Y3RJZCwKCSAgICAgICAgICAgICdvdF9yYXRlJyA9PiAkb3ZlcnRpbWVfcmF0ZSwKCSAgICAgICAgICAgICdvdF9ob3VyJyA9PiAkb3ZlcnRpbWVzLAoJICAgICAgICAgICAgJ2F0dGVuZGFuY2VfYm9udXMnID0+ICRhdHRCb251cywKCSAgICAgICAgICAgICdwcm9kdWN0aW9uX2JvbnVzJyA9PiAkcHJvZHVjdGlvbkJvbnVzLAoJICAgICAgICAgICAgJ2VtcF9zdGF0dXMnID0+ICRzdGF0dXMsCgkgICAgICAgICAgICAnc3RhbXAnID0+ICRzdGFtcCwKCSAgICAgICAgICAgICdwYXlfc3RhdHVzJyA9PiAxLAoJICAgICAgICAgICAgJ2JhbmtfcGF5YWJsZScgPT4gMCwKCSAgICAgICAgICAgICd0ZHMnID0+IDAsCgkgICAgICAgICAgICAnb3Rfc3RhdHVzJz0+ICRlbXBsb3llZS0+YXNfb3QsCgkgICAgICAgICAgICAnZGVzaWduYXRpb25faWQnID0+ICRlbXBsb3llZS0+YXNfZGVzaWduYXRpb25faWQsCgkgICAgICAgICAgICAnc3ViX3NlY3Rpb25faWQnID0+ICRlbXBsb3llZS0+YXNfc3Vic2VjdGlvbl9pZCwKCSAgICAgICAgICAgICdsb2NhdGlvbl9pZCcgPT4gJGVtcGxveWVlLT5hc19sb2NhdGlvbiwKCSAgICAgICAgICAgICdyb2FzdGVyX3N0YXR1cycgPT4gJGVtcGxveWVlLT5zaGlmdF9yb2FzdGVyX3N0YXR1cywKCSAgICAgICAgICAgICd1bml0X2lkJyA9PiAkZW1wbG95ZWUtPmFzX3VuaXRfaWQsCgkgICAgICAgICAgICAnY3JlYXRlZF9ieScgPT4gYXV0aCgpLT5pZCgpCgkgICAgICAgICAgICAKCSAgICAgICAgXTsKCgkgICAgICAgIC8vIGxlYXZlIGFkanVzdCBjYWxjdWxhdGUKCSAgICAgICAgJHNhbGFyeUFkanVzdCA9IFNhbGFyeUFkanVzdE1hc3Rlcjo6Z2V0Q2hlY2tFbXBsb3llZUlkTW9udGhZZWFyV2lzZSgkZW1wbG95ZWUtPmFzc29jaWF0ZV9pZCwgJG1vbnRoLCAkeWVhcik7CgoJICAgICAgICAkbGVhdmVBZGp1c3QgPSAwLjAwOwoJICAgICAgICAkaW5jcmVtZW50QWRqdXN0ID0gMDsKCSAgICAgICAgJHNhbGFyeUFkZCA9IDA7CgkgICAgICAgIGlmKCRzYWxhcnlBZGp1c3QgIT0gbnVsbCl7CgkgICAgICAgICAgICAkYWRqID0gREI6OnRhYmxlKCdocl9zYWxhcnlfYWRqdXN0X2RldGFpbHMnKQoJICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3NhbGFyeV9hZGp1c3RfbWFzdGVyX2lkJywgJHNhbGFyeUFkanVzdC0+aWQpCgkgICAgICAgICAgICAgICAgLT5nZXQoKTsKCgkgICAgICAgICAgICAkbGVhdmVBZGp1c3QgPSBjb2xsZWN0KCRhZGopLT53aGVyZSgndHlwZScsMSktPnN1bSgnYW1vdW50Jyk7CgkgICAgICAgICAgICAkaW5jcmVtZW50QWRqdXN0ID0gY29sbGVjdCgkYWRqKS0+d2hlcmUoJ3R5cGUnLDMpLT5zdW0oJ2Ftb3VudCcpOwoJICAgICAgICAgICAgJHNhbGFyeUFkZCA9IGNvbGxlY3QoJGFkaiktPndoZXJlKCd0eXBlJywyKS0+c3VtKCdhbW91bnQnKTsKCSAgICAgICAgICAgIAoJICAgICAgICB9CgoJICAgICAgICAkbGVhdmVBZGp1c3QgPSBjZWlsKChmbG9hdCkgJGxlYXZlQWRqdXN0KTsKCSAgICAgICAgJGluY3JlbWVudEFkanVzdCA9IGNlaWwoKGZsb2F0KSAkaW5jcmVtZW50QWRqdXN0KTsKCSAgICAgICAgCgkgICAgICAgIC8vIGdldCBzYWxhcnkgcGF5YWJsZSBjYWxjdWxhdGlvbgoJICAgICAgICAkc2FsYXJ5UGF5YWJsZSA9IHJvdW5kKCgoJHBlckRheUdyb3NzKiR0b3RhbF9kYXkpIC0gKCRnZXRBYnNlbnREZWR1Y3QgKyAkZGVkdWN0Q29zdCkpLCAyKTsKCSAgICAgICAgJG90ID0gKCRvdmVydGltZV9yYXRlKiRvdmVydGltZXMpOwoKCSAgICAgICAgJHBhcmFtcyA9IFsKCSAgICAgICAgCSdhc19pZCcgPT4gJGVtcGxveWVlLT5hc19pZCwKCSAgICAgICAgCSdtb250aCcgPT4gJG1vbnRoLAoJICAgICAgICAJJ3llYXInID0+ICR5ZWFyCgkgICAgICAgIF07CgkgICAgICAgICRwYXJ0aWFsQW1vdW50ID0gUGFydGlhbFNhbGFyeTo6Z2V0RW1wbG95ZWVXaXNlUGFydGlhbEFtb3VudCgkcGFyYW1zKTsKCgkgICAgICAgICR0b3RhbFBheWFibGUgPSBjZWlsKChmbG9hdCkoJHNhbGFyeVBheWFibGUgKyAkb3QgKyAkZGVkdWN0U2FsYXJ5QWRkICArICRwcm9kdWN0aW9uQm9udXMgKyAkbGVhdmVBZGp1c3QgKyAkc2FsYXJ5QWRkICsgJGluY3JlbWVudEFkanVzdCAtICRwYXJ0aWFsQW1vdW50KSk7CgoJICAgICAgICBpZigkdG90YWxQYXlhYmxlID4gMTAwMCl7CgkgICAgICAgIAkkc2FsYXJ5WydzdGFtcCddID0gMTA7CgkgICAgICAgIAkkdG90YWxQYXlhYmxlID0gJHRvdGFsUGF5YWJsZSAtIDEwOwoJICAgICAgICB9CgkgICAgICAgIAoJICAgICAgICAkc2FsYXJ5WydwYXJ0aWFsX2Ftb3VudCddID0gJHBhcnRpYWxBbW91bnQ7CgkgICAgICAgICRzYWxhcnlbJ3RvdGFsX3BheWFibGUnXSA9ICR0b3RhbFBheWFibGU7CgkgICAgICAgICRzYWxhcnlbJ2Nhc2hfcGF5YWJsZSddID0gJHRvdGFsUGF5YWJsZTsKCSAgICAgICAgJHNhbGFyeVsnc2FsYXJ5X3BheWFibGUnXSA9ICRzYWxhcnlQYXlhYmxlOwoJICAgICAgICAkc2FsYXJ5WydsZWF2ZV9hZGp1c3QnXSA9ICRsZWF2ZUFkanVzdDsKCgogICAgICAgIAoJICAgIAlpZigoJHByZXNlbnQgKyAkbGVhdmVDb3VudCkgPiAwKXsKCQkgICAgICAgICRnZXRTYWxhcnkgPSBIck1vbnRobHlTYWxhcnk6OndoZXJlKCdhc19pZCcsICRlbXBsb3llZS0+YXNzb2NpYXRlX2lkKQoJICAgICAgICAgICAgICAgIC0+d2hlcmUoJ21vbnRoJywgJG1vbnRoKQoJICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3llYXInLCAkeWVhcikKCSAgICAgICAgICAgICAgICAtPmZpcnN0KCk7CgoJCSAgICAgICAgaWYoJGdldFNhbGFyeSl7CgkJICAgICAgICAgICAgJHN0ID0gREI6OnRhYmxlKCdocl9tb250aGx5X3NhbGFyeScpCgkJICAgICAgICAgICAgCS0+d2hlcmUoJ2lkJywgJGdldFNhbGFyeS0+aWQpCgkJICAgICAgICAgICAgCS0+dXBkYXRlKCRzYWxhcnkpOyAgCgkJICAgICAgICB9ZWxzZXsKCQkgICAgICAgIAkkc3QgPSBEQjo6dGFibGUoJ2hyX21vbnRobHlfc2FsYXJ5JyktPmluc2VydCgkc2FsYXJ5KTsKCQkgICAgICAgICAgICAKCQkgICAgICAgIH0KCgkJICAgICAgICAkZmluYWxTYWxhcnkgPSBIck1vbnRobHlTYWxhcnk6OndoZXJlKCdhc19pZCcsICRlbXBsb3llZS0+YXNzb2NpYXRlX2lkKQoJICAgICAgICAgICAgICAgIC0+d2hlcmUoJ21vbnRoJywgJG1vbnRoKQoJICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3llYXInLCAkeWVhcikKCSAgICAgICAgICAgICAgICAtPmZpcnN0KCk7CgoJCSAgICAgICAgcmV0dXJuIChvYmplY3QpIFsKCQkgICAgICAgIAknc3RhdHVzJyA9PiAxLAoJCSAgICAgICAgCSdzYWxhcnknID0+ICRmaW5hbFNhbGFyeQoJCSAgICAgICAgXTsKCQkgICAgICAgICAKCQkgICAgfWVsc2V7CgkJICAgIAkkZ2V0U2FsYXJ5ID0gSHJNb250aGx5U2FsYXJ5Ojp3aGVyZSgnYXNfaWQnLCAkZW1wbG95ZWUtPmFzc29jaWF0ZV9pZCkKCSAgICAgICAgICAgICAgICAtPndoZXJlKCdtb250aCcsICRtb250aCkKCSAgICAgICAgICAgICAgICAtPndoZXJlKCd5ZWFyJywgJHllYXIpCgkgICAgICAgICAgICAgICAgLT5kZWxldGUoKTsKCgkgICAgICAgICAgICByZXR1cm4gKG9iamVjdCkgWwoJCSAgICAgICAgCSdzdGF0dXMnID0+IDIKCQkgICAgICAgIF07CgoJCSAgICB9CgkJfWNhdGNoKFxFeGNlcHRpb24gJGUpewoJCQkKCQkJREI6OnRhYmxlKCdlcnJvcicpLT5pbnNlcnQoWydtc2cnPT4gJ1BhcnRpYWwgc2FsYXJ5ICcuJGVtcGxveWVlLT5hc3NvY2lhdGVfaWQuJyAnLiRlLT5nZXRNZXNzYWdlKCldKTsKCQkJcmV0dXJuIChvYmplY3QpIFsKCSAgICAgICAgCSdzdGF0dXMnID0+IDAKCSAgICAgICAgXTsKCQl9CiAgICB9CgogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBnZXRIb2xpZGF5RGF0ZSgkZ2V0RW1wbG95ZWUsICRzdGFydERhdGUsICRlbmRFbmQpCiAgICB7CiAgICAJJGRhdGVzID0gW107CiAgICAJaWYoJGdldEVtcGxveWVlICE9IG51bGwpewogICAgCQkkZW1wZG9qID0gJGdldEVtcGxveWVlWydhc19kb2onXTsKICAgIAkJaWYoJGdldEVtcGxveWVlWydzaGlmdF9yb2FzdGVyX3N0YXR1cyddID09IDEpewoJICAgICAgICAgICAgLy8gY2hlY2sgaG9saWRheSByb2FzdGVyIGVtcGxveWVlCgkgICAgICAgICAgICAkZ2V0SG9saWRheSA9IEhvbGlkYXlSb2FzdGVyOjp3aGVyZSgnYXNfaWQnLCAkZ2V0RW1wbG95ZWVbJ2Fzc29jaWF0ZV9pZCddKQoJICAgICAgICAgICAgLT53aGVyZSgnZGF0ZScsJz49JywgJHN0YXJ0RGF0ZSkKCSAgICAgICAgICAgIC0+d2hlcmUoJ2RhdGUnLCc8PScsICRlbmRFbmQpCgkgICAgICAgICAgICAtPndoZXJlKCdyZW1hcmtzJywgJ0hvbGlkYXknKQoJICAgICAgICAgICAgLT5wbHVjaygnZGF0ZScpOwoJICAgICAgICAgICAgaWYoY291bnQoJGdldEhvbGlkYXkpID4gMCl7CgkgICAgICAgICAgICAJaWYoY291bnQoJGRhdGVzKSA+IDApewoJCSAgICAgICAgICAgIAlhcnJheV9wdXNoKCRkYXRlcywgJGdldEhvbGlkYXktPnRvQXJyYXkoKSk7CgkJICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgCgkgICAgICAgIH1lbHNlewoJICAgICAgICAgICAgLy8gY2hlY2sgaG9saWRheSByb2FzdGVyIGVtcGxveWVlCgkgICAgICAgICAgICAkcm9zdGVySG9saWRheUNvdW50ID0gSG9saWRheVJvYXN0ZXI6OndoZXJlKCdhc19pZCcsICRnZXRFbXBsb3llZVsnYXNzb2NpYXRlX2lkJ10pCgkgICAgICAgICAgICAtPndoZXJlKCdkYXRlJywnPj0nLCAkc3RhcnREYXRlKQoJICAgICAgICAgICAgLT53aGVyZSgnZGF0ZScsJzw9JywgJGVuZEVuZCkKCSAgICAgICAgICAgIC0+d2hlcmUoJ3JlbWFya3MnLCAnSG9saWRheScpCgkgICAgICAgICAgICAtPnBsdWNrKCdkYXRlJyk7CgoJICAgICAgICAgICAgaWYoY291bnQoJHJvc3RlckhvbGlkYXlDb3VudCkgPiAwKXsKCSAgICAgICAgICAgIAlpZihjb3VudCgkZGF0ZXMpID4gMCl7CgkJICAgICAgICAgICAgCWFycmF5X3B1c2goJGRhdGVzLCAkcm9zdGVySG9saWRheUNvdW50LT50b0FycmF5KCkpOwoJCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAkZ2V0SG9saWRheSA9IFllYXJseUhvbHlEYXk6OgogICAgICAgICAgICAgICAgd2hlcmUoJ2hyX3locF91bml0JywgJGdldEVtcGxveWVlWydhc191bml0X2lkJ10pCiAgICAgICAgICAgICAgICAtPndoZXJlKCdocl95aHBfZGF0ZXNfb2ZfaG9saWRheXMnLCc+PScsICRzdGFydERhdGUpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdocl95aHBfZGF0ZXNfb2ZfaG9saWRheXMnLCc8PScsICRlbmRFbmQpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdocl95aHBfb3Blbl9zdGF0dXMnLCAwKQogICAgICAgICAgICAgICAgLT5wbHVjaygnaHJfeWhwX2RhdGVzX29mX2hvbGlkYXlzJyk7CiAgICAgICAgICAgICAgICBpZihjb3VudCgkZ2V0SG9saWRheSkgPiAwKXsKCSAgICAgICAgICAgIAlpZihjb3VudCgkZGF0ZXMpID4gMCl7CgkJICAgICAgICAgICAgCWFycmF5X3B1c2goJGRhdGVzLCAkZ2V0SG9saWRheS0+dG9BcnJheSgpKTsKCQkgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAKCSAgICAgICAgfQogICAgCX0KCiAgICAJcmV0dXJuIGFycmF5X3VuaXF1ZSgkZ2V0SG9saWRheS0+dG9BcnJheSgpKTsKCiAgICB9CgogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBhdHRlbmRhbmNlUmVDYWxjdWxhdGlvbigkYXNJZCwgJHJlY29yZERhdGUpCiAgICB7CiAgICAJLy8gZ2V0IHR3byBkYXlzIGF0dGVuZGFuY2UgCiAgICAJdHJ5IHsKICAgIAkJJHRvZGF5ID0gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHJlY29yZERhdGUpKTsKCSAgICAJJHRvbW9ycm93ICA9IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCR0b2RheS4gJyArMSBkYXknKSk7CgkgICAgCSRnZXRBdHRlbmRhbmNlID0gQXR0ZW5kYW5jZUhpc3Rvcnk6OndoZXJlKCdhc19pZCcsICRhc0lkKQoJICAgIAktPndoZXJlQmV0d2VlbignYXR0X2RhdGUnLCBbJHRvZGF5LCAkdG9tb3Jyb3ddKQoJICAgIAktPmdldCgpOwoJICAgIAkkYXNfaW5mbyA9IEVtcGxveWVlOjp3aGVyZSgnYXNfaWQnLCAkYXNJZCktPmZpcnN0KCk7CgkgICAgCSR1bml0ID0gJGFzX2luZm8tPmFzX3VuaXRfaWQ7CgkgICAgCSRnZXRBdHQgPSAnJzsKCSAgICAJLy8gcmV0dXJuICgkZ2V0QXR0ZW5kYW5jZSk7CgkgICAgCWlmKGNvdW50KCRnZXRBdHRlbmRhbmNlKSA+IDAgJiYgJGFzX2luZm8gIT0gbnVsbCl7CgkgICAgCQkkdW5pdElkID0gJGFzX2luZm8tPmFzX3VuaXRfaWQ7CgkgICAgCQkkdGFibGVOYW1lID0gZ2V0X2F0dF90YWJsZSgkdW5pdElkKTsKCSAgICAJCSRxdWV1ZU5hbWUgPSAnZGVmYXVsdCc7CgkgICAgICAgICAgICBpZigkYXNfaW5mby0+YXNfdW5pdF9pZCA9PSAyKXsKCSAgICAgICAgICAgICAgICAkcXVldWVOYW1lID0gJ2NlaWxhdHQnOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgJGRhdGEgPSBbXTsKCSAgICAgICAgICAgIGZvcmVhY2ggKCRnZXRBdHRlbmRhbmNlIGFzICRhdHQpIHsKCSAgICAgICAgICAgIAkkY2hlY2t0aW1lID0gJGF0dC0+cmF3X2RhdGE7CgkgICAgICAgICAgICAJJHB1bmNoX2RhdGUgPSBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkY2hlY2t0aW1lKSk7CgkgICAgICAgICAgICAJJGRheV9vZl9kYXRlID0gZGF0ZSgnaicsIHN0cnRvdGltZSgkY2hlY2t0aW1lKSk7CgkJICAgICAgICAgICAgJGRheV9udW0gPSAiZGF5XyIuJGRheV9vZl9kYXRlOwoJCSAgICAgICAgICAgICRtb250aCA9IGRhdGUoJ20nLCBzdHJ0b3RpbWUoJGNoZWNrdGltZSkpOwoJCSAgICAgICAgICAgICR5ZWFyID0gZGF0ZSgnWScsIHN0cnRvdGltZSgkY2hlY2t0aW1lKSk7CgoJCSAgICAgICAgICAgIGlmKCRhc19pbmZvLT5hc19vdCA9PSAxICYmIGluX2FycmF5KCR1bml0SWQsIFsxLCA0LCA1XSkpewoJICAgICAgICAgICAgICAgICAgIGlmKCFpbl9hcnJheSgkYXNfaW5mby0+YXNfdW5pdF9pZCwgWzEsNCw1XSkpewoJICAgICAgICAgICAgICAgICAgICAgICAgJG1zZ1tdID0gJGFzX2luZm8tPmFzc29jaWF0ZV9pZC4iIC0gIi4kdG9kYXkuIiBUaGlzIGVtcGxveWVlIGFzc2lnbiBvdGhlciB1bml0IjsKCSAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfWVsc2UgaWYoJGFzX2luZm8tPmFzX290ID09IDEgJiYgJGFzX2luZm8tPmFzX3VuaXRfaWQgIT0gJHVuaXRJZCl7CgkgICAgICAgICAgICAgICAgICAgICRtc2dbXSA9ICRhc19pbmZvLT5hc3NvY2lhdGVfaWQuIiAtICIuJHRvZGF5LiIgVGhpcyBlbXBsb3llZSBhc3NpZ24gb3RoZXIgdW5pdCI7CgkgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAvLyBjaGVjayBsb2NrIG1vbnRoCgkgICAgICAgICAgICAgICAgJGNoZWNrTFsnbW9udGgnXSA9ICRtb250aDsKCSAgICAgICAgICAgICAgICAkY2hlY2tMWyd5ZWFyJ10gPSAkeWVhcjsKCSAgICAgICAgICAgICAgICAkY2hlY2tMWyd1bml0X2lkJ10gPSAkYXNfaW5mby0+YXNfdW5pdF9pZDsKCSAgICAgICAgICAgICAgICAkY2hlY2tMb2NrID0gbW9udGhseV9hY3Rpdml0eV9jbG9zZSgkY2hlY2tMKTsKCSAgICAgICAgICAgICAgICBpZigkY2hlY2tMb2NrID09IDEpewoJICAgICAgICAgICAgICAgICAgICAkbXNnW10gPSAkYXNfaW5mby0+YXNzb2NpYXRlX2lkLiIgLSAiLiR0b2RheS4iIE1vbnRoIEFjdGl2aXR5IExvY2siOwoJICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgJHRvZGF5ID0gZGF0ZSgiWS1tLWQiLCBzdHJ0b3RpbWUoJGNoZWNrdGltZSkpOwoKCSAgICAgICAgICAgICAgICAgLy9kZCgkdG9kYXkpO2V4aXQ7CgkgICAgICAgICAgICAgICAgLy8gbGVhdmUgY2hlY2sgaW5kaXZpZHVhbAoJICAgICAgICAgICAgICAgICRnZXRMZWF2ZSA9IERCOjp0YWJsZSgnaHJfbGVhdmUnKQoJICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2xlYXZlX2Fzc19pZCcsICRhc19pbmZvLT5hc3NvY2lhdGVfaWQpCgkgICAgICAgICAgICAgICAgLT53aGVyZSgnbGVhdmVfZnJvbScsICc8PScsICR0b2RheSkKCSAgICAgICAgICAgICAgICAtPndoZXJlKCdsZWF2ZV90bycsICc+PScsICR0b2RheSkKCSAgICAgICAgICAgICAgICAtPndoZXJlKCdsZWF2ZV9zdGF0dXMnLDEpCgkgICAgICAgICAgICAgICAgLT5maXJzdCgpOwoKCSAgICAgICAgICAgICAgICBpZigkZ2V0TGVhdmUgIT0gbnVsbCl7CgkgICAgICAgICAgICAgICAgICAgICRtc2dbXSA9ICRhc19pbmZvLT5hc3NvY2lhdGVfaWQuIiAtICIuJHRvZGF5LiIgTGVhdmUgZm9yIHRoaXMgZW1wbG95ZWUiOwoJICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgJGNoZWNrSG9saWRheUZsYWcgPSAwOwoJICAgICAgICAgICAgICAgIC8vIGNoZWNrIGhvbGlkYXkgaW5kaXZpZHVhbAoJICAgICAgICAgICAgICAgICRnZXRIb2xpZGF5ID0gSG9saWRheVJvYXN0ZXI6OmdldEhvbGlkYXlZZWFyTW9udGhBc0lkRGF0ZVdpc2UoJHllYXIsICRtb250aCwgJGFzX2luZm8tPmFzc29jaWF0ZV9pZCwgJHRvZGF5KTsKCSAgICAgICAgICAgICAgICAgLy9kZCgkZ2V0SG9saWRheSk7ZXhpdDsKCSAgICAgICAgICAgICAgICBpZigkZ2V0SG9saWRheSAhPSBudWxsICYmICRnZXRIb2xpZGF5LT5yZW1hcmtzID09ICdIb2xpZGF5Jyl7CgkgICAgICAgICAgICAgICAgICAgICRjaGVja0hvbGlkYXlGbGFnID0gMTsKCSAgICAgICAgICAgICAgICAgICAgLy8gJG1zZ1tdID0gJGFzX2luZm8tPmFzc29jaWF0ZV9pZC4iIC0gIi4kdG9kYXkuIiBIb2xpZGF5IGZvciByb3N0ZXIgdGhpcyBlbXBsb3llZSI7CgkgICAgICAgICAgICAgICAgICAgIC8vIGNvbnRpbnVlOwoJICAgICAgICAgICAgICAgIH1lbHNlIGlmKCRnZXRIb2xpZGF5ID09IG51bGwpewoJICAgICAgICAgICAgICAgICAgICBpZigkYXNfaW5mby0+c2hpZnRfcm9hc3Rlcl9zdGF0dXMgPT0gMCl7CgkgICAgICAgICAgICAgICAgICAgICAgICAkZ2V0WWVhcmx5SG9saWRheSA9IFllYXJseUhvbHlEYXk6OmdldENoZWNrVW5pdERheVdpc2VIb2xpZGF5KCRhc19pbmZvLT5hc191bml0X2lkLCAkdG9kYXkpOwoJICAgICAgICAgICAgICAgICAgICAgICAgIC8vZGQoJGdldFllYXJseUhvbGlkYXkpO2V4aXQ7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZigkZ2V0WWVhcmx5SG9saWRheSAhPSBudWxsICYmICRnZXRZZWFybHlIb2xpZGF5LT5ocl95aHBfb3Blbl9zdGF0dXMgPT0gMCl7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNoZWNrSG9saWRheUZsYWcgPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICRtc2dbXSA9ICRhc19pbmZvLT5hc3NvY2lhdGVfaWQuIiAtICIuJHRvZGF5LiIgSG9saWRheSBmb3IgdGhpcyBlbXBsb3llZSI7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29udGludWU7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgoJCSAgICAgICAgICAgICRzaGlmdD0gREI6OnRhYmxlKCJocl9zaGlmdF9yb2FzdGVyIikKCQkgICAgICAgICAgICAtPndoZXJlKCdzaGlmdF9yb2FzdGVyX21vbnRoJywgJG1vbnRoKQoJCSAgICAgICAgICAgIC0+d2hlcmUoJ3NoaWZ0X3JvYXN0ZXJfeWVhcicsICR5ZWFyKQoJCSAgICAgICAgICAgIC0+d2hlcmUoInNoaWZ0X3JvYXN0ZXJfdXNlcl9pZCIsICRhc19pbmZvLT5hc19pZCkKCQkgICAgICAgICAgICAtPnNlbGVjdChbCgkJICAgICAgICAgICAgICAgICRkYXlfbnVtLAoJCSAgICAgICAgICAgICAgICAnaHJfc2hpZnQuaHJfc2hpZnRfbmFtZScsCgkJICAgICAgICAgICAgICAgICdocl9zaGlmdC5ocl9zaGlmdF9pZCcsCgkJICAgICAgICAgICAgICAgICdocl9zaGlmdC5ocl9zaGlmdF9zdGFydF90aW1lJywKCQkgICAgICAgICAgICAgICAgJ2hyX3NoaWZ0LmhyX3NoaWZ0X2VuZF90aW1lJywKCQkgICAgICAgICAgICAgICAgJ2hyX3NoaWZ0LmhyX3NoaWZ0X2NvZGUnLAoJCSAgICAgICAgICAgICAgICAnaHJfc2hpZnQuaHJfc2hpZnRfYnJlYWtfdGltZScsCgkJICAgICAgICAgICAgICAgICdocl9zaGlmdC5ocl9zaGlmdF9uaWdodF9mbGFnJywKCQkgICAgICAgICAgICAgICAgJ2hyX3NoaWZ0LmJpbGxfZWxpZ2libGUnCgoJCSAgICAgICAgICAgIF0pCgkJICAgICAgICAgICAgLT5sZWZ0Sm9pbignaHJfc2hpZnQnLCBmdW5jdGlvbigkcSkgdXNlKCRkYXlfbnVtLCAkdW5pdElkKSB7CgkJICAgICAgICAgICAgICAgICRxLT5vbignaHJfc2hpZnQuaHJfc2hpZnRfbmFtZScsICdocl9zaGlmdF9yb2FzdGVyLicuJGRheV9udW0pOwoJCSAgICAgICAgICAgICAgICAkcS0+d2hlcmUoJ2hyX3NoaWZ0LmhyX3NoaWZ0X3VuaXRfaWQnLCAkdW5pdElkKTsKCQkgICAgICAgICAgICB9KQoJCSAgICAgICAgICAgIC0+b3JkZXJCeSgnaHJfc2hpZnQuaHJfc2hpZnRfaWQnLCAnZGVzYycpCgkJICAgICAgICAgICAgLT5maXJzdCgpOwoKCQkgICAgICAgICAgICBpZighZW1wdHkoJHNoaWZ0KSAmJiAkc2hpZnQtPiRkYXlfbnVtICE9IG51bGwpewoJCSAgICAgICAgICAgICAgICAkc2hpZnRfbmFtZT0gJHNoaWZ0LT5ocl9zaGlmdF9uYW1lOwoJCSAgICAgICAgICAgICAgICAkc2hpZnRfY29kZT0gJHNoaWZ0LT5ocl9zaGlmdF9jb2RlOwoJCSAgICAgICAgICAgICAgICAkc2hpZnRfc3RhcnRfdGltZT0gJHNoaWZ0LT5ocl9zaGlmdF9zdGFydF90aW1lOwoJCSAgICAgICAgICAgICAgICAkc2hpZnRfZW5kX3RpbWU9ICRzaGlmdC0+aHJfc2hpZnRfZW5kX3RpbWU7CgkJICAgICAgICAgICAgICAgICRzaGlmdF9icmVha190aW1lPSAkc2hpZnQtPmhyX3NoaWZ0X2JyZWFrX3RpbWU7CgkJICAgICAgICAgICAgICAgICRzaGlmdF9uaWdodF9mbGFnID0gJHNoaWZ0LT5ocl9zaGlmdF9uaWdodF9mbGFnOwoJCSAgICAgICAgICAgICAgICAkYmlsbEVsaWdpYmxlID0gJHNoaWZ0LT5iaWxsX2VsaWdpYmxlOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBlbHNlewoJCSAgICAgICAgICAgICAgICAkc2hpZnRfbmFtZT0gJGFzX2luZm8tPnNoaWZ0Wydocl9zaGlmdF9uYW1lJ107CgkJICAgICAgICAgICAgICAgICRzaGlmdF9jb2RlPSAkYXNfaW5mby0+c2hpZnRbJ2hyX3NoaWZ0X2NvZGUnXTsKCQkgICAgICAgICAgICAgICAgJHNoaWZ0X3N0YXJ0X3RpbWU9ICRhc19pbmZvLT5zaGlmdFsnaHJfc2hpZnRfc3RhcnRfdGltZSddOwoJCSAgICAgICAgICAgICAgICAkc2hpZnRfZW5kX3RpbWU9ICRhc19pbmZvLT5zaGlmdFsnaHJfc2hpZnRfZW5kX3RpbWUnXTsKCQkgICAgICAgICAgICAgICAgJHNoaWZ0X2JyZWFrX3RpbWU9ICRhc19pbmZvLT5zaGlmdFsnaHJfc2hpZnRfYnJlYWtfdGltZSddOwoJCSAgICAgICAgICAgICAgICAkc2hpZnRfbmlnaHRfZmxhZyA9ICRhc19pbmZvLT5zaGlmdFsnaHJfc2hpZnRfbmlnaHRfZmxhZyddOwoJCSAgICAgICAgICAgICAgICAkYmlsbEVsaWdpYmxlID0gJGFzX2luZm8tPnNoaWZ0WydiaWxsX2VsaWdpYmxlJ107CgkJICAgICAgICAgICAgfQoKCQkgICAgICAgICAgICAkc2hpZnRfc3RhcnQgPSAkcHVuY2hfZGF0ZS4iICIuJHNoaWZ0X3N0YXJ0X3RpbWU7CgkJICAgICAgICAgICAgJHNoaWZ0X2VuZCA9ICRwdW5jaF9kYXRlLiIgIi4kc2hpZnRfZW5kX3RpbWU7CgkJICAgICAgICAgICAgJHNoaWZ0X2luX3RpbWUgPSBDYXJib246OmNyZWF0ZUZyb21Gb3JtYXQoJ1ktbS1kIEg6aTpzJywgJHNoaWZ0X3N0YXJ0KTsKCQkgICAgICAgICAgICAkc2hpZnRfb3V0X3RpbWUgPSBDYXJib246OmNyZWF0ZUZyb21Gb3JtYXQoJ1ktbS1kIEg6aTpzJywgJHNoaWZ0X2VuZCk7CgkJICAgICAgICAKCQkgICAgICAgICAgICBpZigkc2hpZnRfb3V0X3RpbWUgPCAkc2hpZnRfaW5fdGltZSl7CgkJICAgICAgICAgICAgICAgICRzaGlmdF9vdXRfdGltZSA9ICRzaGlmdF9vdXRfdGltZS0+Y29weSgpLT5hZGREYXlzKDEpOwoJCSAgICAgICAgICAgIH0KCgkJICAgICAgICAgICAgLy9zaGlmdCBzdGFydCByYW5nZQoJCSAgICAgICAgICAgICRzaGlmdF9zdGFydF9iZWdpbiA9ICRzaGlmdF9pbl90aW1lLT5jb3B5KCktPnN1YkhvdXJzKDIpOyAvLyAyIGhvdXIKCQkgICAgICAgICAgICAkc2hpZnRfc3RhcnRfZW5kID0gJHNoaWZ0X2luX3RpbWUtPmNvcHkoKS0+YWRkSG91cnMoNCk7IC8vNCBob3VyCgkJICAgICAgICAgICAgLy9zaGlmdCBlbmQgcmFnZQoJCSAgICAgICAgICAgICRzaGlmdF9lbmRfYmVnaW4gPSAkc2hpZnRfc3RhcnRfZW5kLT5jb3B5KCktPmFkZFNlY29uZHMoMSk7IC8vIGFmdGVyIDQgaG91cgoJCSAgICAgICAgICAgIC8vICRzaGlmdF9lbmRfZW5kPSAkc2hpZnRfb3V0X3RpbWUrMjg4MDA7IC8vIDggaG91ciBPVCBjYWxjdWxhdGUgaW4gcHJldmlvdXMgc3lzdGVtCgkJICAgICAgICAgICAgLy8gJHNoaWZ0X2VuZF9lbmQ9ICRzaGlmdF9lbmRfYmVnaW4rNjgzOTk7IC8vIDE4IGhvdXIgNTkgbWludXRlIDU5IHNlY29uZAoKCQkgICAgICAgICAgICAkc2hpZnREaWZmID0gc3RydG90aW1lKCRzaGlmdF9vdXRfdGltZSkgLSBzdHJ0b3RpbWUoJHNoaWZ0X2luX3RpbWUpOyAvL3RvdGFsIHNoaWZ0IHRpbWUKCQkgICAgICAgICAgICAkdG90YWxTaGlmdERpZmYgPSAkc2hpZnREaWZmICsgKCRzaGlmdF9icmVha190aW1lKjYwKSArIDc1MDA7IC8vIDc1MDAgPSAyOjA1IGV4dHJhIGFsbG93IHRpbWUgCgkJICAgICAgICAgICAgJG90QWxsb3cgPSA4NjQwMCAtICR0b3RhbFNoaWZ0RGlmZjsgLy84NjQwMCA9IDI0IGhvdXIKCgkJICAgICAgICAgICAgLy8gJG90QWxsb3cgPSA0NjAwMCAtICgkc2hpZnRfYnJlYWtfdGltZSo2MCk7Ly8gMTMtIGhvdXIgMDAgbWludXRlIDAwIHNlY29uZAoJCSAgICAgICAgICAgICRzaGlmdF9lbmRfZW5kID0gJHNoaWZ0X291dF90aW1lLT5jb3B5KCktPmFkZFNlY29uZHMoJG90QWxsb3cpOwoJCSAKCQkgICAgICAgICAgICAvL2NoZWNrIHRpbWUKCQkgICAgICAgICAgICAkY2hlY2tfdGltZSA9IENhcmJvbjo6Y3JlYXRlRnJvbUZvcm1hdCgnWS1tLWQgSDppOnMnLCAkY2hlY2t0aW1lKTsKCQkgICAgICAgICAgICAvL2dldCBleGlzdGluZyBwdW5jaAoJCSAgICAgICAgICAgICRsYXN0X3B1bmNoPSBEQjo6dGFibGUoJHRhYmxlTmFtZSkKCQkgICAgICAgICAgICAtPndoZXJlKCdhc19pZCcsICRhc19pbmZvLT5hc19pZCkKCQkgICAgICAgICAgICAtPndoZXJlKCdpbl9kYXRlJywgJz0nLCAkY2hlY2tfdGltZS0+Zm9ybWF0KCdZLW0tZCcpKQoJCSAgICAgICAgICAgIC0+Zmlyc3QoKTsKCQkgICAgICAgICAgICBpZigkbGFzdF9wdW5jaCl7CgkJICAgICAgICAgICAgICAgIGlmKCgoJHNoaWZ0X3N0YXJ0X2JlZ2luID49ICRsYXN0X3B1bmNoLT5pbl90aW1lIHx8ICRsYXN0X3B1bmNoLT5pbl90aW1lID49ICRzaGlmdF9zdGFydF9lbmQpICAmJiAkbGFzdF9wdW5jaC0+aW5fdGltZSAhPSBudWxsKSB8fCAkbGFzdF9wdW5jaC0+cmVtYXJrcyA9PSAnRFNJJyl7CgkJICAgICAgICAgICAgICAgICAgICBpZigkbGFzdF9wdW5jaC0+b3V0X3RpbWUgIT0gbnVsbCl7ICAgCgkJICAgICAgICAgICAgICAgICAgICAgICAgREI6OnRhYmxlKCR0YWJsZU5hbWUpLT53aGVyZSgnaWQnLCAkbGFzdF9wdW5jaC0+aWQpLT51cGRhdGUoWwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2luX3RpbWUnID0+IG51bGwsICdvdF9ob3VyJyA9PiAwLCAnbGF0ZV9zdGF0dXMnID0+IDBdKTsKCQkgICAgICAgICAgICAgICAgICAgIH1lbHNlewoJCSAgICAgICAgICAgICAgICAgICAgICAgIERCOjp0YWJsZSgkdGFibGVOYW1lKS0+d2hlcmUoJ2lkJywgJGxhc3RfcHVuY2gtPmlkKS0+ZGVsZXRlKCk7CgkJICAgICAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgICAgICAgICAkbGFzdF9wdW5jaCA9IERCOjp0YWJsZSgkdGFibGVOYW1lKS0+d2hlcmUoJ2lkJywgJGxhc3RfcHVuY2gtPmlkKS0+Zmlyc3QoKTsKCgoJCSAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgICAgIGlmKCgkc2hpZnRfZW5kX2JlZ2luID49ICRsYXN0X3B1bmNoLT5vdXRfdGltZSB8fCAkbGFzdF9wdW5jaC0+b3V0X3RpbWUgPj0gJHNoaWZ0X2VuZF9lbmQgKSAmJiAkbGFzdF9wdW5jaC0+b3V0X3RpbWUgIT0gbnVsbCl7CgkJICAgICAgICAgICAgICAgICAgICBpZigkbGFzdF9wdW5jaC0+aW5fdGltZSAhPSBudWxsKXsgCgkJICAgICAgICAgICAgICAgICAgICAgICAgREI6OnRhYmxlKCR0YWJsZU5hbWUpLT53aGVyZSgnaWQnLCAkbGFzdF9wdW5jaC0+aWQpLT51cGRhdGUoWwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAnb3V0X3RpbWUnID0+IG51bGwsICdvdF9ob3VyJyA9PiAwXSk7CgkJICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKCQkgICAgICAgICAgICAgICAgICAgICAgICBEQjo6dGFibGUoJHRhYmxlTmFtZSktPndoZXJlKCdpZCcsICRsYXN0X3B1bmNoLT5pZCktPmRlbGV0ZSgpOwoJCSAgICAgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICAgICAgJGxhc3RfcHVuY2ggPSBEQjo6dGFibGUoJHRhYmxlTmFtZSktPndoZXJlKCdpZCcsICRsYXN0X3B1bmNoLT5pZCktPmZpcnN0KCk7CgoJCSAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGlmKCRzaGlmdF9zdGFydF9iZWdpbiA8PSAkY2hlY2tfdGltZSAmJiAkY2hlY2tfdGltZSA8PSAkc2hpZnRfc3RhcnRfZW5kICAmJiAkY2hlY2tIb2xpZGF5RmxhZyA9PSAwKXsKCQkgICAgICAgICAgICAgICAgLy8gJGNoZWNrSW5UaW1lRmxhZyA9IDA7CgkJICAgICAgICAgICAgICAgIGlmKGVtcHR5KCRsYXN0X3B1bmNoKSl7CgkJICAgICAgICAgICAgICAgICAgICAkcHVuY2hJZCA9IERCOjp0YWJsZSgkdGFibGVOYW1lKQoJCSAgICAgICAgICAgICAgICAgICAgLT5pbnNlcnRHZXRJZChbCgkJICAgICAgICAgICAgICAgICAgICAgICAgJ2FzX2lkJyA9PiAkYXNfaW5mby0+YXNfaWQsCgkJICAgICAgICAgICAgICAgICAgICAgICAgJ2luX2RhdGUnID0+IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRjaGVja3RpbWUpKSwKCQkgICAgICAgICAgICAgICAgICAgICAgICAnaW5fdGltZScgPT4gJGNoZWNrdGltZSwKCQkgICAgICAgICAgICAgICAgICAgICAgICAnaHJfc2hpZnRfY29kZScgPT4gJHNoaWZ0X2NvZGUsCgkJICAgICAgICAgICAgICAgICAgICAgICAgJ2luX3VuaXQnID0+ICR1bml0LAoJCSAgICAgICAgICAgICAgICAgICAgICAgICdyZW1hcmtzJyA9PiAnJwoJCSAgICAgICAgICAgICAgICAgICAgXSk7CgoJCSAgICAgICAgICAgICAgICAgICAgLy8gJGNoZWNrSW5UaW1lRmxhZyA9IDE7CgoJCSAgICAgICAgICAgICAgICB9ZWxzZXsKCQkgICAgICAgICAgICAgICAgICAgICRsYXN0SW5UaW1lID0gJGxhc3RfcHVuY2gtPmluX3RpbWU7CgkJICAgICAgICAgICAgICAgICAgICAkbmV3SW5UaW1lID0gJGNoZWNrdGltZTsKCQkgICAgICAgICAgICAgICAgICAgIGlmKCRuZXdJblRpbWUgPD0gJGxhc3RJblRpbWUgfHwgJGxhc3RfcHVuY2gtPnJlbWFya3MgPT0gJ0RTSScgfHwgJGxhc3RfcHVuY2gtPmluX3RpbWUgPT0gbnVsbCl7CgkJICAgICAgICAgICAgICAgICAgICAgICAgJHB1bmNoSWQgPSAkbGFzdF9wdW5jaC0+aWQ7CgkJICAgICAgICAgICAgICAgICAgICAgICAgREI6OnRhYmxlKCR0YWJsZU5hbWUpCgkJICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnaWQnLCAkbGFzdF9wdW5jaC0+aWQpCgkJICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnYXNfaWQnLCAkYXNfaW5mby0+YXNfaWQpCgkJICAgICAgICAgICAgICAgICAgICAgICAgLT51cGRhdGUoWwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaW5fdGltZScgPT4gJG5ld0luVGltZSwKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2luX3VuaXQnID0+ICR1bml0LAoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaHJfc2hpZnRfY29kZScgPT4gJHNoaWZ0X2NvZGUsCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZW1hcmtzJyA9PiAnJwoJCSAgICAgICAgICAgICAgICAgICAgICAgIF0pOwoJCSAgICAgICAgICAgICAgICAgICAgICAgIAoJCSAgICAgICAgICAgICAgICAgICAgICAgIC8vICRjaGVja0luVGltZUZsYWcgPSAyOwoJCSAgICAgICAgICAgICAgICAgICAgfQoKCQkgICAgICAgICAgICAgICAgfQoKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgZWxzZSBpZigoJHNoaWZ0X2VuZF9iZWdpbiA8PSAkY2hlY2tfdGltZSkgJiYgKCRjaGVja190aW1lIDw9ICRzaGlmdF9lbmRfZW5kKSAgJiYgJGNoZWNrSG9saWRheUZsYWcgPT0gMCl7CgkJICAgICAgICAgICAgICAgIGlmKCFlbXB0eSgkbGFzdF9wdW5jaCkpewoJCSAgICAgICAgICAgICAgICAgICAgJHB1bmNoSWQgPSAkbGFzdF9wdW5jaC0+aWQ7CgkJICAgICAgICAgICAgICAgICAgICAvLyAkY2hlY2tPdXRUaW1lRmxhZyA9IDA7CgkJICAgICAgICAgICAgICAgICAgICBpZigkbGFzdF9wdW5jaC0+b3V0X3RpbWUgPT0gbnVsbCl7CgkJICAgICAgICAgICAgICAgICAgICAgICAgREI6OnRhYmxlKCR0YWJsZU5hbWUpCgkJICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnaWQnLCAkbGFzdF9wdW5jaC0+aWQpCgkJICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnYXNfaWQnLCAkYXNfaW5mby0+YXNfaWQpCgkJICAgICAgICAgICAgICAgICAgICAgICAgLT51cGRhdGUoWwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAnb3V0X3RpbWUnID0+ICRjaGVja3RpbWUsCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICdvdXRfdW5pdCcgPT4gJHVuaXQKCQkgICAgICAgICAgICAgICAgICAgICAgICBdKTsKCgoKCQkgICAgICAgICAgICAgICAgICAgICAgICAvLyAkY2hlY2tPdXRUaW1lRmxhZyA9IDE7CgkJICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKCQkgICAgICAgICAgICAgICAgICAgICAgICAkbGFzdE91dFRpbWUgPSAkbGFzdF9wdW5jaC0+b3V0X3RpbWU7CgkJICAgICAgICAgICAgICAgICAgICAgICAgJG5ld091dFRpbWUgPSAkY2hlY2t0aW1lOwoJCSAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRuZXdPdXRUaW1lID49ICRsYXN0T3V0VGltZSApewoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBEQjo6dGFibGUoJHRhYmxlTmFtZSkKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnaWQnLCAkbGFzdF9wdW5jaC0+aWQpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2FzX2lkJywgJGFzX2luZm8tPmFzX2lkKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnVwZGF0ZShbCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnb3V0X3RpbWUnID0+ICRuZXdPdXRUaW1lLAoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ291dF91bml0JyA9PiAkdW5pdAoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKTsKCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICRjaGVja091dFRpbWVGbGFnID0gMTsKCQkgICAgICAgICAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgICAgICAgICB9CgoJCSAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgICAgIGVsc2V7CgkJICAgICAgICAgICAgICAgICAgICAkcHVuY2hJZCA9IERCOjp0YWJsZSgkdGFibGVOYW1lKQoJCSAgICAgICAgICAgICAgICAgICAgLT5pbnNlcnRHZXRJZChbCgkJICAgICAgICAgICAgICAgICAgICAgICAgJ2FzX2lkJyA9PiAkYXNfaW5mby0+YXNfaWQsCgkJICAgICAgICAgICAgICAgICAgICAgICAgJ2luX2RhdGUnID0+IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRzaGlmdF9zdGFydCkpLAoJCSAgICAgICAgICAgICAgICAgICAgICAgICdpbl90aW1lJyA9PiBkYXRlKCdZLW0tZCBIOmk6cycsIHN0cnRvdGltZSgnKzQgbWludXRlcycsIHN0cnRvdGltZSgkc2hpZnRfc3RhcnQpKSksCgkJICAgICAgICAgICAgICAgICAgICAgICAgJ291dF90aW1lJyA9PiAkY2hlY2t0aW1lLAoJCSAgICAgICAgICAgICAgICAgICAgICAgICdocl9zaGlmdF9jb2RlJyA9PiAkc2hpZnRfY29kZSwKCQkgICAgICAgICAgICAgICAgICAgICAgICAncmVtYXJrcycgICAgICAgPT4gIkRTSSIsCgkJICAgICAgICAgICAgICAgICAgICAgICAgJ2luX3VuaXQnID0+ICR1bml0LAoJCSAgICAgICAgICAgICAgICAgICAgICAgICdvdXRfdW5pdCcgPT4gJHVuaXQKCQkgICAgICAgICAgICAgICAgICAgIF0pOwoJCSAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGVsc2V7CgkJICAgICAgICAgICAgICAgICRzaGlmdF9jb2RlX25ldz1udWxsOwoJCSAgICAgICAgICAgICAgICBpZigkZGF5X29mX2RhdGUgPT0gMSl7CgkJICAgICAgICAgICAgICAgICAgICAkZGF5X29mX2RhdGUgPSAkY2hlY2tfdGltZS0+Y29weSgpLT5zdWJEYXlzKDEpOwoJCSAgICAgICAgICAgICAgICAgICAgJGRheV9vZl9kYXRlPSAkZGF5X29mX2RhdGUtPmZvcm1hdCgnaicpOwoJCSAgICAgICAgICAgICAgICAgICAgaWYoJG1vbnRoID09MSl7CgkJICAgICAgICAgICAgICAgICAgICAgICAgJG1vbnRoPTEyOwoJCSAgICAgICAgICAgICAgICAgICAgICAgICR5ZWFyPSAkeWVhci0xOwoJCSAgICAgICAgICAgICAgICAgICAgfWVsc2V7CgkJICAgICAgICAgICAgICAgICAgICAgICAgJG1vbnRoPSAkbW9udGgtMTsKCQkgICAgICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgICAgICRkYXlfbnVtPSAiZGF5XyIuKCRkYXlfb2ZfZGF0ZSk7CgkJICAgICAgICAgICAgICAgIH1lbHNlewoJCSAgICAgICAgICAgICAgICAgICAgJGRheV9udW09ICJkYXlfIi4oJGRheV9vZl9kYXRlLTEpOwoJCSAgICAgICAgICAgICAgICB9CgoJCSAgICAgICAgICAgICAgICAvLyBjaGVjayBsb2NrIG1vbnRoCgkJICAgICAgICAgICAgICAgICRjaGVja0xQWydtb250aCddID0gJG1vbnRoOwoJCSAgICAgICAgICAgICAgICAkY2hlY2tMUFsneWVhciddID0gJHllYXI7CgkJICAgICAgICAgICAgICAgICRjaGVja0xQWyd1bml0X2lkJ10gPSAkYXNfaW5mby0+YXNfdW5pdF9pZDsKCQkgICAgICAgICAgICAgICAgJGNoZWNrTG9ja1AgPSBtb250aGx5X2FjdGl2aXR5X2Nsb3NlKCRjaGVja0xQKTsKCQkgICAgICAgICAgICAgICAgaWYoJGNoZWNrTG9ja1AgPT0gMSl7CgkJICAgICAgICAgICAgICAgICAgICAkbXNnW10gPSAkYXNfaW5mby0+YXNzb2NpYXRlX2lkLiIgLSAiLiR0b2RheS4iIE1vbnRoIEFjdGl2aXR5IExvY2siOwoJICAgICAgICAgICAgICAgICAgICAJY29udGludWU7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgICAgIAoJCSAgICAgICAgICAgICAgICAvLyByZXR1cm4gJGRheV9udW07CgkJICAgICAgICAgICAgICAgICRzaGlmdD0gREI6OnRhYmxlKCJocl9zaGlmdF9yb2FzdGVyIikKCQkgICAgICAgICAgICAgICAgLT53aGVyZSgnc2hpZnRfcm9hc3Rlcl9tb250aCcsICRtb250aCkKCQkgICAgICAgICAgICAgICAgLT53aGVyZSgnc2hpZnRfcm9hc3Rlcl95ZWFyJywgJHllYXIpCgkJICAgICAgICAgICAgICAgIC0+d2hlcmUoInNoaWZ0X3JvYXN0ZXJfdXNlcl9pZCIsICRhc19pbmZvLT5hc19pZCkKCQkgICAgICAgICAgICAgICAgLT5vcmRlckJ5KCdzaGlmdF9yb2FzdGVyX2lkJywgIkRFU0MiKQoJCSAgICAgICAgICAgICAgICAtPnNlbGVjdChbCgkJICAgICAgICAgICAgICAgICAgICAkZGF5X251bSwKCQkgICAgICAgICAgICAgICAgICAgICdocl9zaGlmdC5ocl9zaGlmdF9zdGFydF90aW1lJywKCQkgICAgICAgICAgICAgICAgICAgICdocl9zaGlmdC5ocl9zaGlmdF9lbmRfdGltZScsCgkJICAgICAgICAgICAgICAgICAgICAnaHJfc2hpZnQuaHJfc2hpZnRfbmFtZScsCgkJICAgICAgICAgICAgICAgICAgICAnaHJfc2hpZnQuaHJfc2hpZnRfY29kZScsCgkJICAgICAgICAgICAgICAgICAgICAnaHJfc2hpZnQuaHJfc2hpZnRfbmlnaHRfZmxhZycsCgkJICAgICAgICAgICAgICAgICAgICAnaHJfc2hpZnQuaHJfc2hpZnRfYnJlYWtfdGltZScsCgkJICAgICAgICAgICAgICAgICAgICAnaHJfc2hpZnQuYmlsbF9lbGlnaWJsZScKCQkgICAgICAgICAgICAgICAgXSkKCQkgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbignaHJfc2hpZnQnLCBmdW5jdGlvbigkcSkgdXNlKCRkYXlfbnVtLCAkdW5pdElkKSB7CgkJICAgICAgICAgICAgICAgICAgICAkcS0+b24oJ2hyX3NoaWZ0LmhyX3NoaWZ0X25hbWUnLCAnaHJfc2hpZnRfcm9hc3Rlci4nLiRkYXlfbnVtKTsKCQkgICAgICAgICAgICAgICAgICAgICRxLT53aGVyZSgnaHJfc2hpZnQuaHJfc2hpZnRfdW5pdF9pZCcsICR1bml0SWQpOwoJCSAgICAgICAgICAgICAgICB9KQoJCSAgICAgICAgICAgICAgICAtPm9yZGVyQnkoJ2hyX3NoaWZ0LmhyX3NoaWZ0X2lkJywgJ2Rlc2MnKQoJCSAgICAgICAgICAgICAgICAtPmZpcnN0KCk7CgoJCSAgICAgICAgICAgICAgICBpZighZW1wdHkoJHNoaWZ0KSAmJiAkc2hpZnQtPiRkYXlfbnVtICE9IG51bGwpewoJCSAgICAgICAgICAgICAgICAgICAgJHNoaWZ0X25hbWU9ICRzaGlmdC0+aHJfc2hpZnRfbmFtZTsKCQkgICAgICAgICAgICAgICAgICAgICRzaGlmdF9jb2RlX25ldz0gJHNoaWZ0LT5ocl9zaGlmdF9jb2RlOwoJCSAgICAgICAgICAgICAgICAgICAgJHNoaWZ0X3N0YXJ0X3RpbWU9ICRzaGlmdC0+aHJfc2hpZnRfc3RhcnRfdGltZTsKCQkgICAgICAgICAgICAgICAgICAgICRzaGlmdF9lbmRfdGltZT0gJHNoaWZ0LT5ocl9zaGlmdF9lbmRfdGltZTsKCQkgICAgICAgICAgICAgICAgICAgICRzaGlmdF9uaWdodF9mbGFnPSAkc2hpZnQtPmhyX3NoaWZ0X25pZ2h0X2ZsYWc7CgkJICAgICAgICAgICAgICAgICAgICAkc2hpZnRfYnJlYWtfdGltZSA9ICRzaGlmdC0+aHJfc2hpZnRfYnJlYWtfdGltZTsKCQkgICAgICAgICAgICAgICAgICAgICRiaWxsRWxpZ2libGUgPSAkc2hpZnQtPmJpbGxfZWxpZ2libGU7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgZWxzZXsKCQkgICAgICAgICAgICAgICAgICAgICRkZWZhdWx0c2hpZnQgPSAkYXNfaW5mby0+c2hpZnQ7CgkJICAgICAgICAgICAgICAgICAgICAkc2hpZnRfbmFtZT0gJGRlZmF1bHRzaGlmdFsnaHJfc2hpZnRfbmFtZSddOwoJCSAgICAgICAgICAgICAgICAgICAgJHNoaWZ0X2NvZGVfbmV3PSAkZGVmYXVsdHNoaWZ0Wydocl9zaGlmdF9jb2RlJ107CgkJICAgICAgICAgICAgICAgICAgICAkc2hpZnRfc3RhcnRfdGltZT0gJGRlZmF1bHRzaGlmdFsnaHJfc2hpZnRfc3RhcnRfdGltZSddOwoJCSAgICAgICAgICAgICAgICAgICAgJHNoaWZ0X2VuZF90aW1lPSAkZGVmYXVsdHNoaWZ0Wydocl9zaGlmdF9lbmRfdGltZSddOwoJCSAgICAgICAgICAgICAgICAgICAgJHNoaWZ0X25pZ2h0X2ZsYWc9ICRkZWZhdWx0c2hpZnRbJ2hyX3NoaWZ0X25pZ2h0X2ZsYWcnXTsKCQkgICAgICAgICAgICAgICAgICAgICRzaGlmdF9icmVha190aW1lID0gJGRlZmF1bHRzaGlmdFsnaHJfc2hpZnRfYnJlYWtfdGltZSddOwoJCSAgICAgICAgICAgICAgICAgICAgJGJpbGxFbGlnaWJsZSA9ICRkZWZhdWx0c2hpZnRbJ2JpbGxfZWxpZ2libGUnXTsKCQkgICAgICAgICAgICAgICAgfQoKCQkgICAgICAgICAgICAgICAgCgkJICAgICAgICAgICAgICAgICRsYXN0X3B1bmNoPSBEQjo6dGFibGUoJHRhYmxlTmFtZSkKCQkgICAgICAgICAgICAgICAgLT53aGVyZSgnYXNfaWQnLCAkYXNfaW5mby0+YXNfaWQpCgkJICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2luX2RhdGUnLCAkY2hlY2tfdGltZS0+Y29weSgpLT5zdWJEYXlzKDEpLT5mb3JtYXQoJ1ktbS1kJykpCgkJICAgICAgICAgICAgICAgIC0+b3JkZXJCeSgnaWQnLCAiREVTQyIpCgkJICAgICAgICAgICAgICAgIC0+Zmlyc3QoKTsKCQkgICAgICAgICAgICAgICAgLy8gcmV0dXJuICRjaGVja190aW1lLT5jb3B5KCktPnN1YkRheXMoMSktPmZvcm1hdCgnWS1tLWQnKTsKCQkgICAgICAgICAgICAgICAgJG91dFB1bmNoRGF0ZSA9ICRwdW5jaF9kYXRlOwoJCSAgICAgICAgICAgICAgICBpZigkbGFzdF9wdW5jaCAhPSBudWxsKXsKCQkgICAgICAgICAgICAgICAgICAgICRwdW5jaF9kYXRlID0gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJGxhc3RfcHVuY2gtPmluX2RhdGUpKTsKCQkgICAgICAgICAgICAgICAgfWVsc2V7CgkJICAgICAgICAgICAgICAgICAgICBpZigkc2hpZnRfbmlnaHRfZmxhZyA9PSAxKXsKCQkgICAgICAgICAgICAgICAgICAgICAgICAkcHVuY2hfZGF0ZSA9ICRjaGVja190aW1lLT5jb3B5KCktPnN1YkRheXMoMSktPmZvcm1hdCgnWS1tLWQnKTsKCQkgICAgICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgfQoKCQkgICAgICAgICAgICAgICAgJHNoaWZ0X3N0YXJ0ID0gJHB1bmNoX2RhdGUuIiAiLiRzaGlmdF9zdGFydF90aW1lOwoJCSAgICAgICAgICAgICAgICAkc2hpZnRfZW5kID0gJHB1bmNoX2RhdGUuIiAiLiRzaGlmdF9lbmRfdGltZTsKCgkJICAgICAgICAgICAgICAgICRzaGlmdF9pbl90aW1lX25ldyA9IENhcmJvbjo6Y3JlYXRlRnJvbUZvcm1hdCgnWS1tLWQgSDppOnMnLCAkc2hpZnRfc3RhcnQpOwoKCQkgICAgICAgICAgICAgICAgJHNoaWZ0X291dF90aW1lX25ldyA9IENhcmJvbjo6Y3JlYXRlRnJvbUZvcm1hdCgnWS1tLWQgSDppOnMnLCAkc2hpZnRfZW5kKTsKCQkgICAgICAgICAgICAgICAgLy8gcmV0dXJuICRzaGlmdF9pbl90aW1lX25ldy4nICcuJHNoaWZ0X291dF90aW1lX25ldzsKCQkgICAgICAgICAgICAKCQkgICAgICAgICAgICAgICAgaWYoJHNoaWZ0X291dF90aW1lX25ldyA8ICRzaGlmdF9pbl90aW1lX25ldyl7CgkJICAgICAgICAgICAgICAgICAgICAkc2hpZnRfb3V0X3RpbWVfbmV3ID0gJHNoaWZ0X291dF90aW1lX25ldy0+Y29weSgpLT5hZGREYXlzKDEpOwoJCSAgICAgICAgICAgICAgICB9CgoJCSAgICAgICAgICAgICAgICAvL3NoaWZ0IHN0YXJ0IHJhbmdlCgkJICAgICAgICAgICAgICAgICRzaGlmdF9zdGFydF9iZWdpbl9uZXcgPSAkc2hpZnRfaW5fdGltZV9uZXctPmNvcHkoKS0+c3ViSG91cnMoMik7IC8vIDIgaG91cgoJCSAgICAgICAgICAgICAgICAkc2hpZnRfc3RhcnRfZW5kX25ldyA9ICRzaGlmdF9pbl90aW1lX25ldy0+Y29weSgpLT5hZGRIb3Vycyg0KTsgLy80IGhvdXIKCQkgICAgICAgICAgICAgICAgLy9zaGlmdCBlbmQgcmFnZQoJCSAgICAgICAgICAgICAgICAkc2hpZnRfZW5kX2JlZ2luX25ldyA9ICRzaGlmdF9zdGFydF9lbmRfbmV3LT5jb3B5KCktPmFkZFNlY29uZHMoMSk7IC8vIGFmdGVyIDQgaG91cgoJCSAgICAgICAgICAgICAgICAvLyAkc2hpZnRfZW5kX2VuZD0gJHNoaWZ0X291dF90aW1lX25ldysyODgwMDsgLy8gOCBob3VyIE9UIGNhbGN1bGF0ZSBpbiBwcmV2aW91cyBzeXN0ZW0KCQkgICAgICAgICAgICAgICAgLy8gJHNoaWZ0X2VuZF9lbmQ9ICRzaGlmdF9lbmRfYmVnaW4rNjgzOTk7IC8vIDE4IGhvdXIgNTkgbWludXRlIDU5IHNlY29uZAoJCSAgICAgICAgICAgICAgICAkc2hpZnREaWZmTmV3ID0gc3RydG90aW1lKCRzaGlmdF9vdXRfdGltZV9uZXcpIC0gc3RydG90aW1lKCRzaGlmdF9pbl90aW1lX25ldyk7IC8vdG90YWwgc2hpZnQgdGltZQoJCSAgICAgICAgICAgICAgICAkdG90YWxTaGlmdERpZmZOZXcgPSAkc2hpZnREaWZmTmV3ICsgKCRzaGlmdF9icmVha190aW1lKjYwKSArIDc1MDA7IC8vIDc1MDAgPSAyOjA1IGV4dHJhIGFsbG93IHRpbWUgCgkJICAgICAgICAgICAgICAgICRvdEFsbG93ID0gODY0MDAgLSAkdG90YWxTaGlmdERpZmZOZXc7IC8vODY0MDAgPSAyNCBob3VyCgkJICAgICAgICAgICAgICAgIC8vICRvdEFsbG93ID0gNDYwMDAgLSAoJHNoaWZ0X2JyZWFrX3RpbWUqNjApOy8vIDEzLSBob3VyIDAwIG1pbnV0ZSAwMCBzZWNvbmQKCQkgICAgICAgICAgICAgICAgJHNoaWZ0X2VuZF9lbmRfbmV3ID0gJHNoaWZ0X291dF90aW1lX25ldy0+Y29weSgpLT5hZGRTZWNvbmRzKCRvdEFsbG93KTsKCQkgICAgICAgICAgICAgICAgaWYoJGNoZWNrSG9saWRheUZsYWcgPT0gMSl7CgkJICAgICAgICAgICAgICAgIAkkc2hpZnRfZW5kX2VuZF9uZXcgPSAkc2hpZnRfZW5kX2VuZF9uZXctPmNvcHkoKS0+YWRkSG91cnMoNik7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgCgkJICAgICAgICAgICAgICAgIC8vY2hlY2sgdGltZQoJCSAgICAgICAgICAgICAgICAkY2hlY2tfdGltZSA9IENhcmJvbjo6Y3JlYXRlRnJvbUZvcm1hdCgnWS1tLWQgSDppOnMnLCAkY2hlY2t0aW1lKTsKCgkJICAgICAgICAgICAgICAgIGlmKCRsYXN0X3B1bmNoKXsKCQkgICAgICAgICAgICAgICAgICAgIGlmKCgoJHNoaWZ0X3N0YXJ0X2JlZ2luX25ldyA+PSAkbGFzdF9wdW5jaC0+aW5fdGltZSB8fCAkbGFzdF9wdW5jaC0+aW5fdGltZSA+PSAkc2hpZnRfc3RhcnRfZW5kX25ldykgICYmICRsYXN0X3B1bmNoLT5pbl90aW1lICE9IG51bGwpIHx8ICRsYXN0X3B1bmNoLT5yZW1hcmtzID09ICdEU0knKXsKCQkgICAgICAgICAgICAgICAgICAgICAgICBpZigkbGFzdF9wdW5jaC0+b3V0X3RpbWUgIT0gbnVsbCl7IAoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBEQjo6dGFibGUoJHRhYmxlTmFtZSktPndoZXJlKCdpZCcsICRsYXN0X3B1bmNoLT5pZCktPnVwZGF0ZShbCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaW5fdGltZScgPT4gbnVsbCwgJ290X2hvdXInID0+IDAsICdsYXRlX3N0YXR1cycgPT4gMF0pOwoJCSAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBEQjo6dGFibGUoJHRhYmxlTmFtZSktPndoZXJlKCdpZCcsICRsYXN0X3B1bmNoLT5pZCktPmRlbGV0ZSgpOwoJCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCgkJICAgICAgICAgICAgICAgICAgICAgICAgJGxhc3RfcHVuY2ggPSBEQjo6dGFibGUoJHRhYmxlTmFtZSktPndoZXJlKCdpZCcsICRsYXN0X3B1bmNoLT5pZCktPmZpcnN0KCk7CgoKCQkgICAgICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgICAgIGlmKCgkc2hpZnRfZW5kX2JlZ2luX25ldyA+PSAkbGFzdF9wdW5jaC0+b3V0X3RpbWUgfHwgJGxhc3RfcHVuY2gtPm91dF90aW1lID49ICRzaGlmdF9lbmRfZW5kX25ldyApICYmICRsYXN0X3B1bmNoLT5vdXRfdGltZSAhPSBudWxsKXsKCQkgICAgICAgICAgICAgICAgICAgICAgICBpZigkbGFzdF9wdW5jaC0+aW5fdGltZSAhPSBudWxsKXsgCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIERCOjp0YWJsZSgkdGFibGVOYW1lKS0+d2hlcmUoJ2lkJywgJGxhc3RfcHVuY2gtPmlkKS0+dXBkYXRlKFsKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdvdXRfdGltZScgPT4gbnVsbCwgJ290X2hvdXInID0+IDBdKTsKCQkgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgREI6OnRhYmxlKCR0YWJsZU5hbWUpLT53aGVyZSgnaWQnLCAkbGFzdF9wdW5jaC0+aWQpLT5kZWxldGUoKTsKCQkgICAgICAgICAgICAgICAgICAgICAgICB9CgoJCSAgICAgICAgICAgICAgICAgICAgICAgICRsYXN0X3B1bmNoID0gREI6OnRhYmxlKCR0YWJsZU5hbWUpLT53aGVyZSgnaWQnLCAkbGFzdF9wdW5jaC0+aWQpLT5maXJzdCgpOwoKCQkgICAgICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICBpZigkc2hpZnRfZW5kX2JlZ2luX25ldyA8PSAkY2hlY2tfdGltZSAmJiAkY2hlY2tfdGltZSA8PSAkc2hpZnRfZW5kX2VuZF9uZXcpewoJCSAgICAgICAgICAgICAgICAgICAgaWYoIWVtcHR5KCRsYXN0X3B1bmNoKSl7CgkJICAgICAgICAgICAgICAgICAgICAgICAgJHB1bmNoSWQgPSAkbGFzdF9wdW5jaC0+aWQ7CgkJICAgICAgICAgICAgICAgICAgICAgICAgLy8gJGNoZWNrT3V0VGltZUZsYWcgPSAwOwoJCSAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRsYXN0X3B1bmNoLT5vdXRfdGltZSA9PSBudWxsKXsKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGhpID0gREI6OnRhYmxlKCR0YWJsZU5hbWUpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2lkJywgJGxhc3RfcHVuY2gtPmlkKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnVwZGF0ZShbCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnb3V0X3RpbWUnID0+ICRjaGVja3RpbWUsCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnb3V0X3VuaXQnID0+ICR1bml0CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pOwoKCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICRjaGVja091dFRpbWVGbGFnID0gMTsKCQkgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxhc3RPdXRUaW1lID0gJGxhc3RfcHVuY2gtPm91dF90aW1lOwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbmV3T3V0VGltZSA9ICRjaGVja3RpbWU7CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRuZXdPdXRUaW1lID49ICRsYXN0T3V0VGltZSl7CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEQjo6dGFibGUoJHRhYmxlTmFtZSkKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2lkJywgJGxhc3RfcHVuY2gtPmlkKQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnYXNfaWQnLCAkYXNfaW5mby0+YXNfaWQpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnVwZGF0ZShbCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ291dF90aW1lJyA9PiAkbmV3T3V0VGltZSwKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnb3V0X3VuaXQnID0+ICR1bml0CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKTsKCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAkY2hlY2tPdXRUaW1lRmxhZyA9IDE7CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKCQkgICAgICAgICAgICAgICAgICAgICAgICBpZighZW1wdHkoJHNoaWZ0X2NvZGVfbmV3KSAmJiAkY2hlY2tIb2xpZGF5RmxhZyA9PSAwICYmICRjaGVja0xlYXZlRmxhZyA9PSAwKXsKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRlZmF1bHRJblRpbWUgPSBkYXRlKCdZLW0tZCBIOmk6cycsIHN0cnRvdGltZSgnKzQgbWludXRlcycsIHN0cnRvdGltZSgkc2hpZnRfc3RhcnQpKSk7CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwdW5jaElkID0gREI6OnRhYmxlKCR0YWJsZU5hbWUpCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+aW5zZXJ0R2V0SWQoWwoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FzX2lkJyA9PiAkYXNfaW5mby0+YXNfaWQsCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaW5fZGF0ZScgPT4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJGRlZmF1bHRJblRpbWUpKSwKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpbl90aW1lJyA9PiAkZGVmYXVsdEluVGltZSwKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdvdXRfdGltZScgICAgICA9PiAkY2hlY2t0aW1lLAoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2hyX3NoaWZ0X2NvZGUnID0+ICRzaGlmdF9jb2RlX25ldywKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZW1hcmtzJyAgICAgICA9PiAiRFNJIiwKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpbl91bml0JyA9PiAkdW5pdCwKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdvdXRfdW5pdCcgPT4gJHVuaXQKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7CgkJICAgICAgICAgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICB9ZWxzZWlmKCFlbXB0eSgkbGFzdF9wdW5jaCkgJiYgJGNoZWNrX3RpbWUgPD0gJHNoaWZ0X2VuZF9lbmRfbmV3ICYmICgkY2hlY2tIb2xpZGF5RmxhZyA9PSAxIHx8ICRjaGVja0xlYXZlRmxhZyA9PSAxKSl7CgkJICAgICAgICAgICAgICAgIAkkcHVuY2hJZCA9ICRsYXN0X3B1bmNoLT5pZDsKCQkgICAgICAgICAgICAgICAgICAgIERCOjp0YWJsZSgkdGFibGVOYW1lKQoJCSAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnaWQnLCAkbGFzdF9wdW5jaC0+aWQpCgkJICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdhc19pZCcsICRhc19pbmZvLT5hc19pZCkKCQkgICAgICAgICAgICAgICAgICAgIC0+dXBkYXRlKFsKCQkgICAgICAgICAgICAgICAgICAgICAgICAnb3V0X3RpbWUnID0+ICRjaGVja3RpbWUsCgkJICAgICAgICAgICAgICAgICAgICAgICAgJ291dF91bml0JyA9PiAkdW5pdAoJCSAgICAgICAgICAgICAgICAgICAgXSk7CgkJICAgICAgICAgICAgICAgIH0KCgkJICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIC8vIGdldCBkYXRhCgkJICAgIAkkZ2V0QXR0ID0gREI6OnRhYmxlKCR0YWJsZU5hbWUpCgkJICAgIAktPnNlbGVjdCgnaWQnLCdhc19pZCcsICdpbl90aW1lJywgJ291dF90aW1lJywgJ290X2hvdXInLCAnaHJfc2hpZnRfY29kZScpCgkJICAgIAktPndoZXJlKCdhc19pZCcsICRhc0lkKQoJCSAgICAJLT53aGVyZSgnaW5fZGF0ZScsICRyZWNvcmREYXRlKQoJCSAgICAJLT5maXJzdCgpOwoKCSAgICAgICAgICAgICRvdEhvdXIgPSAwOwoJICAgICAgICAgICAgaWYoJGdldEF0dCAhPSBudWxsKXsKCSAgICAgICAgICAgIAkkZ2V0U2hpZnQgPSBTaGlmdDo6d2hlcmUoJ2hyX3NoaWZ0X2NvZGUnLCAkZ2V0QXR0LT5ocl9zaGlmdF9jb2RlKS0+d2hlcmUoJ2hyX3NoaWZ0X3VuaXRfaWQnLCAkYXNfaW5mby0+YXNfdW5pdF9pZCktPmZpcnN0KCk7CgkgICAgICAgICAgICAJCgkgICAgICAgICAgICAJaWYoJGdldFNoaWZ0ICE9IG51bGwpewoJICAgICAgICAgICAgCQlpZigkYXNfaW5mby0+YXNfb3QgPT0gMSAmJiAkZ2V0QXR0LT5vdXRfdGltZSAhPSBudWxsICYmICRnZXRBdHQtPmluX3RpbWUgIT0gbnVsbCl7CgkJICAgICAgICAgICAgICAgICAgICAkb3RIb3VyID0gRW1wbG95ZWVIZWxwZXI6OmRhbGl5T1RDYWxjdWxhdGlvbigkZ2V0QXR0LT5pbl90aW1lLCAkZ2V0QXR0LT5vdXRfdGltZSwgJGdldFNoaWZ0LT5ocl9zaGlmdF9zdGFydF90aW1lLCAkZ2V0U2hpZnQtPmhyX3NoaWZ0X2VuZF90aW1lLCAkZ2V0U2hpZnQtPmhyX3NoaWZ0X2JyZWFrX3RpbWUsICRnZXRTaGlmdC0+aHJfc2hpZnRfbmlnaHRfZmxhZywgJGFzX2luZm8tPmFzc29jaWF0ZV9pZCwgJGFzX2luZm8tPnNoaWZ0X3JvYXN0ZXJfc3RhdHVzLCAkYXNfaW5mby0+YXNfdW5pdF9pZCk7CgkJICAgICAgICAgICAgICAgIH0KCgkJICAgICAgICAgICAgICAgIERCOjp0YWJsZSgkdGFibGVOYW1lKQoJCSAgICAgICAgICAgICAgICAtPndoZXJlKCdpZCcsICRnZXRBdHQtPmlkKQoJCSAgICAgICAgICAgICAgICAtPnVwZGF0ZShbJ290X2hvdXInID0+ICRvdEhvdXJdKTsKCgkJICAgICAgICAgICAgICAgIC8vIAoJCSAgICAgICAgICAgICAgICAkcXVldWUgPSAobmV3IFByb2Nlc3NBdHRlbmRhbmNlRmlsZSgkdGFibGVOYW1lLCAkZ2V0QXR0LT5pZCwgJGdldFNoaWZ0LT5ocl9zaGlmdF9uYW1lLCAkZ2V0U2hpZnQtPmhyX3NoaWZ0X3N0YXJ0X3RpbWUsICRnZXRTaGlmdC0+YmlsbF9lbGlnaWJsZSwgJGdldFNoaWZ0LT5ocl9zaGlmdF9uaWdodF9mbGFnKSkKCQkgICAgICAgICAgICAgICAgLT5vblF1ZXVlKCRxdWV1ZU5hbWUpCgkJICAgICAgICAgICAgICAgIC0+ZGVsYXkoQ2FyYm9uOjpub3coKS0+YWRkU2Vjb25kcygyKSk7CgkJICAgICAgICAgICAgICAgIGRpc3BhdGNoKCRxdWV1ZSk7CgoJCSAgICAgICAgICAgICAgICAkZmlyc3REYXRlTW9udGggPSBDYXJib246OnBhcnNlKCRyZWNvcmREYXRlKS0+c3RhcnRPZk1vbnRoKCktPnRvRGF0ZVN0cmluZygpOwoJCQkJICAgIAkkbGFzdERhdGVNb250aCA9IENhcmJvbjo6cGFyc2UoJHJlY29yZERhdGUpLT5lbmRPZk1vbnRoKCktPnRvRGF0ZVN0cmluZygpOwoJCQkJICAgIAkkZ2V0T3QgPSBEQjo6dGFibGUoJHRhYmxlTmFtZSkKCQkJICAgICAgICAgICAgLT5zZWxlY3QoWwoJCQkgICAgICAgICAgICAgICAgREI6OnJhdygnU1VNKG90X2hvdXIpIGFzIG90JykKCQkJICAgICAgICAgICAgXSkKCQkJICAgICAgICAgICAgLT53aGVyZSgnYXNfaWQnLCAkYXNJZCkKCQkJICAgICAgICAgICAgLT53aGVyZSgnaW5fZGF0ZScsJz49JywkZmlyc3REYXRlTW9udGgpCgkJCSAgICAgICAgICAgIC0+d2hlcmUoJ2luX2RhdGUnLCc8PScsICRsYXN0RGF0ZU1vbnRoKQoJCQkgICAgICAgICAgICAtPmZpcnN0KCk7CgkJCSAgICAgICAgICAgIAoJCSAgICAgICAgICAgIAkkZ2V0QXR0LT5vdF9ob3VyID0gbnVtYmVyVG9UaW1lQ2xvY2tGb3JtYXQoJG90SG91cik7CgkJICAgICAgICAgICAgCSRnZXRBdHQtPmluX3RpbWUgPSAkZ2V0QXR0LT5pbl90aW1lICE9IG51bGw/ZGF0ZSgnSDppOnMnLCBzdHJ0b3RpbWUoJGdldEF0dC0+aW5fdGltZSkpOicnOwoJCSAgICAgICAgICAgIAkkZ2V0QXR0LT5vdXRfdGltZSA9ICRnZXRBdHQtPm91dF90aW1lICE9IG51bGw/ZGF0ZSgnSDppOnMnLCBzdHJ0b3RpbWUoJGdldEF0dC0+b3V0X3RpbWUpKTonJzsKCQkgICAgICAgICAgICAJJGdldEF0dC0+dG90YWxPdCA9IG51bWJlclRvVGltZUNsb2NrRm9ybWF0KCRnZXRPdC0+b3Q/PzApOwoJICAgICAgICAgICAgCX1lbHNlewoJICAgICAgICAgICAgCQkkZ2V0QXR0ID0gJyc7CgkgICAgICAgICAgICAJfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgCgkgICAgICAgICAgICAvLyBzYWxhcnkgcHJvY2VzcwogICAgICAgICAgICAgICAgJHllYXJNb250aCA9IGRhdGUoJ1ktbScsIHN0cnRvdGltZSgkcmVjb3JkRGF0ZSkpOwogICAgICAgICAgICAgICAgJG1vbnRoID0gZGF0ZSgnbScsIHN0cnRvdGltZSgkcmVjb3JkRGF0ZSkpOyAKICAgICAgICAgICAgICAgICR5ZWFyID0gZGF0ZSgnWScsIHN0cnRvdGltZSgkcmVjb3JkRGF0ZSkpOyAKICAgICAgICAgICAgICAgIGlmKCRtb250aCA9PSBkYXRlKCdtJykpewogICAgICAgICAgICAgICAgICAgICR0b3RhbERheSA9IGRhdGUoJ2QnKTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICR0b3RhbERheSA9IENhcmJvbjo6cGFyc2UoJHllYXJNb250aCktPmRheXNJbk1vbnRoOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHF1ZXVlID0gKG5ldyBQcm9jZXNzVW5pdFdpc2VTYWxhcnkoJHRhYmxlTmFtZSwgJG1vbnRoLCAkeWVhciwgJGFzX2luZm8tPmFzX2lkLCAkdG90YWxEYXkpKQogICAgICAgICAgICAgICAgLT5vblF1ZXVlKCdzYWxhcnlnZW5lcmF0ZScpCiAgICAgICAgICAgICAgICAtPmRlbGF5KENhcmJvbjo6bm93KCktPmFkZFNlY29uZHMoMikpOwogICAgICAgICAgICAgICAgZGlzcGF0Y2goJHF1ZXVlKTsKCSAgICAJfQoJICAgIAkKCSAgICAJcmV0dXJuICRnZXRBdHQ7CiAgICAJfSBjYXRjaCAoXEV4Y2VwdGlvbiAkZSkgewogICAgCQlyZXR1cm4gJGUtPmdldE1lc3NhZ2UoKTsKICAgIAkJcmV0dXJuICdlcnJvcic7CiAgICAJfQogICAgfQoKCn0=