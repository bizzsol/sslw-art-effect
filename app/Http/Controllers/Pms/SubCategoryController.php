<?php
bolt_decrypt( __FILE__ , 'SCy3Wg'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBBcHBcSW1wb3J0c1xDYXRlZ29yeUltcG9ydDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXENhdGVnb3J5Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHJvZHVjdEF0dHJpYnV0ZTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uVHlwZTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFdhcmVob3VzZXM7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xDYXRlZ29yeURlcGFydG1lbnQ7CnVzZSBBcHBcTW9kZWxzXEhyXERlcGFydG1lbnQ7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKdXNlIElsbHVtaW5hdGVcVmFsaWRhdGlvblxSdWxlOwp1c2UgTWFhdHdlYnNpdGVcRXhjZWxcRmFjYWRlc1xFeGNlbDsKCnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQXR0cmlidXRlOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEF0dHJpYnV0ZU9wdGlvbjsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xDYXRlZ29yeUF0dHJpYnV0ZTsKCnVzZSBEQiwgRGF0YVRhYmxlczsKCmNsYXNzIFN1YkNhdGVnb3J5Q29udHJvbGxlciBleHRlbmRzIENvbnRyb2xsZXIKewogICAgcHVibGljIGZ1bmN0aW9uIGhlYWRlckNvbHVtbnMoJHZhbHVlPScnKQogICAgewogICAgICAgIHJldHVybiBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3Byb2R1Y3RfdHlwZScsICdwcm9kdWN0X3R5cGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydtYWluX2NhdGVnb3J5JywgJ21haW5fY2F0ZWdvcnknLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydjb2RlJywgJ2NvZGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWyduYW1lJywgJ25hbWUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhdHRyaWJ1dGVzJywgJ2F0dHJpYnV0ZXMnXSwKICAgICAgICAgICAgWydzZXJ2aWNlJywgJ3NlcnZpY2UnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhY3Rpb25zJywgJ2FjdGlvbnMnLCAndGV4dC1jZW50ZXInXQogICAgICAgICk7CiAgICB9CiAgICAvKioKICAgICAqIERpc3BsYXkgYSBsaXN0aW5nIG9mIHRoZSByZXNvdXJjZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGluZGV4KCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkdGl0bGUgPSAnU3ViIENhdGVnb3J5JzsKCiAgICAgICAgICAgICRpc19maXhlZF9hc3NldCA9IHJlcXVlc3QoKS0+aGFzKCdmaXhlZC1hc3NldHMnKTsKICAgICAgICAgICAgJGlzX2N3aXAgPSByZXF1ZXN0KCktPmhhcygnY3dpcCcpOwoKICAgICAgICAgICAgJGNhdGVnb3JpZXMgPSBDYXRlZ29yeTo6aGFzKCdjYXRlZ29yeScpCiAgICAgICAgICAgIC0+d2l0aChbJ2NhdGVnb3J5JywgJ2F0dHJpYnV0ZXMuYXR0cmlidXRlJ10pCiAgICAgICAgICAgIC8vIC0+d2hlcmUoJ2lzX2ZpeGVkX2Fzc2V0JywgJGlzX2ZpeGVkX2Fzc2V0KQogICAgICAgICAgICAvLyAtPndoZXJlKCdpc19jd2lwJywgJGlzX2N3aXApCiAgICAgICAgICAgIC0+d2hlbighZGF0YXRhYmxlT3JkZXJpbmcoKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ3BhcmVudF9pZCcsICdkZXNjJyk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICAkYXR0cmlidXRlT3B0aW9ucyA9IEF0dHJpYnV0ZU9wdGlvbjo6YWxsKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YXRhYmxlczo6b2YoJGNhdGVnb3JpZXMpCiAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdwcm9kdWN0X3R5cGUnLCBmdW5jdGlvbigkc3ViQ2F0ZWdvcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkc3ViQ2F0ZWdvcnktPmNhdGVnb3J5LT5pc19maXhlZF9hc3NldCA9PSAxID8gJ0ZpeGVkIEFzc2V0JyA6ICgkc3ViQ2F0ZWdvcnktPmNhdGVnb3J5LT5pc19jd2lwID09IDEgPyAnQ1dJUCcgOiAnUHJvZHVjdHMnKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignc2VydmljZScsIGZ1bmN0aW9uICgkY2F0ZWdvcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkY2F0ZWdvcnktPmlzX3NlcnZpY2UgPT0gMSA/ICc8YSBjbGFzcz0iYnRuIGJ0bi1zdWNjZXNzIGJ0bi14cyI+WWVzPC9hPicgOiAnPGEgY2xhc3M9ImJ0biBidG4tZGFyayBidG4teHMiPk5vPC9hPic7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ21haW5fY2F0ZWdvcnknLCBmdW5jdGlvbigkc3ViQ2F0ZWdvcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkc3ViQ2F0ZWdvcnktPmNhdGVnb3J5LT5uYW1lKT8kc3ViQ2F0ZWdvcnktPmNhdGVnb3J5LT5uYW1lOicnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdtYWluX2NhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2F0dHJpYnV0ZXMnLCBmdW5jdGlvbiAoJHN1YkNhdGVnb3J5KSB1c2UoJGF0dHJpYnV0ZU9wdGlvbnMpewogICAgICAgICAgICAgICAgICAgICRhdHRyID0nJzsKICAgICAgICAgICAgICAgICAgICAkYXR0cmlidXRlcyA9IGlzc2V0KCRzdWJDYXRlZ29yeS0+YXR0cmlidXRlc1swXSkgPyBjb2xsZWN0KCRzdWJDYXRlZ29yeS0+YXR0cmlidXRlcyktPnNvcnRCeSgnc2VyaWFsJyktPnZhbHVlcygpLT5hbGwoKSA6IFtdOwogICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkYXR0cmlidXRlc1swXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGF0dHIgLj0nPHVsPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRhdHRyaWJ1dGVzIGFzICRrZXkgPT4gJGNhdGVnb3J5QXR0cmlidXRlKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXR0ciAuPSc8bGk+PHN0cm9uZz4nLiRjYXRlZ29yeUF0dHJpYnV0ZS0+YXR0cmlidXRlLT5uYW1lLic6PC9zdHJvbmc+ICcuJGF0dHJpYnV0ZU9wdGlvbnMtPndoZXJlKCdhdHRyaWJ1dGVfaWQnLCAkY2F0ZWdvcnlBdHRyaWJ1dGUtPmF0dHJpYnV0ZV9pZCktPndoZXJlSW4oJ2lkJywgKCFlbXB0eSgkY2F0ZWdvcnlBdHRyaWJ1dGUtPm9wdGlvbnMpID8ganNvbl9kZWNvZGUoJGNhdGVnb3J5QXR0cmlidXRlLT5vcHRpb25zLCB0cnVlKSA6IFtdKSktPnBsdWNrKCduYW1lJyktPmltcGxvZGUoJywgJykuJzwvbGk+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJGF0dHIgLj0nPC91bD4nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGF0dHI7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2F0dHJpYnV0ZXMnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdhdHRyaWJ1dGVzLmF0dHJpYnV0ZScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KS0+b3JXaGVyZUhhcygnYXR0cmlidXRlcy5hdHRyaWJ1dGUub3B0aW9ucycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdhdHRyaWJ1dGVzJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgQ2F0ZWdvcnlBdHRyaWJ1dGU6OnNlbGVjdCgnYXR0cmlidXRlcy5jb2RlJykKICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdhdHRyaWJ1dGVzJywgJ2F0dHJpYnV0ZXMuaWQnLCAnPScsICdjYXRlZ29yeV9hdHRyaWJ1dGVzLmF0dHJpYnV0ZV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ2NhdGVnb3J5X2F0dHJpYnV0ZXMuY2F0ZWdvcnlfaWQnLCAnY2F0ZWdvcmllcy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbigkc3ViQ2F0ZWdvcnkpewogICAgICAgICAgICAgICAgICAgICRhY3Rpb25zID0gJyc7CgogICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49JzxhIGhyZWY9IicudXJsKCdwbXMvcHJvZHVjdC1tYW5hZ2VtZW50L3N1Yi1jYXRlZ29yeS8nLiRzdWJDYXRlZ29yeS0+aWQuJy9jcmVhdGUtYXR0cmlidXRlcycpLiciIGNsYXNzPSJidG4gYnRuLXN1Y2Nlc3MgbS0xIGJ0bi14cyI+PGkgY2xhc3M9ImxhcyBsYS1zaXRlbWFwIj48L2k+PC9hPic7CgogICAgICAgICAgICAgICAgICAgICR1cmwgPSByb3V0ZSgncG1zLnByb2R1Y3QtbWFuYWdlbWVudC5zdWItY2F0ZWdvcnkuZWRpdCcsICRzdWJDYXRlZ29yeS0+aWQpOwogICAgICAgICAgICAgICAgICAgIGlmKHJlcXVlc3QoKS0+aGFzKCdmaXhlZC1hc3NldHMnKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICR1cmwgPSB1cmwoJ3Btcy9maXhlZC1hc3NldHMvc3ViLWNhdGVnb3J5L2VkaXQvJy4kc3ViQ2F0ZWdvcnktPmlkLic/Zml4ZWQtYXNzZXRzJyk7CiAgICAgICAgICAgICAgICAgICAgfWVsc2VpZihyZXF1ZXN0KCktPmhhcygnY3dpcCcpKXsKICAgICAgICAgICAgICAgICAgICAgICAgJHVybCA9IHVybCgncG1zL2N3aXAvc3ViLWNhdGVnb3J5LycuJHN1YkNhdGVnb3J5LT5pZC4nL2VkaXQ/Y3dpcCcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGEgaHJlZj0iJy4gJHVybCAuJyIgY2xhc3M9ImJ0biBidG4taW5mbyBtLTEgYnRuLXhzIj48aSBjbGFzcz0ibGFzIGxhLWVkaXQiPjwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBkYXRhLXJvbGU9ImRlbGV0ZSIgZGF0YS1zcmM9IicuIHJvdXRlKCdwbXMucHJvZHVjdC1tYW5hZ2VtZW50LnN1Yi1jYXRlZ29yeS5kZXN0cm95JywgJHN1YkNhdGVnb3J5LT5pZCkgLiciIGNsYXNzPSJidG4gYnRuLWRhbmdlciBtLTEgYnRuLXhzIGRlbGV0ZUJ0biIgb25jbGljaz0iZGVsZXRlRnJvbUNSVUQoJCh0aGlzKSkiPjxpIGNsYXNzPSJsYXMgbGEtdHJhc2giPjwvaT48L2E+JzsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ2F0dHJpYnV0ZXMnLCAnYWN0aW9ucycsICdzZXJ2aWNlJ10pCiAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5zdWItY2F0ZWdvcnkuaW5kZXgnLFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4kdGl0bGUsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPmhlYWRlckNvbHVtbnMoKSwKICAgICAgICAgICAgICAgICdpc19maXhlZF9hc3NldCcgPT4gJGlzX2ZpeGVkX2Fzc2V0LAogICAgICAgICAgICAgICAgJ2lzX2N3aXAnID0+ICRpc19jd2lwLAogICAgICAgICAgICBdKTsKCiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKIAogICAgLyoqCiAgICAgKiBTaG93IHRoZSBmb3JtIGZvciBjcmVhdGluZyBhIG5ldyByZXNvdXJjZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNyZWF0ZSgpCiAgICB7CiAgICAgICAgJHRpdGxlID0gIlN1YiBDYXRlZ29yeSBDcmVhdGUiOwogICAgICAgICRjYXRlZ29yaWVzID0gQ2F0ZWdvcnk6OndpdGgoWwogICAgICAgICAgICAnY2F0ZWdvcnknLCAnZGVwYXJ0bWVudHNMaXN0JwogICAgICAgIF0pCiAgICAgICAgLT5kb2VzbnRIYXZlKCdjYXRlZ29yeScpCiAgICAgICAgLy8gLT53aGVyZSgnaXNfZml4ZWRfYXNzZXQnLHJlcXVlc3QoKS0+aGFzKCdmaXhlZC1hc3NldHMnKSkKICAgICAgICAvLyAtPndoZXJlKCdpc19jd2lwJyxyZXF1ZXN0KCktPmhhcygnY3dpcCcpKQogICAgICAgIC0+b3JkZXJieSgnY29kZScsICdhc2MnKQogICAgICAgIC0+Z2V0KCk7CiAgICAgICAgJHJlcXVpc2l0aW9ucyA9IFJlcXVpc2l0aW9uVHlwZTo6YWxsKCk7CiAgICAgICAgJGRlcGFydG1lbnRzPSBEZXBhcnRtZW50OjphbGwoKTsKICAgICAgICAkY29kZSA9IHVuaXF1ZUNvZGUoNywnQ1QtJywnY2F0ZWdvcmllcycsJ2lkJyk7CiAgICAgICAgJGNoYXJ0T2ZBY2NvdW50c09wdGlvbnMgPSBjaGFydE9mQWNjb3VudHNPcHRpb25zKFtdLCAwLCAwLCBnZXRBbGxHcm91cEFuZExlZGdlcnMoKSk7CgogICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5zdWItY2F0ZWdvcnkuY3JlYXRlJywgY29tcGFjdCgndGl0bGUnLCAnY2F0ZWdvcmllcycsJ3JlcXVpc2l0aW9ucycsJ2RlcGFydG1lbnRzJywnY29kZScsICdjaGFydE9mQWNjb3VudHNPcHRpb25zJykpOwogICAgfQoKICAgIC8qKgogICAgICogU2hvdyB0aGUgZm9ybSBmb3IgY3JlYXRpbmcgYSBuZXcgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjcmVhdGVBdHRyaWJ1dGVzKCRjYXRlZ29yeV9pZCkKICAgIHsKICAgICAgICAkY2F0ZWdvcnkgPSBDYXRlZ29yeTo6ZmluZE9yRmFpbCgkY2F0ZWdvcnlfaWQpOwogICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAndGl0bGUnID0+ICJBdHRyaWJ1dGVzIGZvciAjIi4kY2F0ZWdvcnktPm5hbWUsCiAgICAgICAgICAgICdzdWJjYXRlZ29yeScgPT4gJGNhdGVnb3J5LAogICAgICAgICAgICAnYXR0cmlidXRlcycgPT4gQXR0cmlidXRlOjpoYXMoJ29wdGlvbnMnKS0+d2l0aChbJ29wdGlvbnMnXSktPmdldCgpLAogICAgICAgICAgICAnY2F0ZWdvcnlBdHRyaWJ1dGVzJyA9PiBDYXRlZ29yeUF0dHJpYnV0ZTo6d2hlcmUoJ2NhdGVnb3J5X2lkJywgJGNhdGVnb3J5LT5pZCktPnBsdWNrKCdhdHRyaWJ1dGVfaWQnKS0+dG9BcnJheSgpLAogICAgICAgIF07CgogICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5zdWItY2F0ZWdvcnkuYXR0cmlidXRlcycsICRkYXRhKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gdXBkYXRlQXR0cmlidXRlcyhSZXF1ZXN0ICRyZXF1ZXN0LCAkaWQpCiAgICB7CiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAkY2F0ZWdvcnkgPSBDYXRlZ29yeTo6ZmluZE9yRmFpbCgkaWQpOwogICAgICAgICAgICAkY2F0ZWdvcnktPmZpbGwoJHJlcXVlc3QtPmFsbCgpKS0+c2F2ZSgpOwoKICAgICAgICAgICAgaWYoaXNzZXQoJHJlcXVlc3QtPnByb2R1Y3RBdHRyaWJ1dGVzWzBdKSl7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkcmVxdWVzdC0+cHJvZHVjdEF0dHJpYnV0ZXMgYXMgJGtleSA9PiAkYXR0cmlidXRlX2lkKSB7CiAgICAgICAgICAgICAgICAgICAgQ2F0ZWdvcnlBdHRyaWJ1dGU6OnVwZGF0ZU9yQ3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjYXRlZ29yeV9pZCcgPT4gJGNhdGVnb3J5LT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhdHRyaWJ1dGVfaWQnID0+ICRhdHRyaWJ1dGVfaWQKICAgICAgICAgICAgICAgICAgICBdLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICdzZXJpYWwnID0+ICRyZXF1ZXN0LT5hdHRyaWJ1dGVTZXJpYWxzWyRhdHRyaWJ1dGVfaWRdLAogICAgICAgICAgICAgICAgICAgICAgICAnb3B0aW9ucycgPT4ganNvbl9lbmNvZGUoJHJlcXVlc3QtPmF0dHJpYnV0ZU9wdGlvbnNbJGF0dHJpYnV0ZV9pZF0pLAogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBDYXRlZ29yeUF0dHJpYnV0ZTo6d2hlcmUoJ2NhdGVnb3J5X2lkJywgJGNhdGVnb3J5LT5pZCkKICAgICAgICAgICAgLT53aGVyZU5vdEluKCdhdHRyaWJ1dGVfaWQnLCAkcmVxdWVzdC0+cHJvZHVjdEF0dHJpYnV0ZXMpCiAgICAgICAgICAgIC0+ZGVsZXRlKCk7CgogICAgICAgICAgICAkcHJvZHVjdEF0dHJpYnV0ZXMgPSBQcm9kdWN0QXR0cmlidXRlOjp3aGVyZUhhcygnYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZS5jYXRlZ29yaWVzJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGNhdGVnb3J5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdjYXRlZ29yeV9pZCcsICRjYXRlZ29yeS0+aWQpOwogICAgICAgICAgICB9KS0+Z2V0KCk7CgogICAgICAgICAgICBpZihpc3NldCgkcHJvZHVjdEF0dHJpYnV0ZXNbMF0pKXsKICAgICAgICAgICAgICAgIGZvcmVhY2goJHByb2R1Y3RBdHRyaWJ1dGVzIGFzICRrZXkgPT4gJHByb2R1Y3RBdHRyaWJ1dGUpewogICAgICAgICAgICAgICAgICAgICRzZXJpYWwgPSBDYXRlZ29yeUF0dHJpYnV0ZTo6d2hlcmUoJ2NhdGVnb3J5X2lkJywgJGNhdGVnb3J5LT5pZCkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdhdHRyaWJ1dGUub3B0aW9ucycsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRwcm9kdWN0QXR0cmlidXRlKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lkJywgJHByb2R1Y3RBdHRyaWJ1dGUtPmF0dHJpYnV0ZV9vcHRpb25faWQpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maXJzdCgpOwogICAgICAgICAgICAgICAgICAgICRwcm9kdWN0QXR0cmlidXRlLT5zZXJpYWxfbm8gPSAoaXNzZXQoJHNlcmlhbC0+c2VyaWFsKSA/ICRzZXJpYWwtPnNlcmlhbCA6IDApOwogICAgICAgICAgICAgICAgICAgICRwcm9kdWN0QXR0cmlidXRlLT5zYXZlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFN1Y2Nlc3MoJ1N1YiBDYXRlZ29yeSBBdHRyaWJ1dGVzIGhhdmUgYmVubiB1cGRhdGVkLiAnKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU3RvcmUgYSBuZXdseSBjcmVhdGVkIHJlc291cmNlIGluIHN0b3JhZ2UuCiAgICAgKgogICAgICogQHBhcmFtICBcSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3QgICRyZXF1ZXN0CiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHN0b3JlKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHRoaXMtPnZhbGlkYXRlKCRyZXF1ZXN0LCBbCiAgICAgICAgICAgICdjb2RlJyA9PiBbJ3JlcXVpcmVkJywgJ3N0cmluZycsICdtYXg6MjU1JywgJ3VuaXF1ZTpjYXRlZ29yaWVzJ10sCiAgICAgICAgICAgICduYW1lJyA9PiBbJ3JlcXVpcmVkJywgJ3N0cmluZycsICdtYXg6MjU1J10sCiAgICAgICAgICAgICdwYXJlbnRfaWQnID0+IFsnbnVsbGFibGUnLCAnaW50ZWdlciddLAogICAgICAgICAgICAvLyAncmVxdWlzaXRpb25fdHlwZV9pZCcgPT4gWydyZXF1aXJlZCcsICdpbnRlZ2VyJ10sCiAgICAgICAgXSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJGlucHV0cyA9ICRyZXF1ZXN0LT5hbGwoKTsKICAgICAgICAgICAgdW5zZXQoJGlucHV0c1snX3Rva2VuJ10pOwogICAgICAgICAgICB1bnNldCgkaW5wdXRzWydfbWV0aG9kJ10pOwoKICAgICAgICAgICAgJGNhdGVnb3J5ID0gQ2F0ZWdvcnk6OmNyZWF0ZSgkaW5wdXRzKTsKCiAgICAgICAgICAgICRwYXJlbnQgPSBDYXRlZ29yeTo6ZmluZCgkcmVxdWVzdC0+cGFyZW50X2lkKTsKICAgICAgICAgICAgJGNhdGVnb3J5LT5pc19maXhlZF9hc3NldCA9ICRwYXJlbnQtPmlzX2ZpeGVkX2Fzc2V0OwogICAgICAgICAgICAkY2F0ZWdvcnktPmlzX2N3aXAgPSAkcGFyZW50LT5pc19jd2lwOwogICAgICAgICAgICAkY2F0ZWdvcnktPmlzX3NlcnZpY2UgPSAkcGFyZW50LT5pc19zZXJ2aWNlOwogICAgICAgICAgICAkY2F0ZWdvcnktPnNhdmUoKTsKCiAgICAgICAgICAgICRkZXBhcnRtZW50cyA9IENhdGVnb3J5RGVwYXJ0bWVudDo6d2hlcmUoJ2NhdGVnb3J5X2lkJywgJHJlcXVlc3QtPnBhcmVudF9pZCktPnBsdWNrKCdocl9kZXBhcnRtZW50X2lkJyktPnRvQXJyYXkoKTsKICAgICAgICAgICAgJGNhdGVnb3J5LT5kZXBhcnRtZW50KCktPnN5bmMoJGRlcGFydG1lbnRzKTsKCiAgICAgICAgICAgIC8vIHJldHVybiAkdGhpcy0+cmVkaXJlY3RCYWNrV2l0aFN1Y2Nlc3MoJ1N1YiBDYXRlZ29yeSBjcmVhdGVkIHN1Y2Nlc3NmdWxseScsJ3Btcy5wcm9kdWN0LW1hbmFnZW1lbnQuc3ViLWNhdGVnb3J5LmluZGV4Jyk7CgogICAgICAgICAgICAkdXJsID0gdXJsKCdwbXMvcHJvZHVjdC1tYW5hZ2VtZW50L3N1Yi1jYXRlZ29yeScpOwogICAgICAgICAgICBpZigkcGFyZW50LT5pc19maXhlZF9hc3NldCA9PSAxKXsKICAgICAgICAgICAgICAgICR1cmwgPSB1cmwoJ3Btcy9maXhlZC1hc3NldHMvc3ViLWNhdGVnb3J5JykuJz9maXhlZC1hc3NldHMnOwogICAgICAgICAgICB9ZWxzZWlmKCRwYXJlbnQtPmlzX2N3aXAgPT0gMSl7CiAgICAgICAgICAgICAgICAkdXJsID0gdXJsKCdwbXMvY3dpcC9zdWItY2F0ZWdvcnknKS4nP2N3aXAnOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gJHRoaXMtPnVybFJlZGlyZWN0QmFjaygnU3ViIENhdGVnb3J5IHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5JywgJHVybCwgJ3N1Y2Nlc3MnKTsKICAgICAgICAgICAgCiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRGlzcGxheSB0aGUgc3BlY2lmaWVkIHJlc291cmNlLgogICAgICoKICAgICAqIEBwYXJhbSAgaW50ICAkaWQKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2hvdygkY2F0ZWdvcnlfaWQpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJGNhdGVnb3J5ID0gQ2F0ZWdvcnk6OmZpbmRPckZhaWwoJGNhdGVnb3J5X2lkKTsKICAgICAgICAgICAgJGNhdGVnb3J5LT5zcmMgPSByb3V0ZSgncG1zLnByb2R1Y3QtbWFuYWdlbWVudC5zdWItY2F0ZWdvcnkudXBkYXRlJywgJGNhdGVnb3J5LT5pZCk7CiAgICAgICAgICAgICRjYXRlZ29yeS0+cmVxX3R5cGUgPSAncHV0JzsKICAgICAgICAgICAgJGNhdGVnb3J5LT5wYXJlbnRfaWQgPSAhJGNhdGVnb3J5LT5jYXRlZ29yeT9udWxsOiRjYXRlZ29yeS0+Y2F0ZWdvcnk7CgogICAgICAgICAgICAkYXJyYXk9W107CiAgICAgICAgICAgIGZvcmVhY2goJGNhdGVnb3J5LT5kZXBhcnRtZW50c0xpc3QgYXMgJGtleSA9PiAkZGVwYXJ0bWVudCl7CiAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRhcnJheSwkZGVwYXJ0bWVudC0+aHJfZGVwYXJ0bWVudF9pZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRuZXdfYXJyYXk9W107CgogICAgICAgICAgICBmb3JlYWNoKERlcGFydG1lbnQ6OndoZXJlSW4oJ2hyX2RlcGFydG1lbnRfaWQnLCRhcnJheSktPnNlbGVjdCgnaHJfZGVwYXJ0bWVudF9pZCcpLT5nZXQoKSBhcyAkdmFsdWVzKXsKICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJG5ld19hcnJheSwgJHZhbHVlcy0+aHJfZGVwYXJ0bWVudF9pZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gJ3N1Y2Nlc3MnLAogICAgICAgICAgICAgICAgJ2NhdGVnb3J5JyA9PiAkY2F0ZWdvcnksCiAgICAgICAgICAgICAgICAnZGVwYXJ0bWVudHMnID0+IERlcGFydG1lbnQ6OmFsbCgpLAogICAgICAgICAgICAgICAgJ2RlcGFydG1lbnRzSWQnPT5EZXBhcnRtZW50Ojp3aGVyZUluKCdocl9kZXBhcnRtZW50X2lkJywkYXJyYXkpLT5wbHVjaygnaHJfZGVwYXJ0bWVudF9pZCcpLT5hbGwoKSwKICAgICAgICAgICAgICAgICdpbnZlbnRvcnlfYWNjb3VudF9pZCcgPT4gY2hhcnRPZkFjY291bnRzT3B0aW9ucyhbXSwgJGNhdGVnb3J5LT5pbnZlbnRvcnlfYWNjb3VudF9pZCksCiAgICAgICAgICAgICAgICAnY29nc19hY2NvdW50X2lkJyA9PiBjaGFydE9mQWNjb3VudHNPcHRpb25zKFtdLCAkY2F0ZWdvcnktPmNvZ3NfYWNjb3VudF9pZCksCiAgICAgICAgICAgICAgICAnaW52ZW50b3J5X2FkanVzdG1lbnRzX2FjY291bnRfaWQnID0+IGNoYXJ0T2ZBY2NvdW50c09wdGlvbnMoW10sICRjYXRlZ29yeS0+aW52ZW50b3J5X2FkanVzdG1lbnRzX2FjY291bnRfaWQpLAogICAgICAgICAgICBdOwoKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oJGRhdGEpOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IG51bGwsCiAgICAgICAgICAgICAgICAnaW5mbycgPT4gJHRoLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgXTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oJGRhdGEpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNob3cgdGhlIGZvcm0gZm9yIGVkaXRpbmcgdGhlIHNwZWNpZmllZCByZXNvdXJjZS4KICAgICAqCiAgICAgKiBAcGFyYW0gIGludCAgJGlkCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGVkaXQoJGlkKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRjYXRlZ29yeSA9IENhdGVnb3J5OjpmaW5kT3JGYWlsKCRpZCk7CiAgICAgICAgICAgICRjYXRlZ29yeS0+cGFyZW50X2lkID0gISRjYXRlZ29yeS0+Y2F0ZWdvcnk/bnVsbDokY2F0ZWdvcnktPmNhdGVnb3J5OwoKICAgICAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICdFZGl0IFN1Yi1DYXRlZ29yeScsCiAgICAgICAgICAgICAgICAnY2F0ZWdvcnknID0+ICRjYXRlZ29yeSwKICAgICAgICAgICAgICAgICdjYXRlZ29yaWVzJyA9PiBDYXRlZ29yeTo6ZG9lc250SGF2ZSgnY2F0ZWdvcnknKQogICAgICAgICAgICAgICAgLT53aXRoKFsKICAgICAgICAgICAgICAgICAgICAnZGVwYXJ0bWVudHNMaXN0JywgJ2NhdGVnb3J5JwogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+b3JkZXJieSgnY29kZScsICdhc2MnKQogICAgICAgICAgICAgICAgLT5nZXQoKSwKICAgICAgICAgICAgICAgICdkZXBhcnRtZW50cycgPT4gRGVwYXJ0bWVudDo6YWxsKCksCiAgICAgICAgICAgICAgICAnZGVwYXJ0bWVudHNJZCcgPT4gJGNhdGVnb3J5LT5kZXBhcnRtZW50c0xpc3QtPnBsdWNrKCdocl9kZXBhcnRtZW50X2lkJyktPnRvQXJyYXkoKSwKICAgICAgICAgICAgICAgICdjaGFydE9mQWNjb3VudHNPcHRpb25zJyA9PiBjaGFydE9mQWNjb3VudHNPcHRpb25zKFtdLCAwLCAwLCBnZXRBbGxHcm91cEFuZExlZGdlcnMoKSkKICAgICAgICAgICAgXTsKCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5zdWItY2F0ZWdvcnkuZWRpdCcsICRkYXRhKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIHNwZWNpZmllZCByZXNvdXJjZSBpbiBzdG9yYWdlLgogICAgICoKICAgICAqIEBwYXJhbSAgXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICAkcmVxdWVzdAogICAgICogQHBhcmFtICBpbnQgICRpZAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiB1cGRhdGUoUmVxdWVzdCAkcmVxdWVzdCwgJGNhdGVnb3J5X2lkKQogICAgewogICAgICAgICRjYXRlZ29yeSA9IENhdGVnb3J5OjpmaW5kT3JGYWlsKCRjYXRlZ29yeV9pZCk7CgogICAgICAgICR0aGlzLT52YWxpZGF0ZSgkcmVxdWVzdCwgWwogICAgICAgICAgICAnY29kZScgPT4gWydyZXF1aXJlZCcsICdzdHJpbmcnLCAnbWF4OjI1NScsIFJ1bGU6OnVuaXF1ZSgnY2F0ZWdvcmllcycpLT5pZ25vcmUoJGNhdGVnb3J5LT5pZCldLAogICAgICAgICAgICAnbmFtZScgPT4gWydyZXF1aXJlZCcsICdzdHJpbmcnLCAnbWF4OjI1NSddLAogICAgICAgICAgICAncGFyZW50X2lkJyA9PiBbJ251bGxhYmxlJywgJ2ludGVnZXInXSwKICAgICAgICAgICAgLy8gJ3JlcXVpc2l0aW9uX3R5cGVfaWQnID0+IFsncmVxdWlyZWQnLCAnaW50ZWdlciddLAogICAgICAgIF0pOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRkZXBhcnRtZW50cyA9IENhdGVnb3J5RGVwYXJ0bWVudDo6d2hlcmUoJ2NhdGVnb3J5X2lkJywgJGNhdGVnb3J5LT5wYXJlbnRfaWQpLT5wbHVjaygnaHJfZGVwYXJ0bWVudF9pZCcpLT50b0FycmF5KCk7CgogICAgICAgICAgICAkaW5wdXRzID0gJHJlcXVlc3QtPmFsbCgpOwogICAgICAgICAgICB1bnNldCgkaW5wdXRzWydfdG9rZW4nXSk7CiAgICAgICAgICAgIHVuc2V0KCRpbnB1dHNbJ19tZXRob2QnXSk7CgogICAgICAgICAgICAkcGFyZW50ID0gQ2F0ZWdvcnk6OmZpbmQoJHJlcXVlc3QtPnBhcmVudF9pZCk7CiAgICAgICAgICAgICRjYXRlZ29yeS0+aXNfZml4ZWRfYXNzZXQgPSAkcGFyZW50LT5pc19maXhlZF9hc3NldDsKICAgICAgICAgICAgJGNhdGVnb3J5LT5pc19jd2lwID0gJHBhcmVudC0+aXNfY3dpcDsKICAgICAgICAgICAgJGNhdGVnb3J5LT5zYXZlKCk7CgogICAgICAgICAgICAkY2F0ZWdvcnktPnVwZGF0ZSgkaW5wdXRzKTsKCiAgICAgICAgICAgICRjYXRlZ29yeS0+ZGVwYXJ0bWVudCgpLT5zeW5jKCRkZXBhcnRtZW50cyk7CgogICAgICAgICAgICByZXR1cm4gJHRoaXMtPnVybFJlZGlyZWN0QmFjaygnU3ViIENhdGVnb3J5IHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5JywgdXJsKCdwbXMvcHJvZHVjdC1tYW5hZ2VtZW50L3N1Yi1jYXRlZ29yeScpLCAnc3VjY2VzcycpOwoKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIHNwZWNpZmllZCByZXNvdXJjZSBmcm9tIHN0b3JhZ2UuCiAgICAgKgogICAgICogQHBhcmFtICBpbnQgICRpZAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBkZXN0cm95KCRjYXRlZ29yeV9pZCkKICAgIHsKICAgICAgICB0cnkgewoKICAgICAgICAgICAgJGNhdGVnb3J5ID0gQ2F0ZWdvcnk6OmZpbmRPckZhaWwoJGNhdGVnb3J5X2lkKTsKCiAgICAgICAgICAgIGlmICgkY2F0ZWdvcnktPnByb2R1Y3RzLT5jb3VudCgpID4gMCB8fCAkY2F0ZWdvcnktPnN1YkNhdGVnb3J5LT5jb3VudCgpID4gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJ1N1YkNhdGVnb3J5IGNhbiBub3QgYmUgZGVsZXRlZC4nCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGNhdGVnb3J5LT5zdWJDYXRlZ29yeS0+ZWFjaC0+ZGVsZXRlKCk7CiAgICAgICAgICAgIENhdGVnb3J5RGVwYXJ0bWVudDo6d2hlcmUoJ2NhdGVnb3J5X2lkJywgJGNhdGVnb3J5LT5pZCktPmRlbGV0ZSgpOwogICAgICAgICAgICAkY2F0ZWdvcnktPmRlbGV0ZSgpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAnU3ViQ2F0ZWdvcnkgU3VjY2Vzc2Z1bGx5IERlbGV0ZWQuJwogICAgICAgICAgICBdKTsKCiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9CgoKICAgIHB1YmxpYyBmdW5jdGlvbiBpbXBvcnRDYXRlZ29yeShSZXF1ZXN0ICRyZXF1ZXN0KXsKCiAgICAgICAgJHRoaXMtPnZhbGlkYXRlKCRyZXF1ZXN0LCBbCiAgICAgICAgICAgICdjYXRlZ29yeV9maWxlJyA9PiAncmVxdWlyZWR8bWltZXM6eGxzLHhsc3gnCiAgICAgICAgXSk7CgogICAgICAgICRwYXRoID0gJHJlcXVlc3QtPmZpbGUoJ2NhdGVnb3J5X2ZpbGUnKS0+Z2V0UmVhbFBhdGgoKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgRXhjZWw6OmltcG9ydChuZXcgQ2F0ZWdvcnlJbXBvcnQoKSwgJHBhdGgpOwoKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFN1Y2Nlc3MoJ0NhdGVnb3J5IERhdGEgSW1wb3J0ZWQgc3VjY2Vzc2Z1bGx5LicpOwoKICAgICAgICB9Y2F0Y2ggKFxNYWF0d2Vic2l0ZVxFeGNlbFxWYWxpZGF0b3JzXFZhbGlkYXRpb25FeGNlcHRpb24gJGUpIHsKCiAgICAgICAgICAgICRlcnJvck1lc3NhZ2U9Jyc7CiAgICAgICAgICAgICRyb3dOdW1iZXI9MTsKICAgICAgICAgICAgJHJvd051bWJlcis9JGUtPmZhaWx1cmVzKClbMF0tPnJvdygpOwogICAgICAgICAgICAkY29sdW1uPSRlLT5mYWlsdXJlcygpWzBdLT5hdHRyaWJ1dGUoKTsKCiAgICAgICAgICAgICRlcnJvck1lc3NhZ2UuPSRlLT5mYWlsdXJlcygpWzBdLT5lcnJvcnMoKVswXS4nIGZvciByb3cgJy4kcm93TnVtYmVyLicgb24gQ29sdW1uICcuJGNvbHVtbjsKCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkZXJyb3JNZXNzYWdlKTsKICAgICAgICB9CiAgICB9Cn0K