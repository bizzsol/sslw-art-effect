<?php
bolt_decrypt( __FILE__ , '2O5wdo'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xJbnZlbnRvcnlNb2RlbHNcSW52ZW50b3J5QWN0aW9uQ29udHJvbDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFByb2R1Y3Q7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xXYXJlaG91c2VzOwp1c2UgSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3Q7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlckl0ZW07CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xHcm5cR29vZHNSZWNlaXZlZE5vdGU7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xHcm5cR29vZHNSZWNlaXZlZEl0ZW07CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xHcm5cR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VSZXR1cm47CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVJldHVybkdhdGVPdXQ7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyUmVxdWlzaXRpb247CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZXF1aXNpdGlvbkl0ZW07CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZXF1aXNpdGlvblRyYWNraW5nOwp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcTWFpbDsKdXNlIERCLCBBdXRoLCBEYXRhVGFibGVzOwoKY2xhc3MgU2VydmljZUNvbmZpcm1hdGlvbkNvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyCnsKICAgIHB1YmxpYyBmdW5jdGlvbiBoZWFkZXJDb2x1bW5zKCR2YWx1ZT0nJykKICAgIHsKICAgICAgICByZXR1cm4gJGFycmF5ID0gYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnXSwgCiAgICAgICAgICAgIFsnYXBwcm92YWxfZGF0ZScsICdhcHByb3ZhbF9kYXRlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsncmVmZXJlbmNlX25vJywgJ3JlZmVyZW5jZV9ubycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3N1cHBsaWVyJywgJ3N1cHBsaWVyJywgJ3RleHQtY2VudGVyJ10sIAogICAgICAgICAgICBbJ3F1b3RhdGlvbl9yZWZfbm8nLCAncXVvdGF0aW9uX3JlZl9ubycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3NlcnZpY2VzJywgJ3NlcnZpY2VzJ10sCiAgICAgICAgICAgIC8vIFsndG90YWxfcHJpY2UnLCAndG90YWxfcHJpY2UnLCAndGV4dC1yaWdodCddLCAKICAgICAgICAgICAgLy8gWyd2YXQnLCAndmF0JywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgLy8gWydncm9zc19wcmljZScsICdncm9zc19wcmljZScsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsnYWN0aW9ucycsICdhY3Rpb25zJywgJ3RleHQtY2VudGVyJywnd2lkdGg6MTUlJ10KICAgICAgICApOwogICAgfQoKICAgIC8qKgogICAgICogRGlzcGxheSBhIGxpc3Rpbmcgb2YgdGhlIHJlc291cmNlLgogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5kZXgoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkdGl0bGUgPSAnU2VydmljZSBDb25maXJtYXRpb24nOwogICAgICAgICAgICAkcHVyY2hhc2VPcmRlcnMgPSBQdXJjaGFzZU9yZGVyOjp3aXRoKFsKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVySXRlbXMucmVsUHJvZHVjdCcsCiAgICAgICAgICAgICAgICAncmVsR29vZFJlY2VpdmVOb3RlLnJlbEdvb2RzUmVjZWl2ZWRJdGVtcycKICAgICAgICAgICAgXSkKCiAgICAgICAgICAgIC0+d2hlbighYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0dhdGUgUGVybWlzc2lvbicpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlbihhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnRGVwYXJ0bWVudC1IZWFkJykgJiYgIWF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdTdG9yZS1NYW5hZ2VyJyksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3B1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdocl9kZXBhcnRtZW50X2lkJywgYXV0aCgpLT51c2VyKCktPnByaW9yaXRpZXMtPnBsdWNrKCdocl9kZXBhcnRtZW50X2lkJyktPnRvQXJyYXkoKSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCFhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnRGVwYXJ0bWVudC1IZWFkJykgfHwgYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ1N0b3JlLU1hbmFnZXInKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl9kZXBhcnRtZW50X2lkJywgMCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdHYXRlIFBlcm1pc3Npb24nKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2hyX3VuaXRfaWQnLCBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX3VuaXRfaWQnKS0+dG9BcnJheSgpKTsKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbicsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZU5vdEluKCd0eXBlJyxbJ2RpcmVjdC1wdXJjaGFzZSddKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZUhhcygncHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbi5yZXF1aXNpdGlvbkl0ZW1zLnByb2R1Y3QnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX3NlcnZpY2UnLCAxKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZUluKCdpc19zZW5kJyxbJ3llcyddKQogICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgJGlkcyA9IFtdOwogICAgICAgICAgICBpZigkcHVyY2hhc2VPcmRlcnMtPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgIGZvcmVhY2goJHB1cmNoYXNlT3JkZXJzIGFzICRrZXkgPT4gJHB1cmNoYXNlT3JkZXIpewogICAgICAgICAgICAgICAgICAgIGlmKCRwdXJjaGFzZU9yZGVyLT5yZWxQdXJjaGFzZU9yZGVySXRlbXMtPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCgkcHVyY2hhc2VPcmRlci0+cmVsUHVyY2hhc2VPcmRlckl0ZW1zIGFzICRrZXkgPT4gJGl0ZW0pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGl0ZW0tPnJlbFByb2R1Y3QtPmlzX3NlcnZpY2UgPT0gMSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlY2VpdmVkX3F0eSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHB1cmNoYXNlT3JkZXItPnJlbEdvb2RSZWNlaXZlTm90ZS0+Y291bnQoKSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRwdXJjaGFzZU9yZGVyLT5yZWxHb29kUmVjZWl2ZU5vdGUgYXMgJGtleSA9PiAkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZWNlaXZlZF9xdHkgKz0gJGdybi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT53aGVyZSgncHJvZHVjdF9pZCcsICRpdGVtLT5wcm9kdWN0X2lkKS0+c3VtKCdyZWNlaXZlZF9xdHknKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGl0ZW0tPnF0eSA+ICRyZWNlaXZlZF9xdHkgJiYgIWluX2FycmF5KCRwdXJjaGFzZU9yZGVyLT5pZCwgJGlkcykpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRpZHMsICRwdXJjaGFzZU9yZGVyLT5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAkcHVyY2hhc2VPcmRlcnMgPSBQdXJjaGFzZU9yZGVyOjp3aGVyZUluKCdpZCcsICRpZHMpCiAgICAgICAgICAgIC0+d2l0aChbCiAgICAgICAgICAgICAgICAncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsCiAgICAgICAgICAgICAgICAncmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScsCiAgICAgICAgICAgICAgICAncmVsUG9BdHRhY2htZW50JywKICAgICAgICAgICAgICAgICdyZWxTdXBwbGllclBheW1lbnRzJywKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVySXRlbXMucmVsUHJvZHVjdC5hdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnLAogICAgICAgICAgICAgICAgJ3JlbEdvb2RSZWNlaXZlTm90ZS5yZWxHb29kc1JlY2VpdmVkSXRlbXMnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlbighZGF0YXRhYmxlT3JkZXJpbmcoKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ2lkJywgJ2Rlc2MnKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhVGFibGVzOjpvZigkcHVyY2hhc2VPcmRlcnMpCiAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhcHByb3ZhbF9kYXRlJywgZnVuY3Rpb24oJHBvKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLHN0cnRvdGltZSgkcG8tPnBvX2RhdGUpKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignYXBwcm92YWxfZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncG9fZGF0ZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignYXBwcm92YWxfZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3BvX2RhdGUnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmVmZXJlbmNlX25vJywgZnVuY3Rpb24oJHBvKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIG9uY2xpY2s9InB1cmNoYXNlT3JkZXJEZXRhaWxzKCQodGhpcykpIiBjbGFzcz0iYnRuIGJ0bi1saW5rIiBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsJHBvLT5pZCkuJyI+Jy4kcG8tPnJlZmVyZW5jZV9uby4nPC9hPic7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24oJHBvKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIGlzc2V0KCRwby0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMpID8gKGlzc2V0KCRwby0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPm5hbWUpID8gJHBvLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+bmFtZS4nICgnLiRwby0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPmNvZGUuJyknIDogJycpIDogJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPm9yV2hlcmUoJ2NvZGUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUXVvdGF0aW9uczo6c2VsZWN0KCdzdXBwbGllcnMubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignc3VwcGxpZXJzJywgJ3N1cHBsaWVycy5pZCcsICc9JywgJ3F1b3RhdGlvbnMuc3VwcGxpZXJfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdxdW90YXRpb25zLmlkJywgJ3B1cmNoYXNlX29yZGVycy5xdW90YXRpb25faWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdxdW90YXRpb25fcmVmX25vJywgZnVuY3Rpb24oJHBvKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHBvLT5yZWxRdW90YXRpb24tPnJlZmVyZW5jZV9ubyk/JHBvLT5yZWxRdW90YXRpb24tPnJlZmVyZW5jZV9ubzonJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncXVvdGF0aW9uX3JlZl9ubycsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3F1b3RhdGlvbl9yZWZfbm8nLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBRdW90YXRpb25zOjpzZWxlY3QoJ3F1b3RhdGlvbnMucmVmZXJlbmNlX25vJykKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncXVvdGF0aW9ucy5pZCcsICdwdXJjaGFzZV9vcmRlcnMucXVvdGF0aW9uX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignc2VydmljZXMnLCBmdW5jdGlvbigkcG8pewogICAgICAgICAgICAgICAgICAgICRzZXJ2aWNlcyA9ICcnOwogICAgICAgICAgICAgICAgICAgICRjb3VudCA9IDA7CiAgICAgICAgICAgICAgICAgICAgaWYoJHBvLT5yZWxQdXJjaGFzZU9yZGVySXRlbXMtPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCgkcG8tPnJlbFB1cmNoYXNlT3JkZXJJdGVtcyBhcyAka2V5ID0+ICRpdGVtKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRpdGVtLT5yZWxQcm9kdWN0LT5pc19zZXJ2aWNlID09IDEpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb3VudCsrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzZXJ2aWNlcyAuPSAoJGNvdW50ID4gMSA/ICcsICcgOiAnJykuJGl0ZW0tPnJlbFByb2R1Y3QtPm5hbWUuJyAnLmdldFByb2R1Y3RBdHRyaWJ1dGVzRmFzdGVyKCRpdGVtLT5yZWxQcm9kdWN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzZXJ2aWNlczsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignc2VydmljZXMnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVySXRlbXMucmVsUHJvZHVjdCcsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRrZXl3b3JkKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcldoZXJlKGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRrZXl3b3JkKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXJJdGVtcy5yZWxQcm9kdWN0LmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgLT5vcldoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVySXRlbXMucmVsUHJvZHVjdC5hdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdzZXJ2aWNlcycsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFB1cmNoYXNlT3JkZXJJdGVtOjpzZWxlY3QoJ3Byb2R1Y3RzLm5hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ3Byb2R1Y3RzJywgJ3Byb2R1Y3RzLmlkJywgJz0nLCAncHVyY2hhc2Vfb3JkZXJfaXRlbXMucHJvZHVjdF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3B1cmNoYXNlX29yZGVyX2l0ZW1zLmlkJywgJ3B1cmNoYXNlX29yZGVycy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLy8gLT5lZGl0Q29sdW1uKCd0b3RhbF9wcmljZScsIGZ1bmN0aW9uKCRwbyl7CiAgICAgICAgICAgICAgICAvLyAgICAgcmV0dXJuICgoaXNzZXQoJHBvLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPnN5bWJvbCk/JHBvLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPnN5bWJvbDonJykuJyAnLnN5c3RlbU1vbmV5Rm9ybWF0KCRwby0+dG90YWxfcHJpY2UpKTsKICAgICAgICAgICAgICAgIC8vIH0pCiAgICAgICAgICAgICAgICAvLyAtPmVkaXRDb2x1bW4oJ3ZhdCcsIGZ1bmN0aW9uKCRwbyl7CiAgICAgICAgICAgICAgICAvLyAgICAgcmV0dXJuICgoaXNzZXQoJHBvLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPnN5bWJvbCk/JHBvLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPnN5bWJvbDonJykuJyAnLnN5c3RlbU1vbmV5Rm9ybWF0KCRwby0+dmF0KSk7CiAgICAgICAgICAgICAgICAvLyB9KQogICAgICAgICAgICAgICAgLy8gLT5lZGl0Q29sdW1uKCdncm9zc19wcmljZScsIGZ1bmN0aW9uKCRwbyl7CiAgICAgICAgICAgICAgICAvLyAgICAgcmV0dXJuICgoaXNzZXQoJHBvLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPnN5bWJvbCk/JHBvLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPnN5bWJvbDonJykgLicgJy5zeXN0ZW1Nb25leUZvcm1hdCgkcG8tPmdyb3NzX3ByaWNlKSk7CiAgICAgICAgICAgICAgICAvLyB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbigkcG8pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9IicudXJsKCdwbXMvZ3JuL3NlcnZpY2UtY29uZmlybWF0aW9uLycuJHBvLT5pZCkuJyIgIHRpdGxlPSJTZXJ2aWNlIENvbmZpcm1hdGlvbiIgY2xhc3M9ImJ0biBidG4teHMgYnRuLXN1Y2Nlc3MgbS0xIj48aSBjbGFzcz0ibGFzIGxhLWNoZWNrIj48L2k+Jm5ic3A7Q29uZmlybTwvYT4nOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ3JlZmVyZW5jZV9ubycsJ3N1cHBsaWVyJywndG90YWxfcHJpY2UnLCd2YXQnLCdncm9zc19wcmljZScsICdhY3Rpb25zJ10pCiAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5zZXJ2aWNlLmluZGV4JywgWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAkdGl0bGUsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPmhlYWRlckNvbHVtbnMoKQogICAgICAgICAgICBdKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHNob3coJGlkKQogICAgewogICAgICAgIHRyeXsKICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXIgPSBQdXJjaGFzZU9yZGVyOjp3aXRoKFsKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywKICAgICAgICAgICAgICAgICdyZWxHb29kUmVjZWl2ZU5vdGUnLAogICAgICAgICAgICAgICAgJ3JlbFF1b3RhdGlvbi5leGNoYW5nZVJhdGUuY3VycmVuY3knLAogICAgICAgICAgICAgICAgJ3JlbFBvQXR0YWNobWVudCcsCiAgICAgICAgICAgICAgICAncmVsU3VwcGxpZXJQYXltZW50cycKICAgICAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVyZUhhcygncmVsUXVvdGF0aW9uJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlTm90SW4oJ3R5cGUnLFsnZGlyZWN0LXB1cmNoYXNlJ10pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlSGFzKCdwdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zLnJlcXVpc2l0aW9uLnJlcXVpc2l0aW9uSXRlbXMucHJvZHVjdCcsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaXNfc2VydmljZScsIDEpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlSW4oJ2lzX3NlbmQnLFsneWVzJ10pCiAgICAgICAgICAgIC0+d2hlcmUoJ2lkJywgJGlkKQogICAgICAgICAgICAtPmZpcnN0KCk7CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuc2VydmljZS5jb25maXJtYXRpb24nLCBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICdTZXJ2aWNlIENvbmZpcm1hdGlvbiBmb3IgIycuJHB1cmNoYXNlT3JkZXItPnJlZmVyZW5jZV9ubywKICAgICAgICAgICAgICAgICdwdXJjaGFzZU9yZGVyJyA9PiAkcHVyY2hhc2VPcmRlciwKICAgICAgICAgICAgXSk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiB1cGRhdGUoUmVxdWVzdCAkcmVxdWVzdCwgJHB1cmNoYXNlX29yZGVyX2lkKQogICAgewogICAgICAgICRyZXF1ZXN0LT52YWxpZGF0ZShbCiAgICAgICAgICAgICdkYXRlJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAncmVjZWl2ZWRfcXR5JyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAncmVjZWl2ZWRfcXR5LionID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgIC8vICdjaGFsbGFuJyA9PiAncmVxdWlyZWQnLAogICAgICAgIF0pOwoKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeXsKICAgICAgICAgICAgaWYoYXJyYXlfc3VtKGFycmF5X3ZhbHVlcygkcmVxdWVzdC0+cmVjZWl2ZWRfcXR5KSkgPD0gMCl7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiUGxlYXNlIGVudGVyIHNvbWUgcXVhbnRpdHkgb2Ygc2VydmljZSBmb3IgY29uZmlybWF0aW9uLiIKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkcHVyY2hhc2VPcmRlciA9IFB1cmNoYXNlT3JkZXI6OndoZXJlSGFzKCdyZWxRdW90YXRpb24nLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVOb3RJbigndHlwZScsWydkaXJlY3QtcHVyY2hhc2UnXSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3B1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMucmVxdWlzaXRpb24ucmVxdWlzaXRpb25JdGVtcy5wcm9kdWN0JywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19zZXJ2aWNlJywgMSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmUoJ2lzX3NlbmQnLCAneWVzJykKICAgICAgICAgICAgLT53aGVyZSgnaWQnLCAkcHVyY2hhc2Vfb3JkZXJfaWQpCiAgICAgICAgICAgIC0+Zmlyc3QoKTsKCiAgICAgICAgICAgICRzdG9ja0lucyA9IFtdOwoKICAgICAgICAgICAgJHRvdGFsX3ByaWNlID0gMDsKICAgICAgICAgICAgJHRvdGFsX3ZhdCA9IDA7CiAgICAgICAgICAgIGlmKCRwdXJjaGFzZU9yZGVyLT5yZWxQdXJjaGFzZU9yZGVySXRlbXMtPndoZXJlSW4oJ2lkJywgYXJyYXlfa2V5cygkcmVxdWVzdC0+cmVjZWl2ZWRfcXR5KSktPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgIGZvcmVhY2goJHB1cmNoYXNlT3JkZXItPnJlbFB1cmNoYXNlT3JkZXJJdGVtcy0+d2hlcmVJbignaWQnLCBhcnJheV9rZXlzKCRyZXF1ZXN0LT5yZWNlaXZlZF9xdHkpKSBhcyAka2V5ID0+ICRpdGVtKXsKICAgICAgICAgICAgICAgICAgICBpZihpc3NldCgkcmVxdWVzdC0+cmVjZWl2ZWRfcXR5WyRpdGVtLT5pZF0pICYmICRyZXF1ZXN0LT5yZWNlaXZlZF9xdHlbJGl0ZW0tPmlkXSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAkcHJpY2UgPSAkaXRlbS0+dW5pdF9wcmljZSokcmVxdWVzdC0+cmVjZWl2ZWRfcXR5WyRpdGVtLT5pZF07CiAgICAgICAgICAgICAgICAgICAgICAgICR0b3RhbF9wcmljZSArPSAkcHJpY2U7CiAgICAgICAgICAgICAgICAgICAgICAgICR0b3RhbF92YXQgKz0gKCRpdGVtLT52YXRfcGVyY2VudGFnZSA+IDAgJiYgJHByaWNlID4gMCA/ICgkcHJpY2UqKCRpdGVtLT52YXRfcGVyY2VudGFnZS8xMDApKSA6IDApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gJGNoYWxsYW5GaWxlID0gJyc7CiAgICAgICAgICAgIC8vIGlmICgkcmVxdWVzdC0+aGFzRmlsZSgnY2hhbGxhbl9maWxlJykpewogICAgICAgICAgICAvLyAgICAgJGNoYWxsYW5GaWxlID0gJHRoaXMtPmZpbGVVcGxvYWQoJHJlcXVlc3QtPmZpbGUoJ2NoYWxsYW5fZmlsZScpLCAndXBsb2FkL2dybi9jaGFsbGFuLWZpbGUnKTsKICAgICAgICAgICAgLy8gfQoKICAgICAgICAgICAgJGdvb2RzUmVjZWl2ZWROb3RlID0gR29vZHNSZWNlaXZlZE5vdGU6OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICRwdXJjaGFzZU9yZGVyLT5pZCwKICAgICAgICAgICAgICAgICdyZWZlcmVuY2Vfbm8nID0+IHVuaXF1ZUNvZGUoMjAsICgnR0FURS1JTi0nLmRhdGUoJ3knLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmRhdGUpKS4nLScuJHB1cmNoYXNlT3JkZXItPlVuaXQtPmhyX3VuaXRfc2hvcnRfbmFtZS4nLScpLCAnZ29vZHNfcmVjZWl2ZWRfbm90ZXMnLCAnaWQnKSwKICAgICAgICAgICAgICAgICdncm5fcmVmZXJlbmNlX25vJyA9PiB1bmlxdWVDb2RlKDE2LCAoJ0dSTi0nLmRhdGUoJ3knLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmRhdGUpKS4nLU1CTS0nKSwnZ29vZHNfcmVjZWl2ZWRfbm90ZXMnLCAnaWQnKSwKICAgICAgICAgICAgICAgICdjaGFsbGFuJyA9PiAnc2VydmljZS1jb25maXJtYXRpb24nLAogICAgICAgICAgICAgICAgJ2NoYWxsYW5fZmlsZScgPT4gJycsCiAgICAgICAgICAgICAgICAndG90YWxfcHJpY2UnID0+ICR0b3RhbF9wcmljZSwKICAgICAgICAgICAgICAgICdkaXNjb3VudCcgPT4gMCwKICAgICAgICAgICAgICAgICd2YXQnID0+ICR0b3RhbF92YXQsCiAgICAgICAgICAgICAgICAnZ3Jvc3NfcHJpY2UnID0+ICR0b3RhbF9wcmljZSskdG90YWxfdmF0LAogICAgICAgICAgICAgICAgJ3JlY2VpdmVkX2RhdGUnID0+IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1ZXN0LT5kYXRlKSksCiAgICAgICAgICAgICAgICAnZGVsaXZlcnlfYnknID0+IGF1dGgoKS0+dXNlcigpLT5pZCwKICAgICAgICAgICAgICAgICdyZWNlaXZlX2J5JyA9PiBhdXRoKCktPnVzZXIoKS0+aWQsCiAgICAgICAgICAgICAgICAnbm90ZSAnID0+ICRyZXF1ZXN0LT5ub3RlLAogICAgICAgICAgICAgICAgJ2NyZWF0ZWRfYnknID0+IGF1dGgoKS0+dXNlcigpLT5pZCwKICAgICAgICAgICAgICAgICdyZWNlaXZlZF9zdGF0dXMnID0+ICdmdWxsJwogICAgICAgICAgICBdKTsKCiAgICAgICAgICAgIGlmKCRwdXJjaGFzZU9yZGVyLT5yZWxQdXJjaGFzZU9yZGVySXRlbXMtPndoZXJlSW4oJ2lkJywgYXJyYXlfa2V5cygkcmVxdWVzdC0+cmVjZWl2ZWRfcXR5KSktPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgIGZvcmVhY2goJHB1cmNoYXNlT3JkZXItPnJlbFB1cmNoYXNlT3JkZXJJdGVtcy0+d2hlcmVJbignaWQnLCBhcnJheV9rZXlzKCRyZXF1ZXN0LT5yZWNlaXZlZF9xdHkpKSBhcyAka2V5ID0+ICRpdGVtKXsKICAgICAgICAgICAgICAgICAgICAkcXR5ID0gaXNzZXQoJHJlcXVlc3QtPnJlY2VpdmVkX3F0eVskaXRlbS0+aWRdKSA/ICRyZXF1ZXN0LT5yZWNlaXZlZF9xdHlbJGl0ZW0tPmlkXSA6IDA7CiAgICAgICAgICAgICAgICAgICAgJHN1Yl90b3RhbCA9ICRpdGVtLT51bml0X3ByaWNlKiRxdHk7CiAgICAgICAgICAgICAgICAgICAgJHZhdCA9ICgkaXRlbS0+dmF0X3BlcmNlbnRhZ2UgPiAwICYmICRzdWJfdG90YWwgPiAwID8gKCRzdWJfdG90YWwqKCRpdGVtLT52YXRfcGVyY2VudGFnZS8xMDApKSA6IDApOwogICAgICAgICAgICAgICAgICAgICRnb29kc1JlY2VpdmVkSXRlbSA9IEdvb2RzUmVjZWl2ZWRJdGVtOjpjcmVhdGUoWwogICAgICAgICAgICAgICAgICAgICAgICAnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcgPT4gJGdvb2RzUmVjZWl2ZWROb3RlLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ3Byb2R1Y3RfaWQnID0+ICRpdGVtLT5wcm9kdWN0X2lkLAogICAgICAgICAgICAgICAgICAgICAgICAndW5pdF9hbW91bnQnID0+ICRpdGVtLT51bml0X3ByaWNlLAogICAgICAgICAgICAgICAgICAgICAgICAncXR5JyA9PiAkcXR5LAogICAgICAgICAgICAgICAgICAgICAgICAnc3ViX3RvdGFsJyA9PiAkc3ViX3RvdGFsLAogICAgICAgICAgICAgICAgICAgICAgICAnZGlzY291bnRfcGVyY2VudGFnZScgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc2NvdW50JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAndmF0X3BlcmNlbnRhZ2UnID0+ICRpdGVtLT52YXRfcGVyY2VudGFnZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhdCcgPT4gJHZhdCwKICAgICAgICAgICAgICAgICAgICAgICAgJ3RvdGFsX2Ftb3VudCcgPT4gJHN1Yl90b3RhbCskdmF0LAogICAgICAgICAgICAgICAgICAgICAgICAncXVhbGl0eV9lbnN1cmUnID0+ICdhcHByb3ZlZCcsCiAgICAgICAgICAgICAgICAgICAgICAgICdyZWNlaXZlZF9xdHknID0+ICRxdHksCiAgICAgICAgICAgICAgICAgICAgICAgICd1cGRhdGVkX2F0JyA9PiBkYXRlKCdZLW0tZCBIOmk6cycpLAogICAgICAgICAgICAgICAgICAgICAgICAndXBkYXRlZF9ieScgPT4gYXV0aCgpLT51c2VyKCktPmlkCiAgICAgICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgICAgICRzdG9ja0luID0gR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luOjpjcmVhdGUoWwogICAgICAgICAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICRwdXJjaGFzZU9yZGVyLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2dvb2RzX3JlY2VpdmVkX2l0ZW1faWQnID0+ICRnb29kc1JlY2VpdmVkSXRlbS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdyZWZlcmVuY2Vfbm8nID0+IHVuaXF1ZUNvZGUoMTgsICgnUUUtQVAtJy5kYXRlKCd5Jywgc3RydG90aW1lKCRyZXF1ZXN0LT5kYXRlKSkuJy0nLihhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPnVuaXQtPmhyX3VuaXRfc2hvcnRfbmFtZSkuJy0nKSwgJ2dvb2RzX3JlY2VpdmVkX2l0ZW1zX3N0b2NrX2luJywgJ2lkJyksCiAgICAgICAgICAgICAgICAgICAgICAgICd1bml0X2Ftb3VudCcgPT4gJGl0ZW0tPnVuaXRfcHJpY2UsCiAgICAgICAgICAgICAgICAgICAgICAgICdyZWNlaXZlZF9xdHknID0+ICRxdHksCiAgICAgICAgICAgICAgICAgICAgICAgICdzdWJfdG90YWwnID0+ICRzdWJfdG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgICdkaXNjb3VudF9wZXJjZW50YWdlJyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAnZGlzY291bnQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICd2YXRfcGVyY2VudGFnZScgPT4gJGl0ZW0tPnZhdF9wZXJjZW50YWdlLAogICAgICAgICAgICAgICAgICAgICAgICAndmF0JyA9PiAkdmF0LAogICAgICAgICAgICAgICAgICAgICAgICAndG90YWxfYW1vdW50JyA9PiAkc3ViX3RvdGFsKyR2YXQsCiAgICAgICAgICAgICAgICAgICAgICAgICdpc19ncm5fY29tcGxldGUnID0+ICd5ZXMnLAogICAgICAgICAgICAgICAgICAgICAgICAnd2FyZWhvdXNlX2lkJyA9PiBhdXRoKCktPnVzZXIoKS0+cmVsVXNlcnNXYXJlaG91c2UtPnBsdWNrKCdpZCcpLT50b0FycmF5KClbMF0sCiAgICAgICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJHN0b2NrSW5zLCAkc3RvY2tJbi0+aWQpOwoKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+dXBkYXRlUUNRdWFudGl0eSgkZ29vZHNSZWNlaXZlZEl0ZW0tPmlkLCAkcXR5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGVudHJ5ID0gJHRoaXMtPnJ1bkxlZGdlclF1ZXJpZXMoJHN0b2NrSW5zLCAkZ29vZHNSZWNlaXZlZE5vdGUsICRyZXF1ZXN0LT5kYXRlKTsKICAgICAgICAgICAgaWYoJGVudHJ5WydzdWNjZXNzJ10pewogICAgICAgICAgICAgICAgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXJFbnRyeTo6dXBkYXRlT3JDcmVhdGUoWwogICAgICAgICAgICAgICAgICAgICdzdXBwbGllcl9pZCcgPT4gJHB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+c3VwcGxpZXJfaWQsCiAgICAgICAgICAgICAgICAgICAgJ3B1cmNoYXNlX29yZGVyX2lkJyA9PiAkcHVyY2hhc2VPcmRlci0+aWQsCiAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdncm4nLAogICAgICAgICAgICAgICAgICAgICdlbnRyeV9pZCcgPT4gJGVudHJ5WydlbnRyeSddLT5pZCwKICAgICAgICAgICAgICAgIF0sWwogICAgICAgICAgICAgICAgICAgICd1cGRhdGVkX2F0JyA9PiBkYXRlKCdZLW0tZCBIOmk6cycpCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoaXNzZXQoJHN0b2NrSW5zWzBdKSl7CiAgICAgICAgICAgICAgICAkcHJvamVjdCA9IGlzc2V0KCRnb29kc1JlY2VpdmVkTm90ZS0+cmVsUHVyY2hhc2VPcmRlci0+cHVyY2hhc2VPcmRlclJlcXVpc2l0aW9uc1swXS0+cmVxdWlzaXRpb24tPnByb2plY3RUYXNrLT5pZCk7CiAgICAgICAgICAgICAgICBmb3JlYWNoKCRzdG9ja0lucyBhcyAka2V5ID0+ICRzdG9ja19pbl9pZCl7CiAgICAgICAgICAgICAgICAgICAgJHN0b2NrSW4gPSBHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW46OndoZXJlKCdpZCcsICRzdG9ja19pbl9pZCktPndoZXJlKCdpc19ncm5fY29tcGxldGUnLCAneWVzJyktPmZpcnN0KCk7CiAgICAgICAgICAgICAgICAgICAgJGNhcGl0YWxpemUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGlmKCRwcm9qZWN0KXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+Y2F0ZWdvcnktPmlzX2N3aXAgPT0gMSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2FwaXRhbGl6ZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRzdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmNhdGVnb3J5LT5pc19maXhlZF9hc3NldCA9PSAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjYXBpdGFsaXplID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmKCRjYXBpdGFsaXplICYmICRzdG9ja0luLT5yZWNlaXZlZF9xdHkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgJGJhdGNoID0gRml4ZWRBc3NldEJhdGNoOjpjcmVhdGUoWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2dvb2RzX3JlY2VpdmVkX2l0ZW1zX3N0b2NrX2luX2lkJyA9PiAkc3RvY2tJbi0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYmF0Y2gnID0+IHVuaXF1ZUNvZGVXaXRob3V0UHJlZml4KDgsICdmaXhlZF9hc3NldF9iYXRjaGVzJywgJ2JhdGNoJyksCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RlcHJlY2lhdGlvbl9tZXRob2RfaWQnID0+ICRzdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmRlcHJlY2lhdGlvbl9tZXRob2RfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYmFzZV9yYXRlJyA9PiAkc3RvY2tJbi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5iYXNlX3JhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmF0ZV9tdWx0aXBsaWVyJyA9PiAkc3RvY2tJbi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5yYXRlX211bHRpcGxpZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGVwcmVjaWF0aW9uX3JhdGUnID0+ICRzdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmRlcHJlY2lhdGlvbl9yYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2lzX3llYXJseScgPT4gJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+aXNfeWVhcmx5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3llYXJzJyA9PiAkc3RvY2tJbi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT55ZWFycywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpc19vbmV0aW1lJyA9PiAkc3RvY2tJbi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5pc19vbmV0aW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RlcHJlY2lhdGlvbl9zdGFydF9kYXRlJyA9PiBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkc3RvY2tJbi0+dXBkYXRlZF9hdCkpLAogICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGJhdGNoKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcigkaT0xOyRpPD0kc3RvY2tJbi0+cmVjZWl2ZWRfcXR5OyRpKyspewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpeGVkQXNzZXRCYXRjaEl0ZW06OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdmaXhlZF9hc3NldF9iYXRjaF9pZCcgPT4gJGJhdGNoLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Fzc2V0X2NvZGUnID0+ICRiYXRjaC0+YmF0Y2guJy0nLiRpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgoKICAgICAgICAgICAgaWYoJHB1cmNoYXNlT3JkZXItPnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMtPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgIGZvcmVhY2goJHB1cmNoYXNlT3JkZXItPnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMgYXMgJGtleSA9PiAkcHVyY2hhc2VPcmRlclJlcXVpc2l0aW9uKXsKICAgICAgICAgICAgICAgICAgICBSZXF1aXNpdGlvblRyYWNraW5nOjpzdG9yZVJlcXVpc2l0aW9uVHJhY2tpbmcoJHB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbi0+cmVxdWlzaXRpb25faWQsICdkZWxpdmVyZWQnKTsKICAgICAgICAgICAgICAgICAgICBSZXF1aXNpdGlvblRyYWNraW5nOjpzdG9yZVJlcXVpc2l0aW9uVHJhY2tpbmcoJHB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbi0+cmVxdWlzaXRpb25faWQsICdyZWNlaXZlZCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CiAgICAgICAgICAgIHNlc3Npb24oKS0+Zmxhc2goJ2FsZXJ0LXR5cGUnLCAnc3VjY2VzcycpOwogICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdtZXNzYWdlJywgJ1NlcnZpY2UgaGFzIGJlZW4gY29uZmlybWVkIHN1Y2Nlc3NmdWxseS4nKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgICAgICAnc3VwcGxpZXJfaWQnID0+ICRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnN1cHBsaWVyX2lkLAogICAgICAgICAgICAgICAgJ2dybl9pZCcgPT4gJGdvb2RzUmVjZWl2ZWROb3RlLT5pZAogICAgICAgICAgICBdKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHVwZGF0ZVFDUXVhbnRpdHkoJGdvb2RzX3JlY2VpdmVkX2l0ZW1faWQsICRxY19xdHkpCiAgICB7CiAgICAgICAgaWYoJHFjX3F0eSA+IDApewogICAgICAgICAgICAkYXJyYXkgPSBbXTsKCiAgICAgICAgICAgIC8vUE8gR2VuZXJhdGUgRXF1YWxseSBkaXN0cmlidXRlCiAgICAgICAgICAgICRnb29kc1JlY2VpdmVkSXRlbSA9IEdvb2RzUmVjZWl2ZWRJdGVtOjpmaW5kKCRnb29kc19yZWNlaXZlZF9pdGVtX2lkKTsKICAgICAgICAgICAgJHJlcXVpc2l0aW9uX3F0eSA9IFJlcXVpc2l0aW9uSXRlbTo6d2hlcmUoJ3Byb2R1Y3RfaWQnLCAkZ29vZHNSZWNlaXZlZEl0ZW0tPnByb2R1Y3RfaWQpCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlcXVpc2l0aW9uLnB1cmNoYXNlT3JkZXJzLnB1cmNoYXNlT3JkZXIucmVsR29vZFJlY2VpdmVOb3RlJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGdvb2RzUmVjZWl2ZWRJdGVtKXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpZCcsICRnb29kc1JlY2VpdmVkSXRlbS0+Z29vZHNfcmVjZWl2ZWRfbm90ZV9pZCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+c3VtKCdxdHknKTsKICAgICAgICAgICAgJHBlcmNlbnRhZ2UgPSAoJHJlcXVpc2l0aW9uX3F0eSA+IDAgJiYgJHFjX3F0eSA+IDAgPyAoKCRxY19xdHkvJHJlcXVpc2l0aW9uX3F0eSkqMTAwKSA6IDApOwoKICAgICAgICAgICAgLy9hcnJheV9wdXNoKCRhcnJheSwgJHBlcmNlbnRhZ2UpOwoKICAgICAgICAgICAgJHJlcXVpc2l0aW9ucyA9ICRnb29kc1JlY2VpdmVkSXRlbS0+cmVsR29vZHNSZWNlaXZlZE5vdGUtPnJlbFB1cmNoYXNlT3JkZXItPnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMtPnBsdWNrKCdyZXF1aXNpdGlvbl9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgICAgICRyZXF1aXNpdGlvbkl0ZW1zID0gUmVxdWlzaXRpb25JdGVtOjp3aGVyZUluKCdyZXF1aXNpdGlvbl9pZCcsICRyZXF1aXNpdGlvbnMpLT53aGVyZSgncHJvZHVjdF9pZCcsICRnb29kc1JlY2VpdmVkSXRlbS0+cHJvZHVjdF9pZCktPmdldCgpOwogICAgICAgICAgICBpZihpc3NldCgkcmVxdWlzaXRpb25JdGVtc1swXSkpewogICAgICAgICAgICAgICAgZm9yZWFjaCgkcmVxdWlzaXRpb25JdGVtcyBhcyAka2V5ID0+ICRyZXF1aXNpdGlvbkl0ZW0pewogICAgICAgICAgICAgICAgICAgIGlmKCRxY19xdHk+MCl7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzX3FjX3F0eSA9IHJvdW5kKCgkcGVyY2VudGFnZSA+IDAgPyAoJHJlcXVpc2l0aW9uSXRlbS0+cXR5KigkcGVyY2VudGFnZS8xMDApKSA6IDApKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXNfcWNfcXR5ID0gKCR0aGlzX3FjX3F0eSA+ICRxY19xdHkgPyAkcWNfcXR5IDogJHRoaXNfcWNfcXR5KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFycmF5X3B1c2goJGFycmF5LCBbCiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAncGVyY2VudGFnZScgPT4gJHBlcmNlbnRhZ2UsCiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAncicgPT4gJHJlcXVpc2l0aW9uSXRlbS0+cXR5LAogICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgJ3EnID0+ICR0aGlzX3FjX3F0eQogICAgICAgICAgICAgICAgICAgICAgICAvLyBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbkl0ZW0tPnFjX3F0eSA9ICR0aGlzX3FjX3F0eTsKICAgICAgICAgICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbS0+c2F2ZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgJHFjX3F0eSA9ICgkcWNfcXR5IC0gJHRoaXNfcWNfcXR5KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZigkcWNfcXR5PjApewogICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbkl0ZW0gPSBSZXF1aXNpdGlvbkl0ZW06OndoZXJlSW4oJ3JlcXVpc2l0aW9uX2lkJywgJHJlcXVpc2l0aW9ucyktPndoZXJlKCdwcm9kdWN0X2lkJywgJGdvb2RzUmVjZWl2ZWRJdGVtLT5wcm9kdWN0X2lkKS0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25JdGVtLT5xY19xdHkgPSAoJHJlcXVpc2l0aW9uSXRlbS0+cWNfcXR5K3JvdW5kKCRxY19xdHkpKTsKICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25JdGVtLT5zYXZlKCk7CgogICAgICAgICAgICAgICAgICAgIC8vIGFycmF5X3B1c2goJGFycmF5LCBbCiAgICAgICAgICAgICAgICAgICAgLy8gICAgICdwZXJjZW50YWdlJyA9PiAkcGVyY2VudGFnZSwKICAgICAgICAgICAgICAgICAgICAvLyAgICAgJ3InID0+ICRyZXF1aXNpdGlvbkl0ZW0tPnF0eSwKICAgICAgICAgICAgICAgICAgICAvLyAgICAgJ3EnID0+IHJvdW5kKCRxY19xdHkpLAogICAgICAgICAgICAgICAgICAgIC8vICAgICAnZScgPT4gdHJ1ZQogICAgICAgICAgICAgICAgICAgIC8vIF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vUE8gR2VuZXJhdGUgRXF1YWxseSBkaXN0cmlidXRlCiAgICAgICAgICAgIC8vcmV0dXJuICRhcnJheTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHJ1bkxlZGdlclF1ZXJpZXMoJGlkcywgJGdybiwgJGRhdGUpCiAgICB7CiAgICAgICAgJHN0b2NrSW5zID0gR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luOjp3aGVyZUluKCdpZCcsICRpZHMpLT53aGVyZSgnaXNfZ3JuX2NvbXBsZXRlJywgJ3llcycpLT5nZXQoKTsKICAgICAgICAkaXRlbXMgPSBbXTsKICAgICAgICAkY29zdF9jZW50cmVfaWQgPSAwOwogICAgICAgIGlmKGlzc2V0KCRzdG9ja0luc1swXSkpewogICAgICAgICAgICBmb3JlYWNoKCRzdG9ja0lucyBhcyAka2V5ID0+ICRpdGVtKXsKICAgICAgICAgICAgICAgICRjb3N0X2NlbnRyZV9pZCA9ICRpdGVtLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbEdvb2RzUmVjZWl2ZWROb3RlLT5yZWxQdXJjaGFzZU9yZGVyLT5jb3N0X2NlbnRyZV9pZDsKCiAgICAgICAgICAgICAgICAkZGViaXRfYWNjb3VudCA9IGFjY291bnREZWZhdWx0U2V0dGluZ3MoKVsnaW52ZW50b3J5X2FjY291bnQnXTsKICAgICAgICAgICAgICAgIGlmKGlzc2V0KCRpdGVtLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmlkKSl7CiAgICAgICAgICAgICAgICAgICAgaWYoJGl0ZW0tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+aXNfc2VydmljZSA9PSAxKXsKICAgICAgICAgICAgICAgICAgICAgICAgJGRlYml0X2FjY291bnQgPSBhY2NvdW50RGVmYXVsdFNldHRpbmdzKClbJ2NvZ3NfYWNjb3VudCddOwogICAgICAgICAgICAgICAgICAgICAgICBpZigkaXRlbS0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5jb2dzX2FjY291bnRfaWQgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkZWJpdF9hY2NvdW50ID0gJGl0ZW0tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+Y29nc19hY2NvdW50X2lkOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRpdGVtLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmludmVudG9yeV9hY2NvdW50X2lkID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGViaXRfYWNjb3VudCA9ICRpdGVtLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmludmVudG9yeV9hY2NvdW50X2lkOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGl0ZW1zLCBbCiAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkY29zdF9jZW50cmVfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRkZWJpdF9hY2NvdW50LAogICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gJGl0ZW0tPnRvdGFsX2Ftb3VudCwKICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdHUk4gOjogSW52ZW50b3J5IERlYml0JywKICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2dybicsCiAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJGl0ZW0tPmlkCiAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRpdGVtcywgWwogICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJGNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgIC8vICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAoaXNzZXQoJGl0ZW0tPnJlbFB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5wYXlhYmxlX2FjY291bnRfaWQpICYmICRpdGVtLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+cGF5YWJsZV9hY2NvdW50X2lkID4gMCA/ICRpdGVtLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+cGF5YWJsZV9hY2NvdW50X2lkIDogYWNjb3VudERlZmF1bHRTZXR0aW5ncygpWydzdXBwbGllcl9wYXlhYmxlX2FjY291bnQnXSksCiAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+IGFjY291bnREZWZhdWx0U2V0dGluZ3MoKVsnZ3Jpcl9hY2NvdW50J10sCiAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+ICRpdGVtLT50b3RhbF9hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0dSTiA6OiBHUi9JUiBDcmVkaXQnLAogICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnZ3JuJywKICAgICAgICAgICAgICAgICAgICAnc291cmNlJyA9PiAkaXRlbS0+aWQKICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgIC8vIGFycmF5X3B1c2goJGl0ZW1zLCBbCiAgICAgICAgICAgICAgICAvLyAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAyLAogICAgICAgICAgICAgICAgLy8gICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAoaXNzZXQoJGl0ZW0tPnJlbFB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5wYXlhYmxlX2Rpc2NvdW50X2lkKSAmJiAkaXRlbS0+cmVsUHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPnBheWFibGVfZGlzY291bnRfaWQgPiAwID8gJGl0ZW0tPnJlbFB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5wYXlhYmxlX2Rpc2NvdW50X2lkIDogYWNjb3VudERlZmF1bHRTZXR0aW5ncygpWydzdXBwbGllcl9wYXlhYmxlX2Rpc2NvdW50X2FjY291bnQnXSksCiAgICAgICAgICAgICAgICAvLyAgICAgJ2RlYml0JyA9PiAkaXRlbS0+ZGlzY291bnQsCiAgICAgICAgICAgICAgICAvLyAgICAgJ2NyZWRpdCcgPT4gMCwKICAgICAgICAgICAgICAgIC8vICAgICAnbmFycmF0aW9uJyA9PiAnR1JOIDo6IFN1cHBsaWVyIERpc2NvdW50IFBheWFibGUgRGViaXQnLAogICAgICAgICAgICAgICAgLy8gXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHNhdmVMZWRnZXJFbnRyaWVzKDUsIGRhdGUoJ1ktbS1kIEg6aTpzJywgc3RydG90aW1lKCRkYXRlLicgJy5kYXRlKCdIOmk6cycpKSksIDEsICcnLCAnR1JOJywgJGl0ZW1zLCAkZ3JuLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlX3JhdGVfaWQsIDAsIDAsIDAsIGdldENvc3RDZW50cmVDb21wYW55KCRjb3N0X2NlbnRyZV9pZCkpOwogICAgfQp9Cg==