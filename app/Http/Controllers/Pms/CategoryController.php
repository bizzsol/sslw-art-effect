<?php
bolt_decrypt( __FILE__ , 'FKuILe'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBBcHBcSW1wb3J0c1xDYXRlZ29yeUltcG9ydDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXENhdGVnb3J5Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25UeXBlOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcV2FyZWhvdXNlczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXENhdGVnb3J5RGVwYXJ0bWVudDsKdXNlIEFwcFxNb2RlbHNcSHJcRGVwYXJ0bWVudDsKdXNlIElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0Owp1c2UgSWxsdW1pbmF0ZVxWYWxpZGF0aW9uXFJ1bGU7CnVzZSBNYWF0d2Vic2l0ZVxFeGNlbFxGYWNhZGVzXEV4Y2VsOwp1c2UgREIsIERhdGFUYWJsZXM7CgpjbGFzcyBDYXRlZ29yeUNvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyCnsgICAKCiAgICBwdWJsaWMgZnVuY3Rpb24gaGVhZGVyQ29sdW1ucygkdmFsdWU9JycpCiAgICB7CiAgICAgICAgcmV0dXJuIGFycmF5KAogICAgICAgICAgICBbJ1NMJywgJ1NMJ10sCiAgICAgICAgICAgIFsnY29kZScsICdjb2RlJ10sCiAgICAgICAgICAgIFsnbmFtZScsICduYW1lJ10sCiAgICAgICAgICAgIFsnZGVwYXJ0bWVudCcsICdkZXBhcnRtZW50J10sCiAgICAgICAgICAgIFsncHJvZHVjdF90eXBlJywgJ3Byb2R1Y3RfdHlwZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3R5cGUnLCAndHlwZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3NlcnZpY2UnLCAnc2VydmljZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2FjdGlvbnMnLCAnYWN0aW9ucycsICd0ZXh0LWNlbnRlciddCiAgICAgICAgKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBEaXNwbGF5IGEgbGlzdGluZyBvZiB0aGUgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpbmRleCgpCiAgICB7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgICR0aXRsZSA9ICdDYXRlZ29yeSc7CiAgICAgICAgICAgICRpc19maXhlZF9hc3NldCA9IHJlcXVlc3QoKS0+aGFzKCdmaXhlZC1hc3NldHMnKTsKICAgICAgICAgICAgJGlzX2N3aXAgPSByZXF1ZXN0KCktPmhhcygnY3dpcCcpOwoKICAgICAgICAgICAgJGNhdGVnb3JpZXMgPSBDYXRlZ29yeTo6ZG9lc250SGF2ZSgnY2F0ZWdvcnknKQogICAgICAgICAgICAtPndpdGgoWydjYXRlZ29yeScsICdkZXBhcnRtZW50c0xpc3QnLCAnZGVwYXJ0bWVudHNMaXN0LmRlcGFydG1lbnQnXSkKICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgnY29kZScsICdkZXNjJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YXRhYmxlczo6b2YoJGNhdGVnb3JpZXMpCiAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdkZXBhcnRtZW50JywgZnVuY3Rpb24oJGNhdGVnb3J5KXsKICAgICAgICAgICAgICAgICAgICAkZGVwYXJ0bWVudCA9ICcnOwoKICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRjYXRlZ29yeS0+ZGVwYXJ0bWVudHNMaXN0IGFzICR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgICAgICAkZGVwYXJ0bWVudCAuPSAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIj48c3BhbiBjbGFzcz0ibS0xIGJhZGdlIGJhZGdlLXByaW1hcnkiPicuKGlzc2V0KCR2YWx1ZXMtPmRlcGFydG1lbnQtPmhyX2RlcGFydG1lbnRfbmFtZSk/JHZhbHVlcy0+ZGVwYXJ0bWVudC0+aHJfZGVwYXJ0bWVudF9uYW1lOicnKS4nPC9zcGFuPjwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGRlcGFydG1lbnQ7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2RlcGFydG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdkZXBhcnRtZW50c0xpc3QuZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdocl9kZXBhcnRtZW50X25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2RlcGFydG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBDYXRlZ29yeURlcGFydG1lbnQ6OnNlbGVjdCgnaHJfZGVwYXJ0bWVudC5ocl9kZXBhcnRtZW50X25hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2hyX2RlcGFydG1lbnQnLCAnaHJfZGVwYXJ0bWVudC5ocl9kZXBhcnRtZW50X2lkJywgJz0nLCAnY2F0ZWdvcmllc19kZXBhcnRtZW50LmhyX2RlcGFydG1lbnRfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdjYXRlZ29yaWVzX2RlcGFydG1lbnQuY2F0ZWdvcnlfaWQnLCAnY2F0ZWdvcmllcy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3Byb2R1Y3RfdHlwZScsIGZ1bmN0aW9uICgkY2F0ZWdvcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkY2F0ZWdvcnktPmlzX2ZpeGVkX2Fzc2V0ID09IDEgPyAnRml4ZWQgQXNzZXQnIDogKCRjYXRlZ29yeS0+aXNfY3dpcCA9PSAxID8gJ0NXSVAnIDogJ1Byb2R1Y3RzJyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCd0eXBlJywgZnVuY3Rpb24gKCRjYXRlZ29yeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVjd29yZHMoJGNhdGVnb3J5LT50eXBlKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignc2VydmljZScsIGZ1bmN0aW9uICgkY2F0ZWdvcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkY2F0ZWdvcnktPmlzX3NlcnZpY2UgPT0gMSA/ICc8YSBjbGFzcz0iYnRuIGJ0bi1zdWNjZXNzIGJ0bi14cyI+WWVzPC9hPicgOiAnPGEgY2xhc3M9ImJ0biBidG4tZGFyayBidG4teHMiPk5vPC9hPic7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbigkY2F0ZWdvcnkpewogICAgICAgICAgICAgICAgICAgICRhY3Rpb25zID0gJyc7CiAgICAgICAgICAgICAgICAgICAgJHVybCA9IHJvdXRlKCdwbXMucHJvZHVjdC1tYW5hZ2VtZW50LmNhdGVnb3J5LmVkaXQnLCAkY2F0ZWdvcnktPmlkKTsKICAgICAgICAgICAgICAgICAgICBpZihyZXF1ZXN0KCktPmhhcygnZml4ZWQtYXNzZXRzJykpewogICAgICAgICAgICAgICAgICAgICAgICAkdXJsID0gdXJsKCdwbXMvZml4ZWQtYXNzZXRzL2NhdGVnb3J5L2VkaXQvJy4kY2F0ZWdvcnktPmlkLic/Zml4ZWQtYXNzZXRzJyk7CiAgICAgICAgICAgICAgICAgICAgfWVsc2VpZihyZXF1ZXN0KCktPmhhcygnY3dpcCcpKXsKICAgICAgICAgICAgICAgICAgICAgICAgJHVybCA9IHVybCgncG1zL2N3aXAvY2F0ZWdvcnkvJy4kY2F0ZWdvcnktPmlkLicvZWRpdD9jd2lwJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8YSBjbGFzcz0iYnRuIGJ0bi14cyBidG4taW5mbyByb3VuZGVkLWNpcmNsZSBtLTEiIGhyZWY9IicuJHVybC4nIj48aSBjbGFzcz0ibGEgbGEtZWRpdCI+PC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1kYW5nZXIgbS0xIiBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLnByb2R1Y3QtbWFuYWdlbWVudC5jYXRlZ29yeS5kZXN0cm95JywgJGNhdGVnb3J5LT5pZCkuJyIgb25jbGljaz0iZGVsZXRlRnJvbUNSVUQoJCh0aGlzKSkiPjxpIGNsYXNzPSJsYSBsYS10cmFzaCI+PC9pPjwvYT4nOwoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGFjdGlvbnM7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsnZGVwYXJ0bWVudCcsICdhY3Rpb25zJywgJ3NlcnZpY2UnXSkKICAgICAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmNhdGVnb3J5LmluZGV4JyxbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+JHRpdGxlLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5oZWFkZXJDb2x1bW5zKCksCiAgICAgICAgICAgICAgICAnaXNfZml4ZWRfYXNzZXQnID0+ICRpc19maXhlZF9hc3NldCwKICAgICAgICAgICAgICAgICdpc19jd2lwJyA9PiAkaXNfY3dpcCwKICAgICAgICAgICAgXSk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CgogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBTaG93IHRoZSBmb3JtIGZvciBjcmVhdGluZyBhIG5ldyByZXNvdXJjZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNyZWF0ZSgpCiAgICB7CiAgICAgICAgJHRpdGxlID0gJ0NhdGVnb3J5IEFkZCc7CgogICAgICAgICRjb2RlID0gdW5pcXVlQ29kZSg3LCdDVC0nLCdjYXRlZ29yaWVzJywnaWQnKTsKICAgICAgICAkcmVxdWlzaXRpb25zID0gUmVxdWlzaXRpb25UeXBlOjphbGwoKTsKICAgICAgICAkZGVwYXJ0bWVudHMgPSBEZXBhcnRtZW50OjphbGwoKTsKCiAgICAgICAgJGFjY291bnREZWZhdWx0U2V0dGluZ3MgPSBhY2NvdW50RGVmYXVsdFNldHRpbmdzKCk7CiAgICAgICAgJGNoYXJ0T2ZBY2NvdW50c09wdGlvbnMgPSBjaGFydE9mQWNjb3VudHNPcHRpb25zKFtdLCAwLCAwLCBnZXRBbGxHcm91cEFuZExlZGdlcnMoKSk7CiAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmNhdGVnb3J5LmNyZWF0ZScsIGNvbXBhY3QoJ3RpdGxlJywncmVxdWlzaXRpb25zJywnZGVwYXJ0bWVudHMnLCdjb2RlJywgJ2FjY291bnREZWZhdWx0U2V0dGluZ3MnLCAnY2hhcnRPZkFjY291bnRzT3B0aW9ucycpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFN0b3JlIGEgbmV3bHkgY3JlYXRlZCByZXNvdXJjZSBpbiBzdG9yYWdlLgogICAgICoKICAgICAqIEBwYXJhbSAgXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICAkcmVxdWVzdAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzdG9yZShSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICR0aGlzLT52YWxpZGF0ZSgkcmVxdWVzdCwgWwogICAgICAgICAgICAnY29kZScgPT4gWydyZXF1aXJlZCcsICdzdHJpbmcnLCAnbWF4OjI1NScsICd1bmlxdWU6Y2F0ZWdvcmllcyddLAogICAgICAgICAgICAnbmFtZScgPT4gWydyZXF1aXJlZCcsICdzdHJpbmcnLCAnbWF4OjI1NSddLAogICAgICAgICAgICAndHlwZScgPT4gWydyZXF1aXJlZCcsICdzdHJpbmcnLCAnbWF4OjI1NSddLAogICAgICAgICAgICAncGFyZW50JyA9PiBbJ251bGxhYmxlJywgJ2ludGVnZXInXSwKICAgICAgICAgICAgJ2hyX2RlcGFydG1lbnRfaWQnID0+IFsncmVxdWlyZWQnXSwKICAgICAgICAgICAgJ3Byb2R1Y3RfdHlwZScgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgLy8gJ3JlcXVpc2l0aW9uX3R5cGVfaWQnID0+IFsncmVxdWlyZWQnLCAnaW50ZWdlciddLAogICAgICAgIF0pOwoKICAgICAgICB0cnkgewogICAgICAgICAgICAkaW5wdXRzID0gJHJlcXVlc3QtPmFsbCgpOwogICAgICAgICAgICBpZigkcmVxdWVzdC0+cHJvZHVjdF90eXBlID09ICdwcm9kdWN0cycpewogICAgICAgICAgICAgICAgJGlucHV0c1snaXNfZml4ZWRfYXNzZXQnXSA9IDA7CiAgICAgICAgICAgICAgICAkaW5wdXRzWydpc19jd2lwJ10gPSAwOwogICAgICAgICAgICB9ZWxzZWlmKCRyZXF1ZXN0LT5wcm9kdWN0X3R5cGUgPT0gJ2ZpeGVkX2Fzc2V0Jyl7CiAgICAgICAgICAgICAgICAkaW5wdXRzWydpc19maXhlZF9hc3NldCddID0gMTsKICAgICAgICAgICAgICAgICRpbnB1dHNbJ2lzX2N3aXAnXSA9IDA7CiAgICAgICAgICAgIH1lbHNlaWYoJHJlcXVlc3QtPnByb2R1Y3RfdHlwZSA9PSAnY3dpcCcpewogICAgICAgICAgICAgICAgJGlucHV0c1snaXNfZml4ZWRfYXNzZXQnXSA9IDA7CiAgICAgICAgICAgICAgICAkaW5wdXRzWydpc19jd2lwJ10gPSAxOwogICAgICAgICAgICB9CgogICAgICAgICAgICB1bnNldCgkaW5wdXRzWydfdG9rZW4nXSk7CiAgICAgICAgICAgIHVuc2V0KCRpbnB1dHNbJ19tZXRob2QnXSk7CgogICAgICAgICAgICAkY2F0ZWdvcnk9Q2F0ZWdvcnk6OmNyZWF0ZSgkaW5wdXRzKTsKCiAgICAgICAgICAgICRkZXBhcnRtZW50cz0kcmVxdWVzdC0+aHJfZGVwYXJ0bWVudF9pZDsKICAgICAgICAgICAgJGNhdGVnb3J5LT5kZXBhcnRtZW50KCktPnN5bmMoJGRlcGFydG1lbnRzKTsKCiAgICAgICAgICAgIC8vcmV0dXJuICR0aGlzLT5yZWRpcmVjdEJhY2tXaXRoU3VjY2VzcygnQ2F0ZWdvcnkgY3JlYXRlZCBzdWNjZXNzZnVsbHknLCdwbXMucHJvZHVjdC1tYW5hZ2VtZW50LmNhdGVnb3J5LmluZGV4Jyk7CgogICAgICAgICAgICByZXR1cm4gJHRoaXMtPnVybFJlZGlyZWN0QmFjaygnQ2F0ZWdvcnkgY3JlYXRlZCBzdWNjZXNzZnVsbHknLCAncG1zL3Byb2R1Y3QtbWFuYWdlbWVudC9jYXRlZ29yeScsICdzdWNjZXNzJyk7CgogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGJhY2soKTsKICAgIH0KCiAgICAvKioKICAgICAqIERpc3BsYXkgdGhlIHNwZWNpZmllZCByZXNvdXJjZS4KICAgICAqCiAgICAgKiBAcGFyYW0gIGludCAgJGlkCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNob3coQ2F0ZWdvcnkgJGNhdGVnb3J5KQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIAogICAgICAgICAgICAkY2F0ZWdvcnktPnBhcmVudF9pZCA9ICEkY2F0ZWdvcnktPmNhdGVnb3J5P251bGw6JGNhdGVnb3J5LT5jYXRlZ29yeTsKICAgICAgICAgICAgJGFycmF5PVtdOwogICAgICAgICAgICBmb3JlYWNoKCRjYXRlZ29yeS0+ZGVwYXJ0bWVudHNMaXN0IGFzICRrZXkgPT4gJGRlcGFydG1lbnQpewogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkYXJyYXksJGRlcGFydG1lbnQtPmhyX2RlcGFydG1lbnRfaWQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkbmV3X2FycmF5PVtdOwoKICAgICAgICAgICAgZm9yZWFjaChEZXBhcnRtZW50Ojp3aGVyZUluKCdocl9kZXBhcnRtZW50X2lkJywkYXJyYXkpLT5zZWxlY3QoJ2hyX2RlcGFydG1lbnRfaWQnKS0+Z2V0KCkgYXMgJHZhbHVlcyl7CiAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRuZXdfYXJyYXksICR2YWx1ZXMtPmhyX2RlcGFydG1lbnRfaWQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJ0NhdGVnb3J5IEVkaXQnLAogICAgICAgICAgICAgICAgJ2NhdGVnb3J5JyA9PiAkY2F0ZWdvcnksCiAgICAgICAgICAgICAgICAnZGVwYXJ0bWVudHNJZCcgPT4gRGVwYXJ0bWVudDo6d2hlcmVJbignaHJfZGVwYXJ0bWVudF9pZCcsJGFycmF5KS0+cGx1Y2soJ2hyX2RlcGFydG1lbnRfaWQnKS0+YWxsKCksCiAgICAgICAgICAgICAgICAncmVxdWlzaXRpb25zJyA9PiBSZXF1aXNpdGlvblR5cGU6OmFsbCgpLAogICAgICAgICAgICAgICAgJ2RlcGFydG1lbnRzJyA9PiBEZXBhcnRtZW50OjphbGwoKSwKICAgICAgICAgICAgICAgICdhY2NvdW50RGVmYXVsdFNldHRpbmdzJyA9PiBhY2NvdW50RGVmYXVsdFNldHRpbmdzKCksCiAgICAgICAgICAgICAgICAnY2hhcnRPZkFjY291bnRzT3B0aW9ucycgPT4gY2hhcnRPZkFjY291bnRzT3B0aW9ucyhbXSwgMCksCiAgICAgICAgICAgIF07CgogICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5jYXRlZ29yeS5lZGl0JywgJGRhdGEpOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNob3cgdGhlIGZvcm0gZm9yIGVkaXRpbmcgdGhlIHNwZWNpZmllZCByZXNvdXJjZS4KICAgICAqCiAgICAgKiBAcGFyYW0gIGludCAgJGlkCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGVkaXQoJGlkKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRjYXRlZ29yeSA9IENhdGVnb3J5Ojp3aXRoKFsKICAgICAgICAgICAgICAgICdkZXBhcnRtZW50c0xpc3QnCiAgICAgICAgICAgIF0pLT5maW5kT3JGYWlsKCRpZCk7CiAgICAgICAgICAgICRjYXRlZ29yeS0+cGFyZW50X2lkID0gISRjYXRlZ29yeS0+Y2F0ZWdvcnk/bnVsbDokY2F0ZWdvcnktPmNhdGVnb3J5OwoKICAgICAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICdDYXRlZ29yeSBFZGl0JywKICAgICAgICAgICAgICAgICdjYXRlZ29yeScgPT4gJGNhdGVnb3J5LAogICAgICAgICAgICAgICAgJ2RlcGFydG1lbnRzSWQnID0+ICRjYXRlZ29yeS0+ZGVwYXJ0bWVudHNMaXN0LT5wbHVjaygnaHJfZGVwYXJ0bWVudF9pZCcpLT50b0FycmF5KCksCiAgICAgICAgICAgICAgICAncmVxdWlzaXRpb25zJyA9PiBSZXF1aXNpdGlvblR5cGU6OmFsbCgpLAogICAgICAgICAgICAgICAgJ2RlcGFydG1lbnRzJyA9PiBEZXBhcnRtZW50OjphbGwoKSwKICAgICAgICAgICAgICAgICdhY2NvdW50RGVmYXVsdFNldHRpbmdzJyA9PiBhY2NvdW50RGVmYXVsdFNldHRpbmdzKCksCiAgICAgICAgICAgICAgICAnY2hhcnRPZkFjY291bnRzT3B0aW9ucycgPT4gY2hhcnRPZkFjY291bnRzT3B0aW9ucyhbXSwgMCwgMCwgZ2V0QWxsR3JvdXBBbmRMZWRnZXJzKCkpLAogICAgICAgICAgICBdOwoKICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuY2F0ZWdvcnkuZWRpdCcsICRkYXRhKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIHNwZWNpZmllZCByZXNvdXJjZSBpbiBzdG9yYWdlLgogICAgICoKICAgICAqIEBwYXJhbSAgXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICAkcmVxdWVzdAogICAgICogQHBhcmFtICBpbnQgICRpZAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiB1cGRhdGUoUmVxdWVzdCAkcmVxdWVzdCwgQ2F0ZWdvcnkgJGNhdGVnb3J5KQogICAgewogICAgICAgICR0aGlzLT52YWxpZGF0ZSgkcmVxdWVzdCwgWwogICAgICAgICAgICAnY29kZScgPT4gWydyZXF1aXJlZCcsICdzdHJpbmcnLCAnbWF4OjI1NScsIFJ1bGU6OnVuaXF1ZSgnY2F0ZWdvcmllcycpLT5pZ25vcmUoJGNhdGVnb3J5LT5pZCldLAogICAgICAgICAgICAnbmFtZScgPT4gWydyZXF1aXJlZCcsICdzdHJpbmcnLCAnbWF4OjI1NSddLAogICAgICAgICAgICAndHlwZScgPT4gWydyZXF1aXJlZCcsICdzdHJpbmcnLCAnbWF4OjI1NSddLAogICAgICAgICAgICAncGFyZW50X2lkJyA9PiBbJ251bGxhYmxlJywgJ2ludGVnZXInXSwKICAgICAgICAgICAgLy8gJ3JlcXVpc2l0aW9uX3R5cGVfaWQnID0+IFsncmVxdWlyZWQnLCAnaW50ZWdlciddLAogICAgICAgIF0pOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRpbnB1dHMgPSAkcmVxdWVzdC0+YWxsKCk7CiAgICAgICAgICAgIHVuc2V0KCRpbnB1dHNbJ190b2tlbiddKTsKICAgICAgICAgICAgdW5zZXQoJGlucHV0c1snX21ldGhvZCddKTsKICAgICAgICAgICAgJGNhdGVnb3J5LT51cGRhdGUoJGlucHV0cyk7CgogICAgICAgICAgICAkZGVwYXJ0bWVudHM9JHJlcXVlc3QtPmhyX2RlcGFydG1lbnRfaWQ7CiAgICAgICAgICAgICRjYXRlZ29yeS0+ZGVwYXJ0bWVudCgpLT5zeW5jKCRkZXBhcnRtZW50cyk7CgogICAgICAgICAgICAKICAgICAgICAgICAgJHN1YkNhdGVnb3JpZXMgPSBDYXRlZ29yeTo6d2hlcmUoJ3BhcmVudF9pZCcsICRjYXRlZ29yeS0+aWQpLT5nZXQoKTsKICAgICAgICAgICAgJGRlcGFydG1lbnRzID0gQ2F0ZWdvcnlEZXBhcnRtZW50Ojp3aGVyZSgnY2F0ZWdvcnlfaWQnLCAkY2F0ZWdvcnktPmlkKS0+cGx1Y2soJ2hyX2RlcGFydG1lbnRfaWQnKS0+dG9BcnJheSgpOwogICAgICAgICAgICBpZihpc3NldCgkc3ViQ2F0ZWdvcmllc1swXSkpewogICAgICAgICAgICAgICAgZm9yZWFjaCgkc3ViQ2F0ZWdvcmllcyBhcyAka2V5ID0+ICRzdWJDYXRlZ29yeSl7CiAgICAgICAgICAgICAgICAgICAgJHN1YkNhdGVnb3J5LT5kZXBhcnRtZW50KCktPnN5bmMoJGRlcGFydG1lbnRzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9yZXR1cm4gJHRoaXMtPnJlZGlyZWN0QmFja1dpdGhTdWNjZXNzKCdDYXRlZ29yeSB1cGRhdGVkIHN1Y2Nlc3NmdWxseScsJ3Btcy5wcm9kdWN0LW1hbmFnZW1lbnQuY2F0ZWdvcnkuaW5kZXgnKTsKCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+dXJsUmVkaXJlY3RCYWNrKCdDYXRlZ29yeSB1cGRhdGVkIHN1Y2Nlc3NmdWxseScsICAncG1zL3Byb2R1Y3QtbWFuYWdlbWVudC9jYXRlZ29yeScsICdzdWNjZXNzJyk7CgogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGUgc3BlY2lmaWVkIHJlc291cmNlIGZyb20gc3RvcmFnZS4KICAgICAqCiAgICAgKiBAcGFyYW0gIGludCAgJGlkCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGRlc3Ryb3koQ2F0ZWdvcnkgJGNhdGVnb3J5KQogICAgewogICAgICAgIHRyeSB7CgogICAgICAgICAgICBpZiAoJGNhdGVnb3J5LT5zdWJDYXRlZ29yeS0+Y291bnQoKSA+IDApIHsKICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAnQ2F0ZWdvcnkgY2FuIG5vdCBiZSBkZWxldGVkLicKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkY2F0ZWdvcnktPnN1YkNhdGVnb3J5LT5lYWNoLT5kZWxldGUoKTsKICAgICAgICAgICAgQ2F0ZWdvcnlEZXBhcnRtZW50Ojp3aGVyZSgnY2F0ZWdvcnlfaWQnLCAkY2F0ZWdvcnktPmlkKS0+ZGVsZXRlKCk7CiAgICAgICAgICAgICRjYXRlZ29yeS0+ZGVsZXRlKCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICdDYXRlZ29yeSBTdWNjZXNzZnVsbHkgRGVsZXRlZC4nCiAgICAgICAgICAgIF0pOwoKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJHRoLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgfQoKCiAgICBwdWJsaWMgZnVuY3Rpb24gaW1wb3J0Q2F0ZWdvcnkoUmVxdWVzdCAkcmVxdWVzdCl7CgogICAgICAgICR0aGlzLT52YWxpZGF0ZSgkcmVxdWVzdCwgWwogICAgICAgICAgICAnY2F0ZWdvcnlfZmlsZScgPT4gJ3JlcXVpcmVkfG1pbWVzOnhscyx4bHN4JwogICAgICAgIF0pOwoKICAgICAgICAkcGF0aCA9ICRyZXF1ZXN0LT5maWxlKCdjYXRlZ29yeV9maWxlJyktPmdldFJlYWxQYXRoKCk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEV4Y2VsOjppbXBvcnQobmV3IENhdGVnb3J5SW1wb3J0KCksICRwYXRoKTsKCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhTdWNjZXNzKCdDYXRlZ29yeSBEYXRhIEltcG9ydGVkIHN1Y2Nlc3NmdWxseS4nKTsKCiAgICAgICAgfWNhdGNoIChcTWFhdHdlYnNpdGVcRXhjZWxcVmFsaWRhdG9yc1xWYWxpZGF0aW9uRXhjZXB0aW9uICRlKSB7CgogICAgICAgICAgICAkZXJyb3JNZXNzYWdlPScnOwogICAgICAgICAgICAkcm93TnVtYmVyPTE7CiAgICAgICAgICAgICRyb3dOdW1iZXIrPSRlLT5mYWlsdXJlcygpWzBdLT5yb3coKTsKICAgICAgICAgICAgJGNvbHVtbj0kZS0+ZmFpbHVyZXMoKVswXS0+YXR0cmlidXRlKCk7CgogICAgICAgICAgICAkZXJyb3JNZXNzYWdlLj0kZS0+ZmFpbHVyZXMoKVswXS0+ZXJyb3JzKClbMF0uJyBmb3Igcm93ICcuJHJvd051bWJlci4nIG9uIENvbHVtbiAnLiRjb2x1bW47CgogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJGVycm9yTWVzc2FnZSk7CiAgICAgICAgfQogICAgfQp9Cg==