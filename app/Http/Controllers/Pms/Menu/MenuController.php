<?php
bolt_decrypt( __FILE__ , 'b7kw3R'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zXE1lbnU7Cgp1c2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcQ29udHJvbGxlcjsKCnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xNZW51XE1lbnU7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xNZW51XFN1Yk1lbnU7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xNZW51XFN1YlN1Yk1lbnU7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKCnVzZSBBcHBcSHR0cFxSZXF1ZXN0czsKCnVzZSBJbWFnZSwgREIsIFZhbGlkYXRvciwgRGF0YVRhYmxlczsKdXNlIFNwYXRpZVxQZXJtaXNzaW9uXE1vZGVsc1xQZXJtaXNzaW9uOwoKY2xhc3MgTWVudUNvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyCnsKICAgIHB1YmxpYyBmdW5jdGlvbiBfX2NvbnN0cnVjdCgpewogICAgICAgICR0aGlzLT5taWRkbGV3YXJlKCdhdXRoJyk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGhlYWRlckNvbHVtbnMoJHZhbHVlID0gJycpCiAgICB7CiAgICAgICAgcmV0dXJuIGFycmF5KAogICAgICAgICAgICBbJ1NMJywgJ1NMJ10sCiAgICAgICAgICAgIFsnc2VyaWFsJywgJ3NlcmlhbCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ21vZHVsZScsICdtb2R1bGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWyduYW1lJywgJ25hbWUnXSwKICAgICAgICAgICAgWyd1cmwnLCAndXJsJ10sCiAgICAgICAgICAgIFsnbWVudV9mb3InLCAnbWVudV9mb3InLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydzdWJfbWVudScsICdzdWJfbWVudScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3N0YXR1cycsICdzdGF0dXMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydjcmVhdGVkX2F0JywgJ2NyZWF0ZWRfYXQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhY3Rpb25zJywgJ2FjdGlvbnMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICApOwogICAgfQoKICAgIC8qKgogICAgICogRGlzcGxheSBhIGxpc3Rpbmcgb2YgdGhlIHJlc291cmNlLgogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5kZXgoKQogICAgewogICAgICAgIC8qCiAgICAgICAgJHByb2plY3RNZW51cyA9IFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xNZW51XEFjY291bnRzTWVudTo6d2l0aChbCiAgICAgICAgICAgICdzdWJNZW51JwogICAgICAgIF0pLT5nZXQoKTsKICAgICAgICBmb3JlYWNoKCRwcm9qZWN0TWVudXMgYXMgJG1lbnUpewogICAgICAgICAgICAkbmV3TWVudSA9IE1lbnU6OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAnbW9kdWxlJyA9PiAnZmluYW5jZScsCiAgICAgICAgICAgICAgICAnbmFtZScgPT4gJG1lbnUtPm5hbWUsCiAgICAgICAgICAgICAgICAnbmFtZV9ibicgPT4gJG1lbnUtPm5hbWVfYm4sCiAgICAgICAgICAgICAgICAndXJsJyA9PiAkbWVudS0+dXJsLAogICAgICAgICAgICAgICAgJ2ljb25fY2xhc3MnID0+ICRtZW51LT5pY29uX2NsYXNzLAogICAgICAgICAgICAgICAgJ2ljb24nID0+ICRtZW51LT5pY29uLAogICAgICAgICAgICAgICAgJ2JpZ19pY29uJyA9PiAkbWVudS0+YmlnX2ljb24sCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAkbWVudS0+c3RhdHVzLAogICAgICAgICAgICAgICAgJ3NsdWcnID0+ICRtZW51LT5zbHVnLAogICAgICAgICAgICAgICAgJ3NlcmlhbF9udW0nID0+ICRtZW51LT5zZXJpYWxfbnVtLAogICAgICAgICAgICAgICAgJ21lbnVfZm9yJyA9PiAkbWVudS0+bWVudV9mb3IsCiAgICAgICAgICAgICAgICAnb3Blbl9uZXdfdGFiJyA9PiAkbWVudS0+b3Blbl9uZXdfdGFiLAogICAgICAgICAgICAgICAgJ2NyZWF0ZWRfYnknID0+ICRtZW51LT5jcmVhdGVkX2J5LAogICAgICAgICAgICAgICAgJ3VwZGF0ZWRfYnknID0+ICRtZW51LT51cGRhdGVkX2J5LAogICAgICAgICAgICBdKTsKCiAgICAgICAgICAgIGlmKCRuZXdNZW51KXsKICAgICAgICAgICAgICAgIGlmKCRtZW51LT5zdWJNZW51LT5jb3VudCgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCgkbWVudS0+c3ViTWVudSBhcyAka2V5ID0+ICRzdWJfbWVudSl7CiAgICAgICAgICAgICAgICAgICAgICAgIFN1Yk1lbnU6OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbW9kdWxlJyA9PiAkbmV3TWVudS0+bW9kdWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21lbnVfaWQnID0+ICRuZXdNZW51LT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYW1lJyA9PiAkc3ViX21lbnUtPm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZV9ibicgPT4gJHN1Yl9tZW51LT5uYW1lX2JuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VybCcgPT4gJHN1Yl9tZW51LT51cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaWNvbl9jbGFzcycgPT4gJHN1Yl9tZW51LT5pY29uX2NsYXNzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2ljb24nID0+ICRzdWJfbWVudS0+aWNvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdiaWdfaWNvbicgPT4gJHN1Yl9tZW51LT5iaWdfaWNvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzdGF0dXMnID0+ICRzdWJfbWVudS0+c3RhdHVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NsdWcnID0+ICRzdWJfbWVudS0+c2x1ZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzZXJpYWxfbnVtJyA9PiAkc3ViX21lbnUtPnNlcmlhbF9udW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbWVudV9mb3InID0+ICRzdWJfbWVudS0+bWVudV9mb3IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnb3Blbl9uZXdfdGFiJyA9PiAkc3ViX21lbnUtPm9wZW5fbmV3X3RhYiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVhdGVkX2J5JyA9PiAkc3ViX21lbnUtPmNyZWF0ZWRfYnksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndXBkYXRlZF9ieScgPT4gJHN1Yl9tZW51LT51cGRhdGVkX2J5LAogICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBNZW51Ojp3aXRoKFsKICAgICAgICAgICAgJ3N1Yk1lbnUnCiAgICAgICAgXSktPndoZXJlKCdtb2R1bGUnLCAnZmluYW5jZScpLT5nZXQoKTsKICAgICAgICAqLwoKICAgICAgICB0cnl7CiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgJG1lbnVzID0gTWVudTo6d2l0aChbCiAgICAgICAgICAgICAgICAgICAgJ3N1Yk1lbnUnCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ3NlcmlhbF9udW0nLCAnZGVzYycpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgcmV0dXJuIERhdGFUYWJsZXM6Om9mKCRtZW51cykKICAgICAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignc2VyaWFsJywgZnVuY3Rpb24gKCRtZW51KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkbWVudS0+c2VyaWFsX251bTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdzZXJpYWwnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnc2VyaWFsX251bScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignc2VyaWFsJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ3NlcmlhbF9udW0nLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdtb2R1bGUnLCBmdW5jdGlvbiAoJG1lbnUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVjd29yZHMoaW1wbG9kZSgnICcsIGV4cGxvZGUoJy0nLCAkbWVudS0+bW9kdWxlKSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCduYW1lJywgZnVuY3Rpb24gKCRtZW51KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iJy5yb3V0ZSgncG1zLmFjbC5tZW51LmVkaXQnLCAkbWVudS0+aWQpLiciPjxpIGNsYXNzPSInLiRtZW51LT5pY29uX2NsYXNzLiciPjwvaT4gJy4kbWVudS0+bmFtZS4nPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3VybCcsIGZ1bmN0aW9uICgkbWVudSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9IicudXJsKCRtZW51LT51cmwpLiciIHRhcmdldD0iX2JsYW5rIj4nLnVybCgkbWVudS0+dXJsKS4nPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ21lbnVfZm9yJywgZnVuY3Rpb24gKCRtZW51KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9InRleHQtc3VjY2VzcyI+Jy4kbWVudS0+bWVudV9mb3IuJzwvc3Bhbj4nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3N1Yl9tZW51JywgZnVuY3Rpb24gKCRtZW51KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iJy5yb3V0ZSgncG1zLmFjbC5zdWItbWVudS5zaG93JywgJG1lbnUtPmlkKS4nIiBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IGJ0bi1zbSIgc3R5bGU9ImNvbG9yOiAjZmZmOyI+U3ViIE1lbnUgKCcuJG1lbnUtPnN1Yk1lbnUtPmNvdW50KCdpZCcpLicpPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignc3RhdHVzJywgZnVuY3Rpb24gKCRtZW51KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGkgY2xhc3M9IicuKCRtZW51LT5zdGF0dXMgPT0gTWVudTo6QUNUSVZFID8gJ2ZhIGZhLWNoZWNrLWNpcmNsZSB0ZXh0LXN1Y2Nlc3MnIDogJ2ZhIGZhLXRpbWVzLWNpcmNsZScpLiciPjwvaT4nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdjcmVhdGVkX2F0JywgZnVuY3Rpb24gKCRtZW51KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlKCdZLW0tZCBnOmkgYScsIHN0cnRvdGltZSgkbWVudS0+Y3JlYXRlZF9hdCkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbiAoJG1lbnUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBjbGFzcz0iYnRuIGJ0bi14cyBidG4tcHJpbWFyeSBtLTEiIGhyZWY9Iicucm91dGUoJ3Btcy5hY2wubWVudS5lZGl0JywgJG1lbnUtPmlkKS4nIj48aSBjbGFzcz0ibGEgbGEtZWRpdCI+PC9pPjwvYT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBjbGFzcz0iYnRuIGJ0bi14cyBidG4tZGFuZ2VyICBtLTEiIG9uY2xpY2s9ImRlbGV0ZUZyb21DUlVEKCQodGhpcykpIiBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLmFjbC5tZW51LmRlc3Ryb3knLCAkbWVudS0+aWQpLiciPjxpIGNsYXNzPSJsYSBsYS10cmFzaCI+PC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsnbmFtZScsICd1cmwnLCAnbWVudV9mb3InLCAnc3ViX21lbnUnLCAnc3RhdHVzJywgJ2FjdGlvbnMnXSkKICAgICAgICAgICAgICAgICAgICAtPnRvSnNvbigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMubWVudS5pbmRleCcsIFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJ01lbnUnLCAKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+aGVhZGVyQ29sdW1ucygpLAogICAgICAgICAgICBdKTsKCiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNob3cgdGhlIGZvcm0gZm9yIGNyZWF0aW5nIGEgbmV3IHJlc291cmNlLgogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY3JlYXRlKCkKICAgIHsKICAgICAgICAkdGl0bGU9J0NyZWF0ZSBOZXcgTWVudSc7CiAgICAgICAgJG1heF9zZXJpYWw9TWVudTo6bWF4KCdzZXJpYWxfbnVtJyk7CiAgICAgICAgJHBlcm1pc3Npb25zID0gUGVybWlzc2lvbjo6b3JkZXJCeSgnaWQnLCdERVNDJyktPnBsdWNrKCduYW1lJywgJ25hbWUnKTsKICAgICAgICAkbWVudUZvcj1bCiAgICAgICAgICAgIE1lbnU6OkFETUlOX01FTlUgPT4gTWVudTo6QURNSU5fTUVOVSwKICAgICAgICAgICAgTWVudTo6Q0xJRU5UX01FTlUgPT4gTWVudTo6Q0xJRU5UX01FTlUsCiAgICAgICAgICAgIE1lbnU6OlVTRVJfTUVOVSA9PiBNZW51OjpVU0VSX01FTlUKICAgICAgICBdOwogICAgICAgICRzdGF0dXM9W01lbnU6OkFDVElWRSAgPT4gTWVudTo6QUNUSVZFICwKICAgICAgICAgICAgTWVudTo6SU5BQ1RJVkUgID0+IE1lbnU6OklOQUNUSVZFXTsKCiAgICAgICAgJG9wZW5UYWI9W01lbnU6Ok5PX09QRU5fTkVXX1RBQiAgPT4gTWVudTo6Tk9fT1BFTl9ORVdfVEFCICwKICAgICAgICAgICAgTWVudTo6T1BFTl9ORVdfVEFCICA9PiBNZW51OjpPUEVOX05FV19UQUJdOwogICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5tZW51LmNyZWF0ZScsY29tcGFjdCgndGl0bGUnLCdtYXhfc2VyaWFsJywncGVybWlzc2lvbnMnLCdtZW51Rm9yJywnc3RhdHVzJywnb3BlblRhYicpKTsKCiAgICB9CgogICAgLyoqCiAgICAgKiBTdG9yZSBhIG5ld2x5IGNyZWF0ZWQgcmVzb3VyY2UgaW4gc3RvcmFnZS4KICAgICAqCiAgICAgKiBAcGFyYW0gIFxJbGx1bWluYXRlXEh0dHBcUmVxdWVzdCAgJHJlcXVlc3QKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc3RvcmUoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKCiAgICAgICAgdHJ5ewogICAgICAgICAgICAkaW5wdXQgPSAkcmVxdWVzdC0+YWxsKCk7CgogICAgICAgICAgICBpZihpc3NldCgkaW5wdXRbJ3BhZ2UnXSkpewogICAgICAgICAgICAgICAgJHBhZ2U9UGFnZTo6c2VsZWN0KCduYW1lJywnbmFtZV9ibicpLT53aGVyZSgnbGluaycsJGlucHV0WydwYWdlJ10pLT5maXJzdCgpOwogICAgICAgICAgICAgICAgJGlucHV0Wydtb2R1bGUnXT0kcGFnZVsnbW9kdWxlJ107CiAgICAgICAgICAgICAgICAkaW5wdXRbJ25hbWUnXT0kcGFnZVsnbmFtZSddOwogICAgICAgICAgICAgICAgJGlucHV0WyduYW1lX2JuJ109JHBhZ2VbJ25hbWVfYm4nXTsKICAgICAgICAgICAgICAgICRpbnB1dFsndXJsJ109InBhZ2UvIi4kaW5wdXRbJ3BhZ2UnXTsKICAgICAgICAgICAgfQoKCiAgICAgICAgICAgICR2YWxpZGF0b3IgPSBWYWxpZGF0b3I6Om1ha2UoJGlucHV0LCBbCiAgICAgICAgICAgICAgICAnbW9kdWxlJz0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICAgICAnbmFtZSc9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAgICAgJ3VybCc9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAgICAgJ2ljb24nID0+ICdtaW1lczpqcGVnLGpwZyxibXAscG5nJwogICAgICAgICAgICBdKTsKCiAgICAgICAgICAgIGlmICgkdmFsaWRhdG9yLT5mYWlscygpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVkaXJlY3QoKS0+YmFjaygpLT53aXRoRXJyb3JzKCR2YWxpZGF0b3IpLT53aXRoSW5wdXQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkaW5wdXRbJ3NsdWcnXT1qc29uX2VuY29kZSgkcmVxdWVzdC0+c2x1Zyk7CgogICAgICAgICAgICBpZiAoJHJlcXVlc3QtPmhhc0ZpbGUoJ2ljb24nKSl7CiAgICAgICAgICAgICAgICAkaW5wdXRbJ2ljb24nXT0kdGhpcy0+cGhvdG9VcGxvYWQoJHJlcXVlc3QtPmZpbGUoJ2ljb24nKSwnaW1hZ2VzL21lbnUvaWNvbicsMzIpOwogICAgICAgICAgICAgICAgLy8kaW5wdXRbJ2JpZ19pY29uJ109JHRoaXMtPnBob3RvVXBsb2FkKCRyZXF1ZXN0LT5maWxlKCdpY29uJyksJ2ltYWdlcy9tZW51L2JpZy1pY29uLycsMTI4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgTWVudTo6Y3JlYXRlKCRpbnB1dCk7CgogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoU3VjY2VzcygnTWVudSBjcmVhdGVkIHN1Y2Nlc3NmdWxseScpOwoKICAgICAgICB9Y2F0Y2goXEV4Y2VwdGlvbiAkZSl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkZS0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CgogICAgfQoKICAgIC8qKgogICAgICogRGlzcGxheSB0aGUgc3BlY2lmaWVkIHJlc291cmNlLgogICAgICoKICAgICAqIEBwYXJhbSAgaW50ICAkaWQKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2hvdygkaWQpCiAgICB7CiAgICAgICAgLy8KICAgIH0KCiAgICAvKioKICAgICAqIFNob3cgdGhlIGZvcm0gZm9yIGVkaXRpbmcgdGhlIHNwZWNpZmllZCByZXNvdXJjZS4KICAgICAqCiAgICAgKiBAcGFyYW0gIGludCAgJGlkCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGVkaXQoJGlkKQogICAgewogICAgICAgICR0aXRsZT0nRWRpdCBNZW51IERhdGEnOwogICAgICAgICRtYXhfc2VyaWFsPU1lbnU6Om1heCgnc2VyaWFsX251bScpOwogICAgICAgICRkYXRhPU1lbnU6OmZpbmRPckZhaWwoJGlkKTsKICAgICAgICAkcGVybWlzc2lvbnMgPSBQZXJtaXNzaW9uOjpvcmRlckJ5KCdpZCcsJ0RFU0MnKS0+cGx1Y2soJ25hbWUnLCAnbmFtZScpOwogICAgICAgICRtZW51Rm9yPVsKICAgICAgICAgICAgTWVudTo6QURNSU5fTUVOVSA9PiBNZW51OjpBRE1JTl9NRU5VLAogICAgICAgICAgICBNZW51OjpDTElFTlRfTUVOVSA9PiBNZW51OjpDTElFTlRfTUVOVSwKICAgICAgICAgICAgTWVudTo6VVNFUl9NRU5VID0+IE1lbnU6OlVTRVJfTUVOVQogICAgICAgIF07CiAgICAgICAgJHN0YXR1cz1bTWVudTo6QUNUSVZFICA9PiBNZW51OjpBQ1RJVkUgLAogICAgICAgICAgICBNZW51OjpJTkFDVElWRSAgPT4gTWVudTo6SU5BQ1RJVkVdOwoKICAgICAgICAkb3BlblRhYj1bTWVudTo6Tk9fT1BFTl9ORVdfVEFCICA9PiBNZW51OjpOT19PUEVOX05FV19UQUIgLAogICAgICAgICAgICBNZW51OjpPUEVOX05FV19UQUIgID0+IE1lbnU6Ok9QRU5fTkVXX1RBQl07CgogICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5tZW51LmVkaXQnLGNvbXBhY3QoJ3RpdGxlJywnZGF0YScsJ21heF9zZXJpYWwnLCdwZXJtaXNzaW9ucycsJ21lbnVGb3InLCdzdGF0dXMnLCdvcGVuVGFiJykpOwogICAgfQoKICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBzcGVjaWZpZWQgcmVzb3VyY2UgaW4gc3RvcmFnZS4KICAgICAqCiAgICAgKiBAcGFyYW0gIFxJbGx1bWluYXRlXEh0dHBcUmVxdWVzdCAgJHJlcXVlc3QKICAgICAqIEBwYXJhbSAgaW50ICAkaWQKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gdXBkYXRlKFJlcXVlc3QgJHJlcXVlc3QsICRpZCkKICAgIHsKCiAgICAgICAgJGlucHV0ID0gJHJlcXVlc3QtPmFsbCgpOwogICAgICAgICRkYXRhPU1lbnU6OmZpbmRPckZhaWwoJGlkKTsKCiAgICAgICAgJHZhbGlkYXRvciA9IFZhbGlkYXRvcjo6bWFrZSgkaW5wdXQsIFsKICAgICAgICAgICAgJ21vZHVsZScgICAgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ25hbWUnICAgID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICd1cmwnICAgICAgICAgID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdpY29uJyA9PiAnbWltZXM6anBlZyxqcGcsYm1wLHBuZycKICAgICAgICBdKTsKCiAgICAgICAgaWYgKCR2YWxpZGF0b3ItPmZhaWxzKCkpIHsKICAgICAgICAgICAgcmV0dXJuIHJlZGlyZWN0KCktPmJhY2soKS0+d2l0aEVycm9ycygkdmFsaWRhdG9yKS0+d2l0aElucHV0KCk7CiAgICAgICAgfQoKICAgICAgICAkaW5wdXRbJ3NsdWcnXT1qc29uX2VuY29kZSgkcmVxdWVzdC0+c2x1Zyk7CiAgICAgICAgdHJ5ewoKICAgICAgICAgICAgaWYgKCRyZXF1ZXN0LT5oYXNGaWxlKCdpY29uJykpewogICAgICAgICAgICAgICAgJGlucHV0WydpY29uJ109JHRoaXMtPnBob3RvVXBsb2FkKCRyZXF1ZXN0LT5maWxlKCdpY29uJyksJ2ltYWdlcy9tZW51L2ljb24nLDMyKTsKCiAgICAgICAgICAgICAgICBpZiAoZmlsZV9leGlzdHMoYXNzZXQoJGRhdGEtPmljb24pKSl7IHVubGluayhhc3NldCgkZGF0YS0+aWNvbikpOyAgfQogICAgICAgICAgICAgICAgaWYgKGZpbGVfZXhpc3RzKGFzc2V0KCRkYXRhLT5iaWdfaWNvbikpKXsgdW5saW5rKGFzc2V0KCRkYXRhLT5iaWdfaWNvbikpOyAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAkZGF0YS0+dXBkYXRlKCRpbnB1dCk7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhTdWNjZXNzKCdVc2VyIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5Jyk7CiAgICAgICAgfWNhdGNoKFxFeGNlcHRpb24gJGUpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJGUtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQoKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGUgc3BlY2lmaWVkIHJlc291cmNlIGZyb20gc3RvcmFnZS4KICAgICAqCiAgICAgKiBAcGFyYW0gIGludCAgJGlkCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGRlc3Ryb3koJGlkKQogICAgewogICAgICAgICRkYXRhID0gTWVudTo6ZmluZE9yRmFpbCgkaWQpOwogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgU3ViTWVudTo6d2hlcmVJbignbWVudV9pZCcsIFskaWRdKS0+ZGVsZXRlKCk7CiAgICAgICAgICAgIFN1YlN1Yk1lbnU6OndoZXJlSW4oJ21lbnVfaWQnLCBbJGlkXSktPmRlbGV0ZSgpOwogICAgICAgICAgICAkZGF0YS0+ZGVsZXRlKCk7CiAgICAgICAgICAgICRidWcgPSAwOwogICAgICAgICAgICBpZiAoZmlsZV9leGlzdHMoYXNzZXQoJGRhdGEtPmljb24pKSl7IHVubGluayhhc3NldCgkZGF0YS0+aWNvbikpOyB9CiAgICAgICAgICAgIGlmIChmaWxlX2V4aXN0cyhhc3NldCgkZGF0YS0+YmlnX2ljb24pKSl7IHVubGluayhhc3NldCgkZGF0YS0+YmlnX2ljb24pKTsgfQogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAnTWVudSBEZWxldGVkIHN1Y2Nlc3NmdWxseScKICAgICAgICAgICAgXSk7CiAgICAgICAgfSBjYXRjaCAoXEV4Y2VwdGlvbiAkZSkgewogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgIH0KCgogICAgcHVibGljIGZ1bmN0aW9uIHBhZ2UoKXsKICAgICAgICAkbWF4X3NlcmlhbD1NZW51OjptYXgoJ3NlcmlhbF9udW0nKTsKICAgICAgICAkcGFnZT1QYWdlOjp3aGVyZSgnc3RhdHVzJywxKS0+cGx1Y2soJ25hbWUnLCdsaW5rJyk7CiAgICAgICAgcmV0dXJuIHZpZXcoJ2JhY2tlbmQubWVudS5wYWdlTWVudScsY29tcGFjdCgnbWF4X3NlcmlhbCcsJ3BhZ2UnKSk7CiAgICB9Cn0K