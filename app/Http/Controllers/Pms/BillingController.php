<?php
bolt_decrypt( __FILE__ , 'LmSq3P'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXI7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVySXRlbTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXJBdHRhY2htZW50Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcU3VwcGxpZXJQYXltZW50Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUXVvdGF0aW9uczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkTm90ZTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkU3VtbWFyeTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkSXRlbTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW47CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xJbnZlbnRvcnlNb2RlbHNcSW52ZW50b3J5QWN0aW9uQ29udHJvbDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFByb2R1Y3Q7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZnBcUmVxdWVzdFByb3Bvc2FsOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcU3VwcGxpZXJMZWRnZXJzOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcV2FyZWhvdXNlczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEJpbGxpbmdDaGFsYW47CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xNYWlsOwp1c2UgREIsIEF1dGgsIERhdGFUYWJsZXM7CgpjbGFzcyBCaWxsaW5nQ29udHJvbGxlciBleHRlbmRzIENvbnRyb2xsZXIKeyAgIAogICAgLyoqCiAgICAqIERpc3BsYXkgYSBsaXN0aW5nIG9mIHRoZSByZXNvdXJjZS4KICAgICoKICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGhlYWRlckNvbHVtbnMoJHZhbHVlPScnKQogICAgewogICAgICAgIHJldHVybiBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ3BvX2RhdGUnLCAncG9fZGF0ZScsICd0ZXh0LWxlZnQnLCd3aWR0aDoxNSUnXSwKICAgICAgICAgICAgWydzdXBwbGllcicsICdzdXBwbGllcicsICd0ZXh0LWxlZnQnXSwKICAgICAgICAgICAgWydyZWZlcmVuY2Vfbm8nLCAncmVmZXJlbmNlX25vJywgJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ3BvX3F0eScsICdwb19xdHknLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydncm5fcXR5JywgJ2dybl9xdHknLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydjdXJyZW5jeScsICdjdXJyZW5jeScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3BvX2Ftb3VudCcsICdwb19hbW91bnQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhZHZhbmNlX2Ftb3VudCcsICdhZHZhbmNlX2Ftb3VudCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2dybl9hbW91bnQnLCAnZ3JuX2Ftb3VudCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2JpbGxfYW1vdW50JywgJ2JpbGxfYW1vdW50JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnYmlsbF9ubycsICdiaWxsX25vJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnc3RhdHVzJywgJ3N0YXR1cycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2F0dGFjaG1lbnQnLCAnYXR0YWNobWVudCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2ludm9pY2UnLCAnaW52b2ljZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3ZhdCcsICd2YXQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhY3Rpb25zJywgJ2FjdGlvbnMnLCAndGV4dC1jZW50ZXIgYWN0aW9uJ10KICAgICAgICApOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBpbmRleCgpCiAgICB7CiAgICAgICAgdHJ5ewogICAgICAgICAgICAkcHVyY2hhc2VPcmRlciA9IFB1cmNoYXNlT3JkZXI6OndpdGgoWwogICAgICAgICAgICAgICAgJ3JlbEdvb2RSZWNlaXZlTm90ZScsCiAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVySXRlbXMnLAogICAgICAgICAgICAgICAgJ3JlbFBvQXR0YWNobWVudCcKICAgICAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVyZSgnaXNfc2VuZCcsJ3llcycpCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbEdvb2RSZWNlaXZlTm90ZScsZnVuY3Rpb24gKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlUmF3KCdwdXJjaGFzZV9vcmRlcnMuaWQ9Z29vZHNfcmVjZWl2ZWRfbm90ZXMucHVyY2hhc2Vfb3JkZXJfaWQnKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZUhhcygncmVsR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19ncm5fY29tcGxldGUnLCd5ZXMnKS0+d2hlcmUoJ3RvdGFsX2Ftb3VudCcsICc+JywgMCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmhhcygnZnJvbV9kYXRlJykgJiYgIWVtcHR5KHJlcXVlc3QoKS0+Z2V0KCdmcm9tX2RhdGUnKSksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZURhdGUoJ3BvX2RhdGUnLCAnPj0nLCBkYXRlKCdZLW0tZCcsc3RydG90aW1lKHJlcXVlc3QoKS0+Z2V0KCdmcm9tX2RhdGUnKSkpKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKHJlcXVlc3QoKS0+aGFzKCd0b19kYXRlJykgJiYgIWVtcHR5KHJlcXVlc3QoKS0+Z2V0KCd0b19kYXRlJykpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZURhdGUoJ3BvX2RhdGUnLCAnPD0nLCBkYXRlKCdZLW0tZCcsc3RydG90aW1lKHJlcXVlc3QoKS0+Z2V0KCd0b19kYXRlJykpKSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbighZGF0YXRhYmxlT3JkZXJpbmcoKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ2lkJywgJ2Rlc2MnKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhdGFibGVzOjpvZigkcHVyY2hhc2VPcmRlcikKICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdwb19kYXRlJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGUoJ1ktbS1kJyxzdHJ0b3RpbWUoJHZhbHVlcy0+cG9fZGF0ZSkpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdwb19kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdwb19kYXRlJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdwb19kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJCeSgncG9fZGF0ZScsICRvcmRlcik7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICAoaXNzZXQoJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPm5hbWUpID8gJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPm5hbWUuJyAoJy4kdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+Y29kZS4nKScgOiAnJyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKS0+b3JXaGVyZSgnY29kZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignc3VwcGxpZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBRdW90YXRpb25zOjpzZWxlY3QoJ3N1cHBsaWVycy5uYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdzdXBwbGllcnMnLCAnc3VwcGxpZXJzLmlkJywgJz0nLCAncXVvdGF0aW9ucy5zdXBwbGllcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3F1b3RhdGlvbnMuaWQnLCAncHVyY2hhc2Vfb3JkZXJzLnF1b3RhdGlvbl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdyZWZlcmVuY2Vfbm8nLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9ImJ0bi1saW5rIHNob3dQT0RldGFpbHMiIG9uY2xpY2s9InNob3dQT0RldGFpbHMoJCh0aGlzKSkiIGRhdGEtc3JjPSInLnJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywkdmFsdWVzLT5pZCkuJyI+Jy4kdmFsdWVzLT5yZWZlcmVuY2Vfbm8uJzwvYT4nOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdwb19xdHknLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+cmVsUHVyY2hhc2VPcmRlckl0ZW1zKSA/ICR2YWx1ZXMtPnJlbFB1cmNoYXNlT3JkZXJJdGVtcy0+c3VtKCdxdHknKSA6IDA7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2dybl9xdHknLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgICAgICAkdmFsdWVzLT5yZWxHb29kUmVjZWl2ZU5vdGUtPmVhY2goZnVuY3Rpb24gKCRpdCwkaSl7CiAgICAgICAgICAgICAgICAgICAgICAgICRpdFsnZ3JuX3F0eSddID0gJGl0LT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnN1bSgncXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR2YWx1ZXMtPnJlbEdvb2RSZWNlaXZlTm90ZS0+c3VtKCdncm5fcXR5Jyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2N1cnJlbmN5JywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICBpc3NldCgkdmFsdWVzLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPmNvZGUpID8gJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5LT5jb2RlIDogJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2N1cnJlbmN5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdjb2RlJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKS0+b3JXaGVyZSgnbmFtZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignY3VycmVuY3knLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBRdW90YXRpb25zOjpzZWxlY3QoJ2N1cnJlbmNpZXMuY29kZScpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignZXhjaGFuZ2VfcmF0ZXMnLCAnZXhjaGFuZ2VfcmF0ZXMuaWQnLCAnPScsICdxdW90YXRpb25zLmV4Y2hhbmdlX3JhdGVfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2N1cnJlbmNpZXMnLCAnY3VycmVuY2llcy5pZCcsICc9JywgJ2V4Y2hhbmdlX3JhdGVzLmN1cnJlbmN5X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncXVvdGF0aW9ucy5pZCcsICdwdXJjaGFzZV9vcmRlcnMucXVvdGF0aW9uX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncG9fYW1vdW50JywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN5c3RlbU1vbmV5Rm9ybWF0KCR2YWx1ZXMtPmdyb3NzX3ByaWNlKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYWR2YW5jZV9hbW91bnQnLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgICAgICAkcG9BZHZhbmNlID0gcG9BZHZhbmNlKCR2YWx1ZXMtPmlkKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHBvQWR2YW5jZVsnYWR2YW5jZSddOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdncm5fYW1vdW50JywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgJGdyblRvdGFsQW1vdW50ID0gJHZhbHVlcy0+cmVsR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luLT53aGVyZSgnaXNfZ3JuX2NvbXBsZXRlJywneWVzJyktPnN1bSgndG90YWxfYW1vdW50Jyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN5c3RlbU1vbmV5Rm9ybWF0KCRncm5Ub3RhbEFtb3VudCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2JpbGxfYW1vdW50JywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgaWYoaXNzZXQoJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50WzBdKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICRncm5Ub3RhbEFtb3VudCA9ICR2YWx1ZXMtPnJlbFBvQXR0YWNobWVudC0+c3VtKCdiaWxsX2Ftb3VudCcpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCRncm5Ub3RhbEFtb3VudCA+IDApID8gc3lzdGVtTW9uZXlGb3JtYXQoJGdyblRvdGFsQW1vdW50KSAgOiAnTm90IFVwZGF0ZWQgWWV0JzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdOb3QgVXBkYXRlZCBZZXQnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdiaWxsX25vJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgaWYoaXNzZXQoJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50WzBdKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICRwb0F0dGFjaG1lbnQgPSAkdmFsdWVzLT5yZWxQb0F0dGFjaG1lbnQtPndoZXJlKCdiaWxsX3R5cGUnLCdwbycpLT5maXJzdCgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHBvQXR0YWNobWVudC0+YmlsbF9udW1iZXIpID8gJHBvQXR0YWNobWVudC0+YmlsbF9udW1iZXIgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdOb3QgVXBsb2FkZWQgWWV0JzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignYmlsbF9ubycsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFBvQXR0YWNobWVudCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdiaWxsX251bWJlcicsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignYmlsbF9ubycsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFB1cmNoYXNlT3JkZXJBdHRhY2htZW50OjpzZWxlY3QoJ3B1cmNoYXNlX29yZGVyX2F0dGFjaG1lbnQuYmlsbF9udW1iZXInKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdwdXJjaGFzZV9vcmRlcl9hdHRhY2htZW50LnB1cmNoYXNlX29yZGVyX2lkJywgJ3B1cmNoYXNlX29yZGVycy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3N0YXR1cycsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgICR2YWx1ZXMtPnJlbEdvb2RSZWNlaXZlTm90ZS0+ZWFjaChmdW5jdGlvbiAoJGl0LCRpKXsKICAgICAgICAgICAgICAgICAgICAgICAgJGl0Wydncm5fcXR5J10gPSAkaXQtPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+c3VtKCdxdHknKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAkdG90YWxfZ3JuX3F0eSA9ICR2YWx1ZXMtPnJlbEdvb2RSZWNlaXZlTm90ZS0+c3VtKCdncm5fcXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgJHN0YXR1c3MgPScnOwogICAgICAgICAgICAgICAgICAgIGlmKCR2YWx1ZXMtPnJlbFB1cmNoYXNlT3JkZXJJdGVtcy0+c3VtKCdxdHknKSA9PSAkdG90YWxfZ3JuX3F0eT8/MCl7CiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0dXNzIC49JzxidXR0b24gY2xhc3M9ImJ0biBidG4tZGVmYXVsdCI+RnVsbCBSZWNlaXZlZDwvYnV0dG9uPic7CiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0dXNzLj0nIDxidXR0b24gY2xhc3M9ImJ0biBidG4tZGVmYXVsdCI+UGFydGlhbCBSZWNlaXZlZDwvYnV0dG9uPic7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiAkc3RhdHVzczsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYXR0YWNobWVudCcsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgIC8vIGlmKGNoZWNrUG9BdHRhY2htZW50KCR2YWx1ZXMtPmlkLCAicG8iKSAmJiAoJHZhbHVlcy0+Z3Jvc3NfcHJpY2UgPiAocG9BZHZhbmNlKCR2YWx1ZXMtPmlkKVsnYWR2YW5jZSddKyR2YWx1ZXMtPnJlbFBvQXR0YWNobWVudC0+c3VtKCdiaWxsX2Ftb3VudCcpKSkpewogICAgICAgICAgICAgICAgICAgIGlmKGNoZWNrUG9BdHRhY2htZW50KCR2YWx1ZXMtPmlkLCAicG8iKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBvbmNsaWNrPSJVcGxvYWRQT0F0dGFjaG1lbnQoJCh0aGlzKSkiIGNsYXNzPSJidG4gYnRuLWluZm8gYnRuLXhzIFVwbG9hZFBPQXR0YWNobWVudCIgZGF0YS1pZD0iJy4kdmFsdWVzLT5pZC4nIj48aSBjbGFzcz0ibGFzIGxhLXVwbG9hZCI+PC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignaW52b2ljZScsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgIGlmKGlzc2V0KCR2YWx1ZXMtPnJlbFBvQXR0YWNobWVudFswXSkpewogICAgICAgICAgICAgICAgICAgICAgICAkcG9BdHRhY2htZW50PSR2YWx1ZXMtPnJlbFBvQXR0YWNobWVudC0+d2hlcmUoJ2JpbGxfdHlwZScsJ3BvJyktPmZpcnN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFlbXB0eSgkcG9BdHRhY2htZW50LT5pbnZvaWNlX2ZpbGUpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iJy5hc3NldCgkcG9BdHRhY2htZW50LT5pbnZvaWNlX2ZpbGUpLiciIHRhcmdldD0iX19ibGFuayIgY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiPjxpIGNsYXNzPSJsYXMgbGEtZmlsZS1pbnZvaWNlIj48L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3ZhdCcsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgIGlmKGlzc2V0KCR2YWx1ZXMtPnJlbFBvQXR0YWNobWVudFswXSkpewogICAgICAgICAgICAgICAgICAgICAgICAkcG9BdHRhY2htZW50ID0gJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50LT53aGVyZSgnYmlsbF90eXBlJywncG8nKS0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoIWVtcHR5KCRwb0F0dGFjaG1lbnQtPnZhdF9jaGFsbGFuX2ZpbGUpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iJy5hc3NldCgkcG9BdHRhY2htZW50LT52YXRfY2hhbGxhbl9maWxlKS4nIiB0YXJnZXQ9Il9fYmxhbmsiICBjbGFzcz0iYnRuIGJ0bi1zdWNjZXNzIGJ0bi14cyIgdGl0bGU9IkNsaWNrIGhlcmUgdG8gdmlldyB2YXQgY2hhbGFuIj48aSBjbGFzcz0ibGFzIGxhLW1vbmV5LWNoZWNrLWFsdCI+PC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhY3Rpb25zJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgPSAnJzsKICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSc8ZGl2IGNsYXNzPSJidG4tZ3JvdXAiPjxidXR0b24gY2xhc3M9ImJ0biBkcm9wZG93bi10b2dnbGUiIGRhdGEtdG9nZ2xlPSJkcm9wZG93biI+PHNwYW4+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgZmlsbD0iY3VycmVudENvbG9yIiBjbGFzcz0iYmkgYmktdGhyZWUtZG90cy12ZXJ0aWNhbCIgdmlld0JveD0iMCAwIDE2IDE2Ij48cGF0aCBkPSJNOS41IDEzYTEuNSAxLjUgMCAxIDEtMyAwIDEuNSAxLjUgMCAwIDEgMyAwem0wLTVhMS41IDEuNSAwIDEgMS0zIDAgMS41IDEuNSAwIDAgMSAzIDB6bTAtNWExLjUgMS41IDAgMSAxLTMgMCAxLjUgMS41IDAgMCAxIDMgMHoiLz48L3N2Zz48L3NwYW4+PC9idXR0b24+PHVsIGNsYXNzPSJkcm9wZG93bi1tZW51Ij4nOwoKICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSc8bGk+PGEgaHJlZj0iJy5yb3V0ZSgncG1zLmJpbGxpbmctYXVkaXQucG8uaW52b2ljZS5saXN0JywkdmFsdWVzLT5pZCkuJyIgIGRhdGEtdG9nZ2xlPSJ0b29sdGlwIiB0aXRsZT0iQ2xpY2sgaGVyZSB0byB2aWV3IFBPIENoYWxsYW4iPjxpIGNsYXNzPSJsYXMgbGEtY2hlY2stY2lyY2xlIj48L2k+IENoYWxhbignLiR2YWx1ZXMtPnJlbEdvb2RSZWNlaXZlTm90ZS0+Y291bnQoKS4nKSA8L2E+PC9saT4nOwoKICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucy49JzxsaT48YSB0YXJnZXQ9Il9fYmxhbmsiIGhyZWY9Iicucm91dGUoJ3Btcy5iaWxsaW5nLWF1ZGl0LnBvLmludm9pY2UucHJpbnQnLCR2YWx1ZXMtPmlkKS4nIj48aSBjbGFzcz0ibGFzIGxhLXByaW50Ij48L2k+IFByaW50PC9hPjwvbGk+JzsKCiAgICAgICAgICAgICAgICAgICAgaWYoaXNzZXQoJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50WzBdKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICRwb0F0dGFjaG1lbnQgPSAkdmFsdWVzLT5yZWxQb0F0dGFjaG1lbnQtPndoZXJlKCdiaWxsX3R5cGUnLCdwbycpLT5maXJzdCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYoIWVtcHR5KCRwb0F0dGFjaG1lbnQtPnN0YXR1cykgJiYgICFlbXB0eSgkcG9BdHRhY2htZW50LT5yZW1hcmtzKSl7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSBwby1hdHRhY2htZW50PSInLnN0cmlwX3RhZ3MoJHBvQXR0YWNobWVudC0+cmVtYXJrcykuJyIgY2xhc3M9InZpZXdSZW1hcmtzIiBvbkNsaWNrPSJ2aWV3UmVtYXJrcygkKHRoaXMpKSI+PGkgY2xhc3M9ImxhcyBsYS1leWUiPjwvaT4gVmlldyBSZW1hcmtzPC9hPjwvbGk+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMuPSc8bGk+PGEgdGFyZ2V0PSJfX2JsYW5rIiBocmVmPSInLnJvdXRlKCdwbXMuYmlsbGluZy1hdWRpdC5wby5oaXN0b3J5JywkdmFsdWVzLT5pZCkuJyIgdGl0bGU9Ikhpc3RvcnkiPjxpIGNsYXNzPSJsYXMgbGEtdXNlci1jbG9jayI+PC9pPiBIaXN0b3J5PC9hPjwvbGk+JzsKCiAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzwvdWw+PC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGFjdGlvbnM7CgogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ3N1cHBsaWVyJywncmVmZXJlbmNlX25vJywnYmlsbF9hbW91bnQnLCdzdGF0dXMnLCdhdHRhY2htZW50JywnaW52b2ljZScsJ3ZhdCcsICdhY3Rpb25zJ10pCiAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5iaWxsaW5nLnBvLWxpc3QnLFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJ1BPIExpc3QnLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5oZWFkZXJDb2x1bW5zKCkKICAgICAgICAgICAgXSk7CgogICAgICAgIH1jYXRjaChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhXYXJuaW5nKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGF0dGFjaG1lbnRVcGxvYWRGb3JtKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHBvID0gUHVyY2hhc2VPcmRlcjo6d2l0aChbJ3JlbEdvb2RSZWNlaXZlTm90ZScsJ3JlbEdvb2RSZWNlaXZlTm90ZS5yZWxHb29kc1JlY2VpdmVkSXRlbXMnLCdyZWxQdXJjaGFzZU9yZGVySXRlbXMnLCdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywncmVsUG9BdHRhY2htZW50J10pCiAgICAgICAgLT53aGVyZSgnaWQnLCRyZXF1ZXN0LT5pZCkKICAgICAgICAtPmZpcnN0KCk7CgogICAgICAgIGlmICgkcG8tPnJlbEdvb2RSZWNlaXZlTm90ZS0+Y291bnQoKSA+IDApIHsKICAgICAgICAgICAgZm9yZWFjaCgkcG8tPnJlbEdvb2RSZWNlaXZlTm90ZSBhcyAka2V5PT4kZ3JuKXsKICAgICAgICAgICAgICRwb0F0dGFjaG1lbnQ9UHVyY2hhc2VPcmRlckF0dGFjaG1lbnQ6OndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsJHBvLT5pZCktPndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywkZ3JuLT5pZCktPndoZXJlKCdiaWxsX3R5cGUnLCdncm4nKS0+d2hlcmVJbignc3RhdHVzJywgWydhcHByb3ZlZCddKS0+Zmlyc3QoKTsKCiAgICAgICAgICAgICBpZighaXNzZXQoJHBvQXR0YWNobWVudC0+aWQpKXsKCiAgICAgICAgICAgICAgICAkZ29vZHNSZWNlaXZlSXRlbXNJZD1Hb29kc1JlY2VpdmVkSXRlbTo6d2hlcmUoJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnLCRncm4tPmlkKS0+cGx1Y2soJ2lkJyktPmFsbCgpOwoKICAgICAgICAgICAgICAgICRncm5bJ2dybl9hbW91bnQnXSA9IEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbjo6d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywkcG8tPmlkKQogICAgICAgICAgICAgICAgLT53aGVyZUluKCdnb29kc19yZWNlaXZlZF9pdGVtX2lkJywkZ29vZHNSZWNlaXZlSXRlbXNJZCkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2lzX2dybl9jb21wbGV0ZScsJ3llcycpCiAgICAgICAgICAgICAgICAtPnN1bSgndG90YWxfYW1vdW50Jyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgJHBvX2JpbGwgPSBQdXJjaGFzZU9yZGVyQXR0YWNobWVudDo6d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywkcmVxdWVzdC0+aWQpCiAgICAtPndoZXJlKCdiaWxsX3R5cGUnLCAncG8nKQogICAgLT53aGVyZUluKCdzdGF0dXMnLCBbJ3BlbmRpbmcnLCAnaGFsdCddKQogICAgLT5maXJzdCgpOwoKCgogICAgaWYgKCRwby0+cmVsUXVvdGF0aW9uLT50eXBlPT0nZGlyZWN0LXB1cmNoYXNlJykgewogICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5iaWxsaW5nLmRpcmVjdC1wdXJjaGFzZS5faXRvX3BvX2F0dGFjaGVtZW50X2Zvcm0nLCBjb21wYWN0KCdwbycsICdwb19iaWxsJykpOwogICAgfQoKICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5iaWxsaW5nLl9wby1hdHRhY2hlbWVudC11cGxvYWQnLCBjb21wYWN0KCdwbycsICdwb19iaWxsJykpOwp9CgpwdWJsaWMgZnVuY3Rpb24gcG9JbnZvaWNlTGlzdCgkaWQpCnsKICAgIHRyeXsKICAgICAgICAkdGl0bGU9IlB1cmNoYXNlIE9yZGVyIFdpc2UgQ2hhbGxhbiBMaXN0IjsKCiAgICAgICAgJHB1cmNoYXNlT3JkZXIgPSBQdXJjaGFzZU9yZGVyOjp3aXRoKFsncmVsR29vZFJlY2VpdmVOb3RlJywncmVsR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luJywncmVsUHVyY2hhc2VPcmRlckl0ZW1zJywncmVsUXVvdGF0aW9uJywncmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeSddKS0+ZmluZE9yRmFpbCgkaWQpOwogICAgICAgICRjdXJyZW5jeSA9ICRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPmNvZGU7CgogICAgICAgIGlmICgkcHVyY2hhc2VPcmRlci0+cmVsR29vZFJlY2VpdmVOb3RlLT5jb3VudCgpID4gMCkgewogICAgICAgICAgICBmb3JlYWNoKCRwdXJjaGFzZU9yZGVyLT5yZWxHb29kUmVjZWl2ZU5vdGUgYXMgJGtleT0+JGdybil7CgogICAgICAgICAgICAgICAgJGdvb2RzUmVjZWl2ZUl0ZW1zSWQ9R29vZHNSZWNlaXZlZEl0ZW06OndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywkZ3JuLT5pZCktPnBsdWNrKCdpZCcpLT5hbGwoKTsKCiAgICAgICAgICAgICAgICAkZ3JuWydncm5fYW1vdW50J10gPSBHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW46OndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsJHB1cmNoYXNlT3JkZXItPmlkKQogICAgICAgICAgICAgICAgLT53aGVyZUluKCdnb29kc19yZWNlaXZlZF9pdGVtX2lkJywkZ29vZHNSZWNlaXZlSXRlbXNJZCkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2lzX2dybl9jb21wbGV0ZScsJ3llcycpCiAgICAgICAgICAgICAgICAtPnN1bSgndG90YWxfYW1vdW50Jyk7CgogICAgICAgICAgICAgICAgJGdyblsncG9BdHRhY2htZW50J109UHVyY2hhc2VPcmRlckF0dGFjaG1lbnQ6OndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsJHB1cmNoYXNlT3JkZXItPmlkKQogICAgICAgICAgICAgICAgLT53aGVyZSgnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsICRncm4tPmlkKQogICAgICAgICAgICAgICAgLT53aGVyZSgnYmlsbF90eXBlJywnZ3JuJykKICAgICAgICAgICAgICAgIC0+Zmlyc3QoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmJpbGxpbmcucG8taW52b2ljZS1saXN0Jyxjb21wYWN0KCd0aXRsZScsICdwdXJjaGFzZU9yZGVyJywgJ2N1cnJlbmN5JykpOwogICAgfWNhdGNoKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICB9Cn0KCnB1YmxpYyBmdW5jdGlvbiBwb0ludm9pY2VMaXN0R3JuZGV0YWlscygkaWQpCnsKICAgIHRyeXsKICAgICAgICAkZ3JuID0gR29vZHNSZWNlaXZlZE5vdGU6OmZpbmRPckZhaWwoJGlkKTsKCiAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmJpbGxpbmcuZGlyZWN0LXB1cmNoYXNlLnBvLWludm9pY2UtbGlzdC1ncm4tZGV0YWlscycsY29tcGFjdCgnZ3JuJykpOwogICAgfWNhdGNoKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICByZXR1cm4gJyc7CiAgICB9Cn0KCnB1YmxpYyBmdW5jdGlvbiBhdWRpdFBvSW52b2ljZUxpc3QoJGlkKQp7CiAgICB0cnl7CgogICAgICAgICRwdXJjaGFzZU9yZGVyPVB1cmNoYXNlT3JkZXI6OmZpbmRPckZhaWwoJGlkKTsKCiAgICAgICAgJHRpdGxlPSJQdXJjaGFzZSBPcmRlciBXaXNlIENoYWxsYW4gTGlzdCAoIi4kcHVyY2hhc2VPcmRlci0+cmVmZXJlbmNlX25vLicpJzsKCiAgICAgICAgJGN1cnJlbmN5ID0gJHB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+Y29kZTsKCiAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmJpbGxpbmcuYXVkaXQtcG8taW52b2ljZS1saXN0Jyxjb21wYWN0KCd0aXRsZScsJ3B1cmNoYXNlT3JkZXInLCAnY3VycmVuY3knKSk7CiAgICB9Y2F0Y2goXFRocm93YWJsZSAkdGgpewogICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhXYXJuaW5nKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgIH0KfQoKcHVibGljIGZ1bmN0aW9uIHBvSW52b2ljZVByaW50KCRpZCkKewogICAgdHJ5ewogICAgICAgICR0aXRsZSA9ICJQdXJjaGFzZSBPcmRlciI7CiAgICAgICAgJHB1cmNoYXNlT3JkZXIgPSBQdXJjaGFzZU9yZGVyOjp3aXRoKFsKICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXJJdGVtcy5yZWxQcm9kdWN0LnByb2R1Y3RVbml0JywKICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXJJdGVtcy5yZWxQcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywKICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXJJdGVtcy5yZWxQcm9kdWN0LmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgICdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywKICAgICAgICAgICAgJ3JlbFF1b3RhdGlvbi5leGNoYW5nZVJhdGUuY3VycmVuY3knLAogICAgICAgICAgICAnVW5pdCcsCiAgICAgICAgICAgICdwdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJywKICAgICAgICAgICAgJ3B1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMucmVxdWlzaXRpb24nCiAgICAgICAgXSktPmZpbmRPckZhaWwoJGlkKTsKCiAgICAgICAgJGRlbGl2ZXJ5Q29udGFjdCA9IFxBcHBcVXNlcjo6ZmluZChnZXRNYW5hZ2VySW5mbygnU3RvcmUtTWFuYWdlcicsICRwdXJjaGFzZU9yZGVyLT5ocl91bml0X2lkKSk7CgogICAgICAgIHJldHVybiB2aWV3TVBERigncG1zLmJhY2tlbmQucGFnZXMuYmlsbGluZy5wby1pbnZvaWNlLXBkZicsIFsKICAgICAgICAgICAgJ3RpdGxlJyA9PiAkdGl0bGUsCiAgICAgICAgICAgICdwdXJjaGFzZU9yZGVyJyA9PiAkcHVyY2hhc2VPcmRlciwKICAgICAgICAgICAgJ2RlbGl2ZXJ5Q29udGFjdCcgPT4gJGRlbGl2ZXJ5Q29udGFjdAogICAgICAgIF0sICR0aXRsZSwgJHRpdGxlKTsKCiAgICAgICAgICAgIC8vIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5iaWxsaW5nLnBvLWludm9pY2UtcHJpbnQnLGNvbXBhY3QoJ3RpdGxlJywncHVyY2hhc2VPcmRlcicsICdkZWxpdmVyeUNvbnRhY3QnKSk7CgogICAgfWNhdGNoKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICB9Cn0KCnB1YmxpYyBmdW5jdGlvbiBwb0ludm9pY2VCaWxscygkaWQpCnsKICAgIHRyeXsKICAgICAgICAkcHVyY2hhc2VPcmRlciA9IFB1cmNoYXNlT3JkZXI6OndpdGgoWwogICAgICAgICAgICAncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsCiAgICAgICAgICAgICdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywKICAgICAgICAgICAgJ3JlbFBvQXR0YWNobWVudCcKICAgICAgICBdKS0+ZmluZE9yRmFpbCgkaWQpOwoKICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuYmlsbGluZy5wby1pbnZvaWNlLWJpbGxzJywgWwogICAgICAgICAgICAncHVyY2hhc2VPcmRlcicgPT4gJHB1cmNoYXNlT3JkZXIKICAgICAgICBdKTsKCiAgICB9Y2F0Y2goXFRocm93YWJsZSAkdGgpewogICAgICAgIHJldHVybiAkdGgtPmdldE1lc3NhZ2UoKTsKICAgIH0KfQoKcHVibGljIGZ1bmN0aW9uIGJQT2hlYWRlckNvbHVtbnMoJHZhbHVlPScnKQp7CiAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgIFsncG9fZGF0ZScsICdwb19kYXRlJywgJ3RleHQtbGVmdCcsJ3dpZHRoOjEwJSddLAogICAgICAgIFsnc3VwcGxpZXInLCAnc3VwcGxpZXInLCAndGV4dC1sZWZ0J10sCiAgICAgICAgWydyZWZlcmVuY2Vfbm8nLCAncmVmZXJlbmNlX25vJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgWydwb19xdHknLCAncG9fcXR5JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgWydncm5fcXR5JywgJ2dybl9xdHknLCAndGV4dC1jZW50ZXInXSwKICAgICAgICBbJ2N1cnJlbmN5JywgJ2N1cnJlbmN5JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgWydwb19hbW91bnQnLCAncG9fYW1vdW50JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgWydhZHZhbmNlX2Ftb3VudCcsICdhZHZhbmNlX2Ftb3VudCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgIFsnZ3JuX2Ftb3VudCcsICdncm5fYW1vdW50JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgWydiaWxsX2Ftb3VudCcsICdiaWxsX2Ftb3VudCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgIFsnc3RhdHVzJywgJ3N0YXR1cycsICd0ZXh0LWNlbnRlciddLAogICAgICAgIFsnaW52b2ljZScsICdpbnZvaWNlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgWyd2YXQnLCAndmF0JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgWydhcHByb3ZlZCcsICdhcHByb3ZlZCcsICd0ZXh0LWNlbnRlcicsJ3dpZHRoOjE1JSFpbXBvcnRhbnQnXSwKICAgICAgICBbJ2FjdGlvbnMnLCAnYWN0aW9ucycsICd0ZXh0LWNlbnRlciBhY3Rpb24nXQogICAgKTsKfQpwdWJsaWMgZnVuY3Rpb24gYmlsbGluZ1BPQXR0YWNobWVudExpc3QoKQp7CiAgICB0cnl7CgogICAgICAgICR0aXRsZSA9ICJCaWxsaW5nIEF0dGFjaG1lbnQgTGlzdCI7CgogICAgICAgICRwdXJjaGFzZV9vcmRlciA9IFB1cmNoYXNlT3JkZXI6OndpdGgoWwogICAgICAgICAgICAncmVsR29vZFJlY2VpdmVOb3RlLnJlbEdvb2RzUmVjZWl2ZWRJdGVtcycsCiAgICAgICAgICAgICdyZWxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW4nLAogICAgICAgICAgICAncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsCiAgICAgICAgICAgICdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywKICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXJJdGVtcycsCiAgICAgICAgICAgICdyZWxQb0F0dGFjaG1lbnQnCiAgICAgICAgXSkKICAgICAgICAtPndoZXJlKCdpc19zZW5kJywgJ3llcycpCiAgICAgICAgLT53aGVyZUhhcygncmVsUG9BdHRhY2htZW50JywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignYmlsbF90eXBlJywgWydwbycsICdncm4nXSk7CiAgICAgICAgfSkKICAgICAgICAtPndoZXJlSGFzKCdyZWxHb29kUmVjZWl2ZU5vdGUnLGZ1bmN0aW9uICgkcXVlcnkpewogICAgICAgICAgICAkcXVlcnktPndoZXJlUmF3KCdwdXJjaGFzZV9vcmRlcnMuaWQ9Z29vZHNfcmVjZWl2ZWRfbm90ZXMucHVyY2hhc2Vfb3JkZXJfaWQnKTsKICAgICAgICB9KQogICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmhhcygnZnJvbV9kYXRlJykgJiYgIWVtcHR5KHJlcXVlc3QoKS0+Z2V0KCdmcm9tX2RhdGUnKSksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlRGF0ZSgncG9fZGF0ZScsICc+PScsIGRhdGUoJ1ktbS1kJyxzdHJ0b3RpbWUocmVxdWVzdCgpLT5nZXQoJ2Zyb21fZGF0ZScpKSkpOwogICAgICAgIH0pCiAgICAgICAgLT53aGVuKHJlcXVlc3QoKS0+aGFzKCd0b19kYXRlJykgJiYgIWVtcHR5KHJlcXVlc3QoKS0+Z2V0KCd0b19kYXRlJykpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAkcXVlcnktPndoZXJlRGF0ZSgncG9fZGF0ZScsICc8PScsIGRhdGUoJ1ktbS1kJyxzdHJ0b3RpbWUocmVxdWVzdCgpLT5nZXQoJ3RvX2RhdGUnKSkpKTsKICAgICAgICB9KQogICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmhhcygnc3RhdHVzJykgJiYgIWVtcHR5KHJlcXVlc3QoKS0+Z2V0KCdzdGF0dXMnKSksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQb0F0dGFjaG1lbnQnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3N0YXR1cycsIHJlcXVlc3QoKS0+Z2V0KCdzdGF0dXMnKSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pCiAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCdpZCcsJ2Rlc2MnKTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgIHJldHVybiBEYXRhdGFibGVzOjpvZigkcHVyY2hhc2Vfb3JkZXIpCiAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3BvX2RhdGUnLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgIHJldHVybiBkYXRlKCdZLW0tZCcsc3RydG90aW1lKCR2YWx1ZXMtPnBvX2RhdGUpKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3BvX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncG9fZGF0ZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3BvX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3BvX2RhdGUnLCAkb3JkZXIpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPmFkZENvbHVtbignc3VwcGxpZXInLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgIHJldHVybiAgKGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5uYW1lKSA/ICR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5uYW1lLicgKCcuJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPmNvZGUuJyknIDogJycpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPmZpbHRlckNvbHVtbignc3VwcGxpZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKS0+b3JXaGVyZSgnY29kZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJykKICAgICAgICAgICAgICAgICAgICAtPm9yV2hlcmUoJ2NvZGUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBRdW90YXRpb25zOjpzZWxlY3QoJ3N1cHBsaWVycy5uYW1lJykKICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ3N1cHBsaWVycycsICdzdXBwbGllcnMuaWQnLCAnPScsICdxdW90YXRpb25zLnN1cHBsaWVyX2lkJykKICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdxdW90YXRpb25zLmlkJywgJ3B1cmNoYXNlX29yZGVycy5xdW90YXRpb25faWQnKQogICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdyZWZlcmVuY2Vfbm8nLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iYnRuLWxpbmsgc2hvd1BPRGV0YWlscyIgb25jbGljaz0ic2hvd1BPRGV0YWlscygkKHRoaXMpKSIgZGF0YS1zcmM9Iicucm91dGUoJ3Btcy5wdXJjaGFzZS5vcmRlci1saXN0LnNob3cnLCR2YWx1ZXMtPmlkKS4nIj4nLiR2YWx1ZXMtPnJlZmVyZW5jZV9uby4nPC9hPic7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdwb19xdHknLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkdmFsdWVzLT5yZWxQdXJjaGFzZU9yZGVySXRlbXMpID8gJHZhbHVlcy0+cmVsUHVyY2hhc2VPcmRlckl0ZW1zLT5zdW0oJ3F0eScpIDogMDsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2dybl9xdHknLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgICR2YWx1ZXMtPnJlbEdvb2RSZWNlaXZlTm90ZS0+ZWFjaChmdW5jdGlvbiAoJGl0LCRpKXsKICAgICAgICAgICAgICAgICAgICAkaXRbJ2dybl9xdHknXSA9ICRpdC0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5zdW0oJ3F0eScpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gJHZhbHVlcy0+cmVsR29vZFJlY2VpdmVOb3RlLT5zdW0oJ2dybl9xdHknKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2N1cnJlbmN5JywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICByZXR1cm4gIGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+Y29kZSkgPyAkdmFsdWVzLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPmNvZGUgOiAnJzsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2N1cnJlbmN5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnY29kZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyktPm9yV2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2N1cnJlbmN5JywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBRdW90YXRpb25zOjpzZWxlY3QoJ2N1cnJlbmNpZXMuY29kZScpCiAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdleGNoYW5nZV9yYXRlcycsICdleGNoYW5nZV9yYXRlcy5pZCcsICc9JywgJ3F1b3RhdGlvbnMuZXhjaGFuZ2VfcmF0ZV9pZCcpCiAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdjdXJyZW5jaWVzJywgJ2N1cnJlbmNpZXMuaWQnLCAnPScsICdleGNoYW5nZV9yYXRlcy5jdXJyZW5jeV9pZCcpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncXVvdGF0aW9ucy5pZCcsICdwdXJjaGFzZV9vcmRlcnMucXVvdGF0aW9uX2lkJykKICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdwb19hbW91bnQnLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgIHJldHVybiBzeXN0ZW1Nb25leUZvcm1hdCgkdmFsdWVzLT5ncm9zc19wcmljZSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhZHZhbmNlX2Ftb3VudCcsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgJHBvQWR2YW5jZSA9IHBvQWR2YW5jZSgkdmFsdWVzLT5pZCk7CiAgICAgICAgICAgICAgICByZXR1cm4gJHBvQWR2YW5jZVsnYWR2YW5jZSddOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPmFkZENvbHVtbignZ3JuX2Ftb3VudCcsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgJGdyblRvdGFsQW1vdW50ID0gJHZhbHVlcy0+cmVsR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luLT53aGVyZSgnaXNfZ3JuX2NvbXBsZXRlJywneWVzJyktPnN1bSgndG90YWxfYW1vdW50Jyk7CiAgICAgICAgICAgICAgICByZXR1cm4gc3lzdGVtTW9uZXlGb3JtYXQoJGdyblRvdGFsQW1vdW50KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2JpbGxfYW1vdW50JywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICBpZigkdmFsdWVzLT5yZWxQb0F0dGFjaG1lbnQtPndoZXJlKCdiaWxsX3R5cGUnLCAncG8nKS0+Y291bnQoKSA+IDApewogICAgICAgICAgICAgICAgICAgICRncm5Ub3RhbEFtb3VudCA9ICR2YWx1ZXMtPnJlbFBvQXR0YWNobWVudC0+d2hlcmUoJ2JpbGxfdHlwZScsICdwbycpLT5zdW0oJ2JpbGxfYW1vdW50Jyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgkZ3JuVG90YWxBbW91bnQgPiAwKSA/IHN5c3RlbU1vbmV5Rm9ybWF0KCRncm5Ub3RhbEFtb3VudCkgIDogJ05vdCBVcGRhdGVkIFlldCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gJ05vdCBVcGRhdGVkIFlldCc7CiAgICAgICAgICAgIH0pCgogICAgICAgICAgICAtPmFkZENvbHVtbignc3RhdHVzJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAkdmFsdWVzLT5yZWxHb29kUmVjZWl2ZU5vdGUtPmVhY2goZnVuY3Rpb24gKCRpdCwkaSl7CiAgICAgICAgICAgICAgICAgICAgJGl0Wydncm5fcXR5J10gPSAkaXQtPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+c3VtKCdxdHknKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgJHRvdGFsX2dybl9xdHkgPSAkdmFsdWVzLT5yZWxHb29kUmVjZWl2ZU5vdGUtPnN1bSgnZ3JuX3F0eScpOwoKICAgICAgICAgICAgICAgICRzdGF0dXNzID0nJzsKICAgICAgICAgICAgICAgIGlmKCR2YWx1ZXMtPnJlbFB1cmNoYXNlT3JkZXJJdGVtcy0+c3VtKCdxdHknKSA9PSAkdG90YWxfZ3JuX3F0eT8/MCl7CiAgICAgICAgICAgICAgICAgICAgJHN0YXR1c3MgLj0nPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1kZWZhdWx0Ij5GdWxsIFJlY2VpdmVkPC9idXR0b24+JzsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICRzdGF0dXNzLj0nIDxidXR0b24gY2xhc3M9ImJ0biBidG4tZGVmYXVsdCI+UGFydGlhbCBSZWNlaXZlZDwvYnV0dG9uPic7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gJHN0YXR1c3M7CiAgICAgICAgICAgIH0pCgogICAgICAgICAgICAtPmFkZENvbHVtbignaW52b2ljZScsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgaWYoaXNzZXQoJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50WzBdKSl7CiAgICAgICAgICAgICAgICAgICAgJHBvQXR0YWNobWVudD0kdmFsdWVzLT5yZWxQb0F0dGFjaG1lbnQtPndoZXJlKCdiaWxsX3R5cGUnLCdwbycpLT5maXJzdCgpOwogICAgICAgICAgICAgICAgICAgIGlmKCFlbXB0eSgkcG9BdHRhY2htZW50LT5pbnZvaWNlX2ZpbGUpKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSInLmFzc2V0KCRwb0F0dGFjaG1lbnQtPmludm9pY2VfZmlsZSkuJyIgdGFyZ2V0PSJfX2JsYW5rIiBjbGFzcz0iYnRuIGJ0bi1zdWNjZXNzIGJ0bi14cyI+PGkgY2xhc3M9ImxhcyBsYS1maWxlLWludm9pY2UiPjwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+YWRkQ29sdW1uKCd2YXQnLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgIGlmKGlzc2V0KCR2YWx1ZXMtPnJlbFBvQXR0YWNobWVudFswXSkpewogICAgICAgICAgICAgICAgICAgICRwb0F0dGFjaG1lbnQgPSAkdmFsdWVzLT5yZWxQb0F0dGFjaG1lbnQtPndoZXJlKCdiaWxsX3R5cGUnLCdwbycpLT5maXJzdCgpOwogICAgICAgICAgICAgICAgICAgIGlmKCFlbXB0eSgkcG9BdHRhY2htZW50LT52YXRfY2hhbGxhbl9maWxlKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iJy5hc3NldCgkcG9BdHRhY2htZW50LT52YXRfY2hhbGxhbl9maWxlKS4nIiB0YXJnZXQ9Il9fYmxhbmsiICBjbGFzcz0iYnRuIGJ0bi1zdWNjZXNzIGJ0bi14cyIgdGl0bGU9IkNsaWNrIGhlcmUgdG8gdmlldyB2YXQgY2hhbGFuIj48aSBjbGFzcz0ibGFzIGxhLW1vbmV5LWNoZWNrLWFsdCI+PC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FwcHJvdmVkJywgZnVuY3Rpb24gKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgJGxlZGdlcnMgPSBTdXBwbGllckxlZGdlcnM6OndoZXJlSGFzKCdyZWxTdXBwbGllclBheW1lbnQnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkdmFsdWVzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncHVyY2hhc2Vfb3JkZXJfaWQnLCAkdmFsdWVzLT5pZCkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdiaWxsX3R5cGUnLCAncG8nKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3N0YXR1cycsICdhcHByb3ZlZCcpOwogICAgICAgICAgICAgICAgfSktPmNvdW50KCk7CiAgICAgICAgICAgICAgICAkYXBwcm92ZSA9ICc8ZGl2IHN0eWxlPSJ3aWR0aDogMTAwcHgiPic7CiAgICAgICAgICAgICAgICAkcG9BdHRhY2htZW50ID0gJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50LT53aGVyZSgnYmlsbF90eXBlJywncG8nKTsKCiAgICAgICAgICAgICAgICBpZiAoJGxlZGdlcnMgPT0gMCAmJiAkcG9BdHRhY2htZW50LT5jb3VudCgpID4gMCkgewogICAgICAgICAgICAgICAgICAgIGlmKGlzc2V0KCRwb0F0dGFjaG1lbnQtPmZpcnN0KCktPnN0YXR1cykgJiYgJHBvQXR0YWNobWVudC0+Zmlyc3QoKS0+c3RhdHVzID09PSAnYXBwcm92ZWQnKXsKICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gJzxhIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1zdWNjZXNzIiB0aXRsZT0iQXBwcm92ZWQiPjxpIGNsYXNzPSJsYSBsYS1jaGVjayI+PC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92ZSAuPSAnPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+PHNlbGVjdCBjbGFzcz0iY2hhbmdlU3RhdHVzIGZvcm0tY29udHJvbCIgb25jaGFuZ2U9ImNoYW5nZVN0YXR1cygkKHRoaXMpKSIgc3R5bGU9IndpZHRoOiAxMDAlIiBiaWxsLXR5cGU9InBvIiBwby1pZD0iJy4kdmFsdWVzLT5pZC4nIiBpZD0iY2hhbmdlU3RhdHVzJy4kdmFsdWVzLT5pZC4nIj4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gJzxvcHRpb24gJy4oaXNzZXQoJHBvQXR0YWNobWVudFswXS0+c3RhdHVzKSAmJiAkcG9BdHRhY2htZW50WzBdLT5zdGF0dXMgPT09ICdwZW5kaW5nJz8nc2VsZWN0ZWQnOiIiKS4nIHZhbHVlPSJwZW5kaW5nIj5QZW5kaW5nPC9vcHRpb24+JzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gJzxvcHRpb24gJy4oaXNzZXQoJHBvQXR0YWNobWVudFswXS0+c3RhdHVzKSAmJiAkcG9BdHRhY2htZW50WzBdLT5zdGF0dXMgPT09ICdhcHByb3ZlZCc/J3NlbGVjdGVkJzoiIikuJyB2YWx1ZT0iYXBwcm92ZWQiPkFwcHJvdmVkPC9vcHRpb24+JzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gJzxvcHRpb24gJy4oaXNzZXQoJHBvQXR0YWNobWVudFswXS0+c3RhdHVzKSAmJiAkcG9BdHRhY2htZW50WzBdLT5zdGF0dXMgPT09ICdoYWx0Jz8nc2VsZWN0ZWQnOiIiKS4nIHZhbHVlPSJoYWx0Ij5IYWx0PC9vcHRpb24+JzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gICc8L3NlbGVjdD48L2Rpdj4nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkYXBwcm92ZSAuPSAnPGEgdGFyZ2V0PSJfX2JsYW5rIiBocmVmPSInLnJvdXRlKCdwbXMuYmlsbGluZy1hdWRpdC5wby5oaXN0b3J5JywkdmFsdWVzLT5pZCkuJyIgY2xhc3M9ImJ0biBidG4td2FybmluZyBidG4teHMiIHRpdGxlPSJIaXN0b3J5Ij48aSBjbGFzcz0ibGFzIGxhLXVzZXItY2xvY2siPjwvaT48L2E+JzsKCgogICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gJzxkaXY+JzsKICAgICAgICAgICAgICAgIHJldHVybiAkYXBwcm92ZTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgICRhY3Rpb25zID0gJyc7CiAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSc8ZGl2IGNsYXNzPSJidG4tZ3JvdXAiPjxidXR0b24gY2xhc3M9ImJ0biBkcm9wZG93bi10b2dnbGUiIGRhdGEtdG9nZ2xlPSJkcm9wZG93biI+PHNwYW4+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgZmlsbD0iY3VycmVudENvbG9yIiBjbGFzcz0iYmkgYmktdGhyZWUtZG90cy12ZXJ0aWNhbCIgdmlld0JveD0iMCAwIDE2IDE2Ij48cGF0aCBkPSJNOS41IDEzYTEuNSAxLjUgMCAxIDEtMyAwIDEuNSAxLjUgMCAwIDEgMyAwem0wLTVhMS41IDEuNSAwIDEgMS0zIDAgMS41IDEuNSAwIDAgMSAzIDB6bTAtNWExLjUgMS41IDAgMSAxLTMgMCAxLjUgMS41IDAgMCAxIDMgMHoiLz48L3N2Zz48L3NwYW4+PC9idXR0b24+PHVsIGNsYXNzPSJkcm9wZG93bi1tZW51Ij4nOwogICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0nPGxpPjxhIGhyZWY9Iicucm91dGUoJ3Btcy5iaWxsaW5nLWF1ZGl0LmF1ZGl0LnBvLmludm9pY2UubGlzdCcsJHZhbHVlcy0+aWQpLiciICBkYXRhLXRvZ2dsZT0idG9vbHRpcCIgdGl0bGU9IkNsaWNrIGhlcmUgdG8gdmlldyBQTyBDaGFsbGFuIj48aSBjbGFzcz0ibGFzIGxhLWNoZWNrLWNpcmNsZSI+PC9pPiBDaGFsYW4oJy4kdmFsdWVzLT5yZWxHb29kUmVjZWl2ZU5vdGUtPmNvdW50KCkuJykgPC9hPjwvbGk+CiAgICAgICAgICAgICAgICA8bGk+PGEgdGFyZ2V0PSJfX2JsYW5rIiBocmVmPSInLnJvdXRlKCdwbXMuYmlsbGluZy1hdWRpdC5wby5pbnZvaWNlLnByaW50JywkdmFsdWVzLT5pZCkuJyI+PGkgY2xhc3M9ImxhcyBsYS1wcmludCI+PC9pPiBQcmludDwvYT48L2xpPic7CgogICAgICAgICAgICAgICAgaWYoaXNzZXQoJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50WzBdKSl7CiAgICAgICAgICAgICAgICAgICAgJHBvQXR0YWNobWVudCA9ICR2YWx1ZXMtPnJlbFBvQXR0YWNobWVudC0+d2hlcmUoJ2JpbGxfdHlwZScsJ3BvJyktPmZpcnN0KCk7CgogICAgICAgICAgICAgICAgICAgIGlmKCFlbXB0eSgkcG9BdHRhY2htZW50LT5zdGF0dXMpICYmICAhZW1wdHkoJHBvQXR0YWNobWVudC0+cmVtYXJrcykpewoKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSBwby1hdHRhY2htZW50PSInLnN0cmlwX3RhZ3MoJHBvQXR0YWNobWVudC0+cmVtYXJrcykuJyIgY2xhc3M9InZpZXdSZW1hcmtzIiBvbkNsaWNrPSJ2aWV3UmVtYXJrcygkKHRoaXMpKSI+PGkgY2xhc3M9ImxhcyBsYS1leWUiPjwvaT4gVmlldyBSZW1hcmtzPC9hPjwvbGk+JzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPC91bD48L2Rpdj4nOwogICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwoKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsnc3VwcGxpZXInLCdyZWZlcmVuY2Vfbm8nLCdiaWxsX2Ftb3VudCcsJ3N0YXR1cycsJ2FwcHJvdmVkJywnaW52b2ljZScsJ3ZhdCcsICdhY3Rpb25zJ10pCiAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5iaWxsaW5nLnBvLWF0dGFjaG1lbnQtbGlzdCcsWwogICAgICAgICAgICAndGl0bGUnID0+ICdQTyBMaXN0JywKICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5iUE9oZWFkZXJDb2x1bW5zKCkKICAgICAgICBdKTsKICAgIH1jYXRjaChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgfQp9CgoKcHVibGljIGZ1bmN0aW9uIHBvQWhlYWRlckNvbHVtbnMoJHZhbHVlPScnKQp7CiAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgIFsncG9fZGF0ZScsICdwb19kYXRlJywgJ3RleHQtbGVmdCcsJ3dpZHRoOjE1JSddLAogICAgICAgIFsnc3VwcGxpZXInLCAnc3VwcGxpZXInLCAndGV4dC1sZWZ0J10sCiAgICAgICAgWydyZWZlcmVuY2Vfbm8nLCAncmVmZXJlbmNlX25vJywgJ3RleHQtbGVmdCddLAogICAgICAgIFsncG9fcXR5JywgJ3BvX3F0eScsICd0ZXh0LWNlbnRlciddLAogICAgICAgIFsnY3VycmVuY3knLCAnY3VycmVuY3knLCAndGV4dC1jZW50ZXInXSwKICAgICAgICBbJ3BvX2Ftb3VudCcsICdwb19hbW91bnQnLCAndGV4dC1yaWdodCddLAogICAgICAgIFsnYWR2YW5jZV9hbW91bnQnLCAnYWR2YW5jZV9hbW91bnQnLCAndGV4dC1yaWdodCddLAogICAgICAgIFsnYWN0aW9ucycsICdhY3Rpb25zJywgJ3RleHQtY2VudGVyIGFjdGlvbiddCiAgICApOwp9CgpwdWJsaWMgZnVuY3Rpb24gYmlsbGluZ1BPQWR2YW5lTGlzdCgpCnsKICAgIHRyeXsKCiAgICAgICAgJHRpdGxlPSJQTyBBZHZhbmNlIExpc3QiOwoKICAgICAgICAkcHVyY2hhc2VPcmRlciA9IFB1cmNoYXNlT3JkZXI6OndpdGgoWydyZWxRdW90YXRpb24nLCdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywncmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScsJ3JlbFB1cmNoYXNlT3JkZXJJdGVtcycsJ3JlbFN1cHBsaWVyUGF5bWVudHMnXSkKICAgICAgICAtPndoZXJlKCdpc19zZW5kJywneWVzJykKICAgICAgICAtPndoZXJlSGFzKCdyZWxTdXBwbGllclBheW1lbnRzJywgZnVuY3Rpb24gKCRxdWVyeSl7CiAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2JpbGxfdHlwZScsICdwby1hZHZhbmNlJyk7CiAgICAgICAgfSkKICAgICAgICAtPndoZW4ocmVxdWVzdCgpLT5oYXMoJ2Zyb21fZGF0ZScpICYmICFlbXB0eShyZXF1ZXN0KCktPmdldCgnZnJvbV9kYXRlJykpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZURhdGUoJ3BvX2RhdGUnLCAnPj0nLCBkYXRlKCdZLW0tZCcsc3RydG90aW1lKHJlcXVlc3QoKS0+Z2V0KCdmcm9tX2RhdGUnKSkpKTsKICAgICAgICB9KQogICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmhhcygndG9fZGF0ZScpICYmICFlbXB0eShyZXF1ZXN0KCktPmdldCgndG9fZGF0ZScpKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZURhdGUoJ3BvX2RhdGUnLCAnPD0nLCBkYXRlKCdZLW0tZCcsc3RydG90aW1lKHJlcXVlc3QoKS0+Z2V0KCd0b19kYXRlJykpKSk7CiAgICAgICAgfSkKICAgICAgICAtPndoZW4ocmVxdWVzdCgpLT5oYXMoJ3N0YXR1cycpICYmICFlbXB0eShyZXF1ZXN0KCktPmdldCgnc3RhdHVzJykpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsU3VwcGxpZXJQYXltZW50cycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnc3RhdHVzJyxyZXF1ZXN0KCktPmdldCgnc3RhdHVzJykpOwogICAgICAgICAgICB9KTsKICAgICAgICB9KQogICAgICAgIC0+d2hlbighZGF0YXRhYmxlT3JkZXJpbmcoKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgnaWQnLCAnZGVzYycpOwogICAgICAgIH0pOwoKICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgcmV0dXJuIERhdGF0YWJsZXM6Om9mKCRwdXJjaGFzZU9yZGVyKQogICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdwb19kYXRlJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLHN0cnRvdGltZSgkdmFsdWVzLT5wb19kYXRlKSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdwb19kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3BvX2RhdGUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdwb19kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCdwb19kYXRlJywgJG9yZGVyKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICByZXR1cm4gIChpc3NldCgkdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+bmFtZSkgPyAkdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+bmFtZS4nICgnLiR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5jb2RlLicpJyA6ICcnKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyktPm9yV2hlcmUoJ2NvZGUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBRdW90YXRpb25zOjpzZWxlY3QoJ3N1cHBsaWVycy5uYW1lJykKICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ3N1cHBsaWVycycsICdzdXBwbGllcnMuaWQnLCAnPScsICdxdW90YXRpb25zLnN1cHBsaWVyX2lkJykKICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdxdW90YXRpb25zLmlkJywgJ3B1cmNoYXNlX29yZGVycy5xdW90YXRpb25faWQnKQogICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdyZWZlcmVuY2Vfbm8nLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iYnRuLWxpbmsgc2hvd1BPRGV0YWlscyIgb25jbGljaz0ic2hvd1BPRGV0YWlscygkKHRoaXMpKSIgZGF0YS1zcmM9Iicucm91dGUoJ3Btcy5wdXJjaGFzZS5vcmRlci1saXN0LnNob3cnLCR2YWx1ZXMtPmlkKS4nIj4nLiR2YWx1ZXMtPnJlZmVyZW5jZV9uby4nPC9hPic7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdwb19xdHknLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgIHJldHVybiBudW1iZXJfZm9ybWF0KGlzc2V0KCR2YWx1ZXMtPnJlbFB1cmNoYXNlT3JkZXJJdGVtcyk/ICR2YWx1ZXMtPnJlbFB1cmNoYXNlT3JkZXJJdGVtcy0+c3VtKCdxdHknKTowLDApOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPmFkZENvbHVtbignY3VycmVuY3knLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgIHJldHVybiAgaXNzZXQoJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5LT5jb2RlKT8kdmFsdWVzLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPmNvZGU6Jyc7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdjdXJyZW5jeScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2NvZGUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpLT5vcldoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdjdXJyZW5jeScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUXVvdGF0aW9uczo6c2VsZWN0KCdjdXJyZW5jaWVzLmNvZGUnKQogICAgICAgICAgICAgICAgICAgIC0+am9pbignZXhjaGFuZ2VfcmF0ZXMnLCAnZXhjaGFuZ2VfcmF0ZXMuaWQnLCAnPScsICdxdW90YXRpb25zLmV4Y2hhbmdlX3JhdGVfaWQnKQogICAgICAgICAgICAgICAgICAgIC0+am9pbignY3VycmVuY2llcycsICdjdXJyZW5jaWVzLmlkJywgJz0nLCAnZXhjaGFuZ2VfcmF0ZXMuY3VycmVuY3lfaWQnKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3F1b3RhdGlvbnMuaWQnLCAncHVyY2hhc2Vfb3JkZXJzLnF1b3RhdGlvbl9pZCcpCiAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPmFkZENvbHVtbigncG9fYW1vdW50JywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICByZXR1cm4gc3lzdGVtTW9uZXlGb3JtYXQoJHZhbHVlcy0+Z3Jvc3NfcHJpY2UpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPmFkZENvbHVtbignYWR2YW5jZV9hbW91bnQnLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgICAgICAvLyRwb0FkdmFuY2UgPSBwb0FkdmFuY2UoJHZhbHVlcy0+aWQpOwogICAgICAgICAgICAgICAgJHBvQWR2YW5jZSA9ICR2YWx1ZXMtPnJlbFN1cHBsaWVyUGF5bWVudHMtPndoZXJlKCdiaWxsX3R5cGUnLCdwby1hZHZhbmNlJyk7CiAgICAgICAgICAgICAgICByZXR1cm4gc3lzdGVtTW9uZXlGb3JtYXQoaXNzZXQoJHBvQWR2YW5jZVswXS0+cGF5X2Ftb3VudCkgPyAkcG9BZHZhbmNlWzBdLT5wYXlfYW1vdW50IDogMCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhY3Rpb25zJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAkYWN0aW9ucyA9ICcnOwogICAgICAgICAgICAgICAgJHBvQWR2YW5jZSA9ICR2YWx1ZXMtPnJlbFN1cHBsaWVyUGF5bWVudHMtPndoZXJlKCdiaWxsX3R5cGUnLCdwby1hZHZhbmNlJyk7CgogICAgICAgICAgICAgICAgaWYoaXNzZXQoJHBvQWR2YW5jZVswXS0+c3RhdHVzKSAmJiBpbl9hcnJheSgkcG9BZHZhbmNlWzBdLT5zdGF0dXMsIFsnYXVkaXRlZCcsICdhcHByb3ZlZCddKSl7CiAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMuPSc8YSBjbGFzcz0iYnRuIGJ0bi14cyBidG4tc3VjY2VzcyI+PGkgY2xhc3M9ImxhIGxhLWNoZWNrIj48L2k+IEFwcHJvdmVkPC9hPic7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSc8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj48c2VsZWN0IGNsYXNzPSJjaGFuZ2VTdGF0dXMgZm9ybS1jb250cm9sIiBvbmNoYW5nZT0iY2hhbmdlU3RhdHVzKCQodGhpcykpIiBzdHlsZT0id2lkdGg6IDEwMCUiIGJpbGwtdHlwZT0icG8tYWR2YW5jZSIgcG8taWQ9IicuJHZhbHVlcy0+aWQuJyIgaWQ9ImNoYW5nZVN0YXR1cycuJHZhbHVlcy0+aWQuJyI+JzsKCiAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0nPG9wdGlvbiAnLihpc3NldCgkcG9BZHZhbmNlWzBdLT5zdGF0dXMpICYmICRwb0FkdmFuY2VbMF0tPnN0YXR1cyA9PT0gJ3BlbmRpbmcnPydzZWxlY3RlZCc6IiIpLicgdmFsdWU9InBlbmRpbmciPlBlbmRpbmc8L29wdGlvbj4nOwogICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49JzxvcHRpb24gJy4oaXNzZXQoJHBvQWR2YW5jZVswXS0+c3RhdHVzKSAmJiAkcG9BZHZhbmNlWzBdLT5zdGF0dXMgPT09ICdhdWRpdGVkJz8nc2VsZWN0ZWQnOiIiKS4nIHZhbHVlPSJhdWRpdGVkIj5BcHByb3ZlZDwvb3B0aW9uPic7CiAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0nPG9wdGlvbiAnLihpc3NldCgkcG9BZHZhbmNlWzBdLT5zdGF0dXMpICYmICRwb0FkdmFuY2VbMF0tPnN0YXR1cyA9PT0gJ2NhbmNlbGVkJz8nc2VsZWN0ZWQnOiIiKS4nIHZhbHVlPSJjYW5jZWxlZCI+SGFsdDwvb3B0aW9uPic7CiAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzwvc2VsZWN0PjwvZGl2Pic7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydzdXBwbGllcicsJ3JlZmVyZW5jZV9ubycsJ2FjdGlvbnMnXSkKICAgICAgICAgICAgLT5tYWtlKHRydWUpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmJpbGxpbmcucG8tYWR2YW5jZS1saXN0JyxbCiAgICAgICAgICAgICd0aXRsZScgPT4kdGl0bGUsCiAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+cG9BaGVhZGVyQ29sdW1ucygpCiAgICAgICAgXSk7CgogICAgfWNhdGNoKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICB9Cn0KCiAgICAvKioKICAgICogU3RvcmUgYSBuZXdseSBjcmVhdGVkIHJlc291cmNlIGluIHN0b3JhZ2UuCiAgICAqCiAgICAqIEBwYXJhbSAgXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICAkcmVxdWVzdAogICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYmlsbGluZ0F0dGFjaG1lbnRTdWJtaXQoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsgICAKICAgICAgICAkdGhpcy0+dmFsaWRhdGUoJHJlcXVlc3QsIFsKICAgICAgICAgICAgJ3B1cmNoYXNlX29yZGVyX2lkJyAgPT4gInJlcXVpcmVkfG1heDoxMDAiLAogICAgICAgICAgICAnYmlsbF9hbW91bnQnICA9PiAicmVxdWlyZWR8bWF4OjEwMCIsCiAgICAgICAgICAgICdpbnZvaWNlX2ZpbGUnID0+ICdtaW1lczpqcGVnLGpwZyxwbmcsZ2lmLHBkZnxyZXF1aXJlZHxtYXg6NTA0OCcsCiAgICAgICAgICAgICd2YXRfY2hhbGxhbl9maWxlJyA9PiAnbWltZXM6anBlZyxqcGcscG5nLGdpZixwZGZ8cmVxdWlyZWR8bWF4OjUwNDgnCiAgICAgICAgXSk7CgogICAgICAgICRtb2RlbD1QdXJjaGFzZU9yZGVyOjp3aGVyZSgnaWQnLCRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZCktPmZpcnN0KCk7CiAgICAgICAgaWYgKGVtcHR5KCRtb2RlbCkpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCdQdXJjaGFzZSBPcmRlciBOb3QgRm91bmQhIScpOwogICAgICAgIH0KCiAgICAgICAgJGJpbGxfYW1vdW50ID0gZG91YmxldmFsKHN0cl9yZXBsYWNlKCcsJywnJywkcmVxdWVzdC0+YmlsbF9hbW91bnQpKTsKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeXsKCiAgICAgICAgICAgIGlmICgkbW9kZWwtPnJlbFF1b3RhdGlvbi0+dHlwZT09J2RpcmVjdC1wdXJjaGFzZScpIHsKICAgICAgICAgICAgICAgICR0aGlzLT51cGRhdGVEaXJlY3RQdXJjaGFzZVByaWNlKCRyZXF1ZXN0KTsKCiAgICAgICAgICAgICAgICAvLyAkZ3JuX2Ftb3VudCA9IEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbjo6d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywkcmVxdWVzdC0+cHVyY2hhc2Vfb3JkZXJfaWQpLT53aGVyZSgnaXNfZ3JuX2NvbXBsZXRlJywneWVzJyktPnN1bSgnc3ViX3RvdGFsJyk7CgogICAgICAgICAgICAgICAgLy8gaWYgKCRiaWxsX2Ftb3VudCA+ICRncm5fYW1vdW50KXsKICAgICAgICAgICAgICAgIC8vICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJ1lvdXIgaW5wdXQgYW1vdW50IGlzIGdyZWF0ZXIgdGhlbiBHUk4gYW1vdW50LicpOwogICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICB9ZWxzZXsKCiAgICAgICAgICAgICAgICAvLyAkZ3JuX2Ftb3VudCA9IEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbjo6d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywkcmVxdWVzdC0+cHVyY2hhc2Vfb3JkZXJfaWQpLT53aGVyZSgnaXNfZ3JuX2NvbXBsZXRlJywneWVzJyktPnN1bSgndG90YWxfYW1vdW50Jyk7CgogICAgICAgICAgICAgICAgLy8gaWYgKCRiaWxsX2Ftb3VudCA+ICRncm5fYW1vdW50KXsKICAgICAgICAgICAgICAgIC8vICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJ1lvdXIgaW5wdXQgYW1vdW50IGlzIGdyZWF0ZXIgdGhlbiBHUk4gYW1vdW50LicpOwogICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICB9CgoKICAgICAgICAgICAgJGludm9pY2VfZmlsZT0nJzsKICAgICAgICAgICAgJHZhdF9jaGFsbGFuX2ZpbGU9Jyc7CgogICAgICAgICAgICAkZXhpc2luZ19hdHRhY2htZW50PVB1cmNoYXNlT3JkZXJBdHRhY2htZW50Ojp3aGVyZShbJ3B1cmNoYXNlX29yZGVyX2lkJz0+JHJlcXVlc3QtPnB1cmNoYXNlX29yZGVyX2lkLCdiaWxsX3R5cGUnPT4ncG8nXSktPndoZXJlSW4oJ3N0YXR1cycsIFsncGVuZGluZycsICdoYWx0J10pLT5maXJzdCgpOwoKICAgICAgICAgICAgaWYgKCRyZXF1ZXN0LT5oYXNGaWxlKCdpbnZvaWNlX2ZpbGUnKSB8fCAkcmVxdWVzdC0+aGFzRmlsZSgndmF0X2NoYWxsYW5fZmlsZScpKQogICAgICAgICAgICB7ICAgCgogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRleGlzaW5nX2F0dGFjaG1lbnQpICYmICFlbXB0eSgkZXhpc2luZ19hdHRhY2htZW50LT5pbnZvaWNlX2ZpbGUpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoZmlsZV9leGlzdHMocHVibGljX3BhdGgoJGV4aXNpbmdfYXR0YWNobWVudC0+aW52b2ljZV9maWxlKSkpewogICAgICAgICAgICAgICAgICAgICAgICB1bmxpbmsocHVibGljX3BhdGgoJGV4aXNpbmdfYXR0YWNobWVudC0+aW52b2ljZV9maWxlKSk7ICAgCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZihmaWxlX2V4aXN0cyhwdWJsaWNfcGF0aCgkZXhpc2luZ19hdHRhY2htZW50LT52YXRfY2hhbGxhbl9maWxlKSkpewogICAgICAgICAgICAgICAgICAgICAgICB1bmxpbmsocHVibGljX3BhdGgoJGV4aXNpbmdfYXR0YWNobWVudC0+dmF0X2NoYWxsYW5fZmlsZSkpOyAgIAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkaW52b2ljZV9maWxlPSR0aGlzLT5maWxlVXBsb2FkKCRyZXF1ZXN0LT5maWxlKCdpbnZvaWNlX2ZpbGUnKSwndXBsb2FkL3B1cmNoYXNlLW9yZGVyL2ludm9pY2UnKTsKCiAgICAgICAgICAgICAgICAkdmF0X2NoYWxsYW5fZmlsZT0kdGhpcy0+ZmlsZVVwbG9hZCgkcmVxdWVzdC0+ZmlsZSgndmF0X2NoYWxsYW5fZmlsZScpLCd1cGxvYWQvcHVyY2hhc2Utb3JkZXIvdmF0LWNoYWxhbicpOwogICAgICAgICAgICB9CgoKICAgICAgICAgICAgJFB1cmNoYXNlT3JkZXJBdHRhY2htZW50PVB1cmNoYXNlT3JkZXJBdHRhY2htZW50Ojp1cGRhdGVPckNyZWF0ZSgKICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICAkcmVxdWVzdC0+cHVyY2hhc2Vfb3JkZXJfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2JpbGxfdHlwZScgPT4gJ3BvJwogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnPT4kcmVxdWVzdC0+cHVyY2hhc2Vfb3JkZXJfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2ludm9pY2VfZmlsZSc9PiRpbnZvaWNlX2ZpbGUsCiAgICAgICAgICAgICAgICAgICAgJ3ZhdF9jaGFsbGFuX2ZpbGUnPT4kdmF0X2NoYWxsYW5fZmlsZSwKICAgICAgICAgICAgICAgICAgICAnYmlsbF9hbW91bnQnPT4kYmlsbF9hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgJ2JpbGxfbnVtYmVyJz0+JHJlcXVlc3QtPmJpbGxfbnVtYmVyLAogICAgICAgICAgICAgICAgICAgICdzdGF0dXMnPT4ncGVuZGluZycsCiAgICAgICAgICAgICAgICAgICAgJ2NyZWF0ZWRfYnknPT5cQXV0aDo6dXNlcigpLT5pZCwKICAgICAgICAgICAgICAgICAgICAndXBkYXRlZF9ieSc9PlxBdXRoOjp1c2VyKCktPmlkLAogICAgICAgICAgICAgICAgXQogICAgICAgICAgICApOwoKICAgICAgICAgICAgJFB1cmNoYXNlT3JkZXJBdHRhY2htZW50PVB1cmNoYXNlT3JkZXJBdHRhY2htZW50Ojp3aGVyZShbCiAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICAkcmVxdWVzdC0+cHVyY2hhc2Vfb3JkZXJfaWQsCiAgICAgICAgICAgICAgICAnYmlsbF90eXBlJyA9PiAncG8nCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+dXBkYXRlKFsKICAgICAgICAgICAgICAgICdzdGF0dXMnPT4icGVuZGluZyIsCiAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgJFB1cmNoYXNlT3JkZXJBdHRhY2htZW50PVB1cmNoYXNlT3JkZXJBdHRhY2htZW50Ojp3aGVyZShbCiAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICAkcmVxdWVzdC0+cHVyY2hhc2Vfb3JkZXJfaWQsCiAgICAgICAgICAgICAgICAnYmlsbF90eXBlJyA9PiAncG8nCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+Zmlyc3QoKTsKCiAgICAgICAgICAgICRzdXBwbGllcl9wYXltZW50PVN1cHBsaWVyUGF5bWVudDo6dXBkYXRlT3JDcmVhdGUoCiAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgJ3N1cHBsaWVyX2lkJyA9PiAkbW9kZWwtPnJlbFF1b3RhdGlvbi0+c3VwcGxpZXJfaWQsCiAgICAgICAgICAgICAgICAgICAgJ3B1cmNoYXNlX29yZGVyX2lkJyA9PiAkcmVxdWVzdC0+cHVyY2hhc2Vfb3JkZXJfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2JpbGxfdHlwZScgPT4gJ3BvJywKICAgICAgICAgICAgICAgICAgICAnYmlsbF9udW1iZXInID0+ICRyZXF1ZXN0LT5iaWxsX251bWJlcgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAndHJhbnNlY3Rpb25fZGF0ZScgPT4gZGF0ZSgnWS1tLWQgSDppOnMnKSwKICAgICAgICAgICAgICAgICAgICAndHJhbnNlY3Rpb25fdHlwZScgPT4gJ3B1cmNoYXNlJywKICAgICAgICAgICAgICAgICAgICAnZXhjaGFuZ2VfcmF0ZV9pZCcgPT4gJG1vZGVsLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlX3JhdGVfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2JpbGxfYW1vdW50JyA9PiAkYmlsbF9hbW91bnQsCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAkZ3JucyA9IEdvb2RzUmVjZWl2ZWROb3RlOjpkb2VzbnRIYXZlKCdyZWxQb0F0dGFjaG1lbnQnKQogICAgICAgICAgICAtPndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsICRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZCkKICAgICAgICAgICAgLT5nZXQoJ2lkJyk7CiAgICAgICAgICAgIGlmKGlzc2V0KCRncm5zWzBdKSl7CiAgICAgICAgICAgICAgICBCaWxsaW5nQ2hhbGFuOjp3aGVyZSgncHVyY2hhc2Vfb3JkZXJfYXR0YWNobWVudF9pZCcsICRQdXJjaGFzZU9yZGVyQXR0YWNobWVudC0+aWQpLT5kZWxldGUoKTsKICAgICAgICAgICAgICAgIGZvcmVhY2goJGdybnMgYXMgJGtleSA9PiAkZ3JuKXsKICAgICAgICAgICAgICAgICAgICBCaWxsaW5nQ2hhbGFuOjpjcmVhdGUoWwogICAgICAgICAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfYXR0YWNobWVudF9pZCcgPT4gJFB1cmNoYXNlT3JkZXJBdHRhY2htZW50LT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnID0+ICRncm4tPmlkCiAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAvL05vdGlmaWNhdGlvbgogICAgICAgICAgICAkbWVzc2FnZSA9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsJG1vZGVsLT5pZCkuJz92aWV3IiBkYXRhLXRpdGxlPSJQdXJjaGFzZSBPcmRlciBEZXRhaWxzIj5SZWZlcmVuY2UgTm86Jy4kbW9kZWwtPnJlZmVyZW5jZV9uby4nLiBXYWl0aW5nIGZvciB0aGUgQXVkaXRlZC48L3NwYW4+JzsKCiAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCcnLGdldE1hbmFnZXJJbmZvKCdBdWRpdCcpLCRtZXNzYWdlLCd1bnJlYWQnLCdzZW5kLXRvLWF1ZGl0JywnJyk7CgogICAgLy9kYXRhIGNvbW1pdAogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CgogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoU3VjY2VzcygnU3VjY2Vzc2Z1bGx5IHVwbG9hZGVkIHBvIGludm9pY2UgJiB2YXQgZmlsZS4nKTsKCiAgICAgICAgfWNhdGNoIChFeGNlcHRpb24gJGUpewogICAgLy9kYXRhIHJvbGxiYWNrIGlmIHNvbWV0aW5nIHdyb25nCiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJGUtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQoKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gdXBkYXRlRGlyZWN0UHVyY2hhc2VQcmljZSgkcmVxdWVzdCkKICAgIHsKICAgICAgICBpZiAoaXNzZXQoJHJlcXVlc3QtPnVuaXRfYW1vdW50KSkgewoKICAgICAgICAgICAgZm9yZWFjaCgkcmVxdWVzdC0+dW5pdF9hbW91bnQgYXMgJGdybklkPT4kZGF0YSl7CiAgICAgICAgICAgICAgICAkZ3JuU3ViVG90YWw9MDsKICAgICAgICAgICAgICAgICRncm5EaXNjb3VudD0wOwogICAgICAgICAgICAgICAgJGdyblZhdD0wOwogICAgICAgICAgICAgICAgJGdybkdyb3NzVG90YWw9MDsKCiAgICAgICAgICAgICAgICBmb3JlYWNoKCRkYXRhIGFzICRncm5JdGVtSWQ9PiR1bml0QW1vdW50KXsKCiAgICAgICAgICAgICAgICAgICAgJGdvb2RzUmVjZWl2ZUl0ZW09R29vZHNSZWNlaXZlZEl0ZW06OndoZXJlKCdpZCcsJGdybkl0ZW1JZCktPmZpcnN0KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRnb29kc1JlY2VpdmVJdGVtLT5pZCkpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICRxdHkgPSAkZ29vZHNSZWNlaXZlSXRlbS0+cXR5OwogICAgICAgICAgICAgICAgICAgICAgICAkc3ViVG90YWwgPSAkdW5pdEFtb3VudCokcXR5OwogICAgICAgICAgICAgICAgICAgICAgICAkZ3JuU3ViVG90YWwgKz0gJHN1YlRvdGFsOwogICAgICAgICAgICAgICAgICAgICAgICAkZGlzY291bnRBbW91bnQgPSAoJGdvb2RzUmVjZWl2ZUl0ZW0tPmRpc2NvdW50X3BlcmNlbnRhZ2UqKCR1bml0QW1vdW50KiRxdHkpKS8xMDA7CiAgICAgICAgICAgICAgICAgICAgICAgICRncm5EaXNjb3VudCArPSAkZGlzY291bnRBbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICR2YXRBbW91bnQgPSAoJGdvb2RzUmVjZWl2ZUl0ZW0tPnZhdF9wZXJjZW50YWdlKigkdW5pdEFtb3VudCokcXR5KSkvMTAwOwogICAgICAgICAgICAgICAgICAgICAgICAkZ3JuVmF0ICs9ICR2YXRBbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICRncm9zc1RvdGFsID0gKCRzdWJUb3RhbCskdmF0QW1vdW50KS0kZGlzY291bnRBbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICRncm5Hcm9zc1RvdGFsICs9ICRncm9zc1RvdGFsOwoKICAgICAgICAgICAgICAgICAgICAgICAgJGdvb2RzUmVjZWl2ZUl0ZW0tPnVwZGF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndW5pdF9hbW91bnQnID0+ICR1bml0QW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Yl90b3RhbCcgPT4gJHN1YlRvdGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc2NvdW50JyA9PiAkZGlzY291bnRBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmF0JyA9PiAkdmF0QW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RvdGFsX2Ftb3VudCcgPT4gJGdyb3NzVG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luOjp3aGVyZSgncHVyY2hhc2Vfb3JkZXJfaWQnLCRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZCktPndoZXJlKCdnb29kc19yZWNlaXZlZF9pdGVtX2lkJywkZ3JuSXRlbUlkKQogICAgICAgICAgICAgICAgICAgICAgICAtPnVwZGF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndW5pdF9hbW91bnQnID0+ICR1bml0QW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Yl90b3RhbCcgPT4gJHN1YlRvdGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc2NvdW50JyA9PiAkZGlzY291bnRBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmF0JyA9PiAkdmF0QW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RvdGFsX2Ftb3VudCcgPT4gJGdyb3NzVG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgbGF0ZXN0UHJvZHVjdFByaWNlVXBkYXRlKCRnb29kc1JlY2VpdmVJdGVtLT5wcm9kdWN0X2lkLCR1bml0QW1vdW50KTsKCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRnb29kc1JlY2VpdmVOb3RlID0gR29vZHNSZWNlaXZlZE5vdGU6OndoZXJlKCdpZCcsJGdybklkKS0+Zmlyc3QoKTsKCgogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRnb29kc1JlY2VpdmVOb3RlLT5pZCkpIHsKICAgICAgICAgICAgICAgICAgICAkZ29vZHNSZWNlaXZlTm90ZS0+dXBkYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3RvdGFsX3ByaWNlJyA9PiAkZ3JuU3ViVG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgICdkaXNjb3VudCcgPT4gJGdybkRpc2NvdW50LAogICAgICAgICAgICAgICAgICAgICAgICAndmF0JyA9PiAkZ3JuVmF0LAogICAgICAgICAgICAgICAgICAgICAgICAnZ3Jvc3NfcHJpY2UnID0+ICRncm5Hcm9zc1RvdGFsLAogICAgICAgICAgICAgICAgICAgIF0pOyAgIAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAqIFN0b3JlIGEgbmV3bHkgY3JlYXRlZCByZXNvdXJjZSBpbiBzdG9yYWdlLnMKICAgICoKICAgICogQHBhcmFtICBcSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3QgICRyZXF1ZXN0CiAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBncm5BdHRhY2htZW50VXBsb2FkKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHRoaXMtPnZhbGlkYXRlKCRyZXF1ZXN0LCBbCiAgICAgICAgICAgICdwdXJjaGFzZV9vcmRlcl9pZCcgID0+ICJyZXF1aXJlZHxtYXg6MTAwIiwKICAgICAgICAgICAgJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnICA9PiAicmVxdWlyZWR8bWF4OjEwMCIsCiAgICAgICAgICAgICdiaWxsX2Ftb3VudCcgID0+ICJyZXF1aXJlZHxtYXg6MTAwIiwKICAgICAgICAgICAgJ2ludm9pY2VfZmlsZScgPT4gJ21pbWVzOmpwZWcsanBnLHBuZyxnaWYscGRmfHJlcXVpcmVkfG1heDo1MDQ4JywKICAgICAgICAgICAgJ3ZhdF9jaGFsbGFuX2ZpbGUnID0+ICdtaW1lczpqcGVnLGpwZyxwbmcsZ2lmLHBkZnxyZXF1aXJlZHxtYXg6NTA0OCcKICAgICAgICBdKTsKCiAgICAgICAgJG1vZGVsPVB1cmNoYXNlT3JkZXI6OndoZXJlKCdpZCcsJHJlcXVlc3QtPnB1cmNoYXNlX29yZGVyX2lkKS0+Zmlyc3QoKTsKICAgICAgICBpZiAoZW1wdHkoJG1vZGVsKSkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJ1B1cmNoYXNlIE9yZGVyIE5vdCBGb3VuZCEhJyk7CiAgICAgICAgfQoKICAgICAgICAkYmlsbF9hbW91bnQ9ZG91YmxldmFsKHN0cl9yZXBsYWNlKCcsJywnJywkcmVxdWVzdC0+YmlsbF9hbW91bnQpKTsKCgogICAgICAgIGlmICgkbW9kZWwtPnJlbFF1b3RhdGlvbi0+dHlwZT09J2RpcmVjdC1wdXJjaGFzZScpIHsKICAgICAgICAgICAgJHRoaXMtPnVwZGF0ZURpcmVjdFB1cmNoYXNlUHJpY2UoJHJlcXVlc3QpOwoKICAgICAgICAgICAgJGdvb2RzUmVjZWl2ZUl0ZW1zSWQgPSBHb29kc1JlY2VpdmVkSXRlbTo6d2hlcmUoJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnLCRyZXF1ZXN0LT5nb29kc19yZWNlaXZlZF9ub3RlX2lkKQogICAgICAgICAgICAtPnBsdWNrKCdpZCcpCiAgICAgICAgICAgIC0+YWxsKCk7CiAgICAgICAgICAgICRzdWJ0b3RhbEFtb3VudD0gJG1vZGVsLT5yZWxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW4oKQogICAgICAgICAgICAtPndoZXJlSW4oJ2dvb2RzX3JlY2VpdmVkX2l0ZW1faWQnLCRnb29kc1JlY2VpdmVJdGVtc0lkKQogICAgICAgICAgICAtPndoZXJlKCdpc19ncm5fY29tcGxldGUnLCd5ZXMnKQogICAgICAgICAgICAtPnN1bSgndG90YWxfYW1vdW50Jyk7CgogICAgICAgICAgICAvL2RkKGRvdWJsZXZhbCgkc3VidG90YWxBbW91bnQpKTsKICAgICAgICAgICAgLy9kZCgkYmlsbF9hbW91bnQpOwoKICAgICAgICAgICAgaWYgKGRvdWJsZXZhbCgkc3VidG90YWxBbW91bnQpIT09JGJpbGxfYW1vdW50KXsKICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcignWW91ciBpbnB1dCBhbW91bnQgaXMgZ3JlYXRlciB0aGVuIEdSTiBhbW91bnQuJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9ZWxzZXsKICAgIC8vICRnb29kc1JlY2VpdmVJdGVtc0lkPUdvb2RzUmVjZWl2ZWRJdGVtOjp3aGVyZSgnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsJHJlcXVlc3QtPmdvb2RzX3JlY2VpdmVkX25vdGVfaWQpCiAgICAvLyAgICAgLT5wbHVjaygnaWQnKQogICAgLy8gICAgIC0+YWxsKCk7CgogICAgLy8gaWYgKGRvdWJsZXZhbCgkbW9kZWwtPnJlbEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbigpCiAgICAvLyAgICAgICAgICAgICAtPndoZXJlSW4oJ2dvb2RzX3JlY2VpdmVkX2l0ZW1faWQnLCRnb29kc1JlY2VpdmVJdGVtc0lkKQogICAgLy8gICAgICAgICAgICAgLT53aGVyZSgnaXNfZ3JuX2NvbXBsZXRlJywneWVzJykKICAgIC8vICAgICAgICAgICAgIC0+c3VtKCd0b3RhbF9hbW91bnQnKSkhPT0kYmlsbF9hbW91bnQpewoKICAgIC8vICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJ1lvdXIgaW5wdXQgYW1vdW50IGlzIGdyZWF0ZXIgdGhlbiBHUk4gYW1vdW50LicpOwogICAgLy8gfQogICAgICAgIH0KCgogICAgLy9iZWdhaW4gdHJhbnNhY3Rpb24KICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeXsKCiAgICAgICAgICAgICRpbnZvaWNlX2ZpbGU9Jyc7CiAgICAgICAgICAgICR2YXRfY2hhbGxhbl9maWxlPScnOwoKICAgICAgICAgICAgaWYgKCRyZXF1ZXN0LT5oYXNGaWxlKCdpbnZvaWNlX2ZpbGUnKSB8fCAkcmVxdWVzdC0+aGFzRmlsZSgndmF0X2NoYWxsYW5fZmlsZScpKQogICAgICAgICAgICB7ICAgCiAgICAgICAgICAgICAgICAkZXhpc2luZ19hdHRhY2htZW50PVB1cmNoYXNlT3JkZXJBdHRhY2htZW50Ojp3aGVyZShbJ3B1cmNoYXNlX29yZGVyX2lkJz0+JHJlcXVlc3QtPnB1cmNoYXNlX29yZGVyX2lkLCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJz0+JHJlcXVlc3QtPmdvb2RzX3JlY2VpdmVkX25vdGVfaWQsJ2JpbGxfdHlwZSc9Pidncm4nXSktPndoZXJlSW4oJ3N0YXR1cycsWydwZW5kaW5nJywnaGFsdCddKS0+Zmlyc3QoKTsKCiAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGV4aXNpbmdfYXR0YWNobWVudCkgJiYgIWVtcHR5KCRleGlzaW5nX2F0dGFjaG1lbnQtPmludm9pY2VfZmlsZSkpIHsKICAgICAgICAgICAgICAgICAgICBpZihmaWxlX2V4aXN0cyhwdWJsaWNfcGF0aCgkZXhpc2luZ19hdHRhY2htZW50LT5pbnZvaWNlX2ZpbGUpKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHVubGluayhwdWJsaWNfcGF0aCgkZXhpc2luZ19hdHRhY2htZW50LT5pbnZvaWNlX2ZpbGUpKTsgICAKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmKGZpbGVfZXhpc3RzKHB1YmxpY19wYXRoKCRleGlzaW5nX2F0dGFjaG1lbnQtPnZhdF9jaGFsbGFuX2ZpbGUpKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHVubGluayhwdWJsaWNfcGF0aCgkZXhpc2luZ19hdHRhY2htZW50LT52YXRfY2hhbGxhbl9maWxlKSk7ICAgCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRpbnZvaWNlX2ZpbGU9JHRoaXMtPmZpbGVVcGxvYWQoJHJlcXVlc3QtPmZpbGUoJ2ludm9pY2VfZmlsZScpLCd1cGxvYWQvcHVyY2hhc2Utb3JkZXIvaW52b2ljZScpOwoKICAgICAgICAgICAgICAgICR2YXRfY2hhbGxhbl9maWxlPSR0aGlzLT5maWxlVXBsb2FkKCRyZXF1ZXN0LT5maWxlKCd2YXRfY2hhbGxhbl9maWxlJyksJ3VwbG9hZC9wdXJjaGFzZS1vcmRlci92YXQtY2hhbGFuJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRQdXJjaGFzZU9yZGVyQXR0YWNobWVudD1QdXJjaGFzZU9yZGVyQXR0YWNobWVudDo6dXBkYXRlT3JDcmVhdGUoCiAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgJ3B1cmNoYXNlX29yZGVyX2lkJyA9PiAgJHJlcXVlc3QtPnB1cmNoYXNlX29yZGVyX2lkLAogICAgICAgICAgICAgICAgICAgICdnb29kc19yZWNlaXZlZF9ub3RlX2lkJyA9PiAgJHJlcXVlc3QtPmdvb2RzX3JlY2VpdmVkX25vdGVfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2JpbGxfdHlwZScgPT4gJ2dybicKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgJ3B1cmNoYXNlX29yZGVyX2lkJz0+JHJlcXVlc3QtPnB1cmNoYXNlX29yZGVyX2lkLAogICAgICAgICAgICAgICAgICAgICdnb29kc19yZWNlaXZlZF9ub3RlX2lkJz0+JHJlcXVlc3QtPmdvb2RzX3JlY2VpdmVkX25vdGVfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2ludm9pY2VfZmlsZSc9PiRpbnZvaWNlX2ZpbGUsCiAgICAgICAgICAgICAgICAgICAgJ3ZhdF9jaGFsbGFuX2ZpbGUnPT4kdmF0X2NoYWxsYW5fZmlsZSwKICAgICAgICAgICAgICAgICAgICAnYmlsbF9hbW91bnQnPT4kYmlsbF9hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgJ2JpbGxfdHlwZSc9Pidncm4nLAogICAgICAgICAgICAgICAgICAgICdiaWxsX251bWJlcic9PiRyZXF1ZXN0LT5iaWxsX251bWJlciwKICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJz0+InBlbmRpbmciLAogICAgICAgICAgICAgICAgICAgICdjcmVhdGVkX2J5Jz0+XEF1dGg6OnVzZXIoKS0+aWQsCiAgICAgICAgICAgICAgICAgICAgJ3VwZGF0ZWRfYnknPT5cQXV0aDo6dXNlcigpLT5pZCwKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICRQdXJjaGFzZU9yZGVyQXR0YWNobWVudD1QdXJjaGFzZU9yZGVyQXR0YWNobWVudDo6d2hlcmUoWwogICAgICAgICAgICAgICAgJ3B1cmNoYXNlX29yZGVyX2lkJyA9PiAgJHJlcXVlc3QtPnB1cmNoYXNlX29yZGVyX2lkLAogICAgICAgICAgICAgICAgJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnID0+ICAkcmVxdWVzdC0+Z29vZHNfcmVjZWl2ZWRfbm90ZV9pZCwKICAgICAgICAgICAgICAgICdiaWxsX3R5cGUnID0+ICdncm4nCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+dXBkYXRlKFsKICAgICAgICAgICAgICAgICdzdGF0dXMnPT4icGVuZGluZyIsCiAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgJFB1cmNoYXNlT3JkZXJBdHRhY2htZW50PVB1cmNoYXNlT3JkZXJBdHRhY2htZW50Ojp3aGVyZShbCiAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICAkcmVxdWVzdC0+cHVyY2hhc2Vfb3JkZXJfaWQsCiAgICAgICAgICAgICAgICAnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcgPT4gICRyZXF1ZXN0LT5nb29kc19yZWNlaXZlZF9ub3RlX2lkLAogICAgICAgICAgICAgICAgJ2JpbGxfdHlwZScgPT4gJ2dybicKICAgICAgICAgICAgXSkKICAgICAgICAgICAgLT5maXJzdCgpOwoKICAgICAgICAgICAgaWYoIWlzc2V0KCRleGlzaW5nX2F0dGFjaG1lbnQtPnB1cmNoYXNlX29yZGVyX2lkKSl7CiAgICAgICAgICAgICAgICAkc3VwcGxpZXJfcGF5bWVudCA9IG5ldyBTdXBwbGllclBheW1lbnQoKTsKICAgICAgICAgICAgICAgICRzdXBwbGllcl9wYXltZW50LT5zdXBwbGllcl9pZCA9ICRtb2RlbC0+cmVsUXVvdGF0aW9uLT5zdXBwbGllcl9pZDsKICAgICAgICAgICAgICAgICRzdXBwbGllcl9wYXltZW50LT5wdXJjaGFzZV9vcmRlcl9pZCA9ICRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZDsKICAgICAgICAgICAgICAgICRzdXBwbGllcl9wYXltZW50LT5nb29kc19yZWNlaXZlZF9ub3RlX2lkID0gJHJlcXVlc3QtPmdvb2RzX3JlY2VpdmVkX25vdGVfaWQ7CiAgICAgICAgICAgICAgICAkc3VwcGxpZXJfcGF5bWVudC0+dHJhbnNlY3Rpb25fZGF0ZSA9IGRhdGUoJ1ktbS1kIGg6aTpzJyk7CiAgICAgICAgICAgICAgICAkc3VwcGxpZXJfcGF5bWVudC0+dHJhbnNlY3Rpb25fdHlwZSA9ICdwdXJjaGFzZSc7CiAgICAgICAgICAgICAgICAkc3VwcGxpZXJfcGF5bWVudC0+YmlsbF9udW1iZXIgPSAkcmVxdWVzdC0+YmlsbF9udW1iZXI7CiAgICAgICAgICAgICAgICAkc3VwcGxpZXJfcGF5bWVudC0+ZXhjaGFuZ2VfcmF0ZV9pZCA9ICRtb2RlbC0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZV9yYXRlX2lkOwogICAgICAgICAgICAgICAgJHN1cHBsaWVyX3BheW1lbnQtPmJpbGxfYW1vdW50ID0gJGJpbGxfYW1vdW50OwogICAgICAgICAgICAgICAgJHN1cHBsaWVyX3BheW1lbnQtPmJpbGxfdHlwZSA9ICJncm4iOwogICAgICAgICAgICAgICAgJHN1cHBsaWVyX3BheW1lbnQtPnNhdmUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGdybiA9IEdvb2RzUmVjZWl2ZWROb3RlOjpmaW5kKCRyZXF1ZXN0LT5nb29kc19yZWNlaXZlZF9ub3RlX2lkKTsKICAgICAgICAgICAgQmlsbGluZ0NoYWxhbjo6dXBkYXRlT3JDcmVhdGUoWwogICAgICAgICAgICAgICAgJ3B1cmNoYXNlX29yZGVyX2F0dGFjaG1lbnRfaWQnID0+ICRQdXJjaGFzZU9yZGVyQXR0YWNobWVudC0+aWQKICAgICAgICAgICAgXSxbCiAgICAgICAgICAgICAgICAnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcgPT4gJGdybi0+aWQKICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAkbWVzc2FnZSA9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLmdybi5ncm4tcHJvY2Vzcy5zaG93JywkZ3JuLT5pZCkuJz92aWV3IiBkYXRhLXRpdGxlPSJHUk4gRGV0YWlscyI+UmVmZXJlbmNlIE5vOicuJGdybi0+cmVmZXJlbmNlX25vLicuIFdhaXRpbmcgZm9yIHRoZSBBdWRpdGVkLjwvc3Bhbj4nOwoKICAgICAgICAgICAgQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJycsZ2V0TWFuYWdlckluZm8oJ0F1ZGl0JyksJ1JlZmVyZW5jZSBObzogPHN0cm9uZz4nLiRncm4tPnJlZmVyZW5jZV9uby4nPC9zdHJvbmc+LiBXYWl0aW5nIGZvciB0aGUgQXVkaXRlZCcsJ3VucmVhZCcsJ3NlbmQtdG8tYXVkaXQnLCcnKTsKCiAgICAvL2RhdGEgY29tbWl0CiAgICAgICAgICAgIERCOjpjb21taXQoKTsKCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhTdWNjZXNzKCdTdWNjZXNzZnVsbHkgdXBsb2FkZWQgcG8gaW52b2ljZSAmIHZhdCBmaWxlLicpOwoKICAgICAgICB9Y2F0Y2ggKEV4Y2VwdGlvbiAkZSl7CiAgICAvL2RhdGEgcm9sbGJhY2sgaWYgc29tZXRpbmcgd3JvbmcKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkZS0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CgogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBiaWxsaW5nVXBkYXRlQWN0aW9uKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7ICAgCiAgICAgICAgJGlkID0gJHJlcXVlc3QtPnBvX2lkOwogICAgICAgICRiaWxsVHlwZSA9ICRyZXF1ZXN0LT5iaWxsX3R5cGU7CiAgICAgICAgJHN0YXR1cyA9ICRyZXF1ZXN0LT5zdGF0dXM7CiAgICAgICAgJGdybklkID0gaXNzZXQoJHJlcXVlc3QtPmdybl9pZCk/JHJlcXVlc3QtPmdybl9pZDonJzsKCiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBQdXJjaGFzZU9yZGVyQXR0YWNobWVudDo6d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywkaWQpCiAgICAgICAgICAgIC0+d2hlbighZW1wdHkoJGdybklkKSwgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGdybklkKXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywgJGdybklkKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZSgnYmlsbF90eXBlJywgJGJpbGxUeXBlKQogICAgICAgICAgICAtPnVwZGF0ZShbCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAkc3RhdHVzLAogICAgICAgICAgICAgICAgJ3JlbWFya3MnID0+ICRyZXF1ZXN0LT5yZW1hcmtzCiAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgaWYgKCRzdGF0dXMgPT0gJ3BlbmRpbmcnKSB7CiAgICAgICAgICAgICAgICAkYXVkaXRTdGF0dXMgPSAncGVuZGluZyc7CiAgICAgICAgICAgICAgICAkcHVyY2hhc2VNZXNzYWdlPSJCaWxsaW5nIHN0YXR1cyB1cGRhdGVkIHRvIHBlbmRpbmciOwogICAgICAgICAgICB9ZWxzZWlmKCRzdGF0dXMgPT0gJ2FwcHJvdmVkJyl7CiAgICAgICAgICAgICAgICAkYXVkaXRTdGF0dXMgPSAnYXVkaXRlZCc7CiAgICAgICAgICAgICAgICAkcHVyY2hhc2VNZXNzYWdlPSJTdWNjZXNzZnVsbHkgYXVkaXRlZCBieSBhdWRpdCBkZXBhcnRtZW50IjsKICAgICAgICAgICAgfWVsc2VpZigkc3RhdHVzID09ICdoYWx0Jyl7CiAgICAgICAgICAgICAgICAkYXVkaXRTdGF0dXMgPSAnY2FuY2VsZWQnOwogICAgICAgICAgICAgICAgJHB1cmNoYXNlTWVzc2FnZT0iVGhpcyBiaWxsIGhhbHQgYnkgYXVkaXQgZGVwYXJ0bWVudC4gUGxlYXNlIHVwbG9hZCBpdCBhZ2Fpbi4iOwogICAgICAgICAgICB9CgogICAgICAgICAgICBTdXBwbGllclBheW1lbnQ6OndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsJGlkKQogICAgICAgICAgICAtPndoZW4oIWVtcHR5KCRncm5JZCksIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRncm5JZCl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsICRncm5JZCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmUoJ2JpbGxfdHlwZScsICRiaWxsVHlwZSkKICAgICAgICAgICAgLT51cGRhdGUoWwogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gJGF1ZGl0U3RhdHVzCiAgICAgICAgICAgIF0pOwoKCiAgICAgICAgICAgICRtb2RlbCA9IFB1cmNoYXNlT3JkZXI6OmZpbmRPckZhaWwoJGlkKTsKCiAgICAgICAgICAgIGlmICgkc3RhdHVzID09ICdhcHByb3ZlZCcpIHsKCiAgICAvL0dSL0lSIFByb2Nlc3MKICAgICAgICAgICAgICAgICRhbW91bnQgPSBQdXJjaGFzZU9yZGVyQXR0YWNobWVudDo6d2hlcmUoWwogICAgICAgICAgICAgICAgICAgICdwdXJjaGFzZV9vcmRlcl9pZCcgPT4gJGlkLAogICAgICAgICAgICAgICAgICAgICdiaWxsX3R5cGUnID0+ICRiaWxsVHlwZSwKICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAkc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICdyZW1hcmtzJyA9PiAkcmVxdWVzdC0+cmVtYXJrcwogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlbighZW1wdHkoJGdybklkKSwgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGdybklkKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsICRncm5JZCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5zdW0oJ2JpbGxfYW1vdW50Jyk7CgogICAgICAgICAgICAgICAgJHBvQmlsbCA9IFB1cmNoYXNlT3JkZXJBdHRhY2htZW50Ojp3aGVyZSgncHVyY2hhc2Vfb3JkZXJfaWQnLCAkaWQpCiAgICAgICAgICAgICAgICAtPndoZW4oIWVtcHR5KCRncm5JZCksIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRncm5JZCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnLCAkZ3JuSWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2JpbGxfdHlwZScsICRiaWxsVHlwZSkKICAgICAgICAgICAgICAgIC0+Zmlyc3QoKTsKCiAgICAgICAgICAgICAgICAkYXJyYXkgPSBhcnJheShbCiAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkbW9kZWwtPmNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiBhY2NvdW50RGVmYXVsdFNldHRpbmdzKClbJ2dyaXJfYWNjb3VudCddLAogICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gJGFtb3VudCwKICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdCaWxsIEFwcHJvdmFsIDo6IEdSL0lSIERlYml0JywKICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ3BvLWJpbGwnLAogICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRwb0JpbGwtPmlkCiAgICAgICAgICAgICAgICBdLFsKICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRtb2RlbC0+Y29zdF9jZW50cmVfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+IChpc3NldCgkbW9kZWwtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5wYXlhYmxlX2FjY291bnRfaWQpICYmICRtb2RlbC0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPnBheWFibGVfYWNjb3VudF9pZCA+IDAgPyAkbW9kZWwtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5wYXlhYmxlX2FjY291bnRfaWQgOiBhY2NvdW50RGVmYXVsdFNldHRpbmdzKClbJ3N1cHBsaWVyX3BheWFibGVfYWNjb3VudCddKSwKICAgICAgICAgICAgICAgICAgICAnZGViaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gJGFtb3VudCwKICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnQmlsbCBBcHByb3ZhbCA6OiBTdXBwbGllciBQYXlhYmxlIENyZWRpdCcsCiAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdwby1iaWxsJywKICAgICAgICAgICAgICAgICAgICAnc291cmNlJyA9PiAkcG9CaWxsLT5pZAogICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgJGVudHJ5ID0gc2F2ZUxlZGdlckVudHJpZXMoNSwgZGF0ZSgnWS1tLWQgSDppOnMnKSwgMSwgJycsICdCaWxsIEFwcHJvdmFsJywgJGFycmF5LCAkbW9kZWwtPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VfcmF0ZV9pZCwgMCwgMCwgMCwgZ2V0Q29zdENlbnRyZUNvbXBhbnkoJG1vZGVsLT5jb3N0X2NlbnRyZV9pZCkpOwogICAgICAgICAgICAgICAgaWYoJGVudHJ5WydzdWNjZXNzJ10pewogICAgICAgICAgICAgICAgICAgIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyRW50cnk6OnVwZGF0ZU9yQ3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3N1cHBsaWVyX2lkJyA9PiAkbW9kZWwtPnJlbFF1b3RhdGlvbi0+c3VwcGxpZXJfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdwdXJjaGFzZV9vcmRlcl9pZCcgPT4gJG1vZGVsLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdiaWxsLWFwcHJvdmFsJywKICAgICAgICAgICAgICAgICAgICAgICAgJ2VudHJ5X2lkJyA9PiAkZW50cnlbJ2VudHJ5J10tPmlkLAogICAgICAgICAgICAgICAgICAgIF0sWwogICAgICAgICAgICAgICAgICAgICAgICAndXBkYXRlZF9hdCcgPT4gZGF0ZSgnWS1tLWQgSDppOnMnKQogICAgICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgICAgICBzYXZlU3VwcGxpZXJMZWRnZXIoJG1vZGVsLT5yZWxRdW90YXRpb24tPnN1cHBsaWVyX2lkLCBkYXRlKCdZLW0tZCcpLCAwLCAkYW1vdW50LCAnJywgJycsICdCaWxsIEFwcHJvdmFsIDo6IFN1cHBsaWVyIFBheWFibGUgQ3JlZGl0JywgMCwgMCwgJG1vZGVsLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlX3JhdGVfaWQpOwogICAgICAgICAgICAgICAgfQogICAgLy9HUi9JUiBQcm9jZXNzCgoKICAgICAgICAgICAgICAgICRtZXNzYWdlID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiIGRhdGEtc3JjPSInLnJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywkbW9kZWwtPmlkKS4nP3ZpZXciIGRhdGEtdGl0bGU9IlB1cmNoYXNlIE9yZGVyIERldGFpbHMiPlJlZmVyZW5jZSBObzonLiRtb2RlbC0+cmVmZXJlbmNlX25vLicuIFdhaXRpbmcgZm9yIFBheW1lbnRzLjwvc3Bhbj4nOwogICAgICAgICAgICAgICAgQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJycsZ2V0TWFuYWdlckluZm8oJ0FjY291bnRzJyksJG1lc3NhZ2UsJ3VucmVhZCcsJ3NlbmQtdG8tYWNjb3VudHMnLCcnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9Iicucm91dGUoJ3Btcy5wdXJjaGFzZS5vcmRlci1saXN0LnNob3cnLCRtb2RlbC0+aWQpLic/dmlldyIgZGF0YS10aXRsZT0iUHVyY2hhc2UgT3JkZXIgRGV0YWlscyI+UmVmZXJlbmNlIE5vOicuJG1vZGVsLT5yZWZlcmVuY2Vfbm8uJy4nLiRwdXJjaGFzZU1lc3NhZ2UuJy48L3NwYW4+JzsKICAgICAgICAgICAgQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJycsZ2V0TWFuYWdlckluZm8oJ1B1cmNoYXNlLURlcGFydG1lbnQnKSwkbWVzc2FnZSwndW5yZWFkJywnc2VuZC10by1wdXJjaGFzZScsJycpOwoKICAgICAgICAgICAgREI6OmNvbW1pdCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYoIWVtcHR5KCRncm5JZCkpewogICAgICAgICAgICAgICAgc2Vzc2lvbigpLT5mbGFzaCgnYWxlcnQtdHlwZScsICdzdWNjZXNzJyk7CiAgICAgICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdtZXNzYWdlJywgIkJpbGxpbmcgSW52b2ljZSB1cGRhdGVkIHN1Y2Nlc3NmdWxseSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiQmlsbGluZyBJbnZvaWNlIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5IgogICAgICAgICAgICBdKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHBvQWR2YW5jZVVwZGF0ZUFjdGlvbiAoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsgICAKICAgICAgICAkaWQgPSAkcmVxdWVzdC0+cG9faWQ7CiAgICAgICAgJGJpbGxUeXBlID0gJHJlcXVlc3QtPmJpbGxfdHlwZTsKICAgICAgICAkc3RhdHVzID0gJHJlcXVlc3QtPnN0YXR1czsKCiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBTdXBwbGllclBheW1lbnQ6OndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsJGlkKQogICAgICAgICAgICAtPndoZXJlKCdiaWxsX3R5cGUnLCAkYmlsbFR5cGUpCiAgICAgICAgICAgIC0+dXBkYXRlKFsKICAgICAgICAgICAgICAgICdzdGF0dXMnID0+ICRzdGF0dXMsCiAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgLy9zdGFydCBzdXBwbGllciBwYXltZW50IHVwZGF0ZQogICAgICAgICAgICBpZiAoJHN0YXR1cyA9PSAncGVuZGluZycpIHsKICAgICAgICAgICAgICAgICRhdWRpdFN0YXR1cyA9ICdwZW5kaW5nJzsKICAgICAgICAgICAgICAgICRwdXJjaGFzZU1lc3NhZ2U9IkFkdmFuY2Ugc3RhdHVzIHVwZGF0ZWQgdG8gcGVuZGluZyI7CiAgICAgICAgICAgIH1lbHNlaWYoJHN0YXR1cyA9PSAnYXVkaXRlZCcpewogICAgICAgICAgICAgICAgJGF1ZGl0U3RhdHVzID0gJ2F1ZGl0ZWQnOwogICAgICAgICAgICAgICAgJHB1cmNoYXNlTWVzc2FnZT0iU3VjY2Vzc2Z1bGx5IGF1ZGl0ZWQgYnkgYXVkaXQgZGVwYXJ0bWVudCI7CiAgICAgICAgICAgIH1lbHNlaWYoJHN0YXR1cyA9PSAnY2FuY2VsZWQnKXsKICAgICAgICAgICAgICAgICRhdWRpdFN0YXR1cyA9ICdjYW5jZWxlZCc7CiAgICAgICAgICAgICAgICAkcHVyY2hhc2VNZXNzYWdlPSJUaGlzIEFkdmFuY2UgaGFsdCBieSBhdWRpdCBkZXBhcnRtZW50LiBQbGVhc2UgdXBsb2FkIGl0IGFnYWluLiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy9lbmQgc3VwcGxpZXIgcGF5bWVudCB1cGRhdGUKCiAgICAgICAgICAgICRtb2RlbCA9IFB1cmNoYXNlT3JkZXI6OndoZXJlKCdpZCcsJGlkKS0+Zmlyc3QoKTsKCiAgICAgICAgICAgIGlmICgkc3RhdHVzID09ICdhdWRpdGVkJykgewogICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9Iicucm91dGUoJ3Btcy5wdXJjaGFzZS5vcmRlci1saXN0LnNob3cnLCRtb2RlbC0+aWQpLic/dmlldyIgZGF0YS10aXRsZT0iUHVyY2hhc2UgT3JkZXIgRGV0YWlscyI+UmVmZXJlbmNlIE5vOicuJG1vZGVsLT5yZWZlcmVuY2Vfbm8uJy4gV2FpdGluZyBmb3IgUGF5bWVudHMuPC9zcGFuPic7CiAgICAgICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbignJyxnZXRNYW5hZ2VySW5mbygnQWNjb3VudHMnKSwkbWVzc2FnZSwndW5yZWFkJywnc2VuZC10by1hY2NvdW50cycsJycpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkbWVzc2FnZSA9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsJG1vZGVsLT5pZCkuJz92aWV3IiBkYXRhLXRpdGxlPSJQdXJjaGFzZSBPcmRlciBEZXRhaWxzIj5SZWZlcmVuY2UgTm86Jy4kbW9kZWwtPnJlZmVyZW5jZV9uby4nLicuJHB1cmNoYXNlTWVzc2FnZS4nLjwvc3Bhbj4nOwogICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbignJyxnZXRNYW5hZ2VySW5mbygnUHVyY2hhc2UtRGVwYXJ0bWVudCcpLCRtZXNzYWdlLCd1bnJlYWQnLCdzZW5kLXRvLXB1cmNoYXNlJywnJyk7CgogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICdBZHZhbmNlIFN0YXR1cyB1cGRhdGVkIHN1Y2Nlc3NmdWxseScKICAgICAgICAgICAgXSk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGhpc3RvcnkoJGlkKQogICAgewogICAgICAgIHRyeXsKCiAgICAgICAgICAgICR0aXRsZSA9ICJQdXJjaGFzZSBPcmRlciBIaXN0b3J5IjsKICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXIgPSBQdXJjaGFzZU9yZGVyOjp3aXRoKFsncmVsR29vZFJlY2VpdmVOb3RlJywncmVsR29vZFJlY2VpdmVOb3RlLnJlbFB1cmNoYXNlT3JkZXInLCdyZWxHb29kUmVjZWl2ZU5vdGUucmVsR29vZHNSZWNlaXZlZEl0ZW1zJ10pLT53aGVyZSgnaWQnLCRpZCkKICAgICAgICAgICAgLT5maXJzdCgpOwoKICAgICAgICAgICAgJHByb3Bvc2FscyA9IFJlcXVlc3RQcm9wb3NhbDo6d2l0aChbJ3JlcXVlc3RQcm9wb3NhbFJlcXVpc2l0aW9uLnJlbFJlcXVpc2l0aW9uLnJlbFVzZXJzTGlzdC5lbXBsb3llZS51bml0JywncmVsUXVvdGF0aW9ucy5yZWxTdXBwbGllcnMnXSkKICAgICAgICAgICAgLT53aGVyZUhhcygncmVsUXVvdGF0aW9ucycsZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHB1cmNoYXNlT3JkZXIpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3JlcXVlc3RfcHJvcG9zYWxfaWQnLCAoaXNzZXQoJHB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+cmVxdWVzdF9wcm9wb3NhbF9pZCkgPyAkcHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5yZXF1ZXN0X3Byb3Bvc2FsX2lkIDogMCkpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPm9yZGVyYnkoJ2lkJywnZGVzYycpLT5maXJzdCgpOwoKCiAgICAgICAgICAgICRiaWxsTWFuYWdlID0gUHVyY2hhc2VPcmRlcjo6d2l0aChbJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbicsCiAgICAgICAgICAgICAgICAncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsCiAgICAgICAgICAgICAgICAncmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScsCiAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlckl0ZW1zJywKICAgICAgICAgICAgICAgICdyZWxQb0F0dGFjaG1lbnQnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmUoJ2lzX3NlbmQnLCd5ZXMnKQogICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxHb29kUmVjZWl2ZU5vdGUnLGZ1bmN0aW9uICgkcXVlcnkpewogICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZVJhdygncHVyY2hhc2Vfb3JkZXJzLmlkPWdvb2RzX3JlY2VpdmVkX25vdGVzLnB1cmNoYXNlX29yZGVyX2lkJyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbicsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaXNfZ3JuX2NvbXBsZXRlJywneWVzJyktPndoZXJlKCd0b3RhbF9hbW91bnQnLCAnPicsIDApOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlKCdpZCcsJGlkKQogICAgICAgICAgICAtPmZpcnN0KCk7CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuYmlsbGluZy5wby1oaXN0b3J5Jyxjb21wYWN0KCd0aXRsZScsJ3B1cmNoYXNlT3JkZXInLCdwcm9wb3NhbHMnLCdiaWxsTWFuYWdlJykpOwogICAgICAgIH1jYXRjaChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhXYXJuaW5nKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9Cn0K