<?php
bolt_decrypt( __FILE__ , 'm5KZnK'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBDYWNoZSwgREI7CnVzZSBDYXJib25cQ2FyYm9uOwp1c2UgSWxsdW1pbmF0ZVxEYXRhYmFzZVxFbG9xdWVudFxCdWlsZGVyOwp1c2UgSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3Q7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ29tcGFueTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcTm90aWZpY2F0aW9uOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25EZWxpdmVyeUl0ZW07CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xHcm5cR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlcjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJmcFxSZXF1ZXN0UHJvcG9zYWw7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xRdW90YXRpb25zOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUXVvdGF0aW9uc0l0ZW1zOwp1c2UgQXBwXE1vZGVsc1xVc2VyQ29sdW1uVmlzaWJpbGl0eTsKdXNlIEFwcFxNb2RlbHNcU3lzdGVtSW5mb3JtYXRpb247CnVzZSBBcHBcTW9kdWxlOwp1c2UgQXBwXE1vZGVsc1xIclxVbml0Owp1c2UgQXV0aCwgRGF0YVRhYmxlczsKCmNsYXNzIFNCVUNvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyCnsgIAogICAgcHVibGljIGZ1bmN0aW9uIGhlYWRlckNvbHVtbnMoKQogICAgewogICAgICAgIHJldHVybiAgYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydjb21wYW55JywgJ2NvbXBhbnknLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydTQlVfY29kZScsICdTQlVfY29kZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ1NCVV9uYW1lJywgJ1NCVV9uYW1lJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnU0JVX3Nob3J0X25hbWUnLCAnU0JVX3Nob3J0X25hbWUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydTQlVfYWRkcmVzcycsICdTQlVfYWRkcmVzcycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ1NCVV90ZWxlcGhvbmUnLCAnU0JVX3RlbGVwaG9uZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3BhZCcsICdwYWQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhY3Rpb25zJywgJ2FjdGlvbnMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICApOwogICAgfQogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5kZXgoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICBpZihyZXF1ZXN0KCktPmhhcygndXBkYXRlLXBhZCcpKXsKICAgICAgICAgICAgJHVuaXRzID0gVW5pdDo6d2hlcmVOdWxsKCdwYWQnKS0+Z2V0KCk7CiAgICAgICAgICAgIGlmKGlzc2V0KCR1bml0c1swXSkpewogICAgICAgICAgICAgICAgZm9yZWFjaCgkdW5pdHMgYXMgJHVuaXQpewogICAgICAgICAgICAgICAgICAgICR1bml0LT5wYWQgPSAnYXNzZXRzL2lkY2FyZC9sZXR0ZXJoZWFkLycuJHVuaXQtPmhyX3VuaXRfc2hvcnRfbmFtZS4nLnBuZyc7CiAgICAgICAgICAgICAgICAgICAgJHVuaXQtPnNhdmUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJ29rJzsKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIERhdGF0YWJsZXM6Om9mKAogICAgICAgICAgICAgICAgICAgICAgICBVbml0Ojp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb21wYW55JwogICAgICAgICAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2NvbXBhbnlfaWQnLCBhdXRoKCktPnVzZXIoKS0+Y29tcGFuaWVzLT5wbHVjaygnY29tcGFueV9pZCcpLT50b0FycmF5KCkpCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQoKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignY29tcGFueScsIGZ1bmN0aW9uKCR1bml0KXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdbJy4kdW5pdC0+Y29tcGFueS0+Y29kZS4nXSAnLiR1bml0LT5jb21wYW55LT5uYW1lOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2NvbXBhbnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnY29tcGFueScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnY29kZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b3JXaGVyZSgnbmFtZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignY29tcGFueScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBDb21hcG55OjpzZWxlY3QoJ2NvbXBhbmllcy5jb2RlJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ2NvbXBhbmllcy5pZCcsICdocl91bml0LmNvbXBhbnlfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignU0JVX2NvZGUnLCBmdW5jdGlvbigkdW5pdCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkdW5pdC0+aHJfdW5pdF9jb2RlOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ1NCVV9jb2RlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfY29kZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdTQlVfY29kZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCdocl91bml0X2NvZGUnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdTQlVfbmFtZScsIGZ1bmN0aW9uKCR1bml0KXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR1bml0LT5ocl91bml0X25hbWU7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignU0JVX25hbWUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaHJfdW5pdF9uYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ1NCVV9uYW1lJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ2hyX3VuaXRfbmFtZScsICRvcmRlcik7CiAgICAgICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ1NCVV9zaG9ydF9uYW1lJywgZnVuY3Rpb24oJHVuaXQpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHVuaXQtPmhyX3VuaXRfc2hvcnRfbmFtZTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdTQlVfc2hvcnRfbmFtZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl91bml0X3Nob3J0X25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignU0JVX3Nob3J0X25hbWUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgnaHJfdW5pdF9zaG9ydF9uYW1lJywgJG9yZGVyKTsKICAgICAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignU0JVX2FkZHJlc3MnLCBmdW5jdGlvbigkdW5pdCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkdW5pdC0+aHJfdW5pdF9hZGRyZXNzOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ1NCVV9hZGRyZXNzJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfYWRkcmVzcycsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdTQlVfYWRkcmVzcycsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCdocl91bml0X2FkZHJlc3MnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdTQlVfdGVsZXBob25lJywgZnVuY3Rpb24oJHVuaXQpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHVuaXQtPmhyX3VuaXRfdGVsZXBob25lOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ1NCVV90ZWxlcGhvbmUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaHJfdW5pdF90ZWxlcGhvbmUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignU0JVX3RlbGVwaG9uZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCdocl91bml0X3RlbGVwaG9uZScsICRvcmRlcik7CiAgICAgICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdwYWQnLCBmdW5jdGlvbigkdW5pdCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhZW1wdHkoJHVuaXQtPnBhZCkgPyAnPGEgaHJlZj0iJy51cmwoJHVuaXQtPnBhZCkuJyIgdGFyZ2V0PSJfYmxhbmsiPjxpbWcgc3JjPSInLnVybCgkdW5pdC0+cGFkKS4nIiBzdHlsZT0iaGVpZ2h0OiAxMDBweCIvPjwvYT4nIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbigkdW5pdCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iJy51cmwoJ3Btcy9zYnUvJy4kdW5pdC0+aHJfdW5pdF9pZC4nL2VkaXQnKS4nIiBjbGFzcz0iYnRuIGJ0bi1pbmZvIGJ0bi14cyI+PGkgY2xhc3M9ImxhIGxhLWVkaXQiPjwvaT48L2E+PGEgY2xhc3M9ImJ0biBidG4teHMgYnRuLWRhbmdlciBtbC0yIiBvbmNsaWNrPSJkZWxldGVGcm9tQ1JVRCgkKHRoaXMpKSIgZGF0YS1zcmM9Iicucm91dGUoJ3Btcy5zYnUuZGVzdHJveScsICR1bml0LT5ocl91bml0X2lkKS4nIj48aSBjbGFzcz0ibGEgbGEtdHJhc2giPjwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydhY3Rpb25zJywgJ3BhZCddKQogICAgICAgICAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnNidS5pbmRleCcsIFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJ1NCVScsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPmhlYWRlckNvbHVtbnMoKQogICAgICAgICAgICBdKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGNyZWF0ZShSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5zYnUuY3JlYXRlJywgWwogICAgICAgICAgICAndGl0bGUnID0+ICJDcmVhdGUgTW9kdWxlIiwKICAgICAgICAgICAgJ2NvbXBhbmllcycgPT4gQ29tcGFueTo6YWxsKCksCiAgICAgICAgXSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHN0b3JlKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHRoaXMtPnZhbGlkYXRlKCRyZXF1ZXN0LCBbCiAgICAgICAgICAgICdjb21wYW55X2lkJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnaHJfdW5pdF9jb2RlJyA9PiAncmVxdWlyZWR8dW5pcXVlOmhyX3VuaXQnLAogICAgICAgICAgICAnaHJfdW5pdF9zaG9ydF9uYW1lJyA9PiAncmVxdWlyZWR8dW5pcXVlOmhyX3VuaXQnLAogICAgICAgICAgICAnaHJfdW5pdF9uYW1lJyA9PiAncmVxdWlyZWR8dW5pcXVlOmhyX3VuaXQnLAogICAgICAgICAgICAnaHJfdW5pdF9hZGRyZXNzJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnaHJfdW5pdF90ZWxlcGhvbmUnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgXSk7CgogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5ewogICAgICAgICAgICAkdW5pdCA9IG5ldyBVbml0KCk7CiAgICAgICAgICAgICR1bml0LT5maWxsKCRyZXF1ZXN0LT5hbGwoKSk7CiAgICAgICAgICAgICR1bml0LT5ocl91bml0X25hbWVfYm4gPSAkcmVxdWVzdC0+aHJfdW5pdF9uYW1lOwogICAgICAgICAgICAkdW5pdC0+aHJfdW5pdF9hZGRyZXNzX2JuID0gJHJlcXVlc3QtPmhyX3VuaXRfYWRkcmVzczsKICAgICAgICAgICAgJHVuaXQtPnNhdmUoKTsKCiAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFN1Y2Nlc3MoJ1NCVSBDcmVhdGVkIHN1Y2Nlc3NmdWxseScpOwogICAgICAgIH1jYXRjaCAoXEV4Y2VwdGlvbiAkZSl7CiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJGUtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBlZGl0KCRpZCkKICAgIHsKICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuc2J1LmVkaXQnLCBbCiAgICAgICAgICAgICd0aXRsZScgPT4gIkVkaXQgU0JVIiwKICAgICAgICAgICAgJ3VuaXQnID0+IFVuaXQ6OmZpbmRPckZhaWwoJGlkKSwKICAgICAgICAgICAgJ2NvbXBhbmllcycgPT4gQ29tcGFueTo6YWxsKCksCiAgICAgICAgXSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHVwZGF0ZShSZXF1ZXN0ICRyZXF1ZXN0LCAkaWQpCiAgICB7CiAgICAgICAgJHRoaXMtPnZhbGlkYXRlKCRyZXF1ZXN0LCBbCiAgICAgICAgICAgICdjb21wYW55X2lkJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnaHJfdW5pdF9jb2RlJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnaHJfdW5pdF9zaG9ydF9uYW1lJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnaHJfdW5pdF9uYW1lJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnaHJfdW5pdF9hZGRyZXNzJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnaHJfdW5pdF90ZWxlcGhvbmUnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgXSk7CgogICAgICAgIGlmKCRyZXF1ZXN0LT5oYXNGaWxlKCdwYWRfZmlsZScpKXsKICAgICAgICAgICAgJHRoaXMtPnZhbGlkYXRlKCRyZXF1ZXN0LCBbCiAgICAgICAgICAgICAgICAncGFkX2ZpbGUnID0+ICdyZXF1aXJlZHxpbWFnZXxtYXg6MTAyNDAnLAogICAgICAgICAgICBdKTsKICAgICAgICB9CgogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5ewogICAgICAgICAgICAkc2VhcmNoID0gVW5pdDo6d2hlcmUoZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHJlcXVlc3QpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2NvbXBhbnlfaWQnLCAkcmVxdWVzdC0+Y29tcGFueV9pZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdocl91bml0X2NvZGUnLCAkcmVxdWVzdC0+aHJfdW5pdF9jb2RlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b3JXaGVyZSgnaHJfdW5pdF9zaG9ydF9uYW1lJywgJHJlcXVlc3QtPmhyX3VuaXRfc2hvcnRfbmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPm9yV2hlcmUoJ2hyX3VuaXRfbmFtZScsICRyZXF1ZXN0LT5ocl91bml0X25hbWUpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlKCdocl91bml0X2lkJywgJyE9JywgJGlkKQogICAgICAgICAgICAtPmZpcnN0KCk7CiAgICAgICAgICAgIGlmKGlzc2V0KCRzZWFyY2gtPmhyX3VuaXRfaWQpKXsKICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigiU0JVIEFscmVhZHkgRXhpc3RzLiIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkdW5pdCA9IFVuaXQ6OmZpbmQoJGlkKTsKICAgICAgICAgICAgJHVuaXQtPmZpbGwoJHJlcXVlc3QtPmFsbCgpKTsKICAgICAgICAgICAgJHVuaXQtPmhyX3VuaXRfbmFtZV9ibiA9ICRyZXF1ZXN0LT5ocl91bml0X25hbWU7CiAgICAgICAgICAgICR1bml0LT5ocl91bml0X2FkZHJlc3NfYm4gPSAkcmVxdWVzdC0+aHJfdW5pdF9hZGRyZXNzOwogICAgICAgICAgICAkdW5pdC0+c2F2ZSgpOwoKICAgICAgICAgICAgaWYoJHJlcXVlc3QtPmhhc0ZpbGUoJ3BhZF9maWxlJykpewogICAgICAgICAgICAgICAgaWYoIWVtcHR5KCR1bml0LT5wYWQpKXsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+ZmlsZURlbGV0ZSgkdW5pdC0+cGFkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgJHVuaXQtPnBhZCA9ICR0aGlzLT5maWxlVXBsb2FkKCRyZXF1ZXN0LT5maWxlKCdwYWRfZmlsZScpLCAndXBsb2FkL3BhZHMnKTsKICAgICAgICAgICAgICAgICR1bml0LT5zYXZlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFN1Y2Nlc3MoJ1NCVSBVcGRhdGVkIHN1Y2Nlc3NmdWxseScpOwogICAgICAgIH1jYXRjaCAoXEV4Y2VwdGlvbiAkZSl7CiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJGUtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBkZXN0cm95KCRpZCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBVbml0Ojp3aGVyZSgnaHJfdW5pdF9pZCcsICRpZCktPmRlbGV0ZSgpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZQogICAgICAgICAgICBdKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJHRoLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgfQp9Cg==